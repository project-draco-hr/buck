{
  PartialGraph partialGraph;
  try {
    partialGraph=createPartialGraph(predicate,options);
  }
 catch (  NoSuchBuildTargetException e) {
    throw new HumanReadableException(e);
  }
  ExecutionContext executionContext=new ExecutionContext(options.getVerbosity(),getProjectFilesystem().getProjectRoot(),options.findAndroidPlatformTarget(partialGraph.getDependencyGraph(),stdErr),options.findAndroidNdkDir(),ansi,false,false,stdOut,stdErr);
  Project project=new Project(partialGraph,options.getBasePathToAliasMap(),options.getJavaPackageFinder(),executionContext,getProjectFilesystem(),options.getPathToDefaultAndroidManifest());
  File tempFile=new File(Files.createTempDir(),"project.json");
  int exitCode;
  try {
    exitCode=createIntellijProject(project,tempFile,console.getStdOut());
    if (exitCode != 0) {
      return exitCode;
    }
    List<String> additionalInitialTargets=ImmutableList.of();
    if (options.hasInitialTargets() || !additionalInitialTargets.isEmpty()) {
      BuildCommand buildCommand=new BuildCommand(stdOut,stdErr,console,getProjectFilesystem(),getBuildRuleTypes(),getArtifactCache());
      exitCode=runBuildCommand(buildCommand,options.createBuildCommandOptionsWithInitialTargets(additionalInitialTargets));
      if (exitCode != 0) {
        return exitCode;
      }
    }
  }
  finally {
    if (options.getVerbosity().shouldPrintOutput()) {
      stdErr.printf("project.json was written to %s",tempFile.getAbsolutePath());
    }
 else {
      tempFile.deleteOnExit();
    }
  }
  return 0;
}
