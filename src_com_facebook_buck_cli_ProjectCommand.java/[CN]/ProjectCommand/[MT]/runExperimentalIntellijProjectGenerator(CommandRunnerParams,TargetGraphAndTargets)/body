{
  TargetGraphToActionGraph targetGraphToActionGraph=new TargetGraphToActionGraph(params.getBuckEventBus(),new DefaultTargetNodeToBuildRuleTransformer());
  ActionGraphAndResolver result=Preconditions.checkNotNull(targetGraphToActionGraph.apply(targetGraphAndTargets.getTargetGraph()));
  BuildRuleResolver ruleResolver=result.getResolver();
  SourcePathResolver sourcePathResolver=new SourcePathResolver(ruleResolver);
  JavacOptions javacOptions=new JavaBuckConfig(params.getBuckConfig()).getDefaultJavacOptions();
  IjProject project=new IjProject(targetGraphAndTargets,getJavaPackageFinder(params.getBuckConfig()),JavaFileParser.createJavaFileParser(javacOptions),ruleResolver,sourcePathResolver,params.getCell().getFilesystem(),getIntellijAggregationMode(params.getBuckConfig()),params.getBuckConfig());
  ImmutableSet<BuildTarget> requiredBuildTargets=project.write(runIjCleaner);
  if (requiredBuildTargets.isEmpty()) {
    return 0;
  }
  return shouldProcessAnnotations() ? buildRequiredTargetsWithoutUsingCacheForAnnotatedTargets(params,targetGraphAndTargets,requiredBuildTargets) : runBuild(params,requiredBuildTargets);
}
