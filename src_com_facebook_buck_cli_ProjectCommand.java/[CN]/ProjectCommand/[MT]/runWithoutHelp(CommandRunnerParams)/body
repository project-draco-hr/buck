{
  Pair<ImmutableSet<BuildTarget>,TargetGraph> traversalResult=null;
  try {
    traversalResult=params.getParser().buildTargetGraphForTargetNodeSpecs(params.getBuckEventBus(),params.getCell(),getEnableProfiling(),parseArgumentsAsTargetNodeSpecs(params.getBuckConfig(),params.getCell().getFilesystem().getIgnorePaths(),getArguments()));
  }
 catch (  BuildTargetException|BuildFileParseException|HumanReadableException e) {
    params.getBuckEventBus().post(ConsoleEvent.severe(MoreExceptions.getHumanReadableOrLocalizedMessage(e)));
    return 1;
  }
  ImmutableSet<BuildTarget> passedInTargetsSet=traversalResult.getFirst();
  ProjectGraphParser projectGraphParser=ProjectGraphParsers.createProjectGraphParser(params.getParser(),params.getCell(),params.getBuckEventBus(),getEnableProfiling());
  Ide projectIde=getIdeFromBuckConfig(params.getBuckConfig()).orNull();
  boolean useExperimentalProjectGeneration=isExperimentalIntelliJProjectGenerationEnabled() || projectIde == Ide.XCODE;
  TargetGraph projectGraph=projectGraphParser.buildTargetGraphForTargetNodeSpecs(getTargetNodeSpecsForIde(passedInTargetsSet,params.getCell().getFilesystem().getIgnorePaths(),useExperimentalProjectGeneration));
  projectIde=getIdeBasedOnPassedInTargetsAndProjectGraph(params.getBuckConfig(),passedInTargetsSet,Optional.<TargetGraph>of(projectGraph));
  if (projectIde == ProjectCommand.Ide.XCODE) {
    useExperimentalProjectGeneration=true;
    checkForAndKillXcodeIfRunning(params,getIdePrompt(params.getBuckConfig()));
  }
  ProjectPredicates projectPredicates=ProjectPredicates.forIde(projectIde);
  ImmutableSet<BuildTarget> graphRoots;
  if (!passedInTargetsSet.isEmpty()) {
    ImmutableSet<BuildTarget> supplementalGraphRoots=ImmutableSet.of();
    if (projectIde == Ide.INTELLIJ && !useExperimentalProjectGeneration) {
      supplementalGraphRoots=getRootBuildTargetsForIntelliJ(projectIde,projectGraph,projectPredicates);
    }
    graphRoots=Sets.union(passedInTargetsSet,supplementalGraphRoots).immutableCopy();
  }
 else {
    graphRoots=getRootsFromPredicate(projectGraph,projectPredicates.getProjectRootsPredicate());
  }
  TargetGraphAndTargets targetGraphAndTargets=createTargetGraph(projectGraph,graphRoots,projectGraphParser,projectPredicates.getAssociatedProjectPredicate(),isWithTests(),isWithDependenciesTests(),params.getCell().getFilesystem().getIgnorePaths(),useExperimentalProjectGeneration);
  if (getDryRun()) {
    for (    TargetNode<?> targetNode : targetGraphAndTargets.getTargetGraph().getNodes()) {
      params.getConsole().getStdOut().println(targetNode.toString());
    }
    return 0;
  }
  params.getBuckEventBus().post(ProjectGenerationEvent.started());
  int result;
  try {
switch (projectIde) {
case INTELLIJ:
      result=runIntellijProjectGenerator(params,projectGraph,targetGraphAndTargets,passedInTargetsSet);
    break;
case XCODE:
  result=runXcodeProjectGenerator(params,targetGraphAndTargets,passedInTargetsSet);
break;
default :
throw new IllegalStateException("'ide' should always be of type 'INTELLIJ' or 'XCODE'");
}
}
  finally {
params.getBuckEventBus().post(ProjectGenerationEvent.finished());
}
return result;
}
