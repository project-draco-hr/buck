{
  ImmutableSet<BuildTarget> candidateTargets=filterTargetsFromGraph(fullGraph,predicate);
  TargetGraph candidateGraph=getParser().buildTargetGraphForBuildTargets(candidateTargets,options.getDefaultIncludes(),getBuckEventBus(),console,environment,options.getEnableProfiling());
  ImmutableSet.Builder<BuildTarget> rootsBuilder=ImmutableSet.builder();
  rootsBuilder.addAll(additionalRoots);
  ActionGraph actionGraph=targetGraph.getActionGraph();
  ActionGraph candidateActionGraph=candidateGraph.getActionGraph();
  for (  BuildTarget buildTarget : candidateTargets) {
    BuildRule buildRule=candidateActionGraph.findBuildRuleByTarget(buildTarget);
    if (buildRule != null && associatedRulePredicate.isMatch(buildRule,actionGraph)) {
      rootsBuilder.add(buildRule.getBuildTarget());
    }
  }
  return getParser().buildTargetGraphForBuildTargets(rootsBuilder.build(),options.getDefaultIncludes(),getBuckEventBus(),console,environment,options.getEnableProfiling());
}
