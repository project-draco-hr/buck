{
  checkForAndKillXcodeIfRunning(options.getIdePrompt());
  TargetGraphs targetGraphs;
  SourcePathResolver resolver;
  try {
    targetGraphs=createTargetGraphs(options);
    resolver=new SourcePathResolver(new BuildRuleResolver(targetGraphs.getProjectGraph().getActionGraph(getBuckEventBus()).getNodes()));
  }
 catch (  BuildTargetException|BuildFileParseException e) {
    throw new HumanReadableException(e);
  }
  ImmutableSet<BuildTarget> passedInTargetsSet;
  try {
    ImmutableSet<String> argumentsAsBuildTargets=options.getArgumentsFormattedAsBuildTargets();
    passedInTargetsSet=ImmutableSet.copyOf(getBuildTargets(argumentsAsBuildTargets));
  }
 catch (  NoSuchBuildTargetException e) {
    throw new HumanReadableException(e);
  }
  ExecutionContext executionContext=createExecutionContext(options,targetGraphs.getProjectGraph().getActionGraph(getBuckEventBus()));
  ImmutableSet.Builder<ProjectGenerator.Option> optionsBuilder=ImmutableSet.builder();
  if (options.getReadOnly()) {
    optionsBuilder.add(ProjectGenerator.Option.GENERATE_READ_ONLY_FILES);
  }
  if (options.isWithTests()) {
    optionsBuilder.add(ProjectGenerator.Option.INCLUDE_TESTS);
  }
  if (options.getCombinedProject() != null) {
    ProjectGenerator projectGenerator=new ProjectGenerator(resolver,targetGraphs.getProjectGraph().getActionGraph(getBuckEventBus()).getNodes(),passedInTargetsSet,getProjectFilesystem(),executionContext,getProjectFilesystem().getPathForRelativePath(Paths.get("_gen")),"GeneratedProject",optionsBuilder.addAll(ProjectGenerator.COMBINED_PROJECT_OPTIONS).build());
    projectGenerator.createXcodeProjects();
  }
 else   if (options.getWorkspaceAndProjects()) {
    ImmutableSet<BuildTarget> targets;
    if (passedInTargetsSet.isEmpty()) {
      targets=getAllTargetsOfType(targetGraphs.getMainGraph().getActionGraph(getBuckEventBus()).getNodes(),XcodeWorkspaceConfigDescription.TYPE);
    }
 else {
      targets=passedInTargetsSet;
    }
    LOG.debug("Generating workspace for config targets %s",targets);
    Map<BuildRule,ProjectGenerator> projectGenerators=new HashMap<>();
    for (    BuildTarget workspaceConfig : targets) {
      BuildRule workspaceRule=Preconditions.checkNotNull(targetGraphs.getMainGraph().getActionGraph(getBuckEventBus()).findBuildRuleByTarget(workspaceConfig));
      if (!(workspaceRule instanceof XcodeWorkspaceConfig)) {
        throw new HumanReadableException("%s must be a xcode_workspace_config",workspaceRule.getFullyQualifiedName());
      }
      Iterable<BuildRule> testBuildRules;
      if (targetGraphs.getTestGraph().isPresent()) {
        testBuildRules=targetGraphs.getTestGraph().get().getActionGraph(getBuckEventBus()).getNodes();
      }
 else {
        testBuildRules=Collections.emptySet();
      }
      XcodeWorkspaceConfig workspaceConfigRule=(XcodeWorkspaceConfig)workspaceRule;
      WorkspaceAndProjectGenerator generator=new WorkspaceAndProjectGenerator(resolver,getProjectFilesystem(),targetGraphs.getProjectGraph().getActionGraph(getBuckEventBus()),executionContext,workspaceConfigRule,optionsBuilder.build(),AppleBuildRules.getSourceRuleToTestRulesMap(testBuildRules),workspaceConfigRule.getExtraTests());
      generator.generateWorkspaceAndDependentProjects(projectGenerators);
    }
  }
 else {
    ImmutableSet<BuildTarget> targets;
    if (passedInTargetsSet.isEmpty()) {
      targets=getAllTargetsOfType(targetGraphs.getProjectGraph().getActionGraph(getBuckEventBus()).getNodes(),XcodeProjectConfigDescription.TYPE);
    }
 else {
      targets=passedInTargetsSet;
    }
    SeparatedProjectsGenerator projectGenerator=new SeparatedProjectsGenerator(resolver,getProjectFilesystem(),targetGraphs.getProjectGraph().getActionGraph(getBuckEventBus()),executionContext,targets,optionsBuilder.build());
    projectGenerator.generateProjects();
  }
  return 0;
}
