{
  Optional<ImmutableSet<BuildTarget>> buildTargets=getRootsFromOptions(options);
  ImmutableList.Builder<RuleJsonPredicate> predicateBuilder=ImmutableList.builder();
  ImmutableList.Builder<AssociatedRulePredicate> associatedRulePredicateBuilder=ImmutableList.builder();
  if (rulePredicate.isPresent() || associatedRulePredicate.isPresent()) {
    if (options.isWithTests()) {
      predicateBuilder.add(RuleJsonPredicates.isTestRule());
      associatedRulePredicateBuilder.add(AssociatedRulePredicates.associatedTestsRules());
    }
    predicateBuilder.add(rulePredicate.or(RuleJsonPredicates.alwaysTrue()));
    associatedRulePredicateBuilder.add(associatedRulePredicate.or(AssociatedRulePredicates.alwaysTrue()));
  }
  return PartialGraph.createPartialGraphs(buildTargets,rootsPredicate,predicateBuilder.build(),associatedRulePredicateBuilder.build(),getProjectFilesystem(),options.getDefaultIncludes(),getParser(),getBuckEventBus(),console,environment,options.getEnableProfiling());
}
