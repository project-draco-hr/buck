{
  if (isExperimentalIntelliJProjectGenerationEnabled()) {
    return runExperimentalIntellijProjectGenerator(params,targetGraphAndTargets);
  }
  ActionGraph actionGraph=new TargetGraphToActionGraph(params.getBuckEventBus(),new BuildTargetNodeToBuildRuleTransformer()).apply(targetGraphAndTargets.getTargetGraph());
  try (ExecutionContext executionContext=createExecutionContext(params)){
    Project project=new Project(new SourcePathResolver(new BuildRuleResolver(actionGraph.getNodes())),FluentIterable.from(actionGraph.getNodes()).filter(ProjectConfig.class).toSortedSet(Ordering.natural()),actionGraph,getBasePathToAliasMap(params.getBuckConfig()),getJavaPackageFinder(params.getBuckConfig()),executionContext,new FilesystemBackedBuildFileTree(params.getRepository().getFilesystem(),new ParserConfig(params.getBuckConfig()).getBuildFileName()),params.getRepository().getFilesystem(),getPathToDefaultAndroidManifest(params.getBuckConfig()),new IntellijConfig(params.getBuckConfig()),getPathToPostProcessScript(params.getBuckConfig()),new PythonBuckConfig(params.getBuckConfig(),new ExecutableFinder()).getPythonInterpreter(),params.getObjectMapper(),isAndroidAutoGenerateDisabled(params.getBuckConfig()));
    File tempDir=Files.createTempDir();
    File tempFile=new File(tempDir,"project.json");
    int exitCode;
    try {
      exitCode=project.createIntellijProject(tempFile,executionContext.getProcessExecutor(),!passedInTargetsSet.isEmpty(),params.getConsole().getStdOut(),params.getConsole().getStdErr());
      if (exitCode != 0) {
        return exitCode;
      }
      List<String> additionalInitialTargets=ImmutableList.of();
      if (shouldProcessAnnotations()) {
        try {
          additionalInitialTargets=getAnnotationProcessingTargets(projectGraph,passedInTargetsSet);
        }
 catch (        BuildTargetException|BuildFileParseException e) {
          throw new HumanReadableException(e);
        }
      }
      if (hasInitialTargets(params.getBuckConfig()) || !additionalInitialTargets.isEmpty()) {
        BuildCommand buildCommand=createBuildCommandOptionsWithInitialTargets(params.getBuckConfig(),additionalInitialTargets);
        exitCode=buildCommand.runWithoutHelp(params);
        if (exitCode != 0) {
          return exitCode;
        }
      }
    }
  finally {
      if (params.getConsole().getVerbosity().shouldPrintOutput()) {
        params.getConsole().getStdErr().printf("project.json was written to %s",tempFile.getAbsolutePath());
      }
 else {
        tempFile.delete();
        tempDir.delete();
      }
    }
    if (passedInTargetsSet.isEmpty()) {
      String greenStar=params.getConsole().getAnsi().asHighlightedSuccessText(" * ");
      params.getConsole().getStdErr().printf(params.getConsole().getAnsi().asHighlightedSuccessText("=== Did you know ===") + "\n" + greenStar+ "You can run `buck project <target>` to generate a minimal project "+ "just for that target.\n"+ greenStar+ "This will make your IDE faster when working on large projects.\n"+ greenStar+ "See buck project --help for more info.\n"+ params.getConsole().getAnsi().asHighlightedSuccessText("--=* Knowing is half the battle!")+ "\n");
    }
    return 0;
  }
 }
