{
  if (getArguments().isEmpty()) {
    params.getConsole().printBuildFailure("Must specify at least one build target to fetch.");
    return 1;
  }
  BuildEvent.Started started=BuildEvent.started(getArguments());
  if (params.getParser().getParseStartTime().isPresent()) {
    params.getBuckEventBus().post(started,params.getParser().getParseStartTime().get());
  }
 else {
    params.getBuckEventBus().post(started);
  }
  FetchTargetNodeToBuildRuleTransformer ruleGenerator=createFetchTransformer(params);
  TargetGraphToActionGraph transformer=new TargetGraphToActionGraph(params.getBuckEventBus(),ruleGenerator,params.getFileHashCache());
  ActionGraph actionGraph;
  ImmutableSet<BuildTarget> buildTargets;
  try {
    Pair<ImmutableSet<BuildTarget>,TargetGraph> result=params.getParser().buildTargetGraphForTargetNodeSpecs(parseArgumentsAsTargetNodeSpecs(params.getBuckConfig(),params.getRepository().getFilesystem().getIgnorePaths(),getArguments()),new ParserConfig(params.getBuckConfig()),params.getBuckEventBus(),params.getConsole(),params.getEnvironment(),getEnableProfiling());
    actionGraph=transformer.apply(result.getSecond());
    buildTargets=ruleGenerator.getDownloadableTargets();
  }
 catch (  BuildTargetException|BuildFileParseException e) {
    params.getConsole().printBuildFailureWithoutStacktrace(e);
    return 1;
  }
  int exitCode;
  try (CommandThreadManager pool=new CommandThreadManager("Fetch",getConcurrencyLimit(params.getBuckConfig()));Build build=createBuild(params.getBuckConfig(),actionGraph,params.getRepository().getFilesystem(),params.getAndroidPlatformTargetSupplier(),new CachingBuildEngine(pool.getExecutor(),params.getFileHashCache(),getBuildEngineMode().or(params.getBuckConfig().getBuildEngineMode()),params.getBuckConfig().getBuildDepFiles(),new InputBasedRuleKeyBuilderFactory(params.getFileHashCache(),new SourcePathResolver(transformer.getRuleResolver())),new DependencyFileRuleKeyBuilderFactory(params.getFileHashCache(),new SourcePathResolver(transformer.getRuleResolver()))),getArtifactCache(params),params.getConsole(),params.getBuckEventBus(),Optional.<TargetDevice>absent(),params.getPlatform(),params.getEnvironment(),params.getObjectMapper(),params.getClock(),Optional.<AdbOptions>absent(),Optional.<TargetDeviceOptions>absent())){
    exitCode=build.executeAndPrintFailuresToConsole(buildTargets,isKeepGoing(),params.getConsole(),getPathToBuildReport(params.getBuckConfig()));
  }
   params.getBuckEventBus().post(BuildEvent.finished(started,exitCode));
  return exitCode;
}
