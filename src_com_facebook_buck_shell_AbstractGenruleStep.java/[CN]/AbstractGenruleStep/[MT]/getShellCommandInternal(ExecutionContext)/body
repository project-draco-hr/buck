{
  String command;
  if (context.getPlatform() == Platform.WINDOWS) {
    String commandInUse;
    if (commandString.cmdExe.isPresent()) {
      commandInUse=commandString.cmdExe.get();
    }
 else     if (commandString.cmd.isPresent()) {
      commandInUse=commandString.cmd.get();
    }
 else {
      throw new HumanReadableException("You must specify either cmd_exe or cmd for genrule %s.",getFullyQualifiedName());
    }
    command=replaceMatches(context.getProjectFilesystem(),commandInUse);
    return ImmutableList.of("cmd.exe","/c",command);
  }
 else {
    String commandInUse;
    if (commandString.bash.isPresent()) {
      commandInUse=commandString.bash.get();
    }
 else     if (commandString.cmd.isPresent()) {
      commandInUse=commandString.cmd.get();
    }
 else {
      throw new HumanReadableException("You must specify either bash or cmd for genrule %s.",getFullyQualifiedName());
    }
    command=replaceMatches(context.getProjectFilesystem(),commandInUse);
    return ImmutableList.of("/bin/bash","-e","-c",command);
  }
}
