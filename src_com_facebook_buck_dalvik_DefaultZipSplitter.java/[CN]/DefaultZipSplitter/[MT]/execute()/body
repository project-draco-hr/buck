{
  ClasspathTraverser classpathTraverser=new DefaultClasspathTraverser();
  classpathTraverser.traverse(new ClasspathTraversal(inFiles){
    @Override public void visit(    FileLike entry){
      long entrySize=entry.getSize();
      if (entrySize > 0) {
        remainingSize+=entrySize;
      }
    }
  }
);
  primaryOut=newZipOutput(outPrimary);
  secondaryDexWriter.reset();
  try {
    for (    Path inFile : inFiles) {
      classpathTraverser.traverse(new ClasspathTraversal(Collections.singleton(inFile)){
        @Override public void visit(        FileLike entry) throws IOException {
          processEntry(entry);
        }
      }
);
      DefaultZipOutputStreamHelper currentSecondaryOut=secondaryDexWriter.getCurrentOutput();
      if (currentSecondaryOut != null && currentSecondaryOut.getCurrentSize() >= zipSizeSoftLimit) {
        secondaryDexWriter.finishCurrentZipFile();
      }
    }
  }
  finally {
    primaryOut.close();
    secondaryDexWriter.close();
  }
  return secondaryDexWriter.getFiles();
}
