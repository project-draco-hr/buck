{
  BuildRuleParams linkParams=params.copyWithChanges(OCAML_BYTECODE_LINK,addBytecodeFlavor(params.getBuildTarget()),ImmutableSortedSet.copyOf(pathResolver.filterBuildRuleInputs(allInputs)),ImmutableSortedSet.<BuildRule>of());
  ImmutableList<String> linkerInputs=FluentIterable.from(allInputs).transform(pathResolver.getPathFunction()).transform(Functions.toStringFunction()).toList();
  ImmutableList.Builder<String> flags=ImmutableList.builder();
  flags.addAll(ocamlContext.getFlags());
  flags.addAll(ocamlContext.getCommonCLinkerFlags());
  OCamlLink link=new OCamlLink(linkParams,pathResolver,new OCamlLinkStep.Args(cxxCompiler,ocamlContext.getOcamlBytecodeCompiler(),ocamlContext.getBytecodeOutput(),ocamlContext.getLinkableInput().getArgs(),linkerInputs,flags.build(),ocamlContext.isLibrary(),true));
  resolver.addToIndex(link);
  return link;
}
