def add_rule(rule, build_env):
    if ('name' not in rule):
        raise ValueError(("rules must contain the field 'name'.  Found %s." % rule))
    rule_name = rule['name']
    if (rule_name in build_env['RULES']):
        raise ValueError(('Duplicate rule definition found.  Found %s and %s' % (rule, build_env['RULES'][rule_name])))
    rule['buck_base_path'] = build_env['BASE']
    build_env['RULES'][rule_name] = rule
