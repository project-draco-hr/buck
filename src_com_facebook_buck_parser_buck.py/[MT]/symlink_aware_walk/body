def symlink_aware_walk(base):
    ' Recursive symlink aware version of `os.walk`.\n\n  Will not emit an entry for a directory it has previously visited.\n  '
    visited_dirs = set()
    for entry in os.walk(base, topdown=True, followlinks=True):
        (root, dirs, _files) = entry
        realdirpath = os.path.realpath(root)
        if (realdirpath in visited_dirs):
            dirs[:] = []
            continue
        visited_dirs.add(realdirpath)
        yield entry
    raise StopIteration
