{
  Optional<Path> path=propertyFinder.findDirectoryByPropertiesThenEnvironmentVariable("ndk.dir","ANDROID_NDK");
  if (path.isPresent()) {
    Path ndkPath=path.get();
    Optional<String> ndkVersionOptional=findNdkVersionFromPath(ndkPath);
    if (!ndkVersionOptional.isPresent()) {
      throw new HumanReadableException("Failed to read NDK version from %s",ndkPath);
    }
 else {
      String ndkVersion=ndkVersionOptional.get();
      if (targetNdkVersion.isPresent() && !targetNdkVersion.get().equals(ndkVersion)) {
        throw new HumanReadableException("Supported NDK version is %s but Buck is configured to use %s with " + "ndk.dir or ANDROID_NDK",targetNdkVersion.get(),ndkVersion);
      }
    }
  }
  return path;
}
