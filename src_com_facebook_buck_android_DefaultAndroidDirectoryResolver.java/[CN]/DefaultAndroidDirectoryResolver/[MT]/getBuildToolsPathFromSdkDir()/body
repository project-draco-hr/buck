{
  Path androidSdkDir=findAndroidSdkDir();
  Path buildToolsDir=androidSdkDir.resolve("build-tools");
  if (buildToolsDir.toFile().isDirectory()) {
    File[] directories=buildToolsDir.toFile().listFiles(new FileFilter(){
      @Override public boolean accept(      File pathname){
        return pathname.isDirectory();
      }
    }
);
    if (directories.length == 0) {
      throw new HumanReadableException(Joiner.on(System.getProperty("line.separator")).join("%s was empty, but should have contained a subdirectory with build tools.","Install them using the Android SDK Manager (%s)."),buildToolsDir,androidSdkDir.resolve("tools").resolve("android"));
    }
 else {
      return pickCorrectBuildToolsDir(ImmutableSet.copyOf(directories));
    }
  }
  if (targetBuildToolsVersion.isPresent()) {
    throw unableToFindTargetBuildTools();
  }
  return androidSdkDir.resolve("platform-tools");
}
