{
  String watchmanOutput="";
  EventBus eventBus=createStrictMock(EventBus.class);
  Process process=createWaitForProcessMock(watchmanOutput,1);
  replay(process);
  WatchmanWatcher watcher=createWatcher(eventBus,process);
  try {
    watcher.postEvents();
    fail("Should have thrown RuntimeException.");
  }
 catch (  RuntimeException e) {
    assertTrue("Should be Watchman failure.",e.getMessage().startsWith("Watchman failed"));
  }
}
