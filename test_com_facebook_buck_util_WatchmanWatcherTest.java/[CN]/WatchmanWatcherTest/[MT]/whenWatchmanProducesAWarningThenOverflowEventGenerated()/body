{
  String watchmanOutput=Joiner.on('\n').join("{\"files\": [","{","\"warning\": \"message\"","}","]}");
  Capture<WatchEvent<Path>> eventCapture=newCapture();
  EventBus eventBus=createStrictMock(EventBus.class);
  eventBus.post(capture(newCapture(CaptureType.NONE)));
  eventBus.post(capture(eventCapture));
  Process process=createProcessMock(watchmanOutput);
  expect(process.waitFor()).andReturn(0);
  expectLastCall();
  replay(eventBus,process);
  WatchmanWatcher watcher=createWatcher(eventBus,process,new IncrementingFakeClock(),new ObjectMapper(),10000,10000);
  watcher.postEvents();
  verify(eventBus,process);
  assertEquals("Should be overflow event.",StandardWatchEventKinds.OVERFLOW,eventCapture.getValue().kind());
}
