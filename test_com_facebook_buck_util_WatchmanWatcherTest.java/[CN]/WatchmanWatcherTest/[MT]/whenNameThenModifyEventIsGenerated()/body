{
  String watchmanOutput=Joiner.on('\n').join("{\"files\": [","{","\"name\": \"foo/bar/baz\"","}","]}");
  Capture<WatchEvent<Path>> eventCapture=newCapture();
  EventBus eventBus=createStrictMock(EventBus.class);
  eventBus.post(capture(eventCapture));
  Process process=createWaitForProcessMock(watchmanOutput);
  replay(eventBus,process);
  WatchmanWatcher watcher=createWatcher(eventBus,process,new IncrementingFakeClock(),new ObjectMapper());
  watcher.postEvents(new BuckEventBus(new FakeClock(0),new BuildId()));
  verify(eventBus,process);
  assertEquals("Should be modify event.",StandardWatchEventKinds.ENTRY_MODIFY,eventCapture.getValue().kind());
  assertEquals("Path should match watchman output.","foo/bar/baz",eventCapture.getValue().context().toString());
}
