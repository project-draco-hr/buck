{
  Process process=createProcessMock(output);
  if (exitCode != 0) {
    expect(process.getErrorStream()).andReturn(new ByteArrayInputStream("".getBytes(Charsets.US_ASCII)));
  }
  try {
    expect(process.waitFor()).andReturn(exitCode);
  }
 catch (  InterruptedException e) {
    fail("Should not throw exception.");
  }
  return process;
}
