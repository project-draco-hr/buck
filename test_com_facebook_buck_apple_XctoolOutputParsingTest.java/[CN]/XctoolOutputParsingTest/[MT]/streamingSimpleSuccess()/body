{
  Path jsonPath=TestDataHelper.getTestDataDirectory(this).resolve("xctool-output/simple-success.json");
  final List<Object> streamedObjects=new ArrayList<>();
  try (Reader jsonReader=Files.newBufferedReader(jsonPath,StandardCharsets.UTF_8)){
    XctoolOutputParsing.streamOutputFromReader(jsonReader,eventCallbackAddingEventsToList(streamedObjects));
  }
   assertThat(streamedObjects,hasSize(8));
  Iterator<Object> iter=streamedObjects.iterator();
  Object nextStreamedObject;
  nextStreamedObject=iter.next();
  assertThat(nextStreamedObject,instanceOf(XctoolOutputParsing.StatusEvent.class));
  XctoolOutputParsing.StatusEvent beginStatusEvent=(XctoolOutputParsing.StatusEvent)nextStreamedObject;
  assertThat(beginStatusEvent.timestamp,closeTo(1432065853.406129,EPSILON));
  assertThat(beginStatusEvent.message,equalTo("Collecting info for testables..."));
  assertThat(beginStatusEvent.level,equalTo("Info"));
  nextStreamedObject=iter.next();
  assertThat(nextStreamedObject,instanceOf(XctoolOutputParsing.StatusEvent.class));
  XctoolOutputParsing.StatusEvent endStatusEvent=(XctoolOutputParsing.StatusEvent)nextStreamedObject;
  assertThat(endStatusEvent.timestamp,closeTo(1432065854.077704,EPSILON));
  assertThat(endStatusEvent.message,equalTo("Collecting info for testables..."));
  assertThat(endStatusEvent.level,equalTo("Info"));
  nextStreamedObject=iter.next();
  assertThat(nextStreamedObject,instanceOf(XctoolOutputParsing.BeginOcunitEvent.class));
  XctoolOutputParsing.BeginOcunitEvent beginOcunitEvent=(XctoolOutputParsing.BeginOcunitEvent)nextStreamedObject;
  assertThat(beginOcunitEvent.timestamp,closeTo(1432065854.07812,EPSILON));
  nextStreamedObject=iter.next();
  assertThat(nextStreamedObject,instanceOf(XctoolOutputParsing.BeginTestSuiteEvent.class));
  XctoolOutputParsing.BeginTestSuiteEvent beginTestSuiteEvent=(XctoolOutputParsing.BeginTestSuiteEvent)nextStreamedObject;
  assertThat(beginTestSuiteEvent.timestamp,closeTo(1432065854.736793,EPSILON));
  assertThat(beginTestSuiteEvent.suite,equalTo("Toplevel Test Suite"));
  nextStreamedObject=iter.next();
  assertThat(nextStreamedObject,instanceOf(XctoolOutputParsing.BeginTestEvent.class));
  XctoolOutputParsing.BeginTestEvent beginTestEvent=(XctoolOutputParsing.BeginTestEvent)nextStreamedObject;
  assertThat(beginTestEvent.timestamp,closeTo(1432065854.739917,EPSILON));
  assertThat(beginTestEvent.test,equalTo("-[FooXCTest testTwoPlusTwoEqualsFour]"));
  assertThat(beginTestEvent.className,equalTo("FooXCTest"));
  assertThat(beginTestEvent.methodName,equalTo("testTwoPlusTwoEqualsFour"));
  nextStreamedObject=iter.next();
  assertThat(nextStreamedObject,instanceOf(XctoolOutputParsing.EndTestEvent.class));
  XctoolOutputParsing.EndTestEvent endTestEvent=(XctoolOutputParsing.EndTestEvent)nextStreamedObject;
  assertThat(endTestEvent.timestamp,closeTo(1432065854.740184,EPSILON));
  assertThat(endTestEvent.test,equalTo("-[FooXCTest testTwoPlusTwoEqualsFour]"));
  assertThat(endTestEvent.className,equalTo("FooXCTest"));
  assertThat(endTestEvent.methodName,equalTo("testTwoPlusTwoEqualsFour"));
  assertThat(endTestEvent.succeeded,is(true));
  assertThat(endTestEvent.exceptions,empty());
  assertThat(endTestEvent.totalDuration,closeTo(0.003052949905395508,EPSILON));
  nextStreamedObject=iter.next();
  assertThat(nextStreamedObject,instanceOf(XctoolOutputParsing.EndTestSuiteEvent.class));
  XctoolOutputParsing.EndTestSuiteEvent endTestSuiteEvent=(XctoolOutputParsing.EndTestSuiteEvent)nextStreamedObject;
  assertThat(endTestSuiteEvent.timestamp,closeTo(1432065854.740343,EPSILON));
  assertThat(endTestSuiteEvent.suite,equalTo("Toplevel Test Suite"));
  assertThat(endTestSuiteEvent.testCaseCount,equalTo(1));
  assertThat(endTestSuiteEvent.totalFailureCount,equalTo(0));
  assertThat(endTestSuiteEvent.unexpectedExceptionCount,equalTo(0));
  assertThat(endTestSuiteEvent.totalDuration,closeTo(0.003550052642822266,EPSILON));
  nextStreamedObject=iter.next();
  assertThat(nextStreamedObject,instanceOf(XctoolOutputParsing.EndOcunitEvent.class));
  XctoolOutputParsing.EndOcunitEvent endOcunitEvent=(XctoolOutputParsing.EndOcunitEvent)nextStreamedObject;
  assertThat(endOcunitEvent.timestamp,closeTo(1432065854.806839,EPSILON));
  assertThat(endOcunitEvent.message,nullValue(String.class));
  assertThat(endOcunitEvent.succeeded,is(true));
}
