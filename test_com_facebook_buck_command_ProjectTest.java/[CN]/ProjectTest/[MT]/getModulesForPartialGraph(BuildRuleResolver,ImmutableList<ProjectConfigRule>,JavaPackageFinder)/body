{
  if (javaPackageFinder == null) {
    javaPackageFinder=EasyMock.createMock(JavaPackageFinder.class);
  }
  DependencyGraph graph=RuleMap.createGraphFromBuildRules(ruleResolver);
  List<BuildTarget> targets=ImmutableList.copyOf(Iterables.transform(projectConfigs,new Function<ProjectConfigRule,BuildTarget>(){
    @Override public BuildTarget apply(    ProjectConfigRule rule){
      return rule.getBuildTarget();
    }
  }
));
  PartialGraph partialGraph=PartialGraphFactory.newInstance(graph,targets);
  ExecutionContext executionContext=EasyMock.createMock(ExecutionContext.class);
  ProjectFilesystem projectFilesystem=EasyMock.createMock(ProjectFilesystem.class);
  Properties keystoreProperties=new Properties();
  keystoreProperties.put("key.alias","androiddebugkey");
  keystoreProperties.put("key.store.password","android");
  keystoreProperties.put("key.alias.password","android");
  EasyMock.expect(projectFilesystem.readPropertiesFile("keystore/debug.keystore.properties")).andReturn(keystoreProperties).anyTimes();
  ImmutableMap<String,String> basePathToAliasMap=ImmutableMap.of();
  Project project=new Project(partialGraph,basePathToAliasMap,javaPackageFinder,executionContext,projectFilesystem,Optional.<String>absent(),Optional.<String>absent());
  EasyMock.replay(executionContext,projectFilesystem);
  List<Module> modules=project.createModulesForProjectConfigs();
  EasyMock.verify(executionContext,projectFilesystem);
  return new ProjectWithModules(project,ImmutableList.copyOf(modules));
}
