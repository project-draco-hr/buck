{
  Map<String,BuildRule> buildRuleIndex=Maps.newHashMap();
  JavaLibraryRule supportV4=DefaultJavaLibraryRule.newJavaLibraryRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//java/com/android/support/v4:v4")).addVisibilityPattern(BuildTargetPattern.MATCH_ALL).setArtifactCache(artifactCache).build(buildRuleIndex);
  buildRuleIndex.put(supportV4.getFullyQualifiedName(),supportV4);
  PrebuiltJarRule httpCore=PrebuiltJarRule.newPrebuiltJarRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//third_party/java/httpcore:httpcore")).setBinaryJar("httpcore-4.0.1.jar").addVisibilityPattern(BuildTargetPattern.MATCH_ALL).setArtifactCache(artifactCache).build(buildRuleIndex);
  buildRuleIndex.put(httpCore.getFullyQualifiedName(),httpCore);
  JavaLibraryRule robolectric=DefaultJavaLibraryRule.newJavaLibraryRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//third_party/java/robolectric:robolectric")).addDep("//java/com/android/support/v4:v4").addDep("//third_party/java/httpcore:httpcore").setArtifactCache(artifactCache).build(buildRuleIndex);
  buildRuleIndex.put(robolectric.getFullyQualifiedName(),robolectric);
  ProjectConfigRule projectConfig=ProjectConfigRule.newProjectConfigRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//third_party/java/robolectric:project_config")).setSrcTarget("//third_party/java/robolectric:robolectric").setSrcRoots(ImmutableList.of("src/main/java")).build(buildRuleIndex);
  buildRuleIndex.put(projectConfig.getFullyQualifiedName(),projectConfig);
  ProjectWithModules projectWithModules=getModulesForPartialGraph(buildRuleIndex,ImmutableList.of(projectConfig),null);
  List<Module> modules=projectWithModules.modules;
  assertEquals("Should be one module for the android_library",1,modules.size());
  Module robolectricModule=Iterables.getOnlyElement(modules);
  assertListEquals("It is imperative that httpcore-4.0.1.jar be listed before the support v4 library, " + "or else when robolectric is listed as a dependency, " + "org.apache.http.params.BasicHttpParams will be loaded from android.jar instead of "+ "httpcore-4.0.1.jar.",ImmutableList.of(DependentModule.newSourceFolder(),DependentModule.newLibrary(httpCore.getBuildTarget(),"httpcore_4_0_1"),DependentModule.newModule(supportV4.getBuildTarget(),"module_java_com_android_support_v4"),DependentModule.newStandardJdk()),robolectricModule.dependencies);
}
