{
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  JavaLibraryRule supportV4=ruleResolver.buildAndAddToIndex(DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(new FakeBuildRuleBuilderParams()).setBuildTarget(BuildTargetFactory.newInstance("//java/com/android/support/v4:v4")).addVisibilityPattern(BuildTargetPattern.MATCH_ALL));
  BuildRule httpCore=PrebuiltJarBuilder.createBuilder(BuildTargetFactory.newInstance("//third_party/java/httpcore:httpcore")).setBinaryJar(Paths.get("httpcore-4.0.1.jar")).build(ruleResolver);
  BuildTarget robolectricTarget=BuildTargetFactory.newInstance("//third_party/java/robolectric:robolectric");
  BuildRule robolectricRule=ruleResolver.buildAndAddToIndex(DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(new FakeBuildRuleBuilderParams()).setBuildTarget(robolectricTarget).addDep(BuildTargetFactory.newInstance("//java/com/android/support/v4:v4")).addDep(BuildTargetFactory.newInstance("//third_party/java/httpcore:httpcore")));
  BuildRule projectConfig=ruleResolver.addToIndex(ProjectConfigBuilder.newProjectConfigRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//third_party/java/robolectric:project_config")).setSrcRule(robolectricRule).setSrcRoots(ImmutableList.of("src/main/java")).build());
  ProjectWithModules projectWithModules=getModulesForPartialGraph(ruleResolver,ImmutableList.of(projectConfig),null);
  List<Module> modules=projectWithModules.modules;
  assertEquals("Should be one module for the android_library",1,modules.size());
  Module robolectricModule=Iterables.getOnlyElement(modules);
  assertListEquals("It is imperative that httpcore-4.0.1.jar be listed before the support v4 library, " + "or else when robolectric is listed as a dependency, " + "org.apache.http.params.BasicHttpParams will be loaded from android.jar instead of "+ "httpcore-4.0.1.jar.",ImmutableList.of(DependentModule.newSourceFolder(),DependentModule.newLibrary(httpCore.getBuildTarget(),"httpcore_4_0_1_jar"),DependentModule.newModule(supportV4.getBuildTarget(),"module_java_com_android_support_v4"),DependentModule.newStandardJdk()),robolectricModule.dependencies);
}
