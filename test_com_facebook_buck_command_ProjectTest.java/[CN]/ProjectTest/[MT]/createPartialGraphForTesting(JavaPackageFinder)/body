{
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  ruleResolver.buildAndAddToIndex(DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(BuildTargetFactory.newInstance("//buck-out/android/com/facebook:R")).addSrc(Paths.get("buck-out/android/com/facebook/R.java")).addVisibilityPattern(BuildTargetPattern.MATCH_ALL));
  guava=ruleResolver.buildAndAddToIndex(PrebuiltJarRule.newPrebuiltJarRuleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(BuildTargetFactory.newInstance("//third_party/guava:guava")).setBinaryJar(PATH_TO_GUAVA_JAR).addVisibilityPattern(BuildTargetPattern.MATCH_ALL));
  BuildRule androidResRule=ruleResolver.addToIndex(AndroidResourceRuleBuilder.newBuilder().setBuildTarget(BuildTargetFactory.newInstance("//android_res/base:res")).setRes(Paths.get("android_res/base/res")).setRDotJavaPackage("com.facebook").build());
  BuildRule projectConfigForResource=ruleResolver.addToIndex(ProjectConfigBuilder.newProjectConfigRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//android_res/base:project_config")).setSrcRule(androidResRule).setSrcRoots(ImmutableList.of("res")).build());
  BuildTarget grandchild=BuildTargetFactory.newInstance("//java/src/com/facebook/grandchild:grandchild");
  ruleResolver.buildAndAddToIndex(DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(grandchild).addSrc(Paths.get("Grandchild.java")).addVisibilityPattern(BuildTargetPattern.MATCH_ALL));
  ruleResolver.buildAndAddToIndex(DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(BuildTargetFactory.newInstance("//java/src/com/facebook/child:child")).addSrc(Paths.get("Child.java")).addDep(grandchild).addVisibilityPattern(BuildTargetPattern.MATCH_ALL));
  BuildRule exportLib=ruleResolver.buildAndAddToIndex(DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(BuildTargetFactory.newInstance("//java/src/com/facebook/exportlib:exportlib")).addSrc(Paths.get("ExportLib.java")).addDep(BuildTargetFactory.newInstance("//third_party/guava:guava")).addExportedDep(BuildTargetFactory.newInstance("//third_party/guava:guava")).addVisibilityPattern(BuildTargetPattern.MATCH_ALL));
  BuildRule baseRule=ruleResolver.buildAndAddToIndex(AndroidLibraryRule.newAndroidLibraryRuleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(BuildTargetFactory.newInstance("//java/src/com/facebook/base:base")).addSrc(Paths.get("Base.java")).addDep(BuildTargetFactory.newInstance("//buck-out/android/com/facebook:R")).addDep(BuildTargetFactory.newInstance("//java/src/com/facebook/exportlib:exportlib")).addDep(BuildTargetFactory.newInstance("//java/src/com/facebook/child:child")).addDep(BuildTargetFactory.newInstance("//android_res/base:res")).addVisibilityPattern(BuildTargetPattern.MATCH_ALL));
  BuildRule projectConfigForLibrary=ProjectConfigBuilder.newProjectConfigRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//java/src/com/facebook/base:project_config")).setSrcRule(baseRule).setSrcRoots(ImmutableList.of("src","src-gen")).build();
  ruleResolver.addToIndex(projectConfigForLibrary.getBuildTarget(),projectConfigForLibrary);
  BuildRule projectConfigForExportLibrary=ProjectConfigBuilder.newProjectConfigRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//java/src/com/facebook/exportlib:project_config")).setSrcRule(exportLib).setSrcRoots(ImmutableList.of("src")).build();
  ruleResolver.addToIndex(projectConfigForExportLibrary.getBuildTarget(),projectConfigForExportLibrary);
  BuildTarget keystoreTarget=BuildTargetFactory.newInstance("//keystore:debug");
  KeystoreBuilder.createBuilder(keystoreTarget).setStore(Paths.get("keystore/debug.keystore")).setProperties(Paths.get("keystore/debug.keystore.properties")).build(ruleResolver);
  BuildRule fooAppBuildRule=ruleResolver.buildAndAddToIndex(AndroidBinaryRule.newAndroidBinaryRuleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(BuildTargetFactory.newInstance("//foo:app")).addClasspathDep(BuildTargetFactory.newInstance("//java/src/com/facebook/base:base")).setManifest(new FileSourcePath("foo/AndroidManifest.xml")).setTarget("Google Inc.:Google APIs:16").setKeystore(keystoreTarget).addBuildRuleToExcludeFromDex(BuildTargetFactory.newInstance("//third_party/guava:guava")));
  BuildRule projectConfigUsingNoDx=ruleResolver.addToIndex(ProjectConfigBuilder.newProjectConfigRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//foo:project_config")).setSrcRule(fooAppBuildRule).build());
  BuildRule barAppBuildRule=ruleResolver.buildAndAddToIndex(AndroidBinaryRule.newAndroidBinaryRuleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(BuildTargetFactory.newInstance("//bar:app")).addClasspathDep(BuildTargetFactory.newInstance("//java/src/com/facebook/base:base")).setManifest(new FileSourcePath("foo/AndroidManifest.xml")).setTarget("Google Inc.:Google APIs:16").setKeystore(keystoreTarget));
  BuildRule projectConfig=ruleResolver.addToIndex(ProjectConfigBuilder.newProjectConfigRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//bar:project_config")).setSrcRule(barAppBuildRule).build());
  return getModulesForPartialGraph(ruleResolver,ImmutableList.of(projectConfigForExportLibrary,projectConfigForLibrary,projectConfigForResource,projectConfigUsingNoDx,projectConfig),javaPackageFinder);
}
