{
  BuildRuleBuilderParams buildRuleBuilderParams1=new BuildRuleBuilderParams();
  buildRuleBuilderParams1.buildAndAddToIndex(AndroidResourceRule.newAndroidResourceRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//resources/com/example:res")));
  ProjectConfigRule projectConfigNullSrcRoots=buildRuleBuilderParams1.buildAndAddToIndex(ProjectConfigRule.newProjectConfigRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//resources/com/example:project_config")).setSrcTarget(Optional.of("//resources/com/example:res")).setSrcRoots(null));
  ProjectWithModules projectWithModules1=getModulesForPartialGraph(buildRuleBuilderParams1,ImmutableList.of(projectConfigNullSrcRoots),null);
  assertEquals(1,projectWithModules1.modules.size());
  Module moduleNoJavaSource=projectWithModules1.modules.get(0);
  assertListEquals("Only source folder should be gen/ when setSrcRoots(null) is specified.",ImmutableList.of(SourceFolder.GEN),moduleNoJavaSource.sourceFolders);
  BuildRuleBuilderParams buildRuleBuilderParams2=new BuildRuleBuilderParams();
  buildRuleBuilderParams2.buildAndAddToIndex(AndroidLibraryRule.newAndroidLibraryRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//java/com/example/base:base")));
  ProjectConfigRule inPackageProjectConfig=buildRuleBuilderParams2.buildAndAddToIndex(ProjectConfigRule.newProjectConfigRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//java/com/example/base:project_config")).setSrcTarget(Optional.of("//java/com/example/base:base")).setSrcRoots(ImmutableList.<String>of()));
  JavaPackageFinder javaPackageFinder=EasyMock.createMock(JavaPackageFinder.class);
  EasyMock.expect(javaPackageFinder.findJavaPackageForPath("java/com/example/base/module_java_com_example_base.iml")).andReturn("com.example.base");
  EasyMock.replay(javaPackageFinder);
  ProjectWithModules projectWithModules2=getModulesForPartialGraph(buildRuleBuilderParams2,ImmutableList.of(inPackageProjectConfig),javaPackageFinder);
  EasyMock.verify(javaPackageFinder);
  assertEquals(1,projectWithModules2.modules.size());
  Module moduleWithPackagePrefix=projectWithModules2.modules.get(0);
  assertListEquals("The current directory should be a source folder with a package prefix " + "as well as the gen/ directory.",ImmutableList.of(new SourceFolder("file://$MODULE_DIR$",false,"com.example.base"),SourceFolder.GEN),moduleWithPackagePrefix.sourceFolders);
  BuildRuleBuilderParams buildRuleBuilderParams3=new BuildRuleBuilderParams();
  buildRuleBuilderParams3.buildAndAddToIndex(AndroidLibraryRule.newAndroidLibraryRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//java/com/example/base:base")));
  ProjectConfigRule hasSrcFolderProjectConfig=buildRuleBuilderParams3.buildAndAddToIndex(ProjectConfigRule.newProjectConfigRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//java/com/example/base:project_config")).setSrcTarget(Optional.of("//java/com/example/base:base")).setSrcRoots(ImmutableList.of("src")));
  ProjectWithModules projectWithModules3=getModulesForPartialGraph(buildRuleBuilderParams3,ImmutableList.of(hasSrcFolderProjectConfig),null);
  assertEquals(1,projectWithModules3.modules.size());
  Module moduleHasSrcFolder=projectWithModules3.modules.get(0);
  assertListEquals("Both src/ and gen/ should be source folders.",ImmutableList.of(new SourceFolder("file://$MODULE_DIR$/src",false),SourceFolder.GEN),moduleHasSrcFolder.sourceFolders);
}
