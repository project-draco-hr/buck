{
  Platform platform=Platform.detect();
  Optional<CxxPlatform.LinkerType> linkerType=Optional.absent();
  CxxPlatform.Builder builder=CxxPlatform.builder();
  builder.setFlavor(flavor).setAs(getTool(flavor,"as",config).or(defaultPlatform.getAs())).setAspp(getTool(flavor,"aspp",config).or(defaultPlatform.getAspp())).setCc(getTool(flavor,"cc",config).transform(getCompiler(defaultPlatform.getCc().getClass())).or(defaultPlatform.getCc())).setCxx(getTool(flavor,"cxx",config).transform(getCompiler(defaultPlatform.getCxx().getClass())).or(defaultPlatform.getCxx())).setCpp(getTool(flavor,"cpp",config).or(defaultPlatform.getCpp())).setCxxpp(getTool(flavor,"cxxpp",config).or(defaultPlatform.getCxxpp())).setCxxld(getTool(flavor,"cxxld",config).or(defaultPlatform.getCxxld())).setLd(getLd(flavor,platform,config,linkerType,getTool(flavor,"ld",config).or(defaultPlatform.getLd().getTool()))).setAr(new GnuArchiver(getTool(flavor,"ar",config).or(defaultPlatform.getAr()))).setStrip(getTool(flavor,"strip",config).or(defaultPlatform.getStrip())).setLex(getTool(flavor,"lex",config).or(defaultPlatform.getLex())).setYacc(getTool(flavor,"yacc",config).or(defaultPlatform.getYacc())).setSharedLibraryExtension(defaultPlatform.getSharedLibraryExtension()).setDebugPathSanitizer(defaultPlatform.getDebugPathSanitizer());
  if (config.getDefaultPlatform().isPresent()) {
    CxxPlatforms.addToolFlagsFromCxxPlatform(builder,defaultPlatform);
  }
  CxxPlatforms.addToolFlagsFromConfig(config,builder);
  return builder.build();
}
