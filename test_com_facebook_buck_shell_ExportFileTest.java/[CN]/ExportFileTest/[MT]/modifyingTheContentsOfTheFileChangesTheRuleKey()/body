{
  Path root=Files.createTempDirectory("root");
  FakeProjectFilesystem filesystem=new FakeProjectFilesystem(root.toFile());
  Path temp=Paths.get("example_file");
  FileHashCache hashCache=new DefaultFileHashCache(filesystem);
  SourcePathResolver resolver=new SourcePathResolver(new BuildRuleResolver());
  RuleKeyBuilderFactory ruleKeyFactory=new DefaultRuleKeyBuilderFactory(hashCache,resolver);
  filesystem.writeContentsToPath("I like cheese",temp);
  ExportFileBuilder builder=ExportFileBuilder.newExportFileBuilder(BuildTargetFactory.newInstance("//some:file")).setSrc(new PathSourcePath(filesystem,temp));
  ExportFile rule=(ExportFile)builder.build(new BuildRuleResolver(),filesystem);
  RuleKey original=ruleKeyFactory.newInstance(rule).build();
  filesystem.writeContentsToPath("I really like cheese",temp);
  rule=(ExportFile)builder.build(new BuildRuleResolver(),filesystem);
  hashCache=new DefaultFileHashCache(filesystem);
  resolver=new SourcePathResolver(new BuildRuleResolver());
  ruleKeyFactory=new DefaultRuleKeyBuilderFactory(hashCache,resolver);
  RuleKey refreshed=ruleKeyFactory.newInstance(rule).build();
  assertNotEquals(original,refreshed);
}
