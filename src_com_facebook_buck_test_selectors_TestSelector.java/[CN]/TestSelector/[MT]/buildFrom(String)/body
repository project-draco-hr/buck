{
  if (rawSelectorString == null || rawSelectorString.isEmpty()) {
    throw new RuntimeException("Cannot build from a null or empty string!");
  }
  int hashCount=0;
  for (int position=0; position < rawSelectorString.length(); position++) {
    if (rawSelectorString.charAt(position) == '#') {
      hashCount++;
    }
  }
  if (hashCount > 1) {
    throw new TestSelectorParseException(String.format("Test selector '%s' contains more than one '#'!",rawSelectorString));
  }
  boolean isInclusive=true;
  String remainder;
  if (rawSelectorString.charAt(0) == '!') {
    isInclusive=false;
    remainder=rawSelectorString.substring(1);
  }
 else {
    remainder=rawSelectorString;
  }
  Pattern classPattern=null;
  Pattern methodPattern=null;
  String[] parts=remainder.split("#");
  try {
switch (parts.length) {
case 0:
      break;
case 1:
    classPattern=Pattern.compile(parts[0]);
  break;
case 2:
classPattern=parts[0].isEmpty() ? null : Pattern.compile(parts[0]);
methodPattern=Pattern.compile(parts[1]);
break;
}
}
 catch (PatternSyntaxException e) {
throw new TestSelectorParseException(String.format("Regular expression error in '%s': %s",rawSelectorString,e.getMessage()));
}
return new TestSelector(isInclusive,classPattern,methodPattern);
}
