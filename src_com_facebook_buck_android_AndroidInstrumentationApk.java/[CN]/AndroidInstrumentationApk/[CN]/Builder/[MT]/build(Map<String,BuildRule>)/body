{
  BuildRule apkRule=buildRuleIndex.get(this.apk);
  if (apkRule == null) {
    throw new HumanReadableException("Must specify apk for " + getBuildTarget());
  }
 else   if (!(apkRule instanceof InstallableBuildRule)) {
    throw new HumanReadableException("In %s, apk='%s' must be an android_binary() or apk_genrule() but was %s().",getBuildTarget(),apkRule.getFullyQualifiedName(),apkRule.getType().getDisplayName());
  }
  AndroidBinaryRule underlyingApk=getUnderlyingApk((InstallableBuildRule)apkRule);
  return new AndroidInstrumentationApk(createCachingBuildRuleParams(buildRuleIndex),manifest,underlyingApk);
}
