{
  if (!(env instanceof BuckQueryEnvironment)) {
    throw new QueryException("The environment should be an instance of BuckQueryEnvironment");
  }
  BuckQueryEnvironment buckEnv=(BuckQueryEnvironment)env;
  Set<T> targets=args.get(0).getExpression().eval(env);
  Set<T> tests=new LinkedHashSet<>();
  for (  T target : targets) {
    TargetNode<?> node=buckEnv.getNode((QueryTarget)target);
    tests.addAll((Collection<T>)buckEnv.getTargetsFromBuildTargetsContainer(TargetNodes.getTestTargetsForNode(node)));
  }
  return tests;
}
