{
  Map<BuildTarget,BuildRule> buildRuleIndex=Maps.newHashMap();
  BuildRuleResolver ruleResolver=new BuildRuleResolver(buildRuleIndex);
  ProjectFilesystem projectFilesystem=EasyMock.createMock(ProjectFilesystem.class);
  EasyMock.expect(projectFilesystem.getPathRelativizer()).andReturn(Functions.<String>identity());
  BuildTargetParser buildTargetParser=new BuildTargetParser(projectFilesystem){
    @Override public BuildTarget parse(    String buildTargetName,    ParseContext parseContext) throws NoSuchBuildTargetException {
      return BuildTargetFactory.newInstance(buildTargetName);
    }
  }
;
  Map<String,?> instance=ImmutableMap.of("vm_args",ImmutableList.of("-Dbuck.robolectric_dir=javatests/com/facebook/base"),"source_under_test",ImmutableList.of("//java/com/facebook/base:base"));
  BuildTarget buildTarget=BuildTargetFactory.newInstance("//javatests/com/facebook/base:base");
  BuildFileTree buildFileTree=EasyMock.createMock(BuildFileTree.class);
  EasyMock.replay(projectFilesystem,buildFileTree);
  BuildRuleFactoryParams params=new BuildRuleFactoryParams(instance,projectFilesystem,buildFileTree,buildTargetParser,buildTarget);
  RobolectricTestBuildRuleFactory factory=new RobolectricTestBuildRuleFactory();
  RobolectricTestRule.Builder builder=factory.newBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(buildTarget);
  factory.amendBuilder(builder,params);
  BuildRule base=new FakeJavaLibraryRule(BuildRuleType.ANDROID_LIBRARY,buildTarget,ImmutableSortedSet.<BuildRule>of(),ImmutableSet.<BuildTargetPattern>of());
  buildRuleIndex.put(BuildTargetFactory.newInstance("//java/com/facebook/base:base"),base);
  RobolectricTestRule robolectricRule=(RobolectricTestRule)ruleResolver.buildAndAddToIndex(builder);
  assertEquals(ImmutableList.of("-Dbuck.robolectric_dir=javatests/com/facebook/base"),robolectricRule.getVmArgs());
  assertEquals(ImmutableSet.of(base),robolectricRule.getSourceUnderTest());
  EasyMock.verify(projectFilesystem,buildFileTree);
}
