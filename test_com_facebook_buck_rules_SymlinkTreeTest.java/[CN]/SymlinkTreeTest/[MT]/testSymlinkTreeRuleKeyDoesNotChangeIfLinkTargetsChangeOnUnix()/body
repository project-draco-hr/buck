{
  SourcePathResolver resolver=new SourcePathResolver(new BuildRuleResolver(ImmutableSet.of(symlinkTreeBuildRule)));
  RuleKeyBuilderFactory ruleKeyBuilderFactory=new DefaultRuleKeyBuilderFactory(FakeFileHashCache.createFromStrings(ImmutableMap.<String,String>of()),resolver);
  RuleKey.Builder builder1=ruleKeyBuilderFactory.newInstance(symlinkTreeBuildRule);
  RuleKeyPair pair1=builder1.build();
  Path existingFile=projectFilesystem.resolve(new SourcePathResolver(new BuildRuleResolver()).getPath(links.values().asList().get(0)));
  Files.write(existingFile,"something new".getBytes(Charsets.UTF_8));
  RuleKey.Builder builder2=ruleKeyBuilderFactory.newInstance(symlinkTreeBuildRule);
  RuleKeyPair pair2=builder2.build();
  assertEquals(pair1.getTotalRuleKey(),pair2.getTotalRuleKey());
  assertEquals(pair1.getRuleKeyWithoutDeps(),pair2.getRuleKeyWithoutDeps());
}
