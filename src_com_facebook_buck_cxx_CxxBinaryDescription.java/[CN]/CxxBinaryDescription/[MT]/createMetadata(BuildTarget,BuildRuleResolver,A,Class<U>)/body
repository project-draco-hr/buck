{
  if (buildTarget.getFlavors().contains(CxxInferEnhancer.InferFlavors.INFER_CAPTURE_ALL.get())) {
    CxxPlatform cxxPlatform=cxxPlatforms.getValue(buildTarget.getFlavors()).or(defaultCxxPlatform);
    return Optional.of(CxxInferEnhancer.collectSourcesOverDependencies(buildTarget,resolver,cxxPlatform,args)).transform(new Function<CxxSourceSet,U>(){
      @Override public U apply(      CxxSourceSet input){
        return metadataClass.cast(input);
      }
    }
);
  }
  if (!metadataClass.isAssignableFrom(CxxCompilationDatabaseDependencies.class) || !buildTarget.getFlavors().contains(CxxCompilationDatabase.COMPILATION_DATABASE)) {
    return Optional.absent();
  }
  return CxxDescriptionEnhancer.createCompilationDatabaseDependencies(buildTarget,cxxPlatforms,resolver,args).transform(new Function<CxxCompilationDatabaseDependencies,U>(){
    @Override public U apply(    CxxCompilationDatabaseDependencies input){
      return metadataClass.cast(input);
    }
  }
);
}
