{
  BuildTarget target=createCompileBuildTarget(params.getBuildTarget(),source.getName(),pic);
  boolean cxx=!Files.getFileExtension(source.getName()).equals("c");
  BuildRuleParams compileParams=params.copyWithChanges(COMPILE_TYPE,target,ImmutableSortedSet.<BuildRule>of(),ImmutableSortedSet.<BuildRule>naturalOrder().addAll(SourcePaths.filterBuildRuleInputs(ImmutableList.of(source.getSource()))).addAll(BuildRules.toBuildRulesFor(params.getBuildTarget(),resolver,preprocessorInput.getRules(),false)).build());
  return new CxxCompile(compileParams,compiler,ImmutableList.<String>builder().add("-x",cxx ? "c++" : "c").addAll((pic ? Optional.of("-fPIC") : Optional.<String>absent()).asSet()).addAll(cxx ? preprocessorInput.getCxxppflags() : preprocessorInput.getCppflags()).addAll(compilerFlags).build(),getCompileOutputPath(target,source.getName()),source.getSource(),preprocessorInput.getIncludes(),preprocessorInput.getSystemIncludes());
}
