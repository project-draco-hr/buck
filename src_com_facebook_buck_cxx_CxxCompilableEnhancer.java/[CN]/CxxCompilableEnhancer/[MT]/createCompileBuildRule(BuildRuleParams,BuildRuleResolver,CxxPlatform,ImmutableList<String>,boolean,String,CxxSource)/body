{
  SourcePathResolver pathResolver=new SourcePathResolver(resolver);
  Preconditions.checkArgument(CxxSourceTypes.isCompilableType(source.getType()));
  BuildTarget target=createCompileBuildTarget(params.getBuildTarget(),platform.asFlavor(),name,pic);
  ImmutableSortedSet.Builder<BuildRule> dependencies=ImmutableSortedSet.naturalOrder();
  dependencies.addAll(pathResolver.filterBuildRuleInputs(ImmutableList.of(source.getPath())));
  SourcePath compiler;
  if (CxxSourceTypes.needsCxxCompiler(source.getType())) {
    compiler=platform.getCxx();
  }
 else {
    compiler=platform.getCc();
  }
  ImmutableList.Builder<String> args=ImmutableList.builder();
  args.add("-x",source.getType().getLanguage());
  if (source.getType() == CxxSource.Type.C_CPP_OUTPUT) {
    args.addAll(platform.getCflags());
  }
  if (source.getType() == CxxSource.Type.CXX_CPP_OUTPUT) {
    args.addAll(platform.getCxxflags());
  }
  if (source.getType() == CxxSource.Type.C_CPP_OUTPUT || source.getType() == CxxSource.Type.CXX_CPP_OUTPUT) {
    args.addAll(compilerFlags);
  }
  args.addAll(iXassembler(platform.getAsflags()));
  if (pic) {
    args.add("-fPIC");
  }
  return new CxxCompile(params.copyWithChanges(COMPILE_TYPE,target,dependencies.build(),ImmutableSortedSet.<BuildRule>of()),pathResolver,compiler,Optional.<CxxCompile.Plugin>absent(),args.build(),getCompileOutputPath(target,name),source.getPath());
}
