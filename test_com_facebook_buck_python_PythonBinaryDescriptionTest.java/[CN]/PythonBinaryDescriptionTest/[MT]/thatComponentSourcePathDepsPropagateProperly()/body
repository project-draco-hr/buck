{
  BuildRuleResolver resolver=new BuildRuleResolver();
  Genrule genrule=GenruleBuilder.createGenrule(BuildTargetFactory.newInstance("//:gen")).setOut("blah.py").build();
  BuildRuleParams libParams=BuildRuleParamsFactory.createTrivialBuildRuleParams(BuildTargetFactory.newInstance("//:lib"));
  PythonLibrary lib=new PythonLibrary(libParams,ImmutableMap.<Path,SourcePath>of(Paths.get("hello"),new BuildRuleSourcePath(genrule)),ImmutableMap.<Path,SourcePath>of());
  BuildRuleParams params=new FakeBuildRuleParamsBuilder(BuildTargetFactory.newInstance("//:bin")).setDeps(ImmutableSortedSet.<BuildRule>of(lib)).build();
  PythonBinaryDescription desc=new PythonBinaryDescription(PEX_PATH,new PythonEnvironment(Paths.get("fake_python"),new PythonVersion("Python 2.7")));
  PythonBinaryDescription.Arg arg=desc.createUnpopulatedConstructorArg();
  arg.deps=Optional.of(ImmutableSortedSet.<BuildRule>of());
  arg.main=new TestSourcePath("blah.py");
  BuildRule rule=desc.createBuildRule(params,resolver,arg);
  assertEquals(ImmutableSortedSet.<BuildRule>of(genrule),rule.getDeps());
}
