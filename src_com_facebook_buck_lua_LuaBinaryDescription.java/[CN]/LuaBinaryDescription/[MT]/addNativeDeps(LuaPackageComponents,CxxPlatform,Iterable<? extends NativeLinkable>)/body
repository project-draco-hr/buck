{
  Map<String,SourcePath> nativeLibs=Maps.newLinkedHashMap();
  nativeLibs.putAll(components.getNativeLibraries());
  for (  NativeLinkable nativeLinkable : NativeLinkables.getTransitiveNativeLinkables(cxxPlatform,nativeDeps).values()) {
    NativeLinkable.Linkage linkage=nativeLinkable.getPreferredLinkage(cxxPlatform);
    if (linkage != NativeLinkable.Linkage.STATIC) {
      nativeLibs.putAll(nativeLinkable.getSharedLibraries(cxxPlatform));
    }
  }
  return components.withNativeLibraries(nativeLibs);
}
