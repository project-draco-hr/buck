{
  SourcePathResolver pathResolver=new SourcePathResolver(resolver);
  CxxPlatform cxxPlatform=cxxPlatforms.getValue(params.getBuildTarget()).or(defaultCxxPlatform);
  LuaPackageComponents components=getPackageComponentsFromDeps(params.getDeps(),cxxPlatform);
  StarterType starterType=getStarterType(components);
  Optional<BuildTarget> nativeStarterLibrary=args.nativeStarterLibrary.or(luaConfig.getNativeStarterLibrary());
  if (starterType == StarterType.NATIVE) {
    components=addNativeDeps(components,cxxPlatform,getNativeStarterDeps(resolver,nativeStarterLibrary));
  }
  Tool binary=getInPlaceBinary(params,resolver,pathResolver,cxxPlatform,starterType,nativeStarterLibrary,args.mainModule,components);
  return new LuaBinary(params.appendExtraDeps(binary.getDeps(pathResolver)),pathResolver,getOutputPath(params.getBuildTarget(),params.getProjectFilesystem()),binary,args.mainModule,components,luaConfig.getLua(resolver));
}
