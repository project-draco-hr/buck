{
  Verbosity verbosity=console.getVerbosity();
  Logging.setLoggingLevelForVerbosity(verbosity);
  ArtifactCache artifactCache=getArtifactCache();
  try {
    buildTargets=getBuildTargets(options.getArgumentsFormattedAsBuildTargets());
  }
 catch (  NoSuchBuildTargetException e) {
    console.printBuildFailureWithoutStacktrace(e);
    return 1;
  }
  if (buildTargets.isEmpty()) {
    console.printBuildFailure("Must specify at least one build target.");
    ImmutableSet<String> aliases=options.getBuckConfig().getAliases();
    if (!aliases.isEmpty()) {
      console.getStdErr().println(String.format("Try building one of the following targets:\n%s",Joiner.on(' ').join(Iterators.limit(aliases.iterator(),10))));
    }
    return 1;
  }
  if (getParser().getParseStartTime().isPresent()) {
    getBuckEventBus().post(BuildEvent.started(buildTargets),getParser().getParseStartTime().get());
  }
 else {
    getBuckEventBus().post(BuildEvent.started(buildTargets));
  }
  DependencyGraph dependencyGraph;
  try {
    dependencyGraph=getParser().parseBuildFilesForTargets(buildTargets,options.getDefaultIncludes(),getBuckEventBus());
  }
 catch (  BuildTargetException|BuildFileParseException e) {
    console.printBuildFailureWithoutStacktrace(e);
    return 1;
  }
  final SetMultimap<String,String> missingSymbols=Multimaps.synchronizedSetMultimap(HashMultimap.<String,String>create());
  Object missingSymbolsListener=new Object(){
    @Subscribe public void collectMissingSymbol(    MissingSymbolEvent event){
      missingSymbols.put(event.getTarget(),event.getSymbol());
    }
  }
;
  getBuckEventBus().register(missingSymbolsListener);
  build=options.createBuild(options.getBuckConfig(),dependencyGraph,getProjectFilesystem(),getAndroidDirectoryResolver(),getBuildEngine(),artifactCache,console,getBuckEventBus(),Optional.<TargetDevice>absent(),getCommandRunnerParams().getPlatform(),getCommandRunnerParams().getEnvironment());
  int exitCode=0;
  try {
    exitCode=executeBuildAndPrintAnyFailuresToConsole(buildTargets,build,console);
  }
  finally {
    build.close();
    getBuckEventBus().unregister(missingSymbolsListener);
  }
  getBuckEventBus().post(BuildEvent.finished(buildTargets,exitCode));
  return exitCode;
}
