{
  ArtifactCache artifactCache=getArtifactCache(params,options);
  if (options.getArguments().isEmpty()) {
    params.getConsole().printBuildFailure("Must specify at least one build target.");
    ImmutableSet<String> aliases=params.getBuckConfig().getAliases();
    if (!aliases.isEmpty()) {
      params.getConsole().getStdErr().println(String.format("Try building one of the following targets:\n%s",Joiner.on(' ').join(Iterators.limit(aliases.iterator(),10))));
    }
    return 1;
  }
  if (params.getParser().getParseStartTime().isPresent()) {
    params.getBuckEventBus().post(BuildEvent.started(options.getArguments()),params.getParser().getParseStartTime().get());
  }
 else {
    params.getBuckEventBus().post(BuildEvent.started(options.getArguments()));
  }
  ActionGraph actionGraph;
  try {
    Pair<ImmutableSet<BuildTarget>,TargetGraph> result=params.getParser().buildTargetGraphForTargetNodeSpecs(options.parseArgumentsAsTargetNodeSpecs(params.getBuckConfig(),params.getRepository().getFilesystem().getIgnorePaths(),options.getArguments()),new ParserConfig(params.getBuckConfig()),params.getBuckEventBus(),params.getConsole(),params.getEnvironment(),options.getEnableProfiling());
    buildTargets=result.getFirst();
    actionGraph=new TargetGraphToActionGraph(params.getBuckEventBus(),new BuildTargetNodeToBuildRuleTransformer()).apply(result.getSecond());
  }
 catch (  BuildTargetException|BuildFileParseException e) {
    params.getConsole().printBuildFailureWithoutStacktrace(e);
    return 1;
  }
  try (CommandThreadManager pool=new CommandThreadManager("Build",options.getConcurrencyLimit(params.getBuckConfig()));Build build=options.createBuild(params.getBuckConfig(),actionGraph,params.getRepository().getFilesystem(),params.getAndroidPlatformTargetSupplier(),new CachingBuildEngine(pool.getExecutor(),params.getBuckConfig().getSkipLocalBuildChainDepth().or(1L)),artifactCache,params.getConsole(),params.getBuckEventBus(),Optional.<TargetDevice>absent(),params.getPlatform(),params.getEnvironment(),params.getObjectMapper(),params.getClock())){
    lastBuild=build;
    int exitCode=build.executeAndPrintFailuresToConsole(buildTargets,options.isKeepGoing(),params.getConsole(),options.getPathToBuildReport(params.getBuckConfig()));
    params.getBuckEventBus().post(BuildEvent.finished(options.getArguments(),exitCode));
    return exitCode;
  }
 }
