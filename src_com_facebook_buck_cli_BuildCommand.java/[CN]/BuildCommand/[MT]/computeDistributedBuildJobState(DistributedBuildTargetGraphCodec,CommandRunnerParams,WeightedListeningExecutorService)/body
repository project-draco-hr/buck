{
  TargetGraphAndBuildTargets targetGraphAndBuildTargets=createTargetGraph(params,executorService);
  ActionGraphAndResolver actionGraphAndResolver=createActionGraphAndResolver(params,targetGraphAndBuildTargets);
  DistributedBuildCellIndexer cellIndexer=new DistributedBuildCellIndexer(params.getCell());
  DistributedBuildFileHashes distributedBuildFileHashes=new DistributedBuildFileHashes(actionGraphAndResolver.getActionGraph(),new SourcePathResolver(actionGraphAndResolver.getResolver()),params.getFileHashCache(),cellIndexer,executorService,params.getBuckConfig().getKeySeed());
  return DistributedBuildState.dump(cellIndexer,distributedBuildFileHashes,targetGraphCodec,targetGraphAndBuildTargets.getTargetGraph());
}
