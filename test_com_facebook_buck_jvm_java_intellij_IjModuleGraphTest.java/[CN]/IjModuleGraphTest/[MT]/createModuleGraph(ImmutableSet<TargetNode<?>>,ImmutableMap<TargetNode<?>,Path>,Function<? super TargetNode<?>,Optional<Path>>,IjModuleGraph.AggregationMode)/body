{
  final SourcePathResolver sourcePathResolver=new SourcePathResolver(new BuildRuleResolver());
  DefaultIjLibraryFactory.IjLibraryFactoryResolver sourceOnlyResolver=new DefaultIjLibraryFactory.IjLibraryFactoryResolver(){
    @Override public Path getPath(    SourcePath path){
      return sourcePathResolver.getPath(path);
    }
    @Override public Optional<Path> getPathIfJavaLibrary(    TargetNode<?> targetNode){
      return Optional.fromNullable(javaLibraryPaths.get(targetNode));
    }
  }
;
  IjModuleFactory moduleFactory=new IjModuleFactory(rDotJavaClassPathResolver);
  IjLibraryFactory libraryFactory=new DefaultIjLibraryFactory(sourceOnlyResolver);
  return IjModuleGraph.from(TargetGraphFactory.newInstance(targets),libraryFactory,moduleFactory,aggregationMode);
}
