{
  BuildTarget prebuiltJarTarget=BuildTargetFactory.newInstance("//empty:empty");
  TargetNode<?> prebuiltJarNode=PrebuiltJarBuilder.createBuilder(prebuiltJarTarget).setBinaryJar(Paths.get("spoof")).build();
  BuildTarget javaLibraryTarget=BuildTargetFactory.newInstance("//javasrc:java-library");
  TargetNode<?> javaLibraryNode=JavaLibraryBuilder.createBuilder(javaLibraryTarget).addSrc(Paths.get("javasrc/JavaLibrary.java")).addDep(prebuiltJarTarget).build();
  BuildTarget javaTestTarget=BuildTargetFactory.newInstance("//javatest:test-java-library");
  TargetNode<?> javaTestNode=JavaTestBuilder.createBuilder(javaTestTarget).addSrc(Paths.get("javatest/TestJavaLibrary.java")).addDep(javaLibraryTarget).build();
  ImmutableSet<TargetNode<?>> nodes=ImmutableSet.of(prebuiltJarNode,javaLibraryNode,javaTestNode);
  TargetGraph targetGraph=TargetGraphFactory.newInstance(nodes);
  ImmutableSet<Path> referencedFiles;
  referencedFiles=ImmutableSet.of(Paths.get("excludesrc/CannotFind.java"));
  SortedMap<String,TargetNode<?>> matchingBuildRules=targetsCommand.getMatchingNodes(targetGraph,Optional.of(referencedFiles),Optional.<ImmutableSet<BuildTarget>>absent(),Optional.<ImmutableSet<BuildRuleType>>absent(),false);
  assertTrue(matchingBuildRules.isEmpty());
  referencedFiles=ImmutableSet.of(Paths.get("javatest/TestJavaLibrary.java"));
  matchingBuildRules=targetsCommand.getMatchingNodes(targetGraph,Optional.of(referencedFiles),Optional.<ImmutableSet<BuildTarget>>absent(),Optional.<ImmutableSet<BuildRuleType>>absent(),false);
  assertEquals(ImmutableSet.of("//javatest:test-java-library"),matchingBuildRules.keySet());
  referencedFiles=ImmutableSet.of(Paths.get("javasrc/JavaLibrary.java"));
  matchingBuildRules=targetsCommand.getMatchingNodes(targetGraph,Optional.of(referencedFiles),Optional.<ImmutableSet<BuildTarget>>absent(),Optional.<ImmutableSet<BuildRuleType>>absent(),false);
  assertEquals(ImmutableSet.of("//javatest:test-java-library","//javasrc:java-library"),matchingBuildRules.keySet());
  referencedFiles=ImmutableSet.of(Paths.get("javasrc/" + BuckConstant.BUILD_RULES_FILE_NAME));
  matchingBuildRules=targetsCommand.getMatchingNodes(targetGraph,Optional.of(referencedFiles),Optional.<ImmutableSet<BuildTarget>>absent(),Optional.<ImmutableSet<BuildRuleType>>absent(),false);
  assertEquals(ImmutableSet.of("//javatest:test-java-library","//javasrc:java-library"),matchingBuildRules.keySet());
  referencedFiles=ImmutableSet.of(Paths.get("javatest/TestJavaLibrary.java"),Paths.get("othersrc/CannotFind.java"));
  matchingBuildRules=targetsCommand.getMatchingNodes(targetGraph,Optional.of(referencedFiles),Optional.<ImmutableSet<BuildTarget>>absent(),Optional.<ImmutableSet<BuildRuleType>>absent(),false);
  assertEquals(ImmutableSet.of("//javatest:test-java-library"),matchingBuildRules.keySet());
  matchingBuildRules=targetsCommand.getMatchingNodes(targetGraph,Optional.<ImmutableSet<Path>>absent(),Optional.<ImmutableSet<BuildTarget>>absent(),Optional.<ImmutableSet<BuildRuleType>>absent(),false);
  assertEquals(ImmutableSet.of("//javatest:test-java-library","//javasrc:java-library","//empty:empty"),matchingBuildRules.keySet());
  matchingBuildRules=targetsCommand.getMatchingNodes(targetGraph,Optional.<ImmutableSet<Path>>absent(),Optional.<ImmutableSet<BuildTarget>>absent(),Optional.of(ImmutableSet.of(JavaTestDescription.TYPE,JavaLibraryDescription.TYPE)),false);
  assertEquals(ImmutableSet.of("//javatest:test-java-library","//javasrc:java-library"),matchingBuildRules.keySet());
  matchingBuildRules=targetsCommand.getMatchingNodes(targetGraph,Optional.<ImmutableSet<Path>>absent(),Optional.of(ImmutableSet.of(BuildTargetFactory.newInstance("//javasrc:java-library"))),Optional.of(ImmutableSet.of(JavaTestDescription.TYPE,JavaLibraryDescription.TYPE)),false);
  assertEquals(ImmutableSet.of("//javasrc:java-library"),matchingBuildRules.keySet());
  matchingBuildRules=targetsCommand.getMatchingNodes(targetGraph,Optional.<ImmutableSet<Path>>absent(),Optional.of(ImmutableSet.of(BuildTargetFactory.newInstance("//javasrc:java-library"))),Optional.<ImmutableSet<BuildRuleType>>absent(),false);
  assertEquals(ImmutableSet.of("//javasrc:java-library"),matchingBuildRules.keySet());
  matchingBuildRules=targetsCommand.getMatchingNodes(targetGraph,Optional.of(ImmutableSet.of(Paths.get("javatest/TestJavaLibrary.java"))),Optional.of(ImmutableSet.of(BuildTargetFactory.newInstance("//javasrc:java-library"))),Optional.<ImmutableSet<BuildRuleType>>absent(),false);
  assertEquals(ImmutableSet.<String>of(),matchingBuildRules.keySet());
}
