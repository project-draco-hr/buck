{
  if ((level <= m_level) && (level >= SEVERE)) {
    final Class caller=ClassLoaderResolver.getCallerClass(2);
    final StringBuffer buf=new StringBuffer(m_prefix != null ? m_prefix + ": " : "");
    if ((caller != null) || (method != null)) {
      buf.append("[");
      if (caller != null) {
        String callerName=caller.getName();
        if (callerName.startsWith(PREFIX_TO_STRIP))         callerName=callerName.substring(PREFIX_TO_STRIP_LENGTH);
        String parentName=callerName;
        final int firstDollar=callerName.indexOf('$');
        if (firstDollar > 0)         parentName=callerName.substring(0,firstDollar);
        if ((m_classMask == null) || m_classMask.contains(parentName))         buf.append(callerName);
 else         return;
      }
      if (method != null) {
        buf.append("::");
        buf.append(method);
      }
      buf.append("] ");
    }
    final PrintWriter out=m_out;
    if (msg != null)     buf.append(msg);
    if (throwable != null) {
      final StringWriter sw=new StringWriter();
      final PrintWriter pw=new PrintWriter(sw);
      throwable.printStackTrace(pw);
      pw.flush();
      buf.append(sw.toString());
    }
    out.println(buf);
    if (FLUSH_LOG)     out.flush();
  }
}
