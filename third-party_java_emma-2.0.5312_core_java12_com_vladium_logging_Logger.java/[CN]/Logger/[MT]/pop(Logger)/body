{
  final LinkedList stack=(LinkedList)THREAD_LOCAL_STACK.get();
  try {
    final Logger current=(Logger)stack.getLast();
    if (current != ctx)     throw new IllegalStateException("invalid context being popped: " + ctx);
    stack.removeLast();
    current.cleanup();
  }
 catch (  NoSuchElementException nsee) {
    throw new IllegalStateException("empty logger context stack on thread [" + Thread.currentThread() + "]: "+ nsee);
  }
}
