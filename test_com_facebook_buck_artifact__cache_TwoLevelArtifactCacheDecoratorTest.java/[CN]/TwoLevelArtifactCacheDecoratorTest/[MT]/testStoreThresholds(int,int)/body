{
  try (InMemoryArtifactCache inMemoryArtifactCache=new InMemoryArtifactCache();TwoLevelArtifactCacheDecorator twoLevelCache=new TwoLevelArtifactCacheDecorator(inMemoryArtifactCache,new ProjectFilesystem(tmp.getRoot()),MoreExecutors.newDirectExecutorService(),true,5L,Optional.of(10L))){
    LazyPath lazyPath=LazyPath.ofInstance(tmp.newFile());
    Files.write(lazyPath.get(),new byte[artifactSize]);
    twoLevelCache.store(ImmutableSet.of(dummyRuleKey),ImmutableMap.<String,String>of(),BorrowablePath.notBorrowablePath(lazyPath.get()));
    assertThat(inMemoryArtifactCache.getArtifactCount(),Matchers.equalTo(expectedArtifactsInCache));
  }
 }
