{
  ProjectWorkspace workspace=TestDataHelper.createProjectWorkspaceForScenario(this,"num_threads",tmp);
  workspace.setUp();
  ProcessResult buildResult1=workspace.runBuckCommand("build","//:noop","--verbose","10");
  assertThat("Number of threads to use should be read from .buckconfig.",buildResult1.getStderr(),containsString("Creating a build with 7 threads.\n"));
  ProcessResult buildResult2=workspace.runBuckCommand("build","//:noop","--verbose","10","--num-threads","27");
  assertThat("Command-line arg should override value in .buckconfig.",buildResult2.getStderr(),containsString("Creating a build with 27 threads.\n"));
  File buckconfig=workspace.getFile(".buckconfig");
  assertTrue(buckconfig.delete());
  int numThreads=(int)(Runtime.getRuntime().availableProcessors() * 1.25);
  ProcessResult buildResult3=workspace.runBuckCommand("build","//:noop","--verbose","10");
  assertThat("Once .buckconfig is deleted, the number of threads should be " + "a function of the number of processors.",buildResult3.getStderr(),containsString("Creating a build with " + numThreads + " threads.\n"));
}
