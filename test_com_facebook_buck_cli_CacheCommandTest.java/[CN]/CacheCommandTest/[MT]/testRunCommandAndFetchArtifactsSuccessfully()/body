{
  final String ruleKeyHash="b64009ae3762a42a1651c139ec452f0d18f48e21";
  Console console=createMock(Console.class);
  Capture<String> successMessage=new Capture<>();
  console.printSuccess(capture(successMessage));
  CommandRunnerParamsForTesting commandRunnerParams=CommandRunnerParamsForTesting.builder().setConsole(console).build();
  CacheCommand cacheCommand=new CacheCommand(commandRunnerParams);
  BuckConfig buckConfig=createMock(BuckConfig.class);
  CassandraArtifactCache cassandra=createMock(CassandraArtifactCache.class);
  expect(cassandra.fetch(eq(new RuleKey(ruleKeyHash)),capture(new Capture<File>()))).andReturn(CacheResult.CASSANDRA_HIT);
  Capture<BuckEventBus> buckEventBus=new Capture<>();
  expect(buckConfig.createCassandraArtifactCache(capture(buckEventBus))).andReturn(cassandra);
  replayAll();
  CacheCommandOptions options=new CacheCommandOptions(buckConfig);
  options.setArguments(ImmutableList.of(ruleKeyHash));
  int exitCode=cacheCommand.runCommandWithOptionsInternal(options);
  assertEquals(0,exitCode);
  assertThat(successMessage.getValue(),startsWith("Successfully downloaded artifact with id " + ruleKeyHash + " at "));
  verifyAll();
}
