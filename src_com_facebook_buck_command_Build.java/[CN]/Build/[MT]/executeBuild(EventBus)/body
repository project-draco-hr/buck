{
  events.post(BuildEvents.started());
  Set<BuildRule> rulesToBuild=dependencyGraph.getNodesWithNoIncomingEdges();
  ProjectFilesystem projectFilesystem=new ProjectFilesystem(executionContext.getProjectDirectoryRoot());
  buildContext=BuildContext.builder().setProjectRoot(executionContext.getProjectDirectoryRoot()).setDependencyGraph(dependencyGraph).setCommandRunner(stepRunner).setProjectFilesystem(projectFilesystem).setJavaPackageFinder(javaPackageFinder).setEventBus(events).setAndroidBootclasspathForAndroidPlatformTarget(executionContext.getAndroidPlatformTargetOptional()).setBuildDependencies(buildDependencies).build();
  return Builder.getInstance().buildRules(rulesToBuild,buildContext);
}
