{
  events.post(BuildEvents.started());
  Set<BuildRule> rulesToBuild=dependencyGraph.getNodesWithNoIncomingEdges();
  buildContext=BuildContext.builder().setProjectRoot(executionContext.getProjectDirectoryRoot()).setDependencyGraph(dependencyGraph).setCommandRunner(stepRunner).setProjectFilesystem(executionContext.getProjectFilesystem()).setJavaPackageFinder(javaPackageFinder).setEventBus(events).setAndroidBootclasspathForAndroidPlatformTarget(executionContext.getAndroidPlatformTargetOptional()).setBuildDependencies(buildDependencies).build();
  return Builder.getInstance().buildRules(rulesToBuild,buildContext);
}
