{
  this.clock=config.getClock();
  this.pingEndpoint=Preconditions.checkNotNull(config.getPingEndpoint());
  this.serverPool=Preconditions.checkNotNull(config.getServerPool());
  this.eventBus=Preconditions.checkNotNull(config.getEventBus());
  Preconditions.checkArgument(serverPool.size() > 0,"No server URLs passed.");
  this.healthManager=new ServerHealthManager(this.serverPool,config.getErrorCheckTimeRangeMillis(),config.getMaxErrorPercentage(),config.getLatencyCheckTimeRangeMillis(),config.getMaxAcceptableLatencyMillis(),config.getEventBus());
  this.pingClient=config.getPingHttpClient();
  this.pingClient.setConnectTimeout(config.getConnectionTimeoutMillis(),TimeUnit.MILLISECONDS);
  this.pingClient.setReadTimeout(config.getConnectionTimeoutMillis(),TimeUnit.MILLISECONDS);
  this.pingClient.setWriteTimeout(config.getConnectionTimeoutMillis(),TimeUnit.MILLISECONDS);
  this.schedulerService=config.getSchedulerService();
  backgroundHealthChecker=this.schedulerService.scheduleWithFixedDelay(new Runnable(){
    @Override public void run(){
      backgroundThreadCallForHealthCheck();
    }
  }
,0,config.getHealthCheckIntervalMillis(),TimeUnit.MILLISECONDS);
}
