{
  BuildRuleResolver ruleResolver=new BuildRuleResolver(TargetGraph.EMPTY,new DefaultTargetNodeToBuildRuleTransformer());
  SourcePathResolver pathResolver=new SourcePathResolver(ruleResolver);
  FakeBuildRule resourcesDep=ruleResolver.addToIndex(new FakeBuildRule(BuildTargetFactory.newInstance("//:resource_dep"),pathResolver));
  AndroidResource resource=ruleResolver.addToIndex(new AndroidResource(new FakeBuildRuleParamsBuilder("//:resources").build().appendExtraDeps(ImmutableSortedSet.of(resourcesDep)),pathResolver,ImmutableSortedSet.<BuildRule>of(),new BuildTargetSourcePath(resourcesDep.getBuildTarget()),ImmutableSortedSet.<SourcePath>of(),Optional.<SourcePath>absent(),null,null,ImmutableSortedSet.<SourcePath>of(),Optional.<SourcePath>absent(),new FakeSourcePath("manifest"),false));
  BuildTarget target=BuildTargetFactory.newInstance("//:target");
  BuildRuleParams originalParams=new FakeBuildRuleParamsBuilder(target).setDeclaredDeps(ImmutableSortedSet.<BuildRule>of(resource)).build();
  AndroidBinaryGraphEnhancer graphEnhancer=new AndroidBinaryGraphEnhancer(originalParams,ruleResolver,ResourcesFilter.ResourceCompressionMode.ENABLED_WITH_STRINGS_AS_ASSETS,FilterResourcesStep.ResourceFilter.EMPTY_FILTER,EnumSet.noneOf(RType.class),Optional.<String>absent(),ImmutableSet.<String>of(),new FakeSourcePath("AndroidManifest.xml"),AndroidBinary.PackageType.DEBUG,ImmutableSet.<TargetCpuType>of(),false,false,BuildTargets.getScratchPath(originalParams.getProjectFilesystem(),target,"%s/classes.dex"),DexSplitMode.NO_SPLIT,ImmutableSet.<BuildTarget>of(),ImmutableSet.<BuildTarget>of(),false,ANDROID_JAVAC_OPTIONS,EnumSet.of(ExopackageMode.SECONDARY_DEX),createNiceMock(Keystore.class),BuildConfigFields.empty(),Optional.<SourcePath>absent(),Optional.<Integer>absent(),false,ImmutableMap.<TargetCpuType,NdkCxxPlatform>of(),Optional.<Map<String,List<Pattern>>>absent(),Optional.<BuildTarget>absent(),AndroidBinary.RelinkerMode.DISABLED,MoreExecutors.newDirectExecutorService(),ManifestEntries.empty(),CxxPlatformUtils.DEFAULT_CONFIG,new APKModuleGraph(TargetGraph.EMPTY,originalParams.getBuildTarget(),Optional.<Set<BuildTarget>>absent()));
  graphEnhancer.createAdditionalBuildables();
  ResourcesFilter resourcesFilter=findRuleOfType(ruleResolver,ResourcesFilter.class);
  MoreAsserts.assertDepends("ResourcesFilter must depend on rules behind resources source paths",resourcesFilter,resourcesDep);
}
