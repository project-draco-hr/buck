{
  BuildTarget fooLibTarget=BuildTarget.builder("//foo","lib").addFlavors(CxxDescriptionEnhancer.SHARED_FLAVOR).build();
  TargetNode<?> fooLibNode=AppleLibraryBuilder.createBuilder(fooLibTarget).build();
  BuildTarget fooFrameworkTarget=BuildTarget.builder("//foo","framework").build();
  TargetNode<?> fooFrameworkNode=AppleBundleBuilder.createBuilder(fooFrameworkTarget).setExtension(Either.<AppleBundleExtension,String>ofLeft(AppleBundleExtension.FRAMEWORK)).setBinary(fooLibTarget).build();
  BuildTarget barLibTarget=BuildTarget.builder("//bar","lib").addFlavors(CxxDescriptionEnhancer.SHARED_FLAVOR).build();
  TargetNode<?> barLibNode=AppleLibraryBuilder.createBuilder(barLibTarget).setDeps(Optional.of(ImmutableSortedSet.of(fooFrameworkTarget))).setExportedDeps(Optional.of(ImmutableSortedSet.of(fooFrameworkTarget))).build();
  BuildTarget barFrameworkTarget=BuildTarget.builder("//bar","framework").build();
  TargetNode<?> barFrameworkNode=AppleBundleBuilder.createBuilder(barFrameworkTarget).setExtension(Either.<AppleBundleExtension,String>ofLeft(AppleBundleExtension.FRAMEWORK)).setBinary(barLibTarget).build();
  BuildTarget rootTarget=BuildTarget.builder("//foo","root").build();
  TargetNode<?> rootNode=AppleLibraryBuilder.createBuilder(rootTarget).setDeps(Optional.of(ImmutableSortedSet.of(barFrameworkTarget))).build();
  Iterable<TargetNode<?>> rules=AppleBuildRules.getRecursiveTargetNodeDependenciesOfTypes(TargetGraphFactory.newInstance(ImmutableSet.of(rootNode,fooLibNode,fooFrameworkNode,barLibNode,barFrameworkNode)),AppleBuildRules.RecursiveDependenciesMode.LINKING,rootNode,Optional.<ImmutableSet<BuildRuleType>>absent());
  assertEquals(ImmutableSortedSet.of(barFrameworkNode,fooFrameworkNode),ImmutableSortedSet.copyOf(rules));
}
