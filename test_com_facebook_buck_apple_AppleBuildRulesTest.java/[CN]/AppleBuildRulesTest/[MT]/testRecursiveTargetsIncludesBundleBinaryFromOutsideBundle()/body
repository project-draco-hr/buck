{
  BuildTarget libraryTarget=BuildTarget.builder("//foo","lib").build();
  TargetNode<?> libraryNode=AppleLibraryBuilder.createBuilder(libraryTarget).build();
  BuildTarget bundleTarget=BuildTarget.builder("//foo","bundle").build();
  TargetNode<?> bundleNode=AppleBundleBuilder.createBuilder(bundleTarget).setExtension(Either.<AppleBundleExtension,String>ofLeft(AppleBundleExtension.XCTEST)).setBinary(libraryTarget).build();
  BuildTarget rootTarget=BuildTarget.builder("//foo","root").build();
  TargetNode<?> rootNode=AppleLibraryBuilder.createBuilder(rootTarget).setDeps(Optional.of(ImmutableSortedSet.of(libraryTarget,bundleTarget))).build();
  Iterable<TargetNode<?>> rules=AppleBuildRules.getRecursiveTargetNodeDependenciesOfTypes(TargetGraphFactory.newInstance(ImmutableSet.of(libraryNode,bundleNode,rootNode)),AppleBuildRules.RecursiveDependenciesMode.BUILDING,rootNode,Optional.<ImmutableSet<BuildRuleType>>absent());
  assertTrue(Iterables.elementsEqual(ImmutableSortedSet.of(libraryNode,bundleNode),rules));
}
