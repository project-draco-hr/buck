{
  ProjectFilesystem filesystem=new FakeProjectFilesystem();
  BuildTarget target=BuildTargetFactory.newInstance("//foo:bar");
  CxxLibraryBuilder cxxLibraryBuilder=(CxxLibraryBuilder)new CxxLibraryBuilder(target).setSrcs(ImmutableSortedSet.of(SourceWithFlags.of(new TestSourcePath("test.c"))));
  TargetGraph targetGraph1=TargetGraphFactory.newInstance(cxxLibraryBuilder.build());
  CxxLibrary cxxLibrary=(CxxLibrary)cxxLibraryBuilder.build(new BuildRuleResolver(),filesystem,targetGraph1);
  assertThat(cxxLibrary.getSharedLibraries(targetGraph1,CxxPlatformUtils.DEFAULT_PLATFORM).entrySet(),Matchers.not(Matchers.empty()));
  assertThat(cxxLibrary.getPythonPackageComponents(targetGraph1,CxxPlatformUtils.DEFAULT_PLATFORM).getNativeLibraries().entrySet(),Matchers.not(Matchers.empty()));
  assertThat(cxxLibrary.getNativeLinkableInput(targetGraph1,CxxPlatformUtils.DEFAULT_PLATFORM,Linker.LinkableDepType.SHARED).getArgs(),Matchers.not(Matchers.empty()));
  cxxLibraryBuilder.setSupportedPlatformsRegex(Pattern.compile("nothing"));
  TargetGraph targetGraph2=TargetGraphFactory.newInstance(cxxLibraryBuilder.build());
  cxxLibrary=(CxxLibrary)cxxLibraryBuilder.build(new BuildRuleResolver(),filesystem,targetGraph2);
  assertThat(cxxLibrary.getSharedLibraries(targetGraph2,CxxPlatformUtils.DEFAULT_PLATFORM).entrySet(),Matchers.empty());
  assertThat(cxxLibrary.getPythonPackageComponents(targetGraph2,CxxPlatformUtils.DEFAULT_PLATFORM).getNativeLibraries().entrySet(),Matchers.empty());
  assertThat(cxxLibrary.getNativeLinkableInput(targetGraph2,CxxPlatformUtils.DEFAULT_PLATFORM,Linker.LinkableDepType.SHARED).getArgs(),Matchers.empty());
}
