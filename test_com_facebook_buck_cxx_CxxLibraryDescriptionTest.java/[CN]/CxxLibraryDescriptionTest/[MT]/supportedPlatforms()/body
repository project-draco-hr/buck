{
  ProjectFilesystem filesystem=new FakeProjectFilesystem();
  BuildTarget target=BuildTargetFactory.newInstance("//foo:bar");
  CxxLibraryBuilder cxxLibraryBuilder=(CxxLibraryBuilder)new CxxLibraryBuilder(target).setSrcs(ImmutableSortedSet.of(SourceWithFlags.of(new FakeSourcePath("test.c"))));
  TargetGraph targetGraph1=TargetGraphFactory.newInstance(cxxLibraryBuilder.build());
  CxxLibrary cxxLibrary=(CxxLibrary)cxxLibraryBuilder.build(new BuildRuleResolver(TargetGraph.EMPTY,new BuildTargetNodeToBuildRuleTransformer()),filesystem,targetGraph1);
  assertThat(cxxLibrary.getSharedLibraries(targetGraph1,CxxPlatformUtils.DEFAULT_PLATFORM).entrySet(),Matchers.not(empty()));
  assertThat(cxxLibrary.getPythonPackageComponents(targetGraph1,PythonTestUtils.PYTHON_PLATFORM,CxxPlatformUtils.DEFAULT_PLATFORM).getNativeLibraries().entrySet(),Matchers.not(empty()));
  assertThat(cxxLibrary.getNativeLinkableInput(targetGraph1,CxxPlatformUtils.DEFAULT_PLATFORM,Linker.LinkableDepType.SHARED).getArgs(),Matchers.not(empty()));
  cxxLibraryBuilder.setSupportedPlatformsRegex(Pattern.compile("nothing"));
  TargetGraph targetGraph2=TargetGraphFactory.newInstance(cxxLibraryBuilder.build());
  cxxLibrary=(CxxLibrary)cxxLibraryBuilder.build(new BuildRuleResolver(TargetGraph.EMPTY,new BuildTargetNodeToBuildRuleTransformer()),filesystem,targetGraph2);
  assertThat(cxxLibrary.getSharedLibraries(targetGraph2,CxxPlatformUtils.DEFAULT_PLATFORM).entrySet(),empty());
  assertThat(cxxLibrary.getPythonPackageComponents(targetGraph2,PythonTestUtils.PYTHON_PLATFORM,CxxPlatformUtils.DEFAULT_PLATFORM).getNativeLibraries().entrySet(),empty());
  assertThat(cxxLibrary.getNativeLinkableInput(targetGraph2,CxxPlatformUtils.DEFAULT_PLATFORM,Linker.LinkableDepType.SHARED).getArgs(),empty());
}
