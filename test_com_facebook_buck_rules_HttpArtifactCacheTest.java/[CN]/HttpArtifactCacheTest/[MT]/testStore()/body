{
  String data="test";
  HashCode hashCode=HASH_FUNCTION.hashString(data,Charset.defaultCharset());
  connection.setRequestMethod("POST");
  connection.setDoOutput(true);
  connection.setRequestProperty(eq("Content-Type"),anyString());
  connection.setRequestProperty("Buck-Artifact-Count","1");
  connection.setFixedLengthStreamingMode(EasyMock.anyLong());
  ByteArrayOutputStream output=new ByteArrayOutputStream();
  expect(connection.getOutputStream()).andReturn(output);
  File file=File.createTempFile("000","");
  Files.write(file.toPath(),data.getBytes(),StandardOpenOption.WRITE);
  InputStream is=new ByteArrayInputStream(data.getBytes());
  expect(projectFilesystem.newFileInputStream(file.toPath())).andReturn(is);
  expect(connection.getResponseCode()).andReturn(HttpURLConnection.HTTP_ACCEPTED);
  replay(connection);
  replay(projectFilesystem);
  cache.store(new RuleKey("00000000000000000000000000000000"),file);
  verify(connection);
  verify(projectFilesystem);
  assertNotEquals(-1,output.toString().indexOf(new String(createFileContentsWithHashCode(hashCode,data))));
}
