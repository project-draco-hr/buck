{
  String data="test";
  HashCode hashCode=HashCode.fromString("deadbeef");
  connection.setConnectTimeout(1000);
  connection.setDoOutput(true);
  connection.setRequestMethod("POST");
  ByteArrayOutputStream output=new ByteArrayOutputStream();
  expect(connection.getOutputStream()).andReturn(output);
  File file=File.createTempFile("000","");
  expect(fileHashCache.get(file.toPath())).andReturn(hashCode);
  InputStream is=new ByteArrayInputStream(data.getBytes());
  expect(projectFilesystem.newFileInputStream(file.toPath())).andReturn(is);
  expect(connection.getResponseCode()).andReturn(HttpURLConnection.HTTP_ACCEPTED);
  replay(fileHashCache);
  replay(connection);
  replay(projectFilesystem);
  cache.store(new RuleKey("00000000000000000000000000000000"),file);
  verify(fileHashCache);
  verify(connection);
  verify(projectFilesystem);
  assertNotEquals(-1,output.toString().indexOf(new String(createFileContentsWithHashCode(hashCode,data))));
}
