{
  expect(connection.getResponseCode()).andReturn(HttpURLConnection.HTTP_OK);
  InputStream is=new ByteArrayInputStream("test".getBytes());
  expect(connection.getInputStream()).andReturn(is);
  File file=File.createTempFile("000","");
  Path path=file.toPath();
  projectFilesystem.createParentDirs(path);
  projectFilesystem.copyToPath(is,path,StandardCopyOption.REPLACE_EXISTING);
  replay(connection);
  replay(projectFilesystem);
  assertEquals(cache.fetch(new RuleKey("00000000000000000000000000000000"),file),CacheResult.HTTP_HIT);
  verify(connection);
  verify(projectFilesystem);
}
