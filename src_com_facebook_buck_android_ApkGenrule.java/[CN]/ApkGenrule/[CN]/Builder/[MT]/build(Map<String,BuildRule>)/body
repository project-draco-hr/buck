{
  BuildRule apkRule=buildRuleIndex.get(apk);
  Preconditions.checkState(apk != null && apkRule != null,"Buck should guarantee that apk was set and included in the deps of this rule, " + "so apk should not be null at this point and should have an entry in buildRuleIndex " + "as all deps should.");
  if (!(apkRule instanceof InstallableBuildRule)) {
    throw new HumanReadableException("The 'apk' argument of %s, %s, must correspond to an " + "installable rule, such as android_binary() or apk_genrule().",getBuildTarget(),apkRule.getFullyQualifiedName());
  }
  return new ApkGenrule(createBuildRuleParams(buildRuleIndex),srcs,cmd,relativeToAbsolutePathFunction,(InstallableBuildRule)apkRule);
}
