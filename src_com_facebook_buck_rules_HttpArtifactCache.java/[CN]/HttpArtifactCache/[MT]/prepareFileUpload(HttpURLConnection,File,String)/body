{
  connection.setDoOutput(true);
  connection.setRequestProperty("Content-Type","multipart/form-data; boundary=" + BOUNDARY);
  connection.setRequestProperty("Buck-Artifact-Count","1");
  try (OutputStream os=new BufferedOutputStream(connection.getOutputStream());InputStream is=projectFilesystem.newFileInputStream(file.toPath())){
    os.write(("--" + BOUNDARY + "\r\n").getBytes(StandardCharsets.UTF_8));
    os.write("Content-Disposition: form-data; name=\"key0\"\r\n\r\n".getBytes(StandardCharsets.UTF_8));
    os.write(key.getBytes(StandardCharsets.UTF_8));
    os.write(("\r\n--" + BOUNDARY + "\r\n").getBytes(StandardCharsets.UTF_8));
    os.write("Content-Disposition: form-data; name=\"data0\"; filename=\"artifact\"\r\n".getBytes(StandardCharsets.UTF_8));
    os.write("Content-Type: application/octet-stream\r\n\r\n".getBytes(StandardCharsets.UTF_8));
    ByteStreams.copy(is,os);
    os.write(("\r\n--" + BOUNDARY + "--\r\n").getBytes(StandardCharsets.UTF_8));
  }
 }
