def glob_internal(includes, excludes, include_dotfiles, allow_empty, search_base):
    assert (not isinstance(includes, basestring)), 'The first argument to glob() must be a list of strings.'
    assert (not isinstance(excludes, basestring)), 'The excludes argument must be a list of strings.'

    def includes_iterator():
        for pattern in includes:
            for path in search_base.glob(pattern):
                if (path.is_file() and (include_dotfiles or (not path.name.startswith('.')))):
                    yield path.relative_to(search_base)

    def is_special(pat):
        return (('*' in pat) or ('?' in pat) or ('[' in pat))
    non_special_excludes = set()
    match_excludes = set()
    for pattern in excludes:
        if is_special(pattern):
            match_excludes.add(pattern)
        else:
            non_special_excludes.add(pattern)

    def exclusion(path):
        if (path.as_posix() in non_special_excludes):
            return True
        for pattern in match_excludes:
            result = path.match(pattern, match_entire=True)
            if result:
                return True
        return False
    results = sorted(set([str(p) for p in includes_iterator() if (not exclusion(p))]))
    assert (allow_empty or results), (('glob(includes={includes}, excludes={excludes}, include_dotfiles={include_dotfiles}) ' + 'returned no results.  (allow_empty_globs is set to false in the Buck ') + 'configuration)').format(includes=includes, excludes=excludes, include_dotfiles=include_dotfiles)
    return results
