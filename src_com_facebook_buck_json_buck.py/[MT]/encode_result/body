def encode_result(values, diagnostics, profile):
    result = {'values': values, }
    if diagnostics:
        encoded_diagnostics = []
        for d in diagnostics:
            encoded_diagnostics.append({'message': d.message, 'level': d.level, })
        result['diagnostics'] = encoded_diagnostics
    if (profile is not None):
        result['profile'] = profile
    return bser.dumps(result)
