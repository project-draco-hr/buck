{
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  PrebuiltJarBuilder.createBuilder(BuildTargetFactory.newInstance("//third_party/generator:generator")).setBinaryJar(PATH_TO_GENERATOR_JAR).build(ruleResolver);
  PrebuiltJarBuilder.createBuilder(BuildTargetFactory.newInstance("//third_party/guava:guava")).setBinaryJar(PATH_TO_GUAVA_JAR).build(ruleResolver);
  BuildRule libraryRule=ruleResolver.buildAndAddToIndex(DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(new FakeBuildRuleBuilderParams()).setBuildTarget(BuildTargetFactory.newInstance("//java/com/facebook/base:base")).addSrc(Paths.get("java/com/facebook/base/Base.java")).addDep(BuildTargetFactory.newInstance("//third_party/guava:guava")));
  JavaBinary javaBinary=new JavaBinary(BuildTargetFactory.newInstance("//java/com/facebook/base:Main"),ImmutableSortedSet.of(libraryRule),"com.facebook.base.Main",null,null,new DefaultDirectoryTraverser());
  final String basePath=new File(".").getAbsolutePath().replaceFirst("\\.$","");
  String expectedClasspath=basePath + javaBinary.getPathToOutputFile();
  List<String> expectedCommand=ImmutableList.of("java","-jar",expectedClasspath);
  ProjectFilesystem projectFilesystem=createMock(ProjectFilesystem.class);
  Function<Path,Path> pathRelativizer=new Function<Path,Path>(){
    @Override public Path apply(    Path path){
      return Paths.get(basePath).resolve(path);
    }
  }
;
  expect(projectFilesystem.getAbsolutifier()).andReturn(pathRelativizer);
  replay(projectFilesystem);
  assertEquals(expectedCommand,javaBinary.getExecutableCommand(projectFilesystem));
  verify(projectFilesystem);
  assertFalse("Library rules that are used exclusively by genrules should not be part of the classpath.",expectedClasspath.contains(PATH_TO_GENERATOR_JAR.toString()));
}
