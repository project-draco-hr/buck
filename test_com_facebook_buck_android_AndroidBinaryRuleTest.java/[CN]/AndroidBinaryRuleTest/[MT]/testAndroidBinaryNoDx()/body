{
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  JavaLibraryRule libraryOne=createAndroidLibraryRule("//java/src/com/facebook/base:libraryOne",ruleResolver,null,null,null);
  JavaLibraryRule libraryTwo=createAndroidLibraryRule("//java/src/com/facebook/base:libraryTwo",ruleResolver,null,null,null);
  BuildTarget binaryBuildTarget=BuildTargetFactory.newInstance("//java/src/com/facebook/base:apk");
  AndroidBinaryRule androidBinary=ruleResolver.buildAndAddToIndex(AndroidBinaryRule.newAndroidBinaryRuleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(binaryBuildTarget).addDep(libraryOne.getBuildTarget()).addDep(libraryTwo.getBuildTarget()).addBuildRuleToExcludeFromDex(BuildTargetFactory.newInstance("//java/src/com/facebook/base:libraryTwo")).setManifest("java/src/com/facebook/base/AndroidManifest.xml").setTarget("Google Inc.:Google APIs:16").setKeystorePropertiesPath("java/src/com/facebook/base/keystore.properties").setPackageType("debug"));
  DependencyGraph graph=RuleMap.createGraphFromBuildRules(ruleResolver);
  AndroidTransitiveDependencies transitiveDependencies=androidBinary.findTransitiveDependencies(graph);
  AndroidDexTransitiveDependencies dexTransitiveDependencies=androidBinary.findDexTransitiveDependencies(graph);
  ImmutableList.Builder<Step> commands=ImmutableList.builder();
  BuildContext context=createMock(BuildContext.class);
  replay(context);
  androidBinary.addProguardCommands(context,dexTransitiveDependencies,transitiveDependencies.proguardConfigs,commands,ImmutableSet.<String>of());
  verify(context);
  MakeCleanDirectoryStep expectedClean=new MakeCleanDirectoryStep("buck-out/gen/java/src/com/facebook/base/.proguard/apk");
  GenProGuardConfigStep expectedGenProguard=new GenProGuardConfigStep("buck-out/bin/java/src/com/facebook/base/__manifest_apk__/AndroidManifest.xml",ImmutableSet.<String>of(),"buck-out/gen/java/src/com/facebook/base/.proguard/apk/proguard.txt");
  ProGuardObfuscateStep expectedObfuscation=new ProGuardObfuscateStep("buck-out/gen/java/src/com/facebook/base/.proguard/apk/proguard.txt",ImmutableSet.<String>of(),false,ImmutableMap.of("buck-out/gen/java/src/com/facebook/base/lib__libraryOne__output/libraryOne.jar","buck-out/gen/java/src/com/facebook/base/.proguard/apk/buck-out/gen/java/src/com/" + "facebook/base/lib__libraryOne__output/libraryOne-obfuscated.jar"),ImmutableSet.of("buck-out/gen/java/src/com/facebook/base/lib__libraryTwo__output/libraryTwo.jar"),"buck-out/gen/java/src/com/facebook/base/.proguard/apk");
  assertEquals(ImmutableList.of(expectedClean,expectedGenProguard,expectedObfuscation),commands.build());
}
