{
  AndroidBinaryRule splitDexRule=AndroidBinaryRule.newAndroidBinaryRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//:fbandroid_with_dash_debug_fbsign")).setManifest("AndroidManifest.xml").setKeystorePropertiesPath("keystore.properties").setTarget("Google Inc.:Google APIs:16").setDexSplitMode(new AndroidBinaryRule.DexSplitMode(true,ZipSplitter.DexSplitStrategy.MAXIMIZE_PRIMARY_DEX_SIZE)).build(ImmutableMap.<String,BuildRule>of());
  Set<String> classpath=Sets.newHashSet();
  ImmutableSet.Builder<String> secondaryDexDirectories=ImmutableSet.builder();
  ImmutableList.Builder<Step> commandsBuilder=ImmutableList.builder();
  String primaryDexPath=BIN_DIR + "/.dex/classes.dex";
  splitDexRule.addDexingCommands(classpath,secondaryDexDirectories,commandsBuilder,primaryDexPath);
  assertEquals("Expected 2 new assets paths (one for metadata.txt and the other for the " + "secondary zips)",2,secondaryDexDirectories.build().size());
  List<Step> steps=commandsBuilder.build();
  assertCommandsInOrder(steps,ImmutableList.<Class<?>>of(SplitZipStep.class,SmartDexingStep.class));
}
