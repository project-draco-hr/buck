{
  BuildTarget target=BuildTarget.builder(params.getBuildTarget()).addFlavors(cxxPlatform.getFlavor()).build();
  Optional<BuildRule> rule=ruleResolver.getRuleOptional(target);
  if (!rule.isPresent()) {
    rule=Optional.of((BuildRule)new HalideLibrary(params.copyWithChanges(target,params.getDeclaredDeps(),params.getExtraDeps()),ruleResolver,getResolver(),srcs,halideCompiler,cxxPlatform,halideBuckConfig));
    ruleResolver.addToIndex(rule.get());
  }
  return rule.get();
}
