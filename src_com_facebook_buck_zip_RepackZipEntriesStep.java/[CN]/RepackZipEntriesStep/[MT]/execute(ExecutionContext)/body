{
  try (ZipInputStream in=new ZipInputStream(new BufferedInputStream(new FileInputStream(inputFile)));CustomZipOutputStream out=ZipOutputStreams.newOutputStream(new File(outputFile))){
    for (ZipEntry entry=in.getNextEntry(); entry != null; entry=in.getNextEntry()) {
      CustomZipEntry customEntry=new CustomZipEntry(entry);
      if (entries.contains(customEntry.getName())) {
        customEntry.setCompressionLevel(compressionLevel);
      }
      out.putNextEntry(customEntry);
      ByteStreams.copy(in,out);
      out.closeEntry();
    }
    return 0;
  }
 catch (  IOException e) {
    context.getBuckEventBus().post(LogEvent.create(Level.SEVERE,"Unable to repack zip: %s",Throwables.getStackTraceAsString(e)));
    return 1;
  }
}
