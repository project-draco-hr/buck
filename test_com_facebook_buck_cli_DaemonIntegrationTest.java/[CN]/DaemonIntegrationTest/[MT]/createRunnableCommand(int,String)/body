{
  return new Runnable(){
    @Override public void run(){
      try {
        Main main=new Main(new CapturingPrintStream(),new CapturingPrintStream());
        int exitCode=main.tryRunMainWithExitCode(new BuildId(),tmp.getRoot(),Optional.<NGContext>of(new TestContext()),args);
        assertEquals("Unexpected exit code.",expectedExitCode,exitCode);
      }
 catch (      IOException e) {
        fail("Should not throw exception.");
        throw Throwables.propagate(e);
      }
catch (      InterruptedException e) {
        fail("Should not throw exception.");
        Thread.currentThread().interrupt();
      }
    }
  }
;
}
