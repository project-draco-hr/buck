{
  ImmutableSet<SourcePath> inputs=builder.getInputsSoFar();
  ImmutableSet<SourcePath> depFileInputs=inputs;
  if (possibleDepFileSourcePaths.isPresent()) {
    Sets.SetView<SourcePath> nonDepFileInputs=Sets.difference(inputs,possibleDepFileSourcePaths.get());
    builder.addToRuleKey(ImmutableSet.copyOf(nonDepFileInputs));
    depFileInputs=ImmutableSet.copyOf(Sets.intersection(inputs,possibleDepFileSourcePaths.get()));
  }
  Optional<RuleKey> ruleKey=builder.build();
  if (ruleKey.isPresent()) {
    return Optional.of(new Pair<>(ruleKey.get(),depFileInputs));
  }
 else {
    return Optional.absent();
  }
}
