{
  ImmutableSet<BuildRule> sourceUnderTest=generateSourceUnderTest(sourcesUnderTest,ruleResolver);
  ImmutableList.Builder<String> allVmArgs=ImmutableList.builder();
  allVmArgs.addAll(vmArgs);
  AnnotationProcessingParams processingParams=getAnnotationProcessingBuilder().build(ruleResolver);
  javacOptions.setAnnotationProcessingData(processingParams);
  BuildRuleParams buildRuleParams=createBuildRuleParams(ruleResolver);
  AndroidLibraryGraphEnhancer.Result result=new AndroidLibraryGraphEnhancer(buildTarget,buildRuleParams,params).createBuildableForAndroidResources(ruleResolver,true);
  Optional<DummyRDotJava> dummyRDotJava=result.getOptionalDummyRDotJava();
  ImmutableSet<String> additionalClasspathEntries=dummyRDotJava.isPresent() ? ImmutableSet.of(dummyRDotJava.get().getRDotJavaBinFolder().toString()) : ImmutableSet.<String>of();
  return new RobolectricTestRule(result.getBuildRuleParams(),srcs,resources,labels,contacts,proguardConfig,additionalClasspathEntries,javacOptions.build(),allVmArgs.build(),sourceUnderTest,result.getOptionalDummyRDotJava());
}
