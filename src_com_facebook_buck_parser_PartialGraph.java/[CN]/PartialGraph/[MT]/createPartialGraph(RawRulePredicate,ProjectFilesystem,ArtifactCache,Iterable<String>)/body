{
  List<Map<String,Object>> ruleObjects=BuildFileToJsonParser.getAllRulesInProject(projectFilesystem.getProjectRoot(),includes);
  KnownBuildRuleTypes buildRuleTypes=new KnownBuildRuleTypes();
  BuildFileTree buildFiles=BuildFileTree.constructBuildFileTree(projectFilesystem);
  Parser parser=new Parser(projectFilesystem,buildRuleTypes,artifactCache,buildFiles);
  List<BuildTarget> targets=parser.parseRawRules(ruleObjects,predicate);
  DependencyGraph graph=parser.parseBuildFilesForTargets(targets,includes);
  return new PartialGraph(graph,targets);
}
