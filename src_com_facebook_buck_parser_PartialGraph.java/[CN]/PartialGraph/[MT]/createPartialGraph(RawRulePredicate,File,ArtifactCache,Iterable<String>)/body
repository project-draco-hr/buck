{
  List<Map<String,Object>> ruleObjects=BuildFileToJsonParser.getAllRulesInProject(projectDirectoryRoot,includes);
  ProjectFilesystem filesystem=new ProjectFilesystem(projectDirectoryRoot);
  BuildFileTree buildFiles=BuildFileTree.constructBuildFileTree(filesystem);
  Parser parser=new Parser(filesystem,artifactCache,buildFiles);
  List<BuildTarget> targets=parser.parseRawRules(ruleObjects,predicate);
  DependencyGraph graph=parser.parseBuildFilesForTargets(targets,includes);
  return new PartialGraph(graph,targets);
}
