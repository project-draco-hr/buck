{
  T builder=newBuilder(params.getAbstractBuildRuleFactoryParams());
  BuildTarget target=params.target;
  builder.setBuildTarget(target);
  for (  String dep : params.getOptionalListAttribute("deps")) {
    BuildTarget buildTarget=params.resolveBuildTarget(dep);
    builder.addDep(buildTarget);
  }
  for (  BuildTargetPattern visiBuildTargetPattern : getVisibilityPatterns(params)) {
    builder.addVisibilityPattern(visiBuildTargetPattern);
  }
  if (builder instanceof SrcsAttributeBuilder) {
    for (    String src : params.getOptionalListAttribute("srcs")) {
      String relativePath=params.resolveFilePathRelativeToBuildFileDirectory(src);
      ((SrcsAttributeBuilder)builder).addSrc(relativePath);
    }
  }
  if (builder instanceof ResourcesAttributeBuilder) {
    ResourcesAttributeBuilder attributeBuilder=(ResourcesAttributeBuilder)builder;
    for (    String resource : params.getOptionalListAttribute("resources")) {
      SourcePath path=params.asSourcePath(resource,builder);
      attributeBuilder.addResource(path);
    }
  }
  amendBuilder(builder,params);
  return builder;
}
