{
  AppleSdkPaths appleSdkPaths=AppleSdkPaths.builder().setDeveloperPath(Paths.get(".")).addToolchainPaths(Paths.get("Toolchains/XcodeDefault.xctoolchain")).setPlatformPath(Paths.get("Platforms/iPhoneOS.platform")).setSdkPath(Paths.get("Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS8.0.sdk")).build();
  ImmutableSet<Path> paths=ImmutableSet.<Path>builder().add(Paths.get("Toolchains/XcodeDefault.xctoolchain/usr/bin/clang")).add(Paths.get("Toolchains/XcodeDefault.xctoolchain/usr/bin/clang++")).add(Paths.get("Toolchains/XcodeDefault.xctoolchain/usr/bin/dsymutil")).add(Paths.get("Toolchains/XcodeDefault.xctoolchain/usr/bin/lipo")).add(Paths.get("Toolchains/XcodeDefault.xctoolchain/usr/bin/ranlib")).add(Paths.get("Toolchains/XcodeDefault.xctoolchain/usr/bin/strip")).add(Paths.get("Toolchains/XcodeDefault.xctoolchain/usr/bin/nm")).add(Paths.get("Platforms/iPhoneOS.platform/Developer/usr/bin/libtool")).add(Paths.get("Platforms/iPhoneOS.platform/Developer/usr/bin/ar")).add(Paths.get("usr/bin/actool")).add(Paths.get("usr/bin/ibtool")).add(Paths.get("usr/bin/lldb")).add(Paths.get("usr/bin/xctest")).add(Paths.get("Tools/otest")).build();
  AppleToolchain toolchain=AppleToolchain.builder().setIdentifier("com.apple.dt.XcodeDefault").setPath(Paths.get("Toolchains/XcodeDefault.xctoolchain")).setVersion("1").build();
  AppleSdk targetSdk=AppleSdk.builder().setApplePlatform(ApplePlatform.IPHONEOS).setName("iphoneos8.0").setVersion("8.0").setToolchains(ImmutableList.of(toolchain)).build();
  Flavor testFlavor=ImmutableFlavor.of("test-flavor");
  BuckConfig config=FakeBuckConfig.builder().setSections(ImmutableMap.of("cxx",ImmutableMap.of("cflags","-std=gnu11","cppflags","-DCTHING","cxxflags","-std=c++11","cxxppflags","-DCXXTHING"),"cxx#" + testFlavor.toString(),ImmutableMap.of("cflags","-Wnoerror","cppflags","-DCTHING2","cxxflags","-Woption","cxxppflags","-DCXXTHING2","default_platform","iphoneos8.0-armv7"))).build();
  AppleCxxPlatform appleCxxPlatform=AppleCxxPlatforms.buildWithExecutableChecker(targetSdk,"7.0","armv7",appleSdkPaths,config,new FakeAppleConfig(),new FakeExecutableFinder(paths),Optional.<ProcessExecutor>absent());
  CxxPlatform defaultCxxPlatform=appleCxxPlatform.getCxxPlatform();
  CxxPlatform cxxPlatform=CxxPlatforms.copyPlatformWithFlavorAndConfig(defaultCxxPlatform,new CxxBuckConfig(config,testFlavor),testFlavor);
  assertThat(cxxPlatform.getCflags(),hasItems("-std=gnu11","-Wnoerror"));
  assertThat(cxxPlatform.getCppflags(),hasItems("-DCTHING","-DCTHING2"));
  assertThat(cxxPlatform.getCxxflags(),hasItems("-std=c++11","-Woption"));
  assertThat(cxxPlatform.getCxxppflags(),hasItems("-DCXXTHING","-DCXXTHING2"));
}
