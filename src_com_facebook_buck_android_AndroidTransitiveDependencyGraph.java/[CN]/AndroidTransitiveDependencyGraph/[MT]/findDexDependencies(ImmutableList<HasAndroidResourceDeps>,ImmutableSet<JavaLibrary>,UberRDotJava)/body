{
  final ImmutableSet.Builder<Path> pathsToDexBuilder=ImmutableSet.builder();
  final ImmutableSet.Builder<Path> noDxPathsBuilder=ImmutableSet.builder();
  final ImmutableSet.Builder<Path> pathsToThirdPartyJarsBuilder=ImmutableSet.builder();
  AndroidResourceDetails details=findAndroidResourceDetails(androidResourceDeps);
  final ImmutableSetMultimap<JavaLibrary,Path> classpath=Classpaths.getClasspathEntries(rulesToTraverseForTransitiveDeps);
  for (  Map.Entry<JavaLibrary,Path> entry : classpath.entries()) {
    if (!buildRulesToExcludeFromDex.contains(entry.getKey())) {
      pathsToDexBuilder.add(entry.getValue());
    }
 else {
      noDxPathsBuilder.add(entry.getValue());
    }
  }
  final ImmutableSet<String> rDotJavaPackages=details.rDotJavaPackages;
  if (!rDotJavaPackages.isEmpty()) {
    Path pathToCompiledRDotJavaFiles=uberRDotJava.getPathToCompiledRDotJavaFiles();
    pathsToDexBuilder.add(pathToCompiledRDotJavaFiles);
  }
  ImmutableSet<Path> noDxPaths=noDxPathsBuilder.build();
  Set<Path> classpathEntries=Sets.difference(pathsToDexBuilder.build(),noDxPaths);
  Supplier<Map<String,HashCode>> classNamesToHashesSupplier=Suppliers.memoize(new Supplier<Map<String,HashCode>>(){
    @Override public Map<String,HashCode> get(){
      ImmutableMap.Builder<String,HashCode> builder=ImmutableMap.builder();
      for (      JavaLibrary javaLibrary : classpath.keySet()) {
        if (!buildRulesToExcludeFromDex.contains(javaLibrary)) {
          builder.putAll(javaLibrary.getClassNamesToHashes());
        }
      }
      if (!rDotJavaPackages.isEmpty()) {
        builder.putAll(uberRDotJava.getClassNamesToHashes());
      }
      return builder.build();
    }
  }
);
  new AbstractDependencyVisitor(rulesToTraverseForTransitiveDeps){
    @Override public ImmutableSet<BuildRule> visit(    BuildRule rule){
      if (rule.getBuildable() instanceof PrebuiltJar) {
        PrebuiltJar prebuiltJar=(PrebuiltJar)rule.getBuildable();
        pathsToThirdPartyJarsBuilder.add(prebuiltJar.getBinaryJar().resolve());
      }
      return maybeVisitAllDeps(rule,rule.getProperties().is(LIBRARY));
    }
  }
.start();
  Set<Path> pathsToThirdPartyJars=Sets.difference(pathsToThirdPartyJarsBuilder.build(),noDxPaths);
  return new AndroidDexTransitiveDependencies(classpathEntries,pathsToThirdPartyJars,noDxPaths,classNamesToHashesSupplier);
}
