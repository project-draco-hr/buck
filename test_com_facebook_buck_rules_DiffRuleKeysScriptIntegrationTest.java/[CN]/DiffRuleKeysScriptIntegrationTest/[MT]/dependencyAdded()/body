{
  ProjectWorkspace workspace=TestDataHelper.createProjectWorkspaceForScenario(this,"diff_rulekeys_script",tmp);
  workspace.setUp();
  invokeBuckCommand(workspace,"buck-0.log");
  workspace.writeContentsToPath(Joiner.on('\n').join("java_library(","  name = 'java_lib_1',","  srcs = [ 'JavaLib1.java'],",")","java_library(","  name = 'java_lib_3',","  srcs = ['JavaLib1.java'],","  deps = [':java_lib_1']",")","java_library(","  name = 'java_lib_2',","  srcs = ['JavaLib2.java'],","  deps = [':java_lib_1', ':java_lib_3']",")"),"BUCK");
  invokeBuckCommand(workspace,"buck-1.log");
  String expectedResult=Joiner.on('\n').join("Change details for [//:java_lib_2->buck.extraDeps]","  (buck.declaredDeps):","    -[ruleKey(sha1=5b71a521ddf1ce1583eb8977e3c0b3f7eead0cee)]\n" + "    +[ruleKey(sha1=9c3d14d371d6c0ca71b8960aa8e5c6f4cb230f7d)]\n" + "Change details for [//:java_lib_2->buck.extraDeps]","  (buck.declaredDeps):","    -[ruleKey(sha1=5b71a521ddf1ce1583eb8977e3c0b3f7eead0cee)]\n" + "    +[ruleKey(sha1=9c3d14d371d6c0ca71b8960aa8e5c6f4cb230f7d)]\n" + "  (name):","    -[string(\"//:java_lib_1#abi\")]","    +[string(\"//:java_lib_3#abi\")]","");
  assertThat(runRuleKeyDiffer(workspace).getStdout(),Matchers.equalTo(Optional.of(expectedResult)));
}
