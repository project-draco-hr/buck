{
  if (path.startsWith(GENFILE_PREFIX)) {
    path=path.substring(GENFILE_PREFIX.length());
    return String.format("%s/%s",BuckConstant.GEN_DIR,resolvePathAgainstBuildTargetBase(path));
  }
 else {
    String fullPath=resolvePathAgainstBuildTargetBase(path);
    File file=filesystem.getFileForRelativePath(fullPath);
    if (Files.isSymbolicLink(file.toPath())) {
      return fullPath;
    }
    if (!ignoreFileExistenceChecks && !file.isFile()) {
      throw new RuntimeException(String.format("Not an ordinary file: %s. Failure when trying to create %s.",fullPath,target));
    }
    String basePath=target.getBasePath();
    if (!basePath.isEmpty() && !fullPath.startsWith(basePath + '/')) {
      throw new RuntimeException(file + " is not a descendant of " + target.getBasePath());
    }
    checkFullPath(fullPath);
    return fullPath;
  }
}
