{
  BuildRuleResolver resolver=new BuildRuleResolver();
  SourcePathResolver pathResolver=new SourcePathResolver(resolver);
  BuildRule dep=GenruleBuilder.newGenruleBuilder(BuildTargetFactory.newInstance("//:dep")).setOut("out").build(resolver);
  ShTest shTest=(ShTest)new ShTestBuilder(BuildTargetFactory.newInstance("//:rule")).setTest(new TestSourcePath("test.sh")).setArgs(ImmutableList.of("$(location //:dep)")).build(resolver);
  assertThat(shTest.getDeps(),Matchers.contains(dep));
  assertThat(FluentIterable.from(shTest.getArgs()).transform(Arg.stringifyFunction()),Matchers.contains(pathResolver.getAbsolutePath(new BuildTargetSourcePath(dep.getBuildTarget())).toString()));
}
