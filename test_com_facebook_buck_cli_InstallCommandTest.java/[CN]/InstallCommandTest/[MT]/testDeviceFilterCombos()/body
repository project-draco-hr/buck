{
  TestDevice realDevice1=createRealDevice("1",IDevice.DeviceState.ONLINE);
  TestDevice realDevice2=createRealDevice("2",IDevice.DeviceState.ONLINE);
  TestDevice emulator1=createEmulator("3",IDevice.DeviceState.ONLINE);
  TestDevice emulator2=createEmulator("4",IDevice.DeviceState.ONLINE);
  IDevice[] devices=new IDevice[]{realDevice1,emulator1,realDevice2,emulator2};
  InstallCommandOptions options=getOptions(AdbOptions.SERIAL_NUMBER_SHORT_ARG,realDevice1.getSerialNumber(),AdbOptions.DEVICE_MODE_LONG_ARG);
  List<IDevice> filteredDevices=installCommand.filterDevices(devices,options.adbOptions());
  assertNotNull(filteredDevices);
  assertEquals(1,filteredDevices.size());
  assertSame(realDevice1,filteredDevices.get(0));
  options=getOptions(AdbOptions.SERIAL_NUMBER_SHORT_ARG,emulator1.getSerialNumber(),AdbOptions.DEVICE_MODE_LONG_ARG);
  filteredDevices=installCommand.filterDevices(devices,options.adbOptions());
  assertNull(filteredDevices);
  options=getOptions(AdbOptions.SERIAL_NUMBER_SHORT_ARG,realDevice1.getSerialNumber(),AdbOptions.EMULATOR_MODE_SHORT_ARG);
  filteredDevices=installCommand.filterDevices(devices,options.adbOptions());
  assertNull(filteredDevices);
  options=getOptions(AdbOptions.SERIAL_NUMBER_SHORT_ARG,emulator1.getSerialNumber(),AdbOptions.EMULATOR_MODE_SHORT_ARG);
  filteredDevices=installCommand.filterDevices(devices,options.adbOptions());
  assertNotNull(filteredDevices);
  assertEquals(1,filteredDevices.size());
  assertSame(emulator1,filteredDevices.get(0));
  options=getOptions(AdbOptions.DEVICE_MODE_LONG_ARG,AdbOptions.EMULATOR_MODE_SHORT_ARG,AdbOptions.MULTI_INSTALL_MODE_SHORT_ARG);
  filteredDevices=installCommand.filterDevices(devices,options.adbOptions());
  assertNotNull(filteredDevices);
  assertEquals(devices.length,filteredDevices.size());
  for (  IDevice device : devices) {
    assertTrue(filteredDevices.contains(device));
  }
}
