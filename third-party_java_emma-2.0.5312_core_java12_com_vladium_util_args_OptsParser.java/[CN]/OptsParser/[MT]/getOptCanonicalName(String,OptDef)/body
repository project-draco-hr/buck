{
  if (optdef.isPattern()) {
    final String canonicalPattern=optdef.getCanonicalName();
    final String[] patterns=optdef.getNames();
    for (int p=0; p < patterns.length; ++p) {
      final String pattern=patterns[p];
      if (n.startsWith(pattern)) {
        return canonicalPattern.concat(n.substring(pattern.length()));
      }
    }
    throw new IllegalStateException("failed to detect pattern prefix for [" + n + "]");
  }
 else {
    return optdef.getCanonicalName();
  }
}
