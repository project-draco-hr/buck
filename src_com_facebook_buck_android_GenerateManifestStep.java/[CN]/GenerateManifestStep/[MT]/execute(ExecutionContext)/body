{
  if (skeletonManifestPath.getNameCount() == 0) {
    throw new HumanReadableException("Skeleton manifest filepath is missing");
  }
  if (outManifestPath.getNameCount() == 0) {
    throw new HumanReadableException("Output Manifest filepath is missing");
  }
  if (libraryManifestPaths == null || libraryManifestPaths.isEmpty()) {
    warnUser(context,"No library manifests found. Aborting manifest merge step.");
    return 1;
  }
  try {
    Files.createParentDirs(outManifestPath.toFile());
  }
 catch (  IOException e) {
    e.printStackTrace(context.getStdErr());
    return 1;
  }
  List<File> libraryManifestFiles=Lists.newArrayList();
  for (  SourcePath path : libraryManifestPaths) {
    libraryManifestFiles.add(path.resolve().toFile());
  }
  File skeletonManifestFile=skeletonManifestPath.toFile();
  ICallback callback=new ICallback(){
    @Override public int queryCodenameApiLevel(    @NonNull String codename){
      return BASE_SDK_LEVEL;
    }
  }
;
  IMergerLog log=MergerLog.wrapSdkLog(new BuckEventAndroidLogger(context.getBuckEventBus()));
  ManifestMerger merger=new ManifestMerger(log,callback);
  File outManifestFile=outManifestPath.toFile();
  if (!merger.process(outManifestFile,skeletonManifestFile,Iterables.toArray(libraryManifestFiles,File.class))) {
    throw new HumanReadableException("Error generating manifest file");
  }
  if (context.getPlatform() == Platform.WINDOWS) {
    try {
      String xmlText=Files.toString(outManifestFile,Charsets.UTF_8);
      xmlText=xmlText.replace("\r\n","\n");
      Files.write(xmlText.getBytes(Charsets.UTF_8),outManifestFile);
    }
 catch (    IOException e) {
      throw new HumanReadableException("Error converting line endings of manifest file");
    }
  }
  return 0;
}
