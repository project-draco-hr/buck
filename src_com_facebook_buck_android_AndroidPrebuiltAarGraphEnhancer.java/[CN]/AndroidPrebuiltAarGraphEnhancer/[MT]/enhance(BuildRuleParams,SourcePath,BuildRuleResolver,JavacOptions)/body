{
  SourcePathResolver pathResolver=new SourcePathResolver(ruleResolver);
  UnflavoredBuildTarget originalBuildTarget=originalBuildRuleParams.getBuildTarget().checkUnflavored();
  BuildRuleParams unzipAarParams=originalBuildRuleParams.copyWithChanges(BuildTargets.createFlavoredBuildTarget(originalBuildTarget,AAR_UNZIP_FLAVOR),Suppliers.ofInstance(originalBuildRuleParams.getDeclaredDeps()),Suppliers.ofInstance(originalBuildRuleParams.getExtraDeps()));
  UnzipAar unzipAar=new UnzipAar(unzipAarParams,pathResolver,aarFile);
  ruleResolver.addToIndex(unzipAar);
  SourcePath classesJar=new BuildTargetSourcePath(unzipAar.getProjectFilesystem(),unzipAar.getBuildTarget(),unzipAar.getPathToClassesJar());
  BuildRuleParams prebuiltJarParams=originalBuildRuleParams.copyWithChanges(BuildTargets.createFlavoredBuildTarget(originalBuildTarget,AAR_PREBUILT_JAR_FLAVOR),Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>of(unzipAar)),Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>of()));
  PrebuiltJar prebuiltJar=new PrebuiltJar(prebuiltJarParams,pathResolver,classesJar,Optional.<SourcePath>absent(),Optional.<SourcePath>absent(),Optional.<String>absent());
  ruleResolver.addToIndex(prebuiltJar);
  SourcePath manifest=new BuildTargetSourcePath(unzipAar.getProjectFilesystem(),unzipAar.getBuildTarget(),unzipAar.getAndroidManifest());
  BuildRuleParams androidResourceParams=originalBuildRuleParams.copyWithChanges(BuildTargets.createFlavoredBuildTarget(originalBuildTarget,AAR_ANDROID_RESOURCE_FLAVOR),Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>of(unzipAar)),Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>of()));
  ImmutableSortedSet<Path> resSrcs=ImmutableSortedSet.of();
  ImmutableSortedSet<Path> assetsSrcs=ImmutableSortedSet.of();
  AndroidResource androidResource=new AndroidResource(androidResourceParams,pathResolver,ImmutableSortedSet.<BuildRule>of(unzipAar),new BuildTargetSourcePath(unzipAar.getProjectFilesystem(),unzipAar.getBuildTarget(),unzipAar.getResDirectory()),resSrcs,null,new BuildTargetSourcePath(unzipAar.getProjectFilesystem(),unzipAar.getBuildTarget(),unzipAar.getAssetsDirectory()),assetsSrcs,manifest,false);
  ruleResolver.addToIndex(androidResource);
  BuildRuleParams androidLibraryParams=originalBuildRuleParams.copyWithChanges(BuildTarget.of(originalBuildTarget),Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>of(androidResource,prebuiltJar,unzipAar)),Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>of()));
  return new AndroidPrebuiltAar(androidLibraryParams,pathResolver,new BuildTargetSourcePath(unzipAar.getProjectFilesystem(),unzipAar.getBuildTarget(),unzipAar.getProguardConfig()),unzipAar.getNativeLibsDirectory(),prebuiltJar,androidResource,javacOptions);
}
