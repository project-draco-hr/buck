{
  BuildRuleResolver buildRuleResolver=new BuildRuleResolver();
  SourcePathResolver sourcePathResolver=new SourcePathResolver(buildRuleResolver);
  BuildTarget target=BuildTargetFactory.newInstance("//:target");
  BuildRuleParams params=BuildRuleParamsFactory.createTrivialBuildRuleParams(target);
  ProjectFilesystem filesystem=new AllExistingProjectFilesystem();
  Joiner space=Joiner.on(" ");
  ImmutableList<String> explicitCompilerFlags=ImmutableList.of("-explicit-compilerflag");
  SourcePath as=new TestSourcePath("as");
  ImmutableList<String> asflags=ImmutableList.of("-asflag","-asflag");
  SourcePath cc=new TestSourcePath("cc");
  ImmutableList<String> cflags=ImmutableList.of("-cflag","-cflag");
  SourcePath cxx=new TestSourcePath("cxx");
  ImmutableList<String> cxxflags=ImmutableList.of("-cxxflag","-cxxflag");
  FakeBuckConfig buckConfig=new FakeBuckConfig(ImmutableMap.<String,Map<String,String>>of("cxx",ImmutableMap.<String,String>builder().put("as",sourcePathResolver.getPath(as).toString()).put("asflags",space.join(asflags)).put("cc",sourcePathResolver.getPath(cc).toString()).put("cflags",space.join(cflags)).put("cxx",sourcePathResolver.getPath(cxx).toString()).put("cxxflags",space.join(cxxflags)).build()),filesystem);
  CxxPlatform platform=DefaultCxxPlatforms.build(PROJECT_FILESYSTEM,buckConfig);
  String cSourceName="test.i";
  List<String> cSourcePerFileFlags=ImmutableList.of("-c-source-par-file-flag");
  CxxSource cSource=ImmutableCxxSource.of(CxxSource.Type.C_CPP_OUTPUT,new TestSourcePath(cSourceName),cSourcePerFileFlags);
  CxxCompile cCompile=CxxCompilableEnhancer.createCompileBuildRule(params,buildRuleResolver,platform,explicitCompilerFlags,false,cSourceName,cSource);
  assertContains(cCompile.getFlags(),explicitCompilerFlags);
  assertContains(cCompile.getFlags(),cflags);
  assertContains(cCompile.getFlags(),asflags);
  assertContains(cCompile.getFlags(),cSourcePerFileFlags);
  String cxxSourceName="test.ii";
  List<String> cxxSourcePerFileFlags=ImmutableList.of("-cxx-source-par-file-flag");
  CxxSource cxxSource=ImmutableCxxSource.of(CxxSource.Type.CXX_CPP_OUTPUT,new TestSourcePath(cxxSourceName),cxxSourcePerFileFlags);
  CxxCompile cxxCompile=CxxCompilableEnhancer.createCompileBuildRule(params,buildRuleResolver,platform,explicitCompilerFlags,false,cxxSourceName,cxxSource);
  assertContains(cxxCompile.getFlags(),explicitCompilerFlags);
  assertContains(cxxCompile.getFlags(),cxxflags);
  assertContains(cxxCompile.getFlags(),asflags);
  assertContains(cxxCompile.getFlags(),cxxSourcePerFileFlags);
  String cCppOutputSourceName="test.i";
  List<String> cCppOutputSourcePerFileFlags=ImmutableList.of("-c-cpp-output-source-par-file-flag");
  CxxSource cCppOutputSource=ImmutableCxxSource.of(CxxSource.Type.C_CPP_OUTPUT,new TestSourcePath(cCppOutputSourceName),cCppOutputSourcePerFileFlags);
  CxxCompile cCppOutputCompile=CxxCompilableEnhancer.createCompileBuildRule(params,buildRuleResolver,platform,explicitCompilerFlags,false,cCppOutputSourceName,cCppOutputSource);
  assertContains(cCppOutputCompile.getFlags(),explicitCompilerFlags);
  assertContains(cCppOutputCompile.getFlags(),cflags);
  assertContains(cCppOutputCompile.getFlags(),asflags);
  assertContains(cCppOutputCompile.getFlags(),cCppOutputSourcePerFileFlags);
  String assemblerSourceName="test.s";
  List<String> assemblerSourcePerFileFlags=ImmutableList.of("-assember-source-par-file-flag");
  CxxSource assemblerSource=ImmutableCxxSource.of(CxxSource.Type.ASSEMBLER,new TestSourcePath(assemblerSourceName),assemblerSourcePerFileFlags);
  CxxCompile assemblerCompile=CxxCompilableEnhancer.createCompileBuildRule(params,buildRuleResolver,platform,explicitCompilerFlags,false,assemblerSourceName,assemblerSource);
  assertContains(assemblerCompile.getFlags(),asflags);
  assertContains(assemblerCompile.getFlags(),assemblerSourcePerFileFlags);
}
