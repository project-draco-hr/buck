{
  ImmutableList.Builder<Pair<String,String>> results=ImmutableList.builder();
  Matcher matcher=MACRO_PATTERN.matcher(blob);
  while (matcher.find()) {
    if (matcher.start() > 0 && blob.charAt(matcher.start() - 1) == '\\') {
      continue;
    }
    String name=matcher.group(1);
    if (!macros.contains(name)) {
      throw new MacroException(String.format("no such macro \"%s\"",name));
    }
    String input=Optional.fromNullable(matcher.group(2)).or("");
    results.add(new Pair<>(name,input));
  }
  return results.build();
}
