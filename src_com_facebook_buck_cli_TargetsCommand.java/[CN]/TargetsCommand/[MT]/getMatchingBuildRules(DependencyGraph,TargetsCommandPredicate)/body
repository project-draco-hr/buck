{
  AbstractBottomUpTraversal<BuildRule,SortedMap<String,BuildRule>> traversal=new AbstractBottomUpTraversal<BuildRule,SortedMap<String,BuildRule>>(graph){
    final SortedMap<String,BuildRule> matchingBuildRules=Maps.newTreeMap();
    @Override public void visit(    BuildRule rule){
      if (predicate.apply(rule)) {
        matchingBuildRules.put(rule.getFullyQualifiedName(),rule);
      }
    }
    @Override public SortedMap<String,BuildRule> getResult(){
      return matchingBuildRules;
    }
  }
;
  traversal.traverse();
  return traversal.getResult();
}
