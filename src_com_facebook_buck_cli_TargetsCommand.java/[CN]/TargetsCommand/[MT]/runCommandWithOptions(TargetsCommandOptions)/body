{
  if (options.isResolveAlias()) {
    return doResolveAlias(options);
  }
  ImmutableSet<String> types=options.getTypes();
  ImmutableSet.Builder<BuildRuleType> buildRuleTypesBuilder=ImmutableSet.builder();
  for (  String name : types) {
    try {
      buildRuleTypesBuilder.add(BuildRuleType.valueOf(name.toUpperCase()));
    }
 catch (    IllegalArgumentException e) {
      console.printFailure("Invalid build rule type: " + name);
      return 1;
    }
  }
  Parser parser=createParser();
  ImmutableSet<BuildTarget> matchingBuildTargets;
  try {
    matchingBuildTargets=ImmutableSet.copyOf(getBuildTargets(parser,options.getArgumentsFormattedAsBuildTargets()));
  }
 catch (  NoSuchBuildTargetException e) {
    console.printFailureWithoutStacktrace(e);
    return 1;
  }
  PartialGraph graph;
  try {
    graph=PartialGraph.createFullGraph(getProjectFilesystem().getProjectRoot(),options.getDefaultIncludes());
  }
 catch (  NoSuchBuildTargetException e) {
    console.printFailureWithoutStacktrace(e);
    return 1;
  }
  SortedMap<String,BuildRule> matchingBuildRules=getMatchingBuildRules(graph.getDependencyGraph(),new TargetsCommandPredicate(graph,buildRuleTypesBuilder.build(),options.getReferencedFiles(getProjectFilesystem().getProjectRoot()),matchingBuildTargets));
  if (options.getPrintJson()) {
    printJsonForTargets(matchingBuildRules,options.getDefaultIncludes());
  }
 else {
    printTargetsList(matchingBuildRules,options.isShowOutput());
  }
  return 0;
}
