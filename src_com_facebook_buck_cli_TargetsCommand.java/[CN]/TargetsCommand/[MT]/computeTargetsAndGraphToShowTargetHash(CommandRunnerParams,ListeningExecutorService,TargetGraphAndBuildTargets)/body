{
  if (isDetectTestChanges()) {
    ImmutableSet<BuildTarget> explicitTestTargets;
    explicitTestTargets=TargetGraphAndTargets.getExplicitTestTargets(targetGraphAndBuildTargets.getBuildTargets(),targetGraphAndBuildTargets.getTargetGraph(),true);
    LOG.debug("Got explicit test targets: %s",explicitTestTargets);
    Iterable<BuildTarget> matchingBuildTargetsWithTests=Sets.union(targetGraphAndBuildTargets.getBuildTargets(),explicitTestTargets);
    TargetGraph targetGraphWithTests=params.getParser().buildTargetGraph(params.getBuckEventBus(),params.getCell(),getEnableProfiling(),executor,matchingBuildTargetsWithTests);
    return TargetGraphAndBuildTargets.builder().setTargetGraph(targetGraphWithTests).setBuildTargets(matchingBuildTargetsWithTests).build();
  }
 else {
    return targetGraphAndBuildTargets;
  }
}
