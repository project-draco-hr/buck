{
  Optional<ImmutableSet<BuildRuleType>> buildRuleTypes=getBuildRuleTypesFromParams(params);
  if (!buildRuleTypes.isPresent()) {
    return 1;
  }
  if (isShowOutput() || isShowRuleKey() || isShowTargetHash()) {
    ImmutableMap<BuildTarget,ShowOptions> showRulesResult;
    TargetGraphAndBuildTargets targetGraphAndBuildTargetsForShowRules=buildTargetGraphAndTargetsForShowRules(params,executor,buildRuleTypes);
    showRulesResult=computeShowRules(params,executor,TargetGraphAndTargetNodes.fromTargetGraphAndBuildTargets(targetGraphAndBuildTargetsForShowRules));
    if (shouldUseJsonFormat()) {
      Iterable<TargetNode<?>> matchingNodes=targetGraphAndBuildTargetsForShowRules.getTargetGraph().getAll(targetGraphAndBuildTargetsForShowRules.getBuildTargets());
      printJsonForTargets(params,executor,matchingNodes,showRulesResult,getOutputAttributes());
    }
 else {
      printShowRules(showRulesResult,params);
    }
    return 0;
  }
  TargetGraphAndBuildTargets graphAndTargets=buildTargetGraphAndTargets(params,executor);
  SortedMap<String,TargetNode<?>> matchingNodes=getMatchingNodes(params,graphAndTargets,buildRuleTypes);
  return printResults(params,executor,matchingNodes);
}
