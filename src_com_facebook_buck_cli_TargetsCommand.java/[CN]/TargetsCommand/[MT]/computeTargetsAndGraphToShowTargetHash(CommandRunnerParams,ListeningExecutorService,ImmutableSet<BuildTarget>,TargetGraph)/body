{
  Iterable<BuildTarget> matchingBuildTargetsWithTests;
  final TargetGraph targetGraphWithTests;
  if (isDetectTestChanges()) {
    ImmutableSet<BuildTarget> explicitTestTargets;
    explicitTestTargets=TargetGraphAndTargets.getExplicitTestTargets(matchingBuildTargets,targetGraph,true);
    LOG.debug("Got explicit test targets: %s",explicitTestTargets);
    matchingBuildTargetsWithTests=Sets.union(matchingBuildTargets,explicitTestTargets);
    targetGraphWithTests=params.getParser().buildTargetGraph(params.getBuckEventBus(),params.getCell(),getEnableProfiling(),executor,matchingBuildTargetsWithTests);
  }
 else {
    matchingBuildTargetsWithTests=matchingBuildTargets;
    targetGraphWithTests=targetGraph;
  }
  return new Pair<>(matchingBuildTargetsWithTests,targetGraphWithTests);
}
