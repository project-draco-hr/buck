{
  boolean isDependent=true;
  if (referencedInputs != null) {
    isDependent=!Collections.disjoint(graph.getOutgoingNodesFor(rule),dependentTargets);
    if (!isDependent && basePathOfTargets.contains(rule.getBuildTarget().getBasePath())) {
      for (      Path input : rule.getInputs()) {
        if (referencedInputs.contains(input)) {
          isDependent=true;
          break;
        }
      }
      if (referencedInputs.contains(rule.getBuildTarget().getBuildFilePath())) {
        isDependent=true;
      }
    }
    if (isDependent) {
      dependentTargets.add(rule);
    }
  }
  if (!matchingBuildRules.isEmpty() && !matchingBuildRules.contains(rule.getBuildTarget())) {
    return false;
  }
  return (isDependent && (buildRuleTypes.isEmpty() || buildRuleTypes.contains(rule.getType())));
}
