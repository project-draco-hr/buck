{
  File cacheDir=tmpDir.newFolder();
  File fileX=tmpDir.newFile("x");
  fileHashCache=new FakeFileHashCache(ImmutableMap.of(fileX.toPath(),HashCode.fromInt(0)));
  dirArtifactCache=new DirArtifactCache("dir",new ProjectFilesystem(cacheDir.toPath()),Paths.get("."),true,Optional.<Long>absent());
  Files.write("x",fileX,Charsets.UTF_8);
  RuleKey ruleKey1=new RuleKey("aaaa");
  RuleKey ruleKey2=new RuleKey("bbbb");
  dirArtifactCache.store(ImmutableSet.of(ruleKey1,ruleKey2),ImmutableMap.<String,String>of(),fileX);
  assertEquals(CacheResult.Type.HIT,dirArtifactCache.fetch(ruleKey1,fileX).getType());
  assertEquals(CacheResult.Type.HIT,dirArtifactCache.fetch(ruleKey2,fileX).getType());
}
