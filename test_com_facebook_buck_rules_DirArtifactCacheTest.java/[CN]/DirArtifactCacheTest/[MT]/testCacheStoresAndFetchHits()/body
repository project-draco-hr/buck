{
  File cacheDir=tmpDir.newFolder();
  File fileX=tmpDir.newFile("x");
  File fileY=tmpDir.newFile("y");
  File fileZ=tmpDir.newFile("z");
  DirArtifactCache dirArtifactCache=new DirArtifactCache(cacheDir);
  Files.write("x",fileX,Charsets.UTF_8);
  Files.write("y",fileY,Charsets.UTF_8);
  Files.write("z",fileZ,Charsets.UTF_8);
  InputRule inputRuleX=new InputRuleForTest(fileX);
  InputRule inputRuleY=new InputRuleForTest(fileY);
  InputRule inputRuleZ=new InputRuleForTest(fileZ);
  assertFalse(inputRuleX.equals(inputRuleY));
  assertFalse(inputRuleX.equals(inputRuleZ));
  assertFalse(inputRuleY.equals(inputRuleZ));
  RuleKey ruleKeyX=RuleKey.builder(inputRuleX).build().getTotalRuleKey();
  RuleKey ruleKeyY=RuleKey.builder(inputRuleY).build().getTotalRuleKey();
  RuleKey ruleKeyZ=RuleKey.builder(inputRuleZ).build().getTotalRuleKey();
  assertEquals(CacheResult.MISS,dirArtifactCache.fetch(ruleKeyX,fileX));
  assertEquals(CacheResult.MISS,dirArtifactCache.fetch(ruleKeyY,fileY));
  assertEquals(CacheResult.MISS,dirArtifactCache.fetch(ruleKeyZ,fileZ));
  dirArtifactCache.store(ruleKeyX,fileX);
  dirArtifactCache.store(ruleKeyY,fileY);
  dirArtifactCache.store(ruleKeyZ,fileZ);
  assertTrue(fileX.delete());
  assertTrue(fileY.delete());
  assertTrue(fileZ.delete());
  assertEquals(CacheResult.DIR_HIT,dirArtifactCache.fetch(ruleKeyX,fileX));
  assertEquals(CacheResult.DIR_HIT,dirArtifactCache.fetch(ruleKeyY,fileY));
  assertEquals(CacheResult.DIR_HIT,dirArtifactCache.fetch(ruleKeyZ,fileZ));
  assertEquals(inputRuleX,new InputRuleForTest(fileX));
  assertEquals(inputRuleY,new InputRuleForTest(fileY));
  assertEquals(inputRuleZ,new InputRuleForTest(fileZ));
}
