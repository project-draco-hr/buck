{
  File cacheDir=tmpDir.newFolder();
  File fileX=tmpDir.newFile("x");
  DirArtifactCache dirArtifactCache=new DirArtifactCache(cacheDir,Optional.<Long>absent());
  Files.write("x",fileX,Charsets.UTF_8);
  InputRule inputRuleX=new InputRuleForTest(fileX);
  RuleKey ruleKeyX=RuleKey.builder(inputRuleX,new NullFileHashCache()).build().getTotalRuleKey();
  dirArtifactCache.store(ruleKeyX,fileX);
  assertEquals(CacheResult.DIR_HIT,dirArtifactCache.fetch(ruleKeyX,fileX));
  assertEquals(inputRuleX,new InputRuleForTest(fileX));
  assertTrue(fileX.delete());
  assertEquals(CacheResult.DIR_HIT,dirArtifactCache.fetch(ruleKeyX,fileX));
  assertEquals(inputRuleX,new InputRuleForTest(fileX));
}
