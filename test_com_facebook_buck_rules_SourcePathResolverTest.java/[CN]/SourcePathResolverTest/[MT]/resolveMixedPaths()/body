{
  BuildRuleResolver resolver=new BuildRuleResolver();
  SourcePathResolver pathResolver=new SourcePathResolver(resolver);
  Path pathSourcePathExpectedPath=Paths.get("foo");
  Path buildRuleSourcePathExpectedPath=Paths.get("bar");
  Path buildRuleWithOverriddenOutputPathExpectedPath=Paths.get("baz");
  SourcePath pathSourcePath=new PathSourcePath(pathSourcePathExpectedPath);
  BuildRule rule=new OutputOnlyBuildRule(new FakeBuildRuleParamsBuilder(BuildTargetFactory.newInstance("//:bar")).build(),pathResolver,buildRuleSourcePathExpectedPath);
  resolver.addToIndex(rule);
  SourcePath buildRuleSourcePath=new BuildRuleSourcePath(rule);
  BuildRule ruleWithOverriddenOutputPath=new OutputOnlyBuildRule(new FakeBuildRuleParamsBuilder(BuildTargetFactory.newInstance("//:baz")).build(),pathResolver,Paths.get("notbaz"));
  resolver.addToIndex(ruleWithOverriddenOutputPath);
  SourcePath buildRuleSourcePathWithOverriddenOutputPath=new BuildRuleSourcePath(ruleWithOverriddenOutputPath,buildRuleWithOverriddenOutputPathExpectedPath);
  assertEquals(ImmutableList.of(pathSourcePathExpectedPath,buildRuleSourcePathExpectedPath,buildRuleWithOverriddenOutputPathExpectedPath),pathResolver.getAllPaths(ImmutableList.of(pathSourcePath,buildRuleSourcePath,buildRuleSourcePathWithOverriddenOutputPath)));
}
