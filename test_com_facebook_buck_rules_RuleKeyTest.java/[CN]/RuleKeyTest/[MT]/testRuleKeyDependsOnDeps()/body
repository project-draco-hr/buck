{
  Map<String,BuildRule> buildRuleIndex=Maps.newHashMap();
  DefaultJavaLibraryRule commonRule=DefaultJavaLibraryRule.newJavaLibraryRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//src/com/facebook/buck/cli:common")).setArtifactCache(artifactCache).build(buildRuleIndex);
  buildRuleIndex.put("//src/com/facebook/buck/cli:common",commonRule);
  DefaultJavaLibraryRule.Builder javaLibraryBuilder=DefaultJavaLibraryRule.newJavaLibraryRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//src/com/facebook/buck/cli:cli")).addSrc("src/com/facebook/buck/cli/Main.java").setArtifactCache(artifactCache);
  DefaultJavaLibraryRule libraryNoCommon=javaLibraryBuilder.build(buildRuleIndex);
  javaLibraryBuilder.addDep("//src/com/facebook/buck/cli:common");
  DefaultJavaLibraryRule libraryWithCommon=javaLibraryBuilder.setArtifactCache(artifactCache).build(buildRuleIndex);
  RuleKey r1=libraryNoCommon.getRuleKey();
  RuleKey r2=libraryWithCommon.getRuleKey();
  assertThat("Rule keys should be distinct because the deps of the rules are different.",r1,not(equalTo(r2)));
}
