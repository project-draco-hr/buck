{
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  ruleResolver.buildAndAddToIndex(DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(BuildTargetFactory.newInstance("//src/com/facebook/buck/cli:common")));
  DefaultJavaLibraryRule.Builder javaLibraryBuilder=DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(BuildTargetFactory.newInstance("//src/com/facebook/buck/cli:cli")).addSrc("src/com/facebook/buck/cli/Main.java");
  DefaultJavaLibraryRule libraryNoCommon=ruleResolver.buildAndAddToIndex(javaLibraryBuilder);
  javaLibraryBuilder.addDep(BuildTargetFactory.newInstance("//src/com/facebook/buck/cli:common"));
  DefaultJavaLibraryRule libraryWithCommon=ruleResolver.buildAndAddToIndex(javaLibraryBuilder);
  RuleKey r1=libraryNoCommon.getRuleKey();
  RuleKey r2=libraryWithCommon.getRuleKey();
  assertThat("Rule keys should be distinct because the deps of the rules are different.",r1,not(equalTo(r2)));
}
