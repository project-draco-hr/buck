{
  FakeProjectFilesystem filesystem=new FakeProjectFilesystem();
  BuildRuleResolver ruleResolver1=new BuildRuleResolver();
  BuildRuleResolver ruleResolver2=new BuildRuleResolver();
  JavaLibraryBuilder builder=JavaLibraryBuilder.createBuilder(BuildTargetFactory.newInstance("//src/com/facebook/buck/cli:common"));
  BuildRule commonJavaLibrary=builder.build(ruleResolver1);
  builder.build(ruleResolver2);
  Path mainSrc=Paths.get("src/com/facebook/buck/cli/Main.java");
  filesystem.mkdirs(mainSrc.getParent());
  filesystem.writeContentsToPath("hello",mainSrc);
  JavaLibraryBuilder javaLibraryBuilder=JavaLibraryBuilder.createBuilder(BuildTargetFactory.newInstance("//src/com/facebook/buck/cli:cli")).addSrc(mainSrc);
  BuildRule libraryNoCommon=javaLibraryBuilder.build(ruleResolver1,filesystem);
  javaLibraryBuilder.addDep(commonJavaLibrary.getBuildTarget());
  BuildRule libraryWithCommon=javaLibraryBuilder.build(ruleResolver2,filesystem);
  RuleKey r1=libraryNoCommon.getRuleKey();
  RuleKey r2=libraryWithCommon.getRuleKey();
  assertThat("Rule keys should be distinct because the deps of the rules are different.",r1,not(equalTo(r2)));
}
