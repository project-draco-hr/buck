{
  BuildRuleResolver ruleResolver1=new BuildRuleResolver();
  BuildRuleResolver ruleResolver2=new BuildRuleResolver();
  ProjectFilesystem projectFilesystem=new ProjectFilesystem(new File("."));
  final FileHashCache fileHashCache=new DefaultFileHashCache(projectFilesystem,new TestConsole());
  AbstractBuildRuleBuilderParams builderParams=new DefaultBuildRuleBuilderParams(projectFilesystem,new RuleKeyBuilderFactory(){
    @Override public Builder newInstance(    BuildRule buildRule){
      return RuleKey.builder(buildRule,fileHashCache);
    }
  }
);
  DefaultJavaLibraryRule.Builder commonJavaLibraryRuleBuilder=DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(builderParams).setBuildTarget(BuildTargetFactory.newInstance("//src/com/facebook/buck/cli:common"));
  ruleResolver1.buildAndAddToIndex(commonJavaLibraryRuleBuilder);
  ruleResolver2.buildAndAddToIndex(commonJavaLibraryRuleBuilder);
  DefaultJavaLibraryRule.Builder javaLibraryBuilder=DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(builderParams).setBuildTarget(BuildTargetFactory.newInstance("//src/com/facebook/buck/cli:cli")).addSrc(Paths.get("src/com/facebook/buck/cli/Main.java"));
  DefaultJavaLibraryRule libraryNoCommon=ruleResolver1.buildAndAddToIndex(javaLibraryBuilder);
  javaLibraryBuilder.addDep(BuildTargetFactory.newInstance("//src/com/facebook/buck/cli:common"));
  DefaultJavaLibraryRule libraryWithCommon=ruleResolver2.buildAndAddToIndex(javaLibraryBuilder);
  RuleKey r1=libraryNoCommon.getRuleKey();
  RuleKey r2=libraryWithCommon.getRuleKey();
  assertThat("Rule keys should be distinct because the deps of the rules are different.",r1,not(equalTo(r2)));
}
