{
  ProjectFilesystem projectFilesystem=new FakeProjectFilesystem();
  BuildRuleResolver resolver=new BuildRuleResolver();
  SourcePathResolver pathResolver=new SourcePathResolver(resolver);
  BuildTarget target=BuildTargetFactory.newInstance("//foo/bar:baz");
  FakeBuildRule rule=new FakeBuildRule(ImmutableBuildRuleType.of("example"),target,pathResolver);
  rule.setRuleKey(RuleKey.TO_RULE_KEY.apply("cafebabe"));
  rule.setOutputFile("cheese.txt");
  resolver.addToIndex(rule);
  ImmutableSortedSet<SourcePath> sourcePaths=ImmutableSortedSet.<SourcePath>of(new BuildTargetSourcePath(projectFilesystem,rule.getBuildTarget()),new TestSourcePath("alpha/beta"));
  ImmutableSet<String> strings=ImmutableSet.of("one","two");
  RuleKey.Builder.RuleKeyPair reflective=createEmptyRuleKey(pathResolver).setReflectively("sourcePaths",sourcePaths).setReflectively("strings",strings).build();
  RuleKey.Builder.RuleKeyPair manual=createEmptyRuleKey(pathResolver).setSourcePaths("sourcePaths",sourcePaths).set("strings",strings).build();
  assertEquals(manual.getTotalRuleKey(),reflective.getTotalRuleKey());
}
