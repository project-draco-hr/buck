{
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  BuildTarget libraryOneTarget=BuildTargetFactory.newInstance("//:libone");
  BuildTarget javacTarget=BuildTargetFactory.newInstance("//langtools:javac");
  BuildRule javac=PrebuiltJarBuilder.createBuilder(javacTarget).setBinaryJar(Paths.get("java/src/com/libone/JavacJar.jar")).build(ruleResolver);
  BuildRule rule=JavaLibraryBuilder.createBuilder(libraryOneTarget).addSrc(Paths.get("java/src/com/libone/Bar.java")).setCompiler(javac).build(ruleResolver);
  DefaultJavaLibrary buildable=(DefaultJavaLibrary)rule;
  ImmutableList.Builder<Step> stepsBuilder=ImmutableList.builder();
  buildable.createCommandsForJavac(buildable.getPathToOutput(),ImmutableSet.copyOf(buildable.getTransitiveClasspathEntries().values()),ImmutableSet.copyOf(buildable.getDeclaredClasspathEntries().values()),buildable.getJavacOptions(),BuildDependencies.FIRST_ORDER_ONLY,Optional.<JavacStep.SuggestBuildRules>absent(),stepsBuilder,libraryOneTarget);
  List<Step> steps=stepsBuilder.build();
  assertEquals(steps.size(),3);
  assertTrue(((JavacStep)steps.get(2)).getJavac() instanceof Jsr199Javac);
  JarBackedJavac jsrJavac=((JarBackedJavac)(((JavacStep)steps.get(2)).getJavac()));
  assertEquals(jsrJavac.getJavacJar(),new BuildTargetSourcePath(javac.getProjectFilesystem(),javac.getBuildTarget()));
}
