{
  ProjectPredicates projectPredicates=ProjectPredicates.forIde(targetIde);
  ImmutableSet<BuildTarget> graphRoots;
  if (!passedInTargetsSet.isEmpty()) {
    graphRoots=passedInTargetsSet;
  }
 else {
    graphRoots=ProjectCommand.getRootsFromPredicate(projectGraph,projectPredicates.getProjectRootsPredicate());
  }
  ImmutableSet<BuildTarget> explicitTests;
  if (withTests) {
    explicitTests=TargetGraphAndTargets.getExplicitTestTargets(graphRoots,projectGraph);
  }
 else {
    explicitTests=ImmutableSet.of();
  }
  return TargetGraphAndTargets.create(graphRoots,projectGraph,projectPredicates.getAssociatedProjectPredicate(),withTests,explicitTests);
}
