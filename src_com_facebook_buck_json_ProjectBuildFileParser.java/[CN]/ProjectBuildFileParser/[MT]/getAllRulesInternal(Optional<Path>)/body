{
  ensureNotClosed();
  initIfNeeded();
  Preconditions.checkNotNull(buckPyStdoutParser);
  Preconditions.checkNotNull(buckPyStdinWriter);
  Preconditions.checkNotNull(buckPyProcess);
  Preconditions.checkState(buildFile.isPresent() == isServerMode);
  if (buildFile.isPresent()) {
    buckPyStdinWriter.write(buildFile.get().toString());
    buckPyStdinWriter.newLine();
    buckPyStdinWriter.flush();
  }
  LOG.debug("Parsing output of process %s...",buckPyProcess);
  List<Map<String,Object>> result=buckPyStdoutParser.nextRules();
  LOG.debug("Parsed %d rules from process",result.size());
  return result;
}
