{
  Optional<Path> externalJavac=getJavacPath();
  if (externalJavac.isPresent()) {
    if (!getProcessExecutor().isPresent()) {
      throw new RuntimeException("Misconfigured JavacOptions --- no process executor");
    }
    return ExternalJavac.createJavac(externalJavac.get(),getProcessExecutor().get());
  }
  Optional<SourcePath> javacJarPath=getJavacJarPath();
  if (javacJarPath.isPresent()) {
    return new JarBackedJavac("com.sun.tools.javac.api.JavacTool",ImmutableSet.of(javacJarPath.get()));
  }
  return new JdkProvidedInMemoryJavac();
}
