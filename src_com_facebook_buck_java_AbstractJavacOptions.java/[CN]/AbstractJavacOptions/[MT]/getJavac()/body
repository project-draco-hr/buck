{
  Optional<Path> externalJavac=getJavacPath();
  if (externalJavac.isPresent()) {
    if (!getProcessExecutor().isPresent()) {
      throw new RuntimeException("Misconfigured JavacOptions --- no process executor");
    }
    ProcessExecutorParams params=ProcessExecutorParams.builder().setCommand(ImmutableList.of(externalJavac.get().toString(),"-version")).build();
    ProcessExecutor.Result result;
    try {
      result=getProcessExecutor().get().launchAndExecute(params);
    }
 catch (    InterruptedException|IOException e) {
      throw new RuntimeException(e);
    }
    Optional<JavacVersion> version;
    Optional<String> stderr=result.getStderr();
    if (Strings.isNullOrEmpty(stderr.orNull())) {
      version=Optional.absent();
    }
 else {
      version=Optional.of(JavacVersion.of(stderr.get()));
    }
    return new ExternalJavac(externalJavac.get(),version);
  }
  Optional<SourcePath> javacJarPath=getJavacJarPath();
  if (javacJarPath.isPresent()) {
    return new JarBackedJavac(javacJarPath.get());
  }
  return new JdkProvidedInMemoryJavac();
}
