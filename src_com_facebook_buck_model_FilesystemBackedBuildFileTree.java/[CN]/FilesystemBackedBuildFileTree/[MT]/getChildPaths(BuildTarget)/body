{
  final ImmutableSet.Builder<Path> childPaths=ImmutableSet.builder();
  final Path basePath=target.getBasePath();
  final Set<Path> ignoredPaths=FluentIterable.from(projectFilesystem.getIgnorePaths()).filter(PathOrGlobMatcher.isPath()).transform(PathOrGlobMatcher.toPath()).toSet();
  try {
    projectFilesystem.walkRelativeFileTree(basePath,new SimpleFileVisitor<Path>(){
      @Override public FileVisitResult preVisitDirectory(      Path dir,      BasicFileAttributes attrs){
        if (ignoredPaths.contains(dir)) {
          return FileVisitResult.SKIP_SUBTREE;
        }
        if (dir.equals(basePath)) {
          return FileVisitResult.CONTINUE;
        }
        Path buildFile=dir.resolve(buildFileName);
        if (pathExistenceCache.getUnchecked(buildFile)) {
          childPaths.add(basePath.relativize(dir));
          return FileVisitResult.SKIP_SUBTREE;
        }
        return FileVisitResult.CONTINUE;
      }
    }
);
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
  return childPaths.build();
}
