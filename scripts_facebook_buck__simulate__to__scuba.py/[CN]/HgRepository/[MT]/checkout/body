def checkout(self, rev):
    if (rev is None):
        rev = u'null'
    cmd = [u'hg', u'update', u'--clean', rev]
    try:
        self.run(cmd)
    except subprocess.CalledProcessError as ex:
        if (ex.output and (u"unknown revision '-1'" in ex.output)):
            cmd.extend([u'--config', u'extensions.remotenames=!'])
            self.run(cmd)
        else:
            raise
