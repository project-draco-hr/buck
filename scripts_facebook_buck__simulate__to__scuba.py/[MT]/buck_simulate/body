def buck_simulate(targets, num_threads, repository, times_file, time_aggregate, report_file):
    cmd = [u'buck', u'simulate', u'--report-file', report_file, u'--num-threads', str(num_threads), u'--time-aggregate', time_aggregate]
    if times_file:
        cmd.extend((u'--times-file', times_file))
    cmd.extend(targets)
    sys.stdout.flush()
    return run_cmd(cmd, cwd=repository)
