{
  String command;
  if (context.getPlatform() == Platform.WINDOWS) {
    String commandInUse;
    if (cmdExe.isPresent()) {
      commandInUse=cmdExe.get();
    }
 else     if (cmd.isPresent()) {
      commandInUse=cmd.get();
    }
 else {
      throw new HumanReadableException("You must specify either cmd_exe or cmd for genrule %s.",getFullyQualifiedName());
    }
    command=replaceMatches(context.getProjectFilesystem(),commandInUse);
    return ImmutableList.of("cmd.exe","/c",command);
  }
 else {
    String commandInUse;
    if (bash.isPresent()) {
      commandInUse=bash.get();
    }
 else     if (cmd.isPresent()) {
      commandInUse=cmd.get();
    }
 else {
      throw new HumanReadableException("You must specify either bash or cmd for genrule %s.",getFullyQualifiedName());
    }
    command=replaceMatches(context.getProjectFilesystem(),commandInUse);
    return ImmutableList.of("/bin/bash","-c",command);
  }
}
