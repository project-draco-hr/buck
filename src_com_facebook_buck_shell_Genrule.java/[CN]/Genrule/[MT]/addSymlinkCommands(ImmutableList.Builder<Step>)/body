{
  String basePath=getBuildTarget().getBasePathWithSlash();
  int basePathLength=basePath.length();
  for (  Map.Entry<String,String> entry : srcsToAbsolutePaths.entrySet()) {
    String localPath=entry.getKey();
    String canonicalPath;
    try {
      canonicalPath=new File(entry.getValue()).getCanonicalPath();
    }
 catch (    IOException e) {
      throw new HumanReadableException("Unable to determine the canonical path for: %s. Does the file exist?",localPath);
    }
    if (entry.getValue().equals(canonicalPath)) {
      if (localPath.startsWith(basePath)) {
        localPath=localPath.substring(basePathLength);
      }
 else {
        localPath=new File(canonicalPath).getName();
      }
    }
    String destination=pathToSrcDirectory + "/" + localPath;
    commands.add(new MkdirAndSymlinkFileStep(entry.getKey(),destination));
  }
}
