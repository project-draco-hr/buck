{
  String basePath=getBuildTarget().getBasePathWithSlash();
  int basePathLength=basePath.length();
  for (  Map.Entry<String,Path> entry : srcsToAbsolutePaths.entrySet()) {
    String localPath=entry.getKey();
    Path canonicalPath;
    canonicalPath=MorePaths.absolutify(entry.getValue());
    if (entry.getValue().equals(canonicalPath)) {
      if (localPath.startsWith(basePath)) {
        localPath=localPath.substring(basePathLength);
      }
 else {
        localPath=canonicalPath.getFileName().toString();
      }
    }
    String destination=pathToSrcDirectory + "/" + localPath;
    commands.add(new MkdirAndSymlinkFileStep(entry.getKey(),destination));
  }
}
