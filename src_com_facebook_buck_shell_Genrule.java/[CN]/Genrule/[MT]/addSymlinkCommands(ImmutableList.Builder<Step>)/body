{
  String basePath=getBuildTarget().getBasePathWithSlash();
  int basePathLength=basePath.length();
  for (  Map.Entry<Path,Path> entry : srcsToAbsolutePaths.entrySet()) {
    String localPath=MorePaths.pathWithUnixSeparators(entry.getKey());
    Path canonicalPath;
    canonicalPath=MorePaths.absolutify(entry.getValue());
    if (entry.getValue().equals(canonicalPath)) {
      if (localPath.startsWith(basePath)) {
        localPath=localPath.substring(basePathLength);
      }
 else {
        localPath=canonicalPath.getFileName().toString();
      }
    }
    Path destination=pathToSrcDirectory.resolve(localPath);
    commands.add(new MkdirAndSymlinkFileStep(entry.getKey(),destination));
  }
}
