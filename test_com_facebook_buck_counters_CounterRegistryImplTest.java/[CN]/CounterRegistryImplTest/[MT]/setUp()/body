{
  this.countersStartEvent=EasyMock.newCapture();
  this.countersFinishEvent=EasyMock.newCapture();
  this.mockFuture=EasyMock.createMock(ScheduledFuture.class);
  this.flushCountersRunnable=EasyMock.newCapture();
  this.eventBus=EasyMock.createNiceMock(BuckEventBus.class);
  this.executor=EasyMock.createNiceMock(ScheduledThreadPoolExecutor.class);
  this.eventBus.post(EasyMock.capture(countersStartEvent));
  EasyMock.expectLastCall();
  this.eventBus.post(EasyMock.capture(countersFinishEvent));
  EasyMock.expectLastCall();
  EasyMock.expect(this.executor.scheduleAtFixedRate(EasyMock.capture(flushCountersRunnable),EasyMock.anyInt(),EasyMock.anyInt(),EasyMock.anyObject(TimeUnit.class))).andReturn(this.mockFuture);
  EasyMock.expect(this.mockFuture.cancel(EasyMock.anyBoolean())).andReturn(true).once();
  EasyMock.replay(eventBus,executor,mockFuture);
}
