{
  try {
    Path tempFile=createTempFile(filesystem,target,input);
    String expanded;
    if (delegate instanceof MacroExpanderWithCustomFileOutput) {
      expanded=((MacroExpanderWithCustomFileOutput)delegate).expandForFile(target,resolver,filesystem,input);
    }
 else {
      expanded=delegate.expand(target,resolver,filesystem,input);
    }
    filesystem.writeContentsToPath(expanded,tempFile);
    return "@" + filesystem.getAbsolutifier().apply(tempFile);
  }
 catch (  IOException e) {
    throw new MacroException("Unable to create file to hold expanded results",e);
  }
}
