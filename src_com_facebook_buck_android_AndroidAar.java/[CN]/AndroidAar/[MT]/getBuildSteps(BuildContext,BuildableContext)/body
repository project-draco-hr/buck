{
  ImmutableList.Builder<Step> commands=ImmutableList.builder();
  commands.add(new MakeCleanDirectoryStep(temp));
  commands.add(new RmStep(pathToOutputFile,true));
  commands.add(CopyStep.forFile(manifest.getPathToOutput(),temp.resolve("AndroidManifest.xml")));
  commands.add(CopyStep.forFile(androidResource.getPathToOutput(),temp.resolve("R.txt")));
  commands.add(CopyStep.forDirectory(assembleResourceDirectories.getPathToOutput(),temp.resolve("res"),CopyStep.DirectoryMode.CONTENTS_ONLY));
  commands.add(CopyStep.forDirectory(assembleAssetsDirectories.getPathToOutput(),temp.resolve("assets"),CopyStep.DirectoryMode.CONTENTS_ONLY));
  commands.add(new JarDirectoryStep(temp.resolve("classes.jar"),ImmutableSet.copyOf(getTransitiveClasspathEntries().values()),null,null));
  for (  Path dir : nativeLibsDirectories) {
    commands.add(CopyStep.forDirectory(dir,temp.resolve("jni"),CopyStep.DirectoryMode.CONTENTS_ONLY));
  }
  for (  Path dir : nativeLibAssetsDirectories) {
    CopyNativeLibraries.copyNativeLibrary(dir,temp.resolve("assets").resolve("lib"),ImmutableSet.<TargetCpuType>of(),commands);
  }
  commands.add(new ZipStep(pathToOutputFile,ImmutableSet.<Path>of(),false,ZipStep.DEFAULT_COMPRESSION_LEVEL,temp));
  return commands.build();
}
