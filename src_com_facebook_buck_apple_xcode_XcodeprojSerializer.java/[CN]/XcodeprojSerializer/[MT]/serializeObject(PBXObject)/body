{
  if (obj.getGlobalID() == null) {
    obj.setGlobalID(obj.generateGid(gidGenerator));
  }
 else {
    NSObject object=objects.get(obj.getGlobalID());
    if (object != null) {
      return obj.getGlobalID();
    }
  }
  NSDictionary stack=currentObject;
  currentObject=new NSDictionary();
  currentObject.put("isa",obj.isa());
  obj.serializeInto(this);
  objects.put(obj.getGlobalID(),currentObject);
  currentObject=stack;
  return obj.getGlobalID();
}
