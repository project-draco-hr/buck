{
  ImmutableSet.Builder<DexProducedFromJavaLibrary> preDexDeps=ImmutableSet.builder();
  ImmutableSet<JavaLibrary> transitiveJavaDeps=Classpaths.getClasspathEntries(originalDeps).keySet();
  for (  JavaLibrary javaLibrary : transitiveJavaDeps) {
    if (javaLibrary.getPathToOutputFile() == null) {
      continue;
    }
    if (buildRulesToExcludeFromDex.contains(javaLibrary.getBuildTarget())) {
      continue;
    }
    BuildTarget originalTarget=javaLibrary.getBuildTarget();
    BuildTarget preDexTarget=new BuildTarget(originalTarget.getBaseName(),originalTarget.getShortName(),DEX_FLAVOR);
    BuildRule preDexRule=ruleResolver.get(preDexTarget);
    if (preDexRule != null) {
      preDexDeps.add((DexProducedFromJavaLibrary)preDexRule.getBuildable());
      continue;
    }
    preDexRule=ruleResolver.buildAndAddToIndex(DexProducedFromJavaLibrary.newBuilder(buildRuleBuilderParams).setBuildTarget(preDexTarget).setJavaLibraryToDex(javaLibrary).addVisibilityPattern(BuildTargetPattern.MATCH_ALL));
    preDexDeps.add((DexProducedFromJavaLibrary)preDexRule.getBuildable());
  }
  ImmutableSet<DexProducedFromJavaLibrary> allPreDexDeps=preDexDeps.build();
  BuildTarget buildTargetForDexMerge=createBuildTargetWithFlavor(DEX_MERGE_FLAVOR);
  BuildRule preDexMergeBuildRule=ruleResolver.buildAndAddToIndex(PreDexMerge.newPreDexMergeBuilder(buildRuleBuilderParams).setBuildTarget(buildTargetForDexMerge).setPrimaryDexPath(primaryDexPath).setDexSplitMode(dexSplitMode).setPreDexDeps(allPreDexDeps).setUberRDotJava(uberRDotJava));
  return preDexMergeBuildRule;
}
