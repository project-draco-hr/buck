{
  ImmutableSet<DexProducedFromJavaLibrary> allPreDexDeps=createPreDexRulesForLibraries(preDexRulesNotInThePackageableCollection,packageableCollection);
  BuildRuleParams paramsForPreDexMerge=buildRuleParams.copyWithChanges(createBuildTargetWithFlavor(DEX_MERGE_FLAVOR),Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>naturalOrder().addAll(getDexMergeDeps(aaptPackageResources,allPreDexDeps)).build()),Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>of()));
  PreDexMerge preDexMerge=new PreDexMerge(paramsForPreDexMerge,pathResolver,primaryDexPath,dexSplitMode,allPreDexDeps,aaptPackageResources,dxExecutorService,xzCompressionLevel);
  ruleResolver.addToIndex(preDexMerge);
  return preDexMerge;
}
