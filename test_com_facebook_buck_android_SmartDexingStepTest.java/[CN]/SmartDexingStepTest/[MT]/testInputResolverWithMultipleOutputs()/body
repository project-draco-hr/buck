{
  File primaryOutDir=tmpDir.newFolder("primary-out");
  File primaryOut=new File(primaryOutDir,"primary.jar");
  Set<Path> primaryIn=ImmutableSet.of(Paths.get("input/a.jar"),Paths.get("input/b.jar"),Paths.get("input/c.jar"));
  File secondaryOutDir=tmpDir.newFolder("secondary-out");
  File secondaryInDir=tmpDir.newFolder("secondary-in");
  File secondaryInFile=new File(secondaryInDir,"2.jar");
  Files.write(new byte[]{0},secondaryInFile);
  Multimap<Path,Path> secondaryOutputToInputFiles=ImmutableListMultimap.of(Paths.get(new File(secondaryOutDir,"2.dex.jar").getPath()),Paths.get(secondaryInFile.getPath()));
  InputResolver resolver=new InputResolver(Paths.get("primary-out/primary.jar"),Suppliers.ofInstance(primaryIn),Optional.of(Paths.get("secondary-out")),Optional.of(Suppliers.ofInstance(secondaryOutputToInputFiles)));
  assertTrue("Expected secondary output",resolver.hasSecondaryOutput());
  final ProjectFilesystem projectFilesystem=new ProjectFilesystem(tmpDir.getRoot());
  Multimap<File,File> outputToInputs=resolver.createOutputToInputs(projectFilesystem);
  assertEquals("Expected 2 output artifacts",2,outputToInputs.keySet().size());
  MoreAsserts.assertIterablesEquals("Detected inconsistency with primary input arguments",Iterables.transform(primaryIn,new Function<Path,File>(){
    @Override public File apply(    Path input){
      return projectFilesystem.getFileForRelativePath(input);
    }
  }
),outputToInputs.get(primaryOut));
  File secondaryOutFile=new File(secondaryOutDir,"2.dex.jar");
  MoreAsserts.assertIterablesEquals("Detected inconsistency with secondary output arguments",ImmutableSet.of(secondaryInFile),outputToInputs.get(secondaryOutFile));
}
