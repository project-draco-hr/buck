{
  BuildRule library=appleLibraryDescription.createBuildRule(params.copyWithChanges(AppleLibraryDescription.TYPE,BuildTarget.builder(params.getBuildTarget()).addFlavors(LIBRARY_FLAVOR).addFlavors(CxxDescriptionEnhancer.SHARED_FLAVOR).addFlavors(ImmutableFlavor.of("default")).build(),params.getDeclaredDeps(),params.getExtraDeps()),resolver,args);
  SourcePathResolver sourcePathResolver=new SourcePathResolver(resolver);
  AppleBundle bundle=new AppleBundle(params.copyWithChanges(AppleBundleDescription.TYPE,BuildTarget.builder(params.getBuildTarget()).addFlavors(BUNDLE_FLAVOR).build(),ImmutableSortedSet.of(library),ImmutableSortedSet.<BuildRule>of()),sourcePathResolver,args.extension,args.infoPlist,library,args.xcodeProductType);
  return new AppleTest(params.copyWithDeps(ImmutableSortedSet.<BuildRule>of(bundle),ImmutableSortedSet.<BuildRule>of()),sourcePathResolver,bundle,args.contacts.get(),args.labels.get(),resolver.getAllRules(args.sourceUnderTest.get()));
}
