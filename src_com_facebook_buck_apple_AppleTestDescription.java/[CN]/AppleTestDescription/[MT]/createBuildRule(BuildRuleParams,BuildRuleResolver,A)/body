{
  BuildRule library=appleLibraryDescription.createBuildRule(params.copyWithChanges(AppleLibraryDescription.TYPE,BuildTarget.builder(params.getBuildTarget()).addFlavor(LIBRARY_FLAVOR).addFlavor(CxxDescriptionEnhancer.SHARED_FLAVOR).addFlavor("default").build(),params.getDeclaredDeps(),params.getExtraDeps()),resolver,args);
  SourcePathResolver sourcePathResolver=new SourcePathResolver(resolver);
  AppleBundle bundle=new AppleBundle(params.copyWithChanges(AppleBundleDescription.TYPE,BuildTarget.builder(params.getBuildTarget()).addFlavor(BUNDLE_FLAVOR).build(),ImmutableSortedSet.of(library),ImmutableSortedSet.<BuildRule>of()),sourcePathResolver,args.extension,args.infoPlist,library);
  return new AppleTest(params.copyWithDeps(ImmutableSortedSet.<BuildRule>of(bundle),ImmutableSortedSet.<BuildRule>of()),sourcePathResolver,bundle,args.contacts.get(),args.labels.get(),resolver.getAllRules(args.sourceUnderTest.get()));
}
