{
  List<ListenableFuture<Void>> responses=Lists.newArrayList();
  StringBuilder concatenatedLines=new StringBuilder();
  for (  String line : lines) {
    StringBuilder toAdd=new StringBuilder();
    if (concatenatedLines.length() > 0) {
      toAdd.append('\n');
    }
    try {
      toAdd.append(URLEncoder.encode(line,"UTF-8"));
    }
 catch (    UnsupportedEncodingException e) {
      return Futures.immediateFailedFuture(Throwables.propagate(e));
    }
    if (concatenatedLines.length() + toAdd.length() >= maxRequestSizeBytes) {
      responses.add(submit(category,concatenatedLines));
      concatenatedLines=new StringBuilder();
    }
    concatenatedLines.append(toAdd);
  }
  if (concatenatedLines.length() > 0) {
    responses.add(submit(category,concatenatedLines));
  }
  return toVoid(Futures.allAsList(responses));
}
