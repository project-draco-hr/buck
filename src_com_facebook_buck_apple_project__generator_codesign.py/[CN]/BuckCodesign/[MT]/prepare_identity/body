def prepare_identity(self):
    signature = self.get_output_for_command([self.codesign_tool_path, '-vvvv', '-d', self.app_bundle_path])
    for line in signature.splitlines():
        if line.startswith(AUTHORITY_MARKER):
            self.identity = line[len(AUTHORITY_MARKER):].strip()
            print ('Found identity: ' + self.identity)
            break
    if (not hasattr(self, 'identity')):
        print ('Unable to find identity information from signature:\n' + signature)
        sys.exit(1)
