{
  expect(watchService.poll()).andReturn(key).andReturn(null);
  expect(key.pollEvents()).andReturn(Lists.<WatchEvent<?>>newArrayList(event));
  expect(event.kind()).andReturn(StandardWatchEventKinds.ENTRY_DELETE).anyTimes();
  expect(key.reset()).andReturn(false);
  eventBus.post(anyObject(WatchEvent.class));
  replay(filesystem,eventBus,watchService,path,key,event);
  watcher=new ProjectFilesystemWatcher(filesystem,eventBus,ImmutableSet.<String>of(),watchService);
  visitor.getValue().preVisitDirectory(path,null);
  watcher.postEvents();
  verify(filesystem,eventBus,watchService,path,key,event);
}
