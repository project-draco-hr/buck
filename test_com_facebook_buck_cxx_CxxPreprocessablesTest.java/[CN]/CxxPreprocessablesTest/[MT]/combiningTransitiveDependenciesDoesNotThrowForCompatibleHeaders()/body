{
  SourcePathResolver pathResolver=new SourcePathResolver(new BuildRuleResolver(TargetGraph.EMPTY,new BuildTargetNodeToBuildRuleTransformer()));
  CxxPlatform cxxPlatform=DefaultCxxPlatforms.build(new CxxBuckConfig(FakeBuckConfig.builder().build()));
  CxxPreprocessorInput bottomInput=CxxPreprocessorInput.builder().setIncludes(CxxHeaders.builder().putNameToPathMap(Paths.get("prefix/file.h"),new FakeSourcePath("common/file.h")).putFullNameToPathMap(Paths.get("buck-out/something/prefix/file.h"),new FakeSourcePath("common/file.h")).build()).build();
  BuildRule bottom=createFakeCxxPreprocessorDep("//:bottom",pathResolver,bottomInput);
  CxxPreprocessorInput topInput=CxxPreprocessorInput.builder().setIncludes(CxxHeaders.builder().putNameToPathMap(Paths.get("prefix/file.h"),new FakeSourcePath("common/file.h")).putFullNameToPathMap(Paths.get("buck-out/something-else/prefix/file.h"),new FakeSourcePath("common/file.h")).build()).build();
  BuildRule top=createFakeCxxPreprocessorDep("//:top",pathResolver,topInput,bottom);
  CxxPreprocessorInput expected=CxxPreprocessorInput.builder().setIncludes(CxxHeaders.builder().putNameToPathMap(Paths.get("prefix/file.h"),new FakeSourcePath("common/file.h")).putFullNameToPathMap(Paths.get("buck-out/something/prefix/file.h"),new FakeSourcePath("common/file.h")).putFullNameToPathMap(Paths.get("buck-out/something-else/prefix/file.h"),new FakeSourcePath("common/file.h")).build()).build();
  assertEquals(expected,CxxPreprocessorInput.concat(CxxPreprocessables.getTransitiveCxxPreprocessorInput(TargetGraph.EMPTY,cxxPlatform,ImmutableList.of(top))));
}
