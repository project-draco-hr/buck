{
  Path destinationDir=Paths.get("");
  Path rDotJavaSrcDir=Paths.get("");
  ExecutionContext context=createMock(ExecutionContext.class);
  FakeProjectFileSystem fileSystem=new FakeProjectFileSystem();
  expect(context.getProjectFilesystem()).andStubReturn(fileSystem);
  ImmutableSet<Path> filteredStringFiles=ImmutableSet.of(firstFile,secondFile,thirdFile,fourthFile);
  replayAll();
  CompileStringsStep step=new CompileStringsStep(filteredStringFiles,rDotJavaSrcDir,destinationDir);
  assertEquals(0,step.execute(context));
  Map<String,byte[]> fileContentsMap=fileSystem.getFileContents();
  assertEquals("Incorrect number of string files written.",3,fileContentsMap.size());
  for (  Map.Entry<String,byte[]> entry : fileContentsMap.entrySet()) {
    File expectedFile=testdataDir.resolve(entry.getKey()).toFile();
    assertArrayEquals(createBinaryStream(expectedFile),fileContentsMap.get(entry.getKey()));
  }
  verifyAll();
}
