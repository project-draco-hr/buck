{
  String mode="overwrite";
  Set<String> instrumentDirectories=ImmutableSet.of("root/directory1","directory2");
  ExecutionContext context=createMock(ExecutionContext.class);
  replay(context);
  List<String> expectedShellCommand=ImmutableList.of("java","-classpath",JUnitCommand.PATH_TO_EMMA_JAR,"emma","instr","-outmode",mode,"-outfile",String.format("%s/coverage.em",JUnitCommand.EMMA_OUTPUT_DIR),"-instrpath","root/directory1,directory2");
  InstrumentCommand command=new InstrumentCommand(mode,instrumentDirectories);
  MoreAsserts.assertListEquals(expectedShellCommand,command.getShellCommand(context));
  verify(context);
}
