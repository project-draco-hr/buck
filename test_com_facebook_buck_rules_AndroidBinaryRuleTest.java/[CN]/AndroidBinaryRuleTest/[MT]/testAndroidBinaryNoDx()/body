{
  Map<String,BuildRule> buildRuleIndex=Maps.newHashMap();
  JavaLibraryRule libraryOne=createAndroidLibraryRule("//java/src/com/facebook/base:libraryOne",buildRuleIndex,null,null,null);
  JavaLibraryRule libraryTwo=createAndroidLibraryRule("//java/src/com/facebook/base:libraryTwo",buildRuleIndex,null,null,null);
  BuildTarget binaryBuildTarget=BuildTargetFactory.newInstance("//java/src/com/facebook/base:apk");
  AndroidBinaryRule androidBinary=AndroidBinaryRule.newAndroidBinaryRuleBuilder().setBuildTarget(binaryBuildTarget).addDep(libraryOne.getFullyQualifiedName()).addDep(libraryTwo.getFullyQualifiedName()).addBuildRuleToExcludeFromDex("//java/src/com/facebook/base:libraryTwo").setManifest("java/src/com/facebook/base/AndroidManifest.xml").setTarget("Google Inc.:Google APIs:16").setKeystorePropertiesPath("java/src/com/facebook/base/keystore.properties").setPackageType("debug").build(buildRuleIndex);
  buildRuleIndex.put(androidBinary.getFullyQualifiedName(),androidBinary);
  DependencyGraph graph=RuleMap.createGraphFromBuildRules(buildRuleIndex);
  AndroidTransitiveDependencies transitiveDependencies=androidBinary.findTransitiveDependencies(graph,Optional.<BuildContext>absent());
  ImmutableList.Builder<Step> commands=ImmutableList.builder();
  androidBinary.addProguardCommands(transitiveDependencies,commands,ImmutableSet.<String>of());
  MakeCleanDirectoryStep expectedClean=new MakeCleanDirectoryStep("buck-out/gen/java/src/com/facebook/base/.proguard/apk");
  GenProGuardConfigStep expectedGenProguard=new GenProGuardConfigStep("buck-out/bin/java/src/com/facebook/base/__manifest_apk__/AndroidManifest.xml",ImmutableSet.<String>of(),"buck-out/gen/java/src/com/facebook/base/.proguard/apk/proguard.txt");
  ProGuardObfuscateStep expectedObfuscation=new ProGuardObfuscateStep("buck-out/gen/java/src/com/facebook/base/.proguard/apk/proguard.txt",ImmutableSet.<String>of(),false,ImmutableMap.of("buck-out/gen/java/src/com/facebook/base/lib__libraryOne__output/libraryOne.jar","buck-out/gen/java/src/com/facebook/base/.proguard/apk/buck-out/gen/java/src/com/" + "facebook/base/lib__libraryOne__output/libraryOne-obfuscated.jar"),ImmutableSet.of("buck-out/gen/java/src/com/facebook/base/lib__libraryTwo__output/libraryTwo.jar"),"buck-out/gen/java/src/com/facebook/base/.proguard/apk");
  assertEquals(ImmutableList.of(expectedClean,expectedGenProguard,expectedObfuscation),commands.build());
}
