{
  final SourcePathResolver pathResolver=new SourcePathResolver(resolver);
  final ImmutableList<com.facebook.buck.rules.args.Arg> testArgs=FluentIterable.from(args.args.or(ImmutableList.<String>of())).transform(MacroArg.toMacroArgFunction(MACRO_HANDLER,params.getBuildTarget(),params.getCellRoots(),resolver)).toList();
  return new ShTest(params.appendExtraDeps(new Supplier<Iterable<? extends BuildRule>>(){
    @Override public Iterable<? extends BuildRule> get(){
      return FluentIterable.from(testArgs).transformAndConcat(com.facebook.buck.rules.args.Arg.getDepsFunction(pathResolver));
    }
  }
),pathResolver,args.test,testArgs,args.testRuleTimeoutMs.or(defaultTestRuleTimeoutMs),args.labels.get());
}
