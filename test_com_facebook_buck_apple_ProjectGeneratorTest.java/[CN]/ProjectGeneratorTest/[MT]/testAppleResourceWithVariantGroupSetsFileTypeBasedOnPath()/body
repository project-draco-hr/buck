{
  BuildTarget resourceTarget=BuildTarget.builder("//foo","resource").build();
  TargetNode<?> resourceNode=AppleResourceBuilder.createBuilder(resourceTarget).setFiles(ImmutableSet.<SourcePath>of()).setDirs(ImmutableSet.<SourcePath>of()).setVariants(Optional.<Map<String,Map<String,SourcePath>>>of(ImmutableMap.<String,Map<String,SourcePath>>of("Bar.storyboard",ImmutableMap.<String,SourcePath>of("Base",new TestSourcePath("Base.lproj/Bar.storyboard"))))).build();
  BuildTarget fooLibraryTarget=BuildTarget.builder("//foo","lib").build();
  TargetNode<?> fooLibraryNode=AppleLibraryBuilder.createBuilder(fooLibraryTarget).setDeps(Optional.of(ImmutableSortedSet.of(resourceTarget))).build();
  BuildTarget bundleTarget=BuildTarget.builder("//foo","bundle").build();
  TargetNode<?> bundleNode=AppleBundleBuilder.createBuilder(bundleTarget).setExtension(Either.<AppleBundleExtension,String>ofLeft(AppleBundleExtension.BUNDLE)).setBinary(fooLibraryTarget).setDeps(Optional.of(ImmutableSortedSet.of(resourceTarget))).build();
  ProjectGenerator projectGenerator=createProjectGeneratorForCombinedProject(ImmutableSet.of(fooLibraryNode,bundleNode,resourceNode),ImmutableSet.<ProjectGenerator.Option>of());
  projectGenerator.createXcodeProjects();
  PBXProject project=projectGenerator.getGeneratedProject();
  PBXGroup targetGroup=project.getMainGroup().getOrCreateChildGroupByName(bundleTarget.getFullyQualifiedName());
  PBXGroup resourcesGroup=targetGroup.getOrCreateChildGroupByName("Resources");
  PBXVariantGroup storyboardGroup=(PBXVariantGroup)Iterables.get(resourcesGroup.getChildren(),0);
  PBXFileReference baseStoryboardReference=storyboardGroup.getOrCreateVariantFileReferenceByNameAndSourceTreePath("Base",new SourceTreePath(PBXReference.SourceTree.SOURCE_ROOT,Paths.get("Base.lproj/Bar.storyboard")));
  assertEquals("Base",baseStoryboardReference.getName());
  assertEquals(Optional.of("file.storyboard"),baseStoryboardReference.getLastKnownFileType());
  assertEquals(Optional.<String>absent(),baseStoryboardReference.getExplicitFileType());
}
