{
  Optional<Path> buck=new ExecutableFinder().getOptionalExecutable(Paths.get("buck"),ImmutableMap.<String,String>of());
  assumeThat(buck.isPresent(),is(true));
  BuildTarget binaryTarget=BuildTarget.builder(rootPath,"//foo","binary").build();
  TargetNode<?> binaryNode=AppleBinaryBuilder.createBuilder(binaryTarget).setConfigs(Optional.of(ImmutableSortedMap.of("Debug",ImmutableMap.<String,String>of()))).setSrcs(Optional.of(ImmutableSortedSet.of(SourceWithFlags.of(new TestSourcePath("foo.m"),ImmutableList.of("-foo"))))).build();
  ImmutableSet<TargetNode<?>> nodes=ImmutableSet.<TargetNode<?>>of(binaryNode);
  ProjectGenerator projectGenerator=new ProjectGenerator(TargetGraphFactory.newInstance(nodes),FluentIterable.from(nodes).transform(HasBuildTarget.TO_TARGET).toSet(),projectFilesystem,OUTPUT_DIRECTORY,PROJECT_NAME,"BUCK",ImmutableSet.<ProjectGenerator.Option>of(),Optional.of(binaryTarget),ImmutableList.of("--flag","value with spaces"),new AlwaysFoundExecutableFinder(),ImmutableMap.<String,String>of(),PLATFORMS,DEFAULT_PLATFORM,Functions.<Path>constant(null),getFakeBuckEventBus());
  projectGenerator.createXcodeProjects();
  PBXTarget buildWithBuckTarget=null;
  for (  PBXTarget target : projectGenerator.getGeneratedProject().getTargets()) {
    if (target.getProductName() != null && target.getProductName().endsWith("-Buck")) {
      buildWithBuckTarget=target;
    }
  }
  assertThat(buildWithBuckTarget,is(notNullValue()));
  assertHasConfigurations(buildWithBuckTarget,"Debug");
  assertKeepsConfigurationsInMainGroup(projectGenerator.getGeneratedProject(),buildWithBuckTarget);
  assertEquals("Should have exact number of build phases",1,buildWithBuckTarget.getBuildPhases().size());
  PBXBuildPhase buildPhase=Iterables.getOnlyElement(buildWithBuckTarget.getBuildPhases());
  assertThat(buildPhase,instanceOf(PBXShellScriptBuildPhase.class));
  PBXShellScriptBuildPhase shellScriptBuildPhase=(PBXShellScriptBuildPhase)buildPhase;
  assertThat(shellScriptBuildPhase.getShellScript(),containsString("buck build --flag 'value with spaces' " + binaryTarget.getFullyQualifiedName()));
}
