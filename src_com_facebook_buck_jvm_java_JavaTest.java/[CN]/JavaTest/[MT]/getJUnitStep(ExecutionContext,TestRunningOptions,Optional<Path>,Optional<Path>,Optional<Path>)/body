{
  Set<String> testClassNames=getClassNamesForSources();
  Iterable<String> reorderedTestClasses=reorderClasses(testClassNames,options.isShufflingTests());
  ImmutableList<String> properVmArgs=amendVmArgs(this.vmArgs,executionContext.getTargetDeviceOptional());
  JUnitJvmArgs args=JUnitJvmArgs.builder().setTestType(testType).setDirectoryForTestResults(outDir).setTmpDirectory(tempDir).setClasspathFile(getClassPathFile()).setTestRunnerClasspath(TESTRUNNER_CLASSES).setCodeCoverageEnabled(executionContext.isCodeCoverageEnabled()).setDebugEnabled(executionContext.isDebugEnabled()).setPathToJavaAgent(options.getPathToJavaAgent()).setBuildId(executionContext.getBuckEventBus().getBuildId()).setBuckModuleBaseSourceCodePath(getBuildTarget().getBasePath()).setStdOutLogLevel(stdOutLogLevel).setStdErrLogLevel(stdErrLogLevel).setRobolectricLogPath(robolectricLogPath).setExtraJvmArgs(properVmArgs).addAllTestClasses(reorderedTestClasses).setDryRun(options.isDryRun()).setTestSelectorList(options.getTestSelectorList()).build();
  return new JUnitStep(getProjectFilesystem(),nativeLibsEnvironment,testRuleTimeoutMs,args);
}
