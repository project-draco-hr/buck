{
  BuildRuleResolver resolver=new BuildRuleResolver(TargetGraph.EMPTY,new BuildTargetNodeToBuildRuleTransformer());
  SourcePathResolver pathResolver=new SourcePathResolver(resolver);
  FakeBuildRule exportedRule=resolver.addToIndex(new FakeBuildRule("//:exported_rule",pathResolver));
  FakeExportDependenciesRule exportingRule=resolver.addToIndex(new FakeExportDependenciesRule("//:exporting_rule",pathResolver,exportedRule));
  BuildTarget target=BuildTargetFactory.newInstance("//:rule");
  BuildRule javaLibrary=JavaLibraryBuilder.createBuilder(target).addProvidedDep(exportingRule.getBuildTarget()).build(resolver);
  assertThat(javaLibrary.getDeps(),Matchers.<BuildRule>hasItem(exportedRule));
}
