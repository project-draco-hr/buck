{
  Preconditions.checkArgument(targetNode.getConstructorArg() instanceof ReactNativeLibraryArgs);
  ProjectFilesystem filesystem=targetNode.getRuleFactoryParams().getProjectFilesystem();
  ReactNativeLibraryArgs args=(ReactNativeLibraryArgs)targetNode.getConstructorArg();
  IosReactNativeLibraryDescription description=(IosReactNativeLibraryDescription)targetNode.getDescription();
  ImmutableList.Builder<String> script=ImmutableList.builder();
  script.add("BASE_DIR=${CONFIGURATION_BUILD_DIR}/${UNLOCALIZED_RESOURCES_FOLDER_PATH}");
  script.add("JS_OUT=${BASE_DIR}/" + args.bundleName);
  script.add("SOURCE_MAP=${TEMP_DIR}/rn_source_map/" + args.bundleName + ".map");
  if (skipRNBundle) {
    script.add("rm -rf ${JS_OUT}");
  }
 else {
    script.add("mkdir -p `dirname ${JS_OUT}`");
    script.add("mkdir -p `dirname ${SOURCE_MAP}`");
    script.add(Joiner.on(" ").join(ReactNativeBundle.getBundleScript(filesystem.resolve(sourcePathResolver.apply(description.getReactNativePackager())),filesystem.resolve(sourcePathResolver.apply(args.entryPath)),ReactNativePlatform.IOS,ReactNativeFlavors.isDevMode(targetNode.getBuildTarget()),"${JS_OUT}","${BASE_DIR}","${SOURCE_MAP}")));
  }
  return Joiner.on(" && ").join(script.build());
}
