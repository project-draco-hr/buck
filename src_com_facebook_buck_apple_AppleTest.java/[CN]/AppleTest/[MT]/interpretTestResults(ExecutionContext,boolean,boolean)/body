{
  return new Callable<TestResults>(){
    @Override public TestResults call() throws Exception {
      List<TestCaseSummary> testCaseSummaries;
      if (xctoolStdoutReader.isPresent()) {
        testCaseSummaries=xctoolStdoutReader.get().getTestCaseSummaries();
      }
 else {
        Path resolvedOutputPath=getProjectFilesystem().resolve(testOutputPath);
        try (BufferedReader reader=Files.newBufferedReader(resolvedOutputPath,StandardCharsets.UTF_8)){
          if (useXctest) {
            testCaseSummaries=XctestOutputParsing.parseOutputFromReader(reader);
          }
 else {
            TestCaseSummariesBuildingXctoolEventHandler xctoolEventHandler=new TestCaseSummariesBuildingXctoolEventHandler(NOOP_REPORTING_CALLBACK);
            XctoolOutputParsing.streamOutputFromReader(reader,xctoolEventHandler);
            testCaseSummaries=xctoolEventHandler.getTestCaseSummaries();
          }
        }
       }
      TestResults.Builder testResultsBuilder=TestResults.builder().setBuildTarget(getBuildTarget()).setTestCases(testCaseSummaries).setContacts(contacts).setLabels(FluentIterable.from(labels).transform(Functions.toStringFunction()).toSet());
      if (getProjectFilesystem().isDirectory(testLogsPath)) {
        for (        Path testLogPath : getProjectFilesystem().getDirectoryContents(testLogsPath)) {
          testResultsBuilder.addTestLogPaths(testLogPath);
        }
      }
      return testResultsBuilder.build();
    }
  }
;
}
