{
  outstandingEvents.put(event.getId(),event);
  int outstandingEventCount=outstandingEvents.size();
  if (events.size() + outstandingEventCount > MAX_TRACE_SIZE) {
    System.err.println("Giant thread trace. Clearing to avoid memory leak.");
    if (events.size() > MAX_TRACE_SIZE / 2) {
      this.events.clear();
    }
    if (outstandingEventCount > MAX_TRACE_SIZE / 2) {
      this.outstandingEvents.clear();
    }
  }
  events.add(event);
}
