{
  StringBuilder sb=new StringBuilder();
  long etime=-1;
  long now=System.currentTimeMillis();
  LinkedList<String> indent=Lists.newLinkedList();
  for (int i=0; i < events.size(); i++) {
    TraceEvent e=events.get(i);
    if (e instanceof TraceStop) {
      indent.removeFirst();
    }
    sb.append(" ");
    sb.append(e.toTraceString(startTime,etime,join(indent)));
    sb.append(" ");
    etime=e.getEventTime();
    sb.append("\n");
    if (e instanceof TraceStart) {
      indent.add("|  ");
    }
  }
  if (!outstandingEvents.isEmpty()) {
    sb.append(" Unstopped timers:\n");
    for (    TraceEvent startEvent : outstandingEvents.values()) {
      sb.append("  ");
      sb.append(startEvent);
      sb.append(" (");
      sb.append(now - startEvent.getEventTime());
      sb.append(" ms, started at ");
      sb.append(TraceEvent.formatTime(startEvent.getEventTime()));
      sb.append("\n");
    }
  }
  return sb.toString();
}
