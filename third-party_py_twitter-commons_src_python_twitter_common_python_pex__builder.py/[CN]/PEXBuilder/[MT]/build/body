def build(self, filename):
    self.freeze()
    try:
        os.unlink((filename + '~'))
        self._logger.warn(('Previous binary unexpectedly exists, cleaning: %s' % (filename + '~')))
    except OSError:
        pass
    if os.path.dirname(filename):
        safe_mkdir(os.path.dirname(filename))
    with open((filename + '~'), 'ab') as pexfile:
        assert (os.path.getsize(pexfile.name) == 0)
        pexfile.write(to_bytes(('%s\n' % self._interpreter.identity.hashbang())))
    self._chroot.zip((filename + '~'), mode='a')
    if os.path.exists(filename):
        os.unlink(filename)
    os.rename((filename + '~'), filename)
    chmod_plus_x(filename)
