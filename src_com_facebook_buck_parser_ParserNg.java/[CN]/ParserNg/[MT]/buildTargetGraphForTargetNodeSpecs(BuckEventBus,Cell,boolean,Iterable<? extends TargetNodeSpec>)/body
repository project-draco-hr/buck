{
  TargetGraph graph=null;
  try (PerBuildState state=new PerBuildState(permState,eventBus,rootCell,enableProfiling)){
    ImmutableSet<BuildTarget> buildTargets=resolveTargetSpecs(state,rootCell,targetNodeSpecs);
    ParseEvent.Started started=ParseEvent.started(buildTargets);
    eventBus.post(started);
    try {
      graph=buildTargetGraph(eventBus,rootCell,enableProfiling,buildTargets);
      return new Pair<>(buildTargets,graph);
    }
  finally {
      eventBus.post(ParseEvent.finished(started,Optional.fromNullable(graph)));
    }
  }
 }
