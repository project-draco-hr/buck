{
  InMemoryArtifactCache cache1=new InMemoryArtifactCache();
  InMemoryArtifactCache cache2=new InMemoryArtifactCache();
  MultiArtifactCache multiArtifactCache=new MultiArtifactCache(ImmutableList.<ArtifactCache>of(cache1,cache2));
  File output=tmp.newFile();
  ImmutableMap<String,String> metadata=ImmutableMap.of("hello","world");
  cache2.store(ImmutableSet.of(dummyRuleKey),metadata,new byte[0]);
  multiArtifactCache.fetch(dummyRuleKey,output);
  CacheResult result=cache1.fetch(dummyRuleKey,output);
  assertThat(result.getType(),Matchers.equalTo(CacheResult.Type.HIT));
  assertThat(result.getMetadata(),Matchers.equalTo(metadata));
  multiArtifactCache.close();
}
