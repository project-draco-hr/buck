{
  Path outDir=temp.newFolder().toPath().toAbsolutePath();
  ProjectFilesystem filesystem=new ProjectFilesystem(outDir);
  File directory=TestDataHelper.getTestDataDirectory(this);
  Path source=new File(directory,"prebuilt/junit.jar").toPath();
  Path binJar=Paths.get("source.jar");
  Files.copy(source,outDir.resolve(binJar));
  Path abiJar=outDir.resolve("abi.jar");
  ExecutionContext executionContext=TestExecutionContext.newBuilder().setProjectFilesystem(filesystem).build();
  FakeBuildableContext context=new FakeBuildableContext();
  new CalculateAbiStep(context,binJar,abiJar).execute(executionContext);
  String expectedHash=filesystem.computeSha1(Paths.get("abi.jar"));
  ImmutableMap<String,Object> metadata=context.getRecordedMetadata();
  Object seenHash=metadata.get(AbiRule.ABI_KEY_ON_DISK_METADATA);
  assertEquals(expectedHash,seenHash);
}
