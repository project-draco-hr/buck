{
  boolean isOptional=Optional.class.isAssignableFrom(field.getType());
  if (isOptional) {
    Type type=field.getGenericType();
    if (type instanceof ParameterizedType) {
      return ((ParameterizedType)type).getActualTypeArguments()[0];
    }
 else {
      throw new RuntimeException("Unexpected type parameter for Optional: " + type);
    }
  }
 else {
    return field.getGenericType();
  }
}
