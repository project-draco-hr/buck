{
  TargetNodeToBuildRuleTransformer transformer=new DefaultTargetNodeToBuildRuleTransformer();
  TargetGraphToActionGraph targetGraphToActionGraph=new TargetGraphToActionGraph(eventBus,transformer);
  Pair<TargetGraph,ActionGraphAndResolver> newActionGraph=new Pair<TargetGraph,ActionGraphAndResolver>(targetGraph,targetGraphToActionGraph.apply(targetGraph));
  if (lastActionGraph != null && lastActionGraph.getFirst().equals(targetGraph)) {
    cacheHitCounter.inc();
    if (!equalRuleKeysFromActionGraphs(lastActionGraph.getSecond(),newActionGraph.getSecond())) {
      actionGraphsMismatch.inc();
    }
  }
 else {
    cacheMissCounter.inc();
  }
  lastActionGraph=newActionGraph;
  return lastActionGraph.getSecond();
}
