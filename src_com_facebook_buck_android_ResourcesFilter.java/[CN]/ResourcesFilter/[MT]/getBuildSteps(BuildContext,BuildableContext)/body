{
  ImmutableList.Builder<Step> steps=ImmutableList.builder();
  AndroidResourceDetails androidResourceDetails=androidResourceDepsFinder.getAndroidResourceDetails();
  final FilterResourcesStep filterResourcesStep=createFilterResourcesStep(androidResourceDetails.resDirectories,androidResourceDetails.whitelistedStringDirs);
  steps.add(filterResourcesStep);
  final ImmutableSet<Path> resDirectories=filterResourcesStep.getOutputResourceDirs();
  final Supplier<ImmutableSet<Path>> nonEnglishStringFiles=Suppliers.memoize(new Supplier<ImmutableSet<Path>>(){
    @Override public ImmutableSet<Path> get(){
      return filterResourcesStep.getNonEnglishStringFiles();
    }
  }
);
  for (  Path outputResourceDir : resDirectories) {
    buildableContext.recordArtifactsInDirectory(outputResourceDir);
  }
  steps.add(new AbstractExecutionStep("record_build_output"){
    @Override public int execute(    ExecutionContext context){
      buildableContext.addMetadata(RES_DIRECTORIES_KEY,Iterables.transform(resDirectories,Functions.toStringFunction()));
      buildableContext.addMetadata(NON_ENGLISH_STRING_FILES_KEY,Iterables.transform(nonEnglishStringFiles.get(),Functions.toStringFunction()));
      return 0;
    }
  }
);
  return steps.build();
}
