{
  assumeTrue(Platform.detect() == Platform.MACOS);
  ProjectWorkspace workspace=TestDataHelper.createProjectWorkspaceForScenario(this,"apple_library_header_symlink_tree",tmp);
  workspace.setUp();
  BuildTarget buildTarget=BuildTarget.builder("//Libraries/TestLibrary","TestLibrary").addFlavors(ImmutableFlavor.of("default")).addFlavors(ImmutableFlavor.of("header-map-file")).build();
  ProjectWorkspace.ProcessResult result=workspace.runBuckCommand("build",buildTarget.getFullyQualifiedName());
  result.assertSuccess();
  Path projectRoot=Paths.get(tmp.getRootPath().toFile().getCanonicalPath());
  Path inputPath=projectRoot.resolve(buildTarget.getBasePath());
  Path outputPath=projectRoot.resolve(BuildTargets.getGenPath(buildTarget,"%s"));
  HeaderMapUtils.assertThatHeaderMapContains(ImmutableMap.of("PrivateHeader.h",inputPath.resolve("PrivateHeader.h").toString(),"TestLibrary/PrivateHeader.h",inputPath.resolve("PrivateHeader.h").toString(),"PublicHeader.h",inputPath.resolve("PublicHeader.h").toString()),HeaderMap.deserialize(ByteStreams.toByteArray(new FileInputStream(outputPath.toFile()))));
}
