{
  try (AutoCloseableLock writeLock=nodesAndTargetsLock.writeLock()){
    TargetNode<?> updatedNode=allTargetNodes.get(target,targetNode);
    if (updatedNode.equals(targetNode)) {
      targetsCornucopia.put(target.getUnflavoredBuildTarget(),target);
    }
    return updatedNode;
  }
 }
