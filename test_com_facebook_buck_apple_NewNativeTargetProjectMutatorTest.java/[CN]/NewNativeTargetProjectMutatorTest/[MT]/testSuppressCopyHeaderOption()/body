{
  Iterable<GroupedSource> sources=ImmutableList.of(GroupedSource.ofSourcePath(new TestSourcePath("foo.h")));
{
    NewNativeTargetProjectMutator mutator=mutatorWithCommonDefaults();
    mutator.setShouldGenerateCopyHeadersPhase(false).setSources(sources,ImmutableMap.<SourcePath,ImmutableList<String>>of());
    NewNativeTargetProjectMutator.Result result=mutator.buildTargetAndAddToProject(generatedProject);
    assertThat("copy headers phase should be omitted",Iterables.filter(result.target.getBuildPhases(),PBXHeadersBuildPhase.class),emptyIterable());
  }
{
    NewNativeTargetProjectMutator mutator=mutatorWithCommonDefaults();
    mutator.setShouldGenerateCopyHeadersPhase(true).setSources(sources,ImmutableMap.<SourcePath,ImmutableList<String>>of());
    NewNativeTargetProjectMutator.Result result=mutator.buildTargetAndAddToProject(generatedProject);
    assertThat("copy headers phase should be generated",Iterables.filter(result.target.getBuildPhases(),PBXHeadersBuildPhase.class),not(emptyIterable()));
  }
}
