{
  Path compiler=Paths.get("compiler");
  ImmutableList<String> flags=ImmutableList.of("-Dtest=blah");
  Path output=Paths.get("test.ii");
  Path input=Paths.get("test.cpp");
  ImmutableList<Path> includes=ImmutableList.of(Paths.get("foo/bar"),Paths.get("test"));
  ImmutableList<Path> systemIncludes=ImmutableList.of(Paths.get("/usr/include"),Paths.get("/include"));
  ImmutableMap<Path,Path> replacementPaths=ImmutableMap.of();
  CxxPreprocessStep cxxPreprocessStep=new CxxPreprocessStep(compiler,flags,output,input,includes,systemIncludes,replacementPaths);
  ImmutableList<String> expected=ImmutableList.<String>builder().add(compiler.toString()).add("-E").addAll(flags).addAll(MoreIterables.zipAndConcat(Iterables.cycle("-I"),Iterables.transform(includes,Functions.toStringFunction()))).addAll(MoreIterables.zipAndConcat(Iterables.cycle("-isystem"),Iterables.transform(systemIncludes,Functions.toStringFunction()))).add(input.toString()).build();
  ImmutableList<String> actual=cxxPreprocessStep.getCommand();
  assertEquals(expected,actual);
}
