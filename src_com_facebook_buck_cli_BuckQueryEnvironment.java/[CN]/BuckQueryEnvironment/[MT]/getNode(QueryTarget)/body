{
  Preconditions.checkState(target instanceof QueryBuildTarget);
  ListeningExecutorService executor=null;
  try {
    executor=com.google.common.util.concurrent.MoreExecutors.listeningDecorator(MoreExecutors.newSingleThreadExecutor("buck query.getNode"));
    return params.getParser().getTargetNode(params.getBuckEventBus(),params.getCell(),enableProfiling,executor,((QueryBuildTarget)target).getBuildTarget());
  }
 catch (  BuildTargetException|BuildFileParseException e) {
    throw new QueryException("Error getting target node for %s\n%s",target,e.getMessage());
  }
 finally {
    if (executor != null) {
      executor.shutdown();
    }
  }
}
