{
  ProjectFilesystem projectFilesystem=new ProjectFilesystem(tmpDir.getRoot());
  ChromeTraceBuildListener listener=new ChromeTraceBuildListener(projectFilesystem,3);
  try {
    tmpDir.getRoot().setReadOnly();
    listener.outputTrace(new BuildId("BUILD_ID"));
    fail("Expected an exception.");
  }
 catch (  HumanReadableException e) {
    assertEquals("Unable to write trace file: java.nio.file.AccessDeniedException: " + projectFilesystem.resolve(BuckConstant.BUCK_OUTPUT_PATH),e.getMessage());
  }
 finally {
    tmpDir.getRoot().setWritable(true);
  }
}
