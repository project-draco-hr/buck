{
  ProjectFilesystem projectFilesystem=new ProjectFilesystem(tmpDir.getRoot().toPath());
  BuildId buildId=new BuildId("BUILD_ID");
  String tracePath=String.format("%s/build.trace",BuckConstant.getBuckTraceDir());
  File traceFile=new File(tmpDir.getRoot(),tracePath);
  projectFilesystem.createParentDirs(tracePath);
  traceFile.createNewFile();
  traceFile.setLastModified(0);
  for (int i=0; i < 10; ++i) {
    File oldResult=new File(tmpDir.getRoot(),String.format("%s/build.100%d.trace",BuckConstant.getBuckTraceDir(),i));
    oldResult.createNewFile();
    oldResult.setLastModified(TimeUnit.SECONDS.toMillis(i));
  }
  ChromeTraceBuildListener listener=new ChromeTraceBuildListener(projectFilesystem,buildId,new FakeClock(1409702151000000000L),ObjectMappers.newDefaultInstance(),Locale.US,TimeZone.getTimeZone("America/Los_Angeles"),3,false);
  listener.outputTrace(buildId);
  ImmutableList<String> files=FluentIterable.from(Arrays.asList(projectFilesystem.listFiles(BuckConstant.getBuckTraceDir()))).transform(new Function<File,String>(){
    @Override public String apply(    File input){
      return input.getName();
    }
  }
).toList();
  assertEquals(4,files.size());
  assertEquals(ImmutableSortedSet.of("build.trace","build.1009.trace","build.1008.trace","build.2014-09-02.16-55-51.BUILD_ID.trace"),ImmutableSortedSet.copyOf(files));
}
