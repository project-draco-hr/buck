{
  if (currentSecondaryOut == null || !currentSecondaryOut.canPutEntry(entry) || newSecondaryOutOnNextEntry) {
    if (currentSecondaryOut != null) {
      currentSecondaryOut.close();
    }
    currentSecondaryIndex++;
    File newSecondaryFile=new File(outSecondaryDir,String.format(secondaryPattern,currentSecondaryIndex));
    secondaryFiles.add(newSecondaryFile);
    currentSecondaryOut=newZipOutput(newSecondaryFile);
    newSecondaryOutOnNextEntry=false;
    if (canaryStrategy == ZipSplitter.CanaryStrategy.INCLUDE_CANARIES) {
      FileLike canaryFile=CanaryFactory.create(currentSecondaryIndex);
      currentSecondaryOut.putEntry(canaryFile);
    }
    Preconditions.checkState(currentSecondaryOut.canPutEntry(entry));
  }
  return currentSecondaryOut;
}
