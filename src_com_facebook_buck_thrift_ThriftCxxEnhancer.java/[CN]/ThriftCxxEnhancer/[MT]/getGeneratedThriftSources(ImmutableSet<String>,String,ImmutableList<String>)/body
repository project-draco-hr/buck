{
  final String base=Files.getNameWithoutExtension(name);
  final boolean bootstrap=options.contains("bootstrap");
  final boolean layouts=options.contains("frozen");
  final boolean templates=cpp2 || options.contains("templates");
  final boolean perfhash=!cpp2 && options.contains("perfhash");
  final boolean separate_processmap=cpp2 && options.contains("separate_processmap");
  ImmutableList.Builder<String> sources=ImmutableList.builder();
  sources.add(base + "_constants.h");
  sources.add(base + "_constants.cpp");
  sources.add(base + "_types.h");
  sources.add(base + "_types.cpp");
  if (templates) {
    sources.add(base + "_types.tcc");
  }
  if (layouts) {
    sources.add(base + "_layouts.h");
    sources.add(base + "_layouts.cpp");
  }
  if (!bootstrap && !cpp2) {
    sources.add(base + "_reflection.h");
    sources.add(base + "_reflection.cpp");
  }
  for (  String service : services) {
    sources.add(service + ".h");
    sources.add(service + ".cpp");
    if (cpp2) {
      sources.add(service + "_client.cpp");
    }
    if (separate_processmap) {
      sources.add(service + "_processmap_binary.cpp");
      sources.add(service + "_processmap_compact.cpp");
    }
    if (templates) {
      sources.add(service + ".tcc");
    }
    if (perfhash) {
      sources.add(service + "_gperf.tcc");
    }
  }
  return sources.build();
}
