{
  UnflavoredBuildTarget originalBuildTarget=originalBuildRuleParams.getBuildTarget().checkUnflavored();
  SourcePathResolver pathResolver=new SourcePathResolver(resolver);
  ImmutableList.Builder<BuildRule> depRules=ImmutableList.builder();
  AndroidManifestDescription.Arg androidManifestArgs=androidManifestDescription.createUnpopulatedConstructorArg();
  androidManifestArgs.skeleton=args.manifestSkeleton;
  androidManifestArgs.deps=args.deps;
  BuildRuleParams androidManifestParams=originalBuildRuleParams.copyWithChanges(AndroidManifestDescription.TYPE,BuildTargets.createFlavoredBuildTarget(originalBuildTarget,AAR_ANDROID_MANIFEST_FLAVOR),Suppliers.ofInstance(originalBuildRuleParams.getDeclaredDeps()),Suppliers.ofInstance(originalBuildRuleParams.getExtraDeps()));
  AndroidManifest manifest=androidManifestDescription.createBuildRule(androidManifestParams,resolver,androidManifestArgs);
  depRules.add(resolver.addToIndex(manifest));
  AndroidPackageableCollector collector=new AndroidPackageableCollector(originalBuildRuleParams.getBuildTarget(),ImmutableSet.<BuildTarget>of(),ImmutableSet.<BuildTarget>of());
  collector.addPackageables(AndroidPackageableCollector.getPackageableRules(originalBuildRuleParams.getDeps()));
  AndroidPackageableCollection packageableCollection=collector.build();
  ImmutableSortedSet<BuildRule> androidResourceDeclaredDeps=AndroidResourceHelper.androidResOnly(originalBuildRuleParams.getDeclaredDeps());
  ImmutableSortedSet<BuildRule> androidResourceExtraDeps=AndroidResourceHelper.androidResOnly(originalBuildRuleParams.getExtraDeps());
  BuildRuleParams assembleAssetsParams=originalBuildRuleParams.copyWithChanges(originalBuildRuleParams.getBuildRuleType(),BuildTargets.createFlavoredBuildTarget(originalBuildTarget,AAR_ASSEMBLE_ASSETS_FLAVOR),Suppliers.ofInstance(androidResourceDeclaredDeps),Suppliers.ofInstance(androidResourceExtraDeps));
  ImmutableCollection<SourcePath> assetsDirectories=packageableCollection.getAssetsDirectories();
  AssembleDirectories assembleAssetsDirectories=new AssembleDirectories(assembleAssetsParams,pathResolver,assetsDirectories);
  depRules.add(resolver.addToIndex(assembleAssetsDirectories));
  BuildRuleParams assembleResourceParams=originalBuildRuleParams.copyWithChanges(originalBuildRuleParams.getBuildRuleType(),BuildTargets.createFlavoredBuildTarget(originalBuildTarget,AAR_ASSEMBLE_RESOURCE_FLAVOR),Suppliers.ofInstance(androidResourceDeclaredDeps),Suppliers.ofInstance(androidResourceExtraDeps));
  ImmutableCollection<SourcePath> resDirectories=packageableCollection.getResourceDetails().getResourceDirectories();
  AssembleDirectories assembleResourceDirectories=new AssembleDirectories(assembleResourceParams,pathResolver,resDirectories);
  depRules.add(resolver.addToIndex(assembleResourceDirectories));
  BuildRuleParams androidResourceParams=originalBuildRuleParams.copyWithChanges(AndroidLibraryDescription.TYPE,BuildTargets.createFlavoredBuildTarget(originalBuildTarget,AAR_ANDROID_RESOURCE_FLAVOR),Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>of(manifest,assembleAssetsDirectories,assembleResourceDirectories)),Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>of()));
  AndroidResource androidResource=new AndroidResource(androidResourceParams,pathResolver,ImmutableSortedSet.copyOf(depRules.build()),new BuildTargetSourcePath(assembleResourceDirectories.getProjectFilesystem(),assembleResourceDirectories.getBuildTarget()),ImmutableSortedSet.<Path>of(),null,new BuildTargetSourcePath(assembleAssetsDirectories.getProjectFilesystem(),assembleAssetsDirectories.getBuildTarget()),ImmutableSortedSet.<Path>of(),new BuildTargetSourcePath(manifest.getProjectFilesystem(),manifest.getBuildTarget()),false);
  depRules.add(resolver.addToIndex(androidResource));
  depRules.addAll(getTargetsAsRules(packageableCollection.getNativeLibsTargets(),BuildTarget.of(originalBuildTarget),resolver));
  BuildRuleParams androidAarParams=originalBuildRuleParams.copyWithChanges(TYPE,BuildTarget.of(originalBuildTarget),Suppliers.ofInstance(ImmutableSortedSet.copyOf(depRules.build())),Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>of()));
  return new AndroidAar(androidAarParams,pathResolver,manifest,androidResource,assembleResourceDirectories,assembleAssetsDirectories,packageableCollection.getNativeLibAssetsDirectories(),packageableCollection.getNativeLibsDirectories());
}
