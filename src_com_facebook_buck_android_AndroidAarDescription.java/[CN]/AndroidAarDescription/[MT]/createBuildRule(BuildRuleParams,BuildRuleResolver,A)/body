{
  UnflavoredBuildTarget originalBuildTarget=originalBuildRuleParams.getBuildTarget().checkUnflavored();
  SourcePathResolver pathResolver=new SourcePathResolver(resolver);
  ImmutableList.Builder<BuildRule> aarExtraDepsBuilder=ImmutableList.<BuildRule>builder().addAll(originalBuildRuleParams.getExtraDeps());
  AndroidManifestDescription.Arg androidManifestArgs=androidManifestDescription.createUnpopulatedConstructorArg();
  androidManifestArgs.skeleton=args.manifestSkeleton;
  androidManifestArgs.deps=args.deps;
  BuildRuleParams androidManifestParams=originalBuildRuleParams.copyWithChanges(BuildTargets.createFlavoredBuildTarget(originalBuildTarget,AAR_ANDROID_MANIFEST_FLAVOR),Suppliers.ofInstance(originalBuildRuleParams.getDeclaredDeps()),Suppliers.ofInstance(originalBuildRuleParams.getExtraDeps()));
  AndroidManifest manifest=androidManifestDescription.createBuildRule(androidManifestParams,resolver,androidManifestArgs);
  aarExtraDepsBuilder.add(resolver.addToIndex(manifest));
  AndroidPackageableCollector collector=new AndroidPackageableCollector(originalBuildRuleParams.getBuildTarget(),ImmutableSet.<BuildTarget>of(),ImmutableSet.<BuildTarget>of());
  collector.addPackageables(AndroidPackageableCollector.getPackageableRules(originalBuildRuleParams.getDeps()));
  AndroidPackageableCollection packageableCollection=collector.build();
  ImmutableSortedSet<BuildRule> androidResourceDeclaredDeps=AndroidResourceHelper.androidResOnly(originalBuildRuleParams.getDeclaredDeps());
  ImmutableSortedSet<BuildRule> androidResourceExtraDeps=AndroidResourceHelper.androidResOnly(originalBuildRuleParams.getExtraDeps());
  BuildRuleParams assembleAssetsParams=originalBuildRuleParams.copyWithChanges(BuildTargets.createFlavoredBuildTarget(originalBuildTarget,AAR_ASSEMBLE_ASSETS_FLAVOR),Suppliers.ofInstance(androidResourceDeclaredDeps),Suppliers.ofInstance(androidResourceExtraDeps));
  ImmutableCollection<SourcePath> assetsDirectories=packageableCollection.getAssetsDirectories();
  AssembleDirectories assembleAssetsDirectories=new AssembleDirectories(assembleAssetsParams,pathResolver,assetsDirectories);
  aarExtraDepsBuilder.add(resolver.addToIndex(assembleAssetsDirectories));
  BuildRuleParams assembleResourceParams=originalBuildRuleParams.copyWithChanges(BuildTargets.createFlavoredBuildTarget(originalBuildTarget,AAR_ASSEMBLE_RESOURCE_FLAVOR),Suppliers.ofInstance(androidResourceDeclaredDeps),Suppliers.ofInstance(androidResourceExtraDeps));
  ImmutableCollection<SourcePath> resDirectories=packageableCollection.getResourceDetails().getResourceDirectories();
  AssembleDirectories assembleResourceDirectories=new AssembleDirectories(assembleResourceParams,pathResolver,resDirectories);
  aarExtraDepsBuilder.add(resolver.addToIndex(assembleResourceDirectories));
  BuildRuleParams androidResourceParams=originalBuildRuleParams.copyWithChanges(BuildTargets.createFlavoredBuildTarget(originalBuildTarget,AAR_ANDROID_RESOURCE_FLAVOR),Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>of(manifest,assembleAssetsDirectories,assembleResourceDirectories)),Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>of()));
  AndroidResource androidResource=new AndroidResource(androidResourceParams,pathResolver,ImmutableSortedSet.<BuildRule>naturalOrder().add(assembleAssetsDirectories).add(assembleResourceDirectories).addAll(originalBuildRuleParams.getDeclaredDeps()).build(),new BuildTargetSourcePath(assembleResourceDirectories.getBuildTarget()),ImmutableSortedSet.<Path>of(),null,new BuildTargetSourcePath(assembleAssetsDirectories.getBuildTarget()),ImmutableSortedSet.<Path>of(),new BuildTargetSourcePath(manifest.getBuildTarget()),false);
  aarExtraDepsBuilder.add(resolver.addToIndex(androidResource));
  aarExtraDepsBuilder.addAll(getTargetsAsRules(packageableCollection.getNativeLibsTargets(),BuildTarget.of(originalBuildTarget),resolver));
  BuildRuleParams androidAarParams=originalBuildRuleParams.copyWithExtraDeps(Suppliers.ofInstance(ImmutableSortedSet.copyOf(aarExtraDepsBuilder.build())));
  return new AndroidAar(androidAarParams,pathResolver,manifest,androidResource,assembleResourceDirectories,assembleAssetsDirectories,packageableCollection.getNativeLibAssetsDirectories(),packageableCollection.getNativeLibsDirectories());
}
