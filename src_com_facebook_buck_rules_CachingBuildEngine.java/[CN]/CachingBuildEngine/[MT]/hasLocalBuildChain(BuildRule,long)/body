{
  BuildRuleSuccess success;
  try {
    success=Preconditions.checkNotNull(getBuildRuleResult(rule.getBuildTarget()));
  }
 catch (  InterruptedException|ExecutionException e) {
    throw new IllegalStateException(e);
  }
  if (success.getType() == BuildRuleSuccess.Type.BUILT_LOCALLY && rule.getCacheMode() == CacheMode.ENABLED) {
    if (depth == 0) {
      return true;
    }
 else {
      for (      BuildRule dep : rule.getDeps()) {
        if (hasLocalBuildChain(dep,depth - 1)) {
          return true;
        }
      }
    }
  }
  return false;
}
