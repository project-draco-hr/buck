{
  ImmutableList.Builder<FileHashCache> caches=ImmutableList.builder();
  caches.add(sharedHashCache);
  StackedFileHashCache fileHashCache=new StackedFileHashCache(caches.build());
  SourcePathResolver pathResolver=new SourcePathResolver(ruleResolver);
  return new RuleKeyFactories(new InputBasedRuleKeyBuilderFactory(fileHashCache,pathResolver),new AbiRuleKeyBuilderFactory(fileHashCache,pathResolver),new DependencyFileRuleKeyBuilderFactory(fileHashCache,pathResolver));
}
