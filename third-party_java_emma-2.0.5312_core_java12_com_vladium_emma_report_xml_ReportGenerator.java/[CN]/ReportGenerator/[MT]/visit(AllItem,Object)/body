{
  try {
    File outFile=m_settings.getOutFile();
    if (outFile == null) {
      outFile=new File("coverage.xml");
      m_settings.setOutFile(outFile);
    }
    final File fullOutFile=Files.newFile(m_settings.getOutDir(),outFile);
    m_log.info("writing [" + getType() + "] report to ["+ fullOutFile.getAbsolutePath()+ "] ...");
    openOutFile(fullOutFile,m_settings.getOutEncoding(),true);
    m_out.write("<?xml version=\"1.0\" encoding=\"" + m_settings.getOutEncoding() + "\"?>");
    try {
      final StringBuffer label=new StringBuffer(101);
      label.append("<!-- ");
      label.append(IAppConstants.APP_NAME);
      label.append(" v");
      label.append(IAppConstants.APP_VERSION_WITH_BUILD_ID_AND_TAG);
      label.append(" report, generated ");
      label.append(new Date(EMMAProperties.getTimeStamp()));
      label.append(" -->");
      m_out.write(label.toString());
      m_out.newLine();
      m_out.flush();
    }
 catch (    IOException ioe) {
      throw new EMMARuntimeException(IAppErrorCodes.REPORT_IO_FAILURE,ioe);
    }
    eol();
    openElementTag("report");
    closeElementTag(false);
    m_out.incIndent();
    eol();
    openElementTag("stats");
    closeElementTag(false);
    m_out.incIndent();
{
      emitStatsCount("packages",item.getChildCount());
      emitStatsCount("classes",item.getAggregate(IItem.TOTAL_CLASS_COUNT));
      emitStatsCount("methods",item.getAggregate(IItem.TOTAL_METHOD_COUNT));
      if (m_srcView && m_hasSrcFileInfo) {
        emitStatsCount("srcfiles",item.getAggregate(IItem.TOTAL_SRCFILE_COUNT));
        if (m_hasLineNumberInfo)         emitStatsCount("srclines",item.getAggregate(IItem.TOTAL_LINE_COUNT));
      }
    }
    m_out.decIndent();
    eol();
    endElement("stats");
    eol();
    openElementTag("data");
    closeElementTag(false);
    m_out.incIndent();
{
      final ItemComparator childrenOrder=m_typeSortComparators[PackageItem.getTypeMetadata().getTypeID()];
      emitItem(item,childrenOrder);
    }
    m_out.decIndent();
    eol();
    endElement("data");
    m_out.decIndent();
    eol();
    endElement("report");
  }
 catch (  IOException ioe) {
    throw new EMMARuntimeException(IAppErrorCodes.REPORT_IO_FAILURE,ioe);
  }
  return ctx;
}
