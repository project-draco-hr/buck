{
  ImmutableBiMap.Builder<String,String> filteredResourcesDirMapBuilder=ImmutableBiMap.builder();
  String resDestinationBasePath=getBinPath("__filtered__%s__");
  int count=0;
  for (  String resDir : resourceDirectories) {
    filteredResourcesDirMapBuilder.put(resDir,Paths.get(resDestinationBasePath,String.valueOf(count++)).toString());
  }
  ImmutableBiMap<String,String> resSourceToDestDirMap=filteredResourcesDirMapBuilder.build();
  FilterResourcesStep.Builder filterResourcesStepBuilder=FilterResourcesStep.builder().setInResToOutResDirMap(resSourceToDestDirMap).setResourceFilter(resourceFilter);
  if (isStoreStringsAsAssets()) {
    filterResourcesStepBuilder.enableStringsFilter();
  }
  FilterResourcesStep filterResourcesStep=filterResourcesStepBuilder.build();
  commands.add(filterResourcesStep);
  if (isStoreStringsAsAssets()) {
    Path tmpStringsDirPath=getPathForTmpStringAssetsDirectory();
    commands.add(new MakeCleanDirectoryStep(tmpStringsDirPath));
    commands.add(new CompileStringsStep(filterResourcesStep,tmpStringsDirPath));
  }
  return resSourceToDestDirMap.values();
}
