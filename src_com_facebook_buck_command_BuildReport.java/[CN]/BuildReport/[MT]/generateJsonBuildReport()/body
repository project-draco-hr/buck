{
  LinkedHashMap<String,Object> results=Maps.newLinkedHashMap();
  boolean isOverallSuccess=true;
  for (  Map.Entry<BuildRule,Optional<BuildResult>> entry : ruleToResult.entrySet()) {
    BuildRule rule=entry.getKey();
    Optional<BuildRuleSuccessType> success=entry.getValue().transform(BuildResult.RULE_TO_SUCCESS);
    Map<String,Object> value=Maps.newLinkedHashMap();
    boolean isSuccess=success.isPresent();
    value.put("success",isSuccess);
    if (!isSuccess) {
      isOverallSuccess=false;
    }
    if (isSuccess) {
      value.put("type",success.get().name());
      Path outputFile=rule.getPathToOutputFile();
      value.put("output",outputFile != null ? outputFile.toString() : null);
    }
    results.put(rule.getFullyQualifiedName(),value);
  }
  Map<String,Object> report=Maps.newLinkedHashMap();
  report.put("success",isOverallSuccess);
  report.put("results",results);
  ObjectMapper objectMapper=new ObjectMapper();
  objectMapper.enable(SerializationFeature.INDENT_OUTPUT);
  return objectMapper.writeValueAsString(report);
}
