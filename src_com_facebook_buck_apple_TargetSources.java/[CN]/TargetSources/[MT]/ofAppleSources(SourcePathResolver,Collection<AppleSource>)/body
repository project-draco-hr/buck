{
  ImmutableSortedMap.Builder<SourcePath,String> perFileFlagsBuilder=ImmutableSortedMap.naturalOrder();
  ImmutableSortedSet.Builder<SourcePath> srcPathsBuilder=ImmutableSortedSet.naturalOrder();
  ImmutableSortedSet.Builder<SourcePath> headerPathsBuilder=ImmutableSortedSet.naturalOrder();
  RuleUtils.extractSourcePaths(resolver,perFileFlagsBuilder,srcPathsBuilder,headerPathsBuilder,appleSources);
  ImmutableSortedMap<SourcePath,String> perFileFlags=perFileFlagsBuilder.build();
  ImmutableSortedSet<SourcePath> srcPaths=srcPathsBuilder.build();
  ImmutableSortedSet<SourcePath> headerPaths=headerPathsBuilder.build();
  ImmutableList<GroupedSource> groupedSource=RuleUtils.createGroupsFromSourcePaths(resolver,Iterables.concat(srcPaths,headerPaths));
  return ImmutableTargetSources.of(groupedSource,perFileFlags,srcPaths,headerPaths);
}
