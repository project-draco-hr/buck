{
  BuildTarget inferAnalyzeBuildTarget=createInferAnalyzeBuildTarget(params.getBuildTarget());
  Optional<CxxInferAnalyze> existingRule=resolver.getRuleOptionalWithType(inferAnalyzeBuildTarget,CxxInferAnalyze.class);
  if (existingRule.isPresent()) {
    return existingRule.get();
  }
  BuildRuleParams paramsWithoutInferFlavor=params.withoutFlavor(INFER_ANALYZE);
  ImmutableMap<Path,SourcePath> headers=CxxDescriptionEnhancer.parseHeaders(paramsWithoutInferFlavor,resolver,cxxPlatform,args);
  ImmutableMap<String,SourcePath> lexSrcs=CxxDescriptionEnhancer.parseLexSources(paramsWithoutInferFlavor,resolver,args);
  ImmutableMap<String,SourcePath> yaccSrcs=CxxDescriptionEnhancer.parseYaccSources(paramsWithoutInferFlavor,resolver,args);
  HeaderSymlinkTree headerSymlinkTree=CxxDescriptionEnhancer.requireHeaderSymlinkTree(paramsWithoutInferFlavor,resolver,pathResolver,cxxPlatform,true,lexSrcs,yaccSrcs,headers,HeaderVisibility.PRIVATE);
  ImmutableList<CxxPreprocessorInput> preprocessorInputs;
  if (args instanceof CxxBinaryDescription.Arg) {
    preprocessorInputs=computePreprocessorInputForCxxBinaryDescriptionArg(targetGraph,paramsWithoutInferFlavor,cxxPlatform,(CxxBinaryDescription.Arg)args,headerSymlinkTree);
  }
 else   if (args instanceof CxxLibraryDescription.Arg) {
    preprocessorInputs=computePreprocessorInputForCxxLibraryDescriptionArg(targetGraph,paramsWithoutInferFlavor,resolver,pathResolver,cxxPlatform,(CxxLibraryDescription.Arg)args,headerSymlinkTree);
  }
 else {
    throw new IllegalStateException("Only Binary and Library args supported.");
  }
  ImmutableSet<CxxInferAnalyze> transitiveDepsLibraryRules=requireTransitiveDependentLibraries(targetGraph,cxxPlatform,paramsWithoutInferFlavor.getDeps());
  CxxHeaderSourceSpec lexYaccSources=CxxDescriptionEnhancer.requireLexYaccSources(paramsWithoutInferFlavor,resolver,pathResolver,cxxPlatform,lexSrcs,yaccSrcs);
  ImmutableMap<String,CxxSource> srcs=CxxDescriptionEnhancer.parseCxxSources(paramsWithoutInferFlavor,resolver,cxxPlatform,args);
  ImmutableMap<String,CxxSource> sources=ImmutableMap.<String,CxxSource>builder().putAll(srcs).putAll(lexYaccSources.getCxxSources()).build();
  CxxInferCaptureAndAnalyzeRules cxxInferCaptureAndAnalyzeRules=new CxxInferCaptureAndAnalyzeRules(createInferCaptureBuildRules(paramsWithoutInferFlavor,resolver,cxxPlatform,sources,CxxSourceRuleFactory.PicType.PDC,inferTools,preprocessorInputs,CxxFlags.getFlags(args.compilerFlags,args.platformCompilerFlags,cxxPlatform),args.prefixHeader),transitiveDepsLibraryRules);
  return createInferAnalyzeRule(params,resolver,inferAnalyzeBuildTarget,pathResolver,inferTools,cxxInferCaptureAndAnalyzeRules);
}
