{
  CxxSourceSet sources=collectSourcesOverDependencies(params.getBuildTarget(),ruleResolver,cxxPlatform,args);
  BuildRuleParams cleanParams=InferFlavors.paramsWithoutAnyInferFlavor(params);
  ImmutableSet<CxxInferCapture> captureRules=requireInferCaptureBuildRules(cleanParams,ruleResolver,cxxPlatform,sources.toSourcesMap(),inferBuckConfig,sourceFilter,args);
  return ruleResolver.addToIndex(new CxxInferCaptureTransitive(params.copyWithChanges(params.getBuildTarget(),Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>naturalOrder().addAll(captureRules).build()),params.getExtraDeps()),new SourcePathResolver(ruleResolver),captureRules));
}
