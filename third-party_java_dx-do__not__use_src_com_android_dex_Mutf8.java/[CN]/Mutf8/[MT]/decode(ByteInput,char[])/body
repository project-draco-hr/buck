{
  int s=0;
  while (true) {
    char a=(char)(in.readByte() & 0xff);
    if (a == 0) {
      return new String(out,0,s);
    }
    out[s]=a;
    if (a < '\u0080') {
      s++;
    }
 else     if ((a & 0xe0) == 0xc0) {
      int b=in.readByte() & 0xff;
      if ((b & 0xC0) != 0x80) {
        throw new UTFDataFormatException("bad second byte");
      }
      out[s++]=(char)(((a & 0x1F) << 6) | (b & 0x3F));
    }
 else     if ((a & 0xf0) == 0xe0) {
      int b=in.readByte() & 0xff;
      int c=in.readByte() & 0xff;
      if (((b & 0xC0) != 0x80) || ((c & 0xC0) != 0x80)) {
        throw new UTFDataFormatException("bad second or third byte");
      }
      out[s++]=(char)(((a & 0x0F) << 12) | ((b & 0x3F) << 6) | (c & 0x3F));
    }
 else {
      throw new UTFDataFormatException("bad byte");
    }
  }
}
