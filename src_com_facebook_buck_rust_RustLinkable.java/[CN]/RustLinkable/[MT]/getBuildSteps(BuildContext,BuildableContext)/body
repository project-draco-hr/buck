{
  ImmutableMap.Builder<String,Path> externalCratesBuilder=ImmutableMap.builder();
  for (  BuildRule buildRule : getDeps()) {
    if (!(buildRule instanceof RustLibrary)) {
      throw new HumanReadableException("%s (dep of %s) is not an instance of rust_library!",buildRule.getBuildTarget().getFullyQualifiedName(),getBuildTarget().getFullyQualifiedName());
    }
    Path ruleOutput=buildRule.getPathToOutput();
    Preconditions.checkNotNull(ruleOutput);
    externalCratesBuilder.put(buildRule.getBuildTarget().getShortName(),ruleOutput);
  }
  return ImmutableList.of(new MakeCleanDirectoryStep(getProjectFilesystem(),scratchDir),new SymlinkFilesIntoDirectoryStep(getProjectFilesystem(),getProjectFilesystem().getRootPath(),getResolver().deprecatedAllPaths(srcs),scratchDir),new MakeCleanDirectoryStep(getProjectFilesystem(),output.getParent()),new RustCompileStep(getProjectFilesystem().getRootPath(),compiler.getCommandPrefix(getResolver()),flags,features,output,externalCratesBuilder.build(),getCrateRoot()));
}
