{
  ProvisioningProfileMetadata selectedProfile=Futures.getUnchecked(provisioningProfileCopyStep.getSelectedProvisioningProfileFuture());
  ImmutableSet<HashCode> fingerprints=selectedProfile.getDeveloperCertificateFingerprints();
  if (fingerprints.isEmpty()) {
    return Iterables.getFirst(codeSignIdentityStore.getIdentities(),CodeSignIdentity.AD_HOC);
  }
  for (  CodeSignIdentity identity : codeSignIdentityStore.getIdentities()) {
    if (identity.getFingerprint().isPresent() && fingerprints.contains(identity.getFingerprint().get())) {
      return identity;
    }
  }
  throw new HumanReadableException("No code sign identity available for provisioning profile: %s\n" + "Profile requires an identity with one of the following SHA1 fingerprints " + "available in your keychain: \n  %s",selectedProfile.getProfilePath(),Joiner.on("\n  ").join(fingerprints));
}
