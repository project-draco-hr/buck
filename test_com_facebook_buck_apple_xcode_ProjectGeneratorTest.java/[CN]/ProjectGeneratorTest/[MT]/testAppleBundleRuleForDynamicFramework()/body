{
  BuildRuleResolver resolver=new BuildRuleResolver();
  SourcePath xcconfigFile=new PathSourcePath(Paths.get("Test.xcconfig"));
  projectFilesystem.writeContentsToPath("",new SourcePathResolver(resolver).getPath(xcconfigFile));
  BuildRuleParams dynamicLibraryParams=new FakeBuildRuleParamsBuilder(BuildTarget.builder("//dep","dynamic").setFlavor(AppleLibraryDescription.DYNAMIC_LIBRARY).build()).setType(AppleLibraryDescription.TYPE).build();
  AppleNativeTargetDescriptionArg dynamicLibraryArg=createDescriptionArgWithDefaults(appleLibraryDescription);
  dynamicLibraryArg.configs=Optional.of(ImmutableSortedMap.of("Debug",new XcodeRuleConfiguration(ImmutableList.of(new XcodeRuleConfigurationLayer(xcconfigFile),new XcodeRuleConfigurationLayer(xcconfigFile)))));
  BuildRule dynamicLibraryDep=appleLibraryDescription.createBuildRule(dynamicLibraryParams,resolver,dynamicLibraryArg);
  resolver.addToIndex(dynamicLibraryDep);
  BuildRule rule=createAppleBundleBuildRule(BuildTarget.builder("//foo","bundle").build(),resolver,appleBundleDescription,dynamicLibraryDep,AppleBundleExtension.FRAMEWORK);
  resolver.addToIndex(rule);
  ProjectGenerator projectGenerator=createProjectGeneratorForCombinedProject(ImmutableSortedSet.of(rule),ImmutableSet.of(rule.getBuildTarget()),ImmutableSet.of(ProjectGenerator.Option.REFERENCE_EXISTING_XCCONFIGS));
  projectGenerator.createXcodeProjects();
  PBXProject project=projectGenerator.getGeneratedProject();
  PBXTarget target=assertTargetExistsAndReturnTarget(project,"//foo:bundle");
  assertEquals(target.getProductType(),PBXTarget.ProductType.FRAMEWORK);
  assertThat(target.isa(),equalTo("PBXNativeTarget"));
  PBXFileReference productReference=target.getProductReference();
  assertEquals("bundle.framework",productReference.getName());
  assertEquals(Optional.of("wrapper.framework"),productReference.getExplicitFileType());
  assertHasConfigurations(target,"Debug");
  XCBuildConfiguration configuration=target.getBuildConfigurationList().getBuildConfigurationsByName().asMap().get("Debug");
  NSDictionary settings=configuration.getBuildSettings();
  assertEquals(new NSString("framework"),settings.get("WRAPPER_EXTENSION"));
}
