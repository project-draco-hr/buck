{
  BuildRuleResolver resolver=new BuildRuleResolver();
  BuildRule modelRule=createBuildRuleWithDefaults(BuildTarget.builder("//foo","model").build(),resolver,ImmutableSortedSet.<BuildRule>of(),coreDataModelDescription,new Function<CoreDataModelDescription.Arg,CoreDataModelDescription.Arg>(){
    @Override public CoreDataModelDescription.Arg apply(    CoreDataModelDescription.Arg args){
      args.path=new TestSourcePath("foo.xcdatamodel").asReference();
      return args;
    }
  }
);
  resolver.addToIndex(modelRule);
  BuildRule libraryRule=createBuildRuleWithDefaults(BuildTarget.builder("//foo","lib").build(),ImmutableSortedSet.of(modelRule),appleLibraryDescription,resolver);
  resolver.addToIndex(libraryRule);
  ProjectGenerator projectGenerator=createProjectGeneratorForCombinedProject(ImmutableSet.of(libraryRule),ImmutableSet.of(libraryRule.getBuildTarget()));
  projectGenerator.createXcodeProjects();
  PBXProject project=projectGenerator.getGeneratedProject();
  PBXGroup targetGroup=project.getMainGroup().getOrCreateChildGroupByName(libraryRule.getFullyQualifiedName());
  PBXGroup resourcesGroup=targetGroup.getOrCreateChildGroupByName("Resources");
  assertThat(resourcesGroup.getChildren(),hasSize(1));
  PBXFileReference modelReference=(PBXFileReference)Iterables.get(resourcesGroup.getChildren(),0);
  assertEquals("foo.xcdatamodel",modelReference.getName());
}
