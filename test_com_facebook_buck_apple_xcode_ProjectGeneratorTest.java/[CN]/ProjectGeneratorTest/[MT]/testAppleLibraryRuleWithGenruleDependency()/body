{
  BuildRuleResolver buildRuleResolver=new BuildRuleResolver();
  BuildRule genrule=GenruleBuilder.createGenrule(BuildTarget.builder("//foo","script").build()).addSrc(new TestSourcePath("script/input.png").resolve()).setBash("echo \"hello world!\"").setOut("helloworld.txt").build();
  buildRuleResolver.addToIndex(genrule.getBuildTarget(),genrule);
  BuildTarget libTarget=BuildTarget.builder("//foo","lib").build();
  BuildRuleParams libParams=new FakeBuildRuleParamsBuilder(libTarget).setDeps(ImmutableSortedSet.of(genrule)).setType(AppleLibraryDescription.TYPE).build();
  AppleNativeTargetDescriptionArg arg=appleLibraryDescription.createUnpopulatedConstructorArg();
  arg.configs=ImmutableMap.of("Debug",ImmutableList.<Either<Path,ImmutableMap<String,String>>>of());
  arg.srcs=ImmutableList.of(AppleSource.ofSourcePathWithFlags(new Pair<SourcePath,String>(new TestSourcePath("foo.m"),"-foo")),AppleSource.ofSourcePath(new TestSourcePath("foo.h")));
  arg.frameworks=ImmutableSortedSet.of();
  arg.deps=Optional.absent();
  arg.gid=Optional.absent();
  arg.headerPathPrefix=Optional.absent();
  arg.useBuckHeaderMaps=Optional.absent();
  BuildRule rule=appleLibraryDescription.createBuildRule(libParams,buildRuleResolver,arg);
  buildRuleResolver.addToIndex(libTarget,rule);
  ProjectGenerator projectGenerator=createProjectGeneratorForCombinedProject(buildRuleResolver,ImmutableSet.of(rule.getBuildTarget()));
  projectGenerator.createXcodeProjects();
  PBXProject project=projectGenerator.getGeneratedProject();
  assertThat(project.getTargets(),hasSize(1));
  PBXTarget target=project.getTargets().get(0);
  assertThat(target.getName(),equalTo("//foo:lib"));
  assertThat(target.isa(),equalTo("PBXNativeTarget"));
  PBXShellScriptBuildPhase shellScriptBuildPhase=ProjectGeneratorTestUtils.getSingletonPhaseByType(target,PBXShellScriptBuildPhase.class);
  assertThat(Iterables.getOnlyElement(shellScriptBuildPhase.getInputPaths()),equalTo("../script/input.png"));
  assertThat(shellScriptBuildPhase.getShellScript(),equalTo("/bin/bash -e -c 'echo \"hello world!\"'"));
}
