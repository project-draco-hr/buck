{
  BuildTarget dynamicLibraryTarget=BuildTarget.builder("//dep","dynamic").setFlavor(AppleLibraryDescription.DYNAMIC_LIBRARY).build();
  TargetNode<?> dynamicLibraryNode=AppleLibraryBuilder.createBuilder(dynamicLibraryTarget).build();
  BuildTarget xctestTarget=BuildTarget.builder("//foo","xctest").build();
  TargetNode<?> xctestNode=AppleBundleBuilder.createBuilder(xctestTarget).setExtension(Either.<AppleBundleExtension,String>ofLeft(AppleBundleExtension.XCTEST)).setBinary(dynamicLibraryTarget).build();
  BuildTarget testTarget=BuildTarget.builder("//foo","test").build();
  TargetNode<?> testNode=AppleTestBuilder.createBuilder(testTarget).setTestBundle(xctestTarget).build();
  ProjectGenerator projectGenerator=createProjectGeneratorForCombinedProject(ImmutableSet.of(dynamicLibraryNode,xctestNode,testNode),ImmutableSet.of(testTarget));
  projectGenerator.createXcodeProjects();
  PBXTarget target=assertTargetExistsAndReturnTarget(projectGenerator.getGeneratedProject(),"//foo:xctest");
  assertEquals(target.getProductType(),PBXTarget.ProductType.UNIT_TEST);
  assertThat(target.isa(),equalTo("PBXNativeTarget"));
  PBXFileReference productReference=target.getProductReference();
  assertEquals("xctest.xctest",productReference.getName());
}
