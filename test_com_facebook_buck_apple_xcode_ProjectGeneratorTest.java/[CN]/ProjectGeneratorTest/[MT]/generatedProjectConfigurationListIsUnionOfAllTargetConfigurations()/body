{
  SourcePath confFile=new PathSourcePath(EMPTY_XCCONFIG_PATH);
  ImmutableList<XcodeRuleConfigurationLayer> confFiles=ImmutableList.of(new XcodeRuleConfigurationLayer(confFile),new XcodeRuleConfigurationLayer(confFile));
  BuildTarget buildTarget1=BuildTarget.builder("//foo","rule1").build();
  TargetNode<?> node1=AppleLibraryBuilder.createBuilder(buildTarget1).setConfigs(Optional.of(ImmutableSortedMap.of("Conf1",new XcodeRuleConfiguration(confFiles),"Conf2",new XcodeRuleConfiguration(confFiles)))).build();
  BuildTarget buildTarget2=BuildTarget.builder("//foo","rule2").build();
  TargetNode<?> node2=AppleLibraryBuilder.createBuilder(buildTarget2).setConfigs(Optional.of(ImmutableSortedMap.of("Conf2",new XcodeRuleConfiguration(confFiles),"Conf3",new XcodeRuleConfiguration(confFiles)))).build();
  ProjectGenerator projectGenerator=createProjectGeneratorForCombinedProject(ImmutableSet.of(node1,node2));
  projectGenerator.createXcodeProjects();
  PBXProject generatedProject=projectGenerator.getGeneratedProject();
  Map<String,XCBuildConfiguration> configurations=generatedProject.getBuildConfigurationList().getBuildConfigurationsByName().asMap();
  assertThat(configurations,hasKey("Conf1"));
  assertThat(configurations,hasKey("Conf2"));
  assertThat(configurations,hasKey("Conf3"));
}
