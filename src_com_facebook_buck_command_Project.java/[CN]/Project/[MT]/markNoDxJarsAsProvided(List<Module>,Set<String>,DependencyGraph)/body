{
  Map<String,String> intelliJLibraryNameToJarPath=Maps.newHashMap();
  for (  String jarPath : noDxJars) {
    String libraryName=getIntellijNameForBinaryJar(jarPath);
    intelliJLibraryNameToJarPath.put(libraryName,jarPath);
  }
  for (  Module module : modules) {
    Set<String> classpathEntriesToDex;
    if (module.srcRule instanceof AndroidBinaryRule) {
      AndroidBinaryRule androidBinaryRule=(AndroidBinaryRule)module.srcRule;
      AndroidDexTransitiveDependencies dexTransitiveDependencies=androidBinaryRule.findDexTransitiveDependencies(dependencyGraph);
      classpathEntriesToDex=Sets.newHashSet(Sets.intersection(noDxJars,dexTransitiveDependencies.classpathEntriesToDex));
    }
 else {
      classpathEntriesToDex=ImmutableSet.of();
    }
    for (    DependentModule dependentModule : module.dependencies) {
      if (!dependentModule.isLibrary()) {
        continue;
      }
      String libraryName=dependentModule.getLibraryName();
      String jarPath=intelliJLibraryNameToJarPath.get(libraryName);
      if (jarPath != null) {
        if (classpathEntriesToDex.contains(jarPath)) {
          dependentModule.scope=null;
          classpathEntriesToDex.remove(jarPath);
        }
 else {
          dependentModule.scope="PROVIDED";
        }
      }
    }
    for (    String entry : classpathEntriesToDex) {
      String libraryName=getIntellijNameForBinaryJar(entry);
      DependentModule dependency=DependentModule.newLibrary(null,libraryName);
      module.dependencies.add(dependency);
    }
  }
}
