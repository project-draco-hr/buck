{
  CompilationDatabaseTraversal traversal=new CompilationDatabaseTraversal(buildRuleResolver);
  Iterable<AbstractAppleNativeTargetBuildRule> startNodes=FluentIterable.from(params.getDeclaredDeps()).filter(AbstractAppleNativeTargetBuildRule.class);
  try {
    traversal.traverse(startNodes);
  }
 catch (  CycleException|IOException|InterruptedException e) {
    throw new RuntimeException(e);
  }
  BuildRuleParams compilationDatabaseParams=params.copyWithDeps(traversal.deps.build(),params.getExtraDeps());
  return new CompilationDatabase(compilationDatabaseParams,pathResolver,appleConfig,targetSources,args.frameworks.get(),traversal.includePaths.build(),args.prefixHeader);
}
