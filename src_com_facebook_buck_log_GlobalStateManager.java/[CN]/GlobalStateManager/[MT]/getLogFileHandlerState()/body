{
  return new LogFileHandlerState(){
    @Override public Iterable<OutputStreamWriter> getWriters(    @Nullable String commandId){
      if (commandId == null) {
        return commandIdToLogFileHandlerWriter.values();
      }
      OutputStreamWriter writer=commandIdToLogFileHandlerWriter.get(commandId);
      if (writer != null) {
        return Collections.singleton(writer);
      }
 else {
        return commandIdToLogFileHandlerWriter.values();
      }
    }
    @Override public String threadIdToCommandId(    long threadId){
      return threadIdToCommandId.get(threadId);
    }
  }
;
}
