{
  try {
    Files.createDirectories(logFilePath.getParent());
    ReferenceCountedWriter newWriter=newReferenceCounterWriter(logFilePath.toString());
    Writer oldWriter=commandIdToLogFileHandlerWriter.get(DEFAULT_LOG_FILE_WRITER_KEY);
    commandIdToLogFileHandlerWriter.put(DEFAULT_LOG_FILE_WRITER_KEY,newWriter);
    if (oldWriter != null) {
      oldWriter.flush();
      oldWriter.close();
    }
    return newWriter;
  }
 catch (  FileNotFoundException e) {
    throw new RuntimeException(String.format("Could not create file [%s].",logFilePath),e);
  }
catch (  IOException e) {
    throw new RuntimeException(String.format("Exception wrapping file [%s].",logFilePath),e);
  }
}
