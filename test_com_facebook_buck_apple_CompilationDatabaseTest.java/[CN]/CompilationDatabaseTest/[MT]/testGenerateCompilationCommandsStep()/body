{
  CompilationDatabase compilationDatabase=createTestCompilationDatabase();
  List<Step> buildSteps=compilationDatabase.getBuildSteps(FakeBuildContext.NOOP_CONTEXT,new FakeBuildableContext());
  Step step=buildSteps.get(3);
  assertTrue(step instanceof GenerateCompilationCommandsJson);
  GenerateCompilationCommandsJson generateCompilationCommandsStep=(GenerateCompilationCommandsJson)step;
  final String root="/Users/user/src";
  final Path fakeRoot=Paths.get(root);
  ProjectFilesystem projectFilesystem=new FakeProjectFilesystem(){
    @Override public Path resolve(    Path relativePath){
      return fakeRoot.resolve(relativePath);
    }
  }
;
  ExecutionContext context=TestExecutionContext.newBuilder().setProjectFilesystem(projectFilesystem).build();
  Iterable<JsonSerializableDatabaseEntry> expectedEntries=ImmutableList.of(new JsonSerializableDatabaseEntry(root + "/foo",root + "/foo/Hello.m",Joiner.on(' ').join("clang","-x","objective-c","-arch","i386","-mios-simulator-version-min=7.0","-fmessage-length=0","-fdiagnostics-show-note-include-stack","-fmacro-backtrace-limit=0","-std=gnu99","-fpascal-strings","-fexceptions","-fasm-blocks","-fstrict-aliasing","-fobjc-abi-version=2","-fobjc-legacy-dispatch","-O0","-g","-MMD","-fobjc-arc","-isysroot","/path/to/somewhere" + "/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator8.0.sdk","-F/path/to/somewhere/" + "Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator8.0.sdk/" + "System/Library/Frameworks/CoreLocation.framework","-F/path/to/somewhere/" + "Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator8.0.sdk/" + "System/Library/Frameworks/Foundation.framework","-F/path/to/somewhere/" + "Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator8.0.sdk/" + "System/Library/Frameworks/UIKit.framework","-I/Users/user/src/buck-out/gen/library/lib.hmap","-include","/Users/user/src/foo/bar.pch","-c",root + "/foo/Hello.m")),new JsonSerializableDatabaseEntry(root + "/foo",root + "/foo/Hello.h",Joiner.on(' ').join("clang","-x","objective-c","-arch","i386","-mios-simulator-version-min=7.0","-fmessage-length=0","-fdiagnostics-show-note-include-stack","-fmacro-backtrace-limit=0","-std=gnu99","-fpascal-strings","-fexceptions","-fasm-blocks","-fstrict-aliasing","-fobjc-abi-version=2","-fobjc-legacy-dispatch","-O0","-g","-MMD","-fobjc-arc","-isysroot","/path/to/somewhere" + "/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator8.0.sdk","-F/path/to/somewhere/" + "Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator8.0.sdk/" + "System/Library/Frameworks/CoreLocation.framework","-F/path/to/somewhere/" + "Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator8.0.sdk/" + "System/Library/Frameworks/Foundation.framework","-F/path/to/somewhere/" + "Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator8.0.sdk/" + "System/Library/Frameworks/UIKit.framework","-I/Users/user/src/buck-out/gen/library/lib.hmap","-include","/Users/user/src/foo/bar.pch","-c",root + "/foo/Hello.h","public")));
  Iterable<JsonSerializableDatabaseEntry> observedEntries=generateCompilationCommandsStep.createEntries(context);
  MoreAsserts.assertIterablesEquals(expectedEntries,observedEntries);
}
