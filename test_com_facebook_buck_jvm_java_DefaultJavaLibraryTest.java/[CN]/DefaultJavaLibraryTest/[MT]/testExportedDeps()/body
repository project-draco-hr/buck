{
  BuildRuleResolver ruleResolver=new BuildRuleResolver(TargetGraph.EMPTY,new BuildTargetNodeToBuildRuleTransformer());
  BuildTarget nonIncludedTarget=BuildTargetFactory.newInstance("//:not_included");
  BuildRule notIncluded=JavaLibraryBuilder.createBuilder(nonIncludedTarget).addSrc(Paths.get("java/src/com/not_included/Raz.java")).build(ruleResolver);
  BuildTarget includedTarget=BuildTargetFactory.newInstance("//:included");
  BuildRule included=JavaLibraryBuilder.createBuilder(includedTarget).addSrc(Paths.get("java/src/com/included/Rofl.java")).build(ruleResolver);
  BuildTarget libraryOneTarget=BuildTargetFactory.newInstance("//:libone");
  BuildRule libraryOne=JavaLibraryBuilder.createBuilder(libraryOneTarget).addDep(notIncluded.getBuildTarget()).addDep(included.getBuildTarget()).addExportedDep(included.getBuildTarget()).addSrc(Paths.get("java/src/com/libone/Bar.java")).build(ruleResolver);
  BuildTarget libraryTwoTarget=BuildTargetFactory.newInstance("//:libtwo");
  BuildRule libraryTwo=JavaLibraryBuilder.createBuilder(libraryTwoTarget).addSrc(Paths.get("java/src/com/libtwo/Foo.java")).addDep(libraryOne.getBuildTarget()).addExportedDep(libraryOne.getBuildTarget()).build(ruleResolver);
  BuildTarget parentTarget=BuildTargetFactory.newInstance("//:parent");
  BuildRule parent=JavaLibraryBuilder.createBuilder(parentTarget).addSrc(Paths.get("java/src/com/parent/Meh.java")).addDep(libraryTwo.getBuildTarget()).build(ruleResolver);
  assertEquals("A java_library that depends on //:libone should include only libone.jar in its " + "classpath when compiling itself.",ImmutableSetMultimap.of(getJavaLibrary(notIncluded),Paths.get("buck-out/gen/lib__not_included__output/not_included.jar")),getJavaLibrary(notIncluded).getOutputClasspathEntries());
  assertEquals(ImmutableSetMultimap.of(getJavaLibrary(included),Paths.get("buck-out/gen/lib__included__output/included.jar")),getJavaLibrary(included).getOutputClasspathEntries());
  assertEquals(ImmutableSetMultimap.of(getJavaLibrary(included),Paths.get("buck-out/gen/lib__included__output/included.jar"),getJavaLibrary(libraryOne),Paths.get("buck-out/gen/lib__libone__output/libone.jar"),getJavaLibrary(libraryOne),Paths.get("buck-out/gen/lib__included__output/included.jar")),getJavaLibrary(libraryOne).getOutputClasspathEntries());
  assertEquals("//:libtwo exports its deps, so a java_library that depends on //:libtwo should include " + "both libone.jar and libtwo.jar in its classpath when compiling itself.",ImmutableSetMultimap.of(getJavaLibrary(libraryOne),Paths.get("buck-out/gen/lib__libone__output/libone.jar"),getJavaLibrary(libraryOne),Paths.get("buck-out/gen/lib__included__output/included.jar"),getJavaLibrary(libraryTwo),Paths.get("buck-out/gen/lib__libone__output/libone.jar"),getJavaLibrary(libraryTwo),Paths.get("buck-out/gen/lib__libtwo__output/libtwo.jar"),getJavaLibrary(libraryTwo),Paths.get("buck-out/gen/lib__included__output/included.jar")),getJavaLibrary(libraryTwo).getOutputClasspathEntries());
  assertEquals("A java_binary that depends on //:parent should include libone.jar, libtwo.jar and " + "parent.jar.",ImmutableSetMultimap.<JavaLibrary,Path>builder().put(getJavaLibrary(included),Paths.get("buck-out/gen/lib__included__output/included.jar")).put(getJavaLibrary(notIncluded),Paths.get("buck-out/gen/lib__not_included__output/not_included.jar")).putAll(getJavaLibrary(libraryOne),Paths.get("buck-out/gen/lib__included__output/included.jar"),Paths.get("buck-out/gen/lib__libone__output/libone.jar")).putAll(getJavaLibrary(libraryTwo),Paths.get("buck-out/gen/lib__included__output/included.jar"),Paths.get("buck-out/gen/lib__not_included__output/not_included.jar"),Paths.get("buck-out/gen/lib__libone__output/libone.jar"),Paths.get("buck-out/gen/lib__libtwo__output/libtwo.jar")).put(getJavaLibrary(parent),Paths.get("buck-out/gen/lib__parent__output/parent.jar")).build(),getJavaLibrary(parent).getTransitiveClasspathEntries());
  assertThat(getJavaLibrary(parent).getTransitiveClasspathDeps(),Matchers.equalTo(ImmutableSet.<JavaLibrary>builder().add(getJavaLibrary(included)).add(getJavaLibrary(notIncluded)).add(getJavaLibrary(libraryOne)).add(getJavaLibrary(libraryTwo)).add(getJavaLibrary(parent)).build()));
  assertEquals("A java_library that depends on //:parent should include only parent.jar in its " + "-classpath when compiling itself.",ImmutableSetMultimap.of(getJavaLibrary(parent),Paths.get("buck-out/gen/lib__parent__output/parent.jar")),getJavaLibrary(parent).getOutputClasspathEntries());
}
