{
  new DirectoryTraversal(directory){
    @Override public void visit(    File file,    String relativePath){
      JarEntry entry=new JarEntry(relativePath);
      String entryName=entry.getName();
      entry.setTime(file.lastModified());
      try {
        if (directoryEntriesInsertedIntoOutputJar.contains(entryName)) {
          return;
        }
        jar.putNextEntry(entry);
        Files.copy(file,jar);
        jar.closeEntry();
        if (entryName.endsWith("/")) {
          directoryEntriesInsertedIntoOutputJar.add(entryName);
        }
      }
 catch (      IOException e) {
        Throwables.propagate(e);
      }
    }
  }
.traverse();
}
