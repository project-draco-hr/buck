{
  return new ArtifactCache(){
    @Override public CacheResult fetch(    RuleKey ruleKey,    File output) throws InterruptedException {
      eventBus.post(ArtifactCacheEvent.started(ArtifactCacheEvent.Operation.FETCH,ImmutableSet.of(ruleKey)));
      CacheResult fetchResult=delegate.fetch(ruleKey,output);
      eventBus.post(ArtifactCacheEvent.finished(ArtifactCacheEvent.Operation.FETCH,ImmutableSet.of(ruleKey),fetchResult));
      return fetchResult;
    }
    @Override public void store(    ImmutableSet<RuleKey> ruleKeys,    File output) throws InterruptedException {
      eventBus.post(ArtifactCacheEvent.started(ArtifactCacheEvent.Operation.STORE,ruleKeys));
      delegate.store(ruleKeys,output);
      eventBus.post(ArtifactCacheEvent.finished(ArtifactCacheEvent.Operation.STORE,ruleKeys));
    }
    @Override public boolean isStoreSupported(){
      return delegate.isStoreSupported();
    }
    @Override public void close() throws IOException {
      delegate.close();
    }
  }
;
}
