{
  ExecutionContext context=TestExecutionContext.newInstance();
  ImmutableList<String> args=ImmutableList.of("-rpath","hello","a.o","libb.a","-lsysroot","/Library/Application Support/blabla");
  Path frameworkRoot=Paths.get("/System/Frameworks");
  final Path librarySearchPath=Paths.get("/System/libraries");
  final String library="z";
  CxxPrepareForLinkStep step=new CxxPrepareForLinkStep(argFilePath,output,args,ImmutableSet.of(frameworkRoot),ImmutableSet.of(librarySearchPath),ImmutableSet.of(library));
  step.execute(context);
  assertThat(Files.exists(argFilePath),Matchers.equalTo(true));
  ImmutableList<String> expectedFileContents=ImmutableList.<String>builder().add("-o",output.toString()).add("-F",frameworkRoot.toString()).add("-L",librarySearchPath.toString()).add("-l" + library).add("-rpath").add("hello").add("a.o").add("libb.a").add("-lsysroot").add("\"/Library/Application Support/blabla\"").build();
  List<String> fileContents=Files.readAllLines(argFilePath,StandardCharsets.UTF_8);
  assertThat(fileContents,Matchers.<List<String>>equalTo(expectedFileContents));
  Files.deleteIfExists(argFilePath);
}
