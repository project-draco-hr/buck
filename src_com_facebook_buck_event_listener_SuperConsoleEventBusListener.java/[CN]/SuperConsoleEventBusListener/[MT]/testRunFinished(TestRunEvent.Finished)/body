{
  boolean set=testRunFinished.compareAndSet(null,finished);
  Preconditions.checkState(set,"Test run should not finish after test run already finished");
  ImmutableList.Builder<String> builder=ImmutableList.builder();
  for (  TestResults results : finished.getResults()) {
    testFormatter.reportResult(builder,results);
  }
  testFormatter.runComplete(builder,finished.getResults());
synchronized (testReportBuilder) {
    testReportBuilder.addAll(builder.build());
    logEvents.add(ConsoleEvent.info(Joiner.on('\n').join(testReportBuilder.build())));
  }
}
