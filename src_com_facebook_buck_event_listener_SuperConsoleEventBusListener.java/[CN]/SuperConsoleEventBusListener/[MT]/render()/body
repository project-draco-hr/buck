{
  ImmutableList<String> lines=createRenderLinesAtTime(clock.currentTimeMillis());
  String nextFrame=clearLastRender() + Joiner.on("\n").join(lines);
  nextFrame=ansi.asNoWrap(nextFrame);
  lastNumLinesPrinted=lines.size();
synchronized (console.getStdOut()) {
synchronized (console.getStdErr()) {
      if (console.getStdOut().isDirty() || console.getStdErr().isDirty()) {
        renderScheduler.shutdown();
      }
 else       if (!nextFrame.isEmpty()) {
        console.getStdErr().getRawStream().println(nextFrame);
      }
    }
  }
}
