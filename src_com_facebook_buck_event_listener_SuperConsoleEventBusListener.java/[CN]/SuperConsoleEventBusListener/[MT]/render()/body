{
  ImmutableList<String> lines=createRenderLinesAtTime(clock.currentTimeMillis());
  String nextFrame=clearLastRender() + Joiner.on("\n").join(lines);
  lastNumLinesPrinted=lines.size();
synchronized (console.getStdOut()) {
synchronized (console.getStdErr()) {
      boolean stdoutDirty=console.getStdOut().isDirty();
      boolean stderrDirty=console.getStdErr().isDirty();
      if (stdoutDirty || stderrDirty) {
        LOG.debug("Stopping console output (stdout dirty %s, stderr dirty %s).",stdoutDirty,stderrDirty);
        stopRenderScheduler();
      }
 else       if (!nextFrame.isEmpty()) {
        nextFrame=ansi.asNoWrap(nextFrame);
        console.getStdErr().getRawStream().println(nextFrame);
      }
    }
  }
}
