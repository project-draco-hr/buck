{
  Optional<Path> javac=buckConfig.getJavac();
  Optional<String> javacVersion=Optional.absent();
  if (javac.isPresent()) {
    try {
      ProcessExecutor.Result versionResult=executor.execute(Runtime.getRuntime().exec(javac.get() + " -version"));
      if (versionResult.getExitCode() == 0) {
        javacVersion=Optional.of(versionResult.getStdout());
      }
 else {
        throw new HumanReadableException(versionResult.getStderr());
      }
    }
 catch (    IOException e) {
      throw new HumanReadableException("Could not run " + javac.get() + " -version");
    }
  }
  Builder builder=createDefaultBuilder();
  builder.register(BuildRuleType.JAVA_LIBRARY,new JavaLibraryBuildRuleFactory(javac,javacVersion));
  builder.register(BuildRuleType.ANDROID_LIBRARY,new AndroidLibraryBuildRuleFactory(javac,javacVersion));
  Optional<String> ndkVersion=buckConfig.getNdkVersion();
  if (!ndkVersion.isPresent()) {
    ndkVersion=androidDirectoryResolver.getNdkVersion();
  }
  builder.register(BuildRuleType.NDK_LIBRARY,new NdkLibraryBuildRuleFactory(ndkVersion));
  return builder;
}
