{
  if (!buildPlatform.equals(Platform.MACOS)) {
    return;
  }
  Path appleDeveloperDirectory=appleDeveloperDirectorySupplier.get();
  if (!Files.isDirectory(appleDeveloperDirectory)) {
    return;
  }
  Path xcodeDir=appleDeveloperDirectory.getParent();
  if (xcodeDir == null) {
    LOG.warn("Couldn't find parent of developer directory %s (Apple platforms will be unavailable)",appleDeveloperDirectory);
    return;
  }
  Path versionPlistPath=xcodeDir.resolve("version.plist");
  if (!Files.exists(versionPlistPath)) {
    LOG.warn("Couldn't find version file at %s (Apple platforms will be unavailable)",versionPlistPath);
    return;
  }
  ImmutableMap<String,Path> toolchainPaths=AppleToolchainDiscovery.discoverAppleToolchainPaths(appleDeveloperDirectory);
  ImmutableMap<AppleSdk,AppleSdkPaths> sdkPaths=AppleSdkDiscovery.discoverAppleSdkPaths(appleDeveloperDirectory,versionPlistPath,toolchainPaths);
  for (  Map.Entry<AppleSdk,AppleSdkPaths> entry : sdkPaths.entrySet()) {
    AppleSdk sdk=entry.getKey();
    AppleSdkPaths appleSdkPaths=entry.getValue();
    String targetSdkVersion=appleConfig.getTargetSdkVersion(sdk.getApplePlatform()).or(sdk.getVersion());
    LOG.debug("SDK %s using default version %s",sdk,targetSdkVersion);
    for (    String architecture : sdk.getArchitectures()) {
      CxxPlatform appleCxxPlatform=AppleCxxPlatforms.build(sdk.getApplePlatform(),sdk.getName(),targetSdkVersion,architecture,appleSdkPaths,buckConfig);
      appleCxxPlatformsToAppleSdkPathsBuilder.put(appleCxxPlatform,appleSdkPaths);
    }
  }
}
