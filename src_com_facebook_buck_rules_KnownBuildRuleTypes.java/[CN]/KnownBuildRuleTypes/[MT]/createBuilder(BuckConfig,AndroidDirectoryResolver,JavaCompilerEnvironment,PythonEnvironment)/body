{
  Platform platform=Platform.detect();
  Optional<String> ndkVersion=config.getNdkVersion();
  if (!ndkVersion.isPresent()) {
    ndkVersion=androidDirectoryResolver.getNdkVersion();
  }
  ThriftBuckConfig thriftBuckConfig=new ThriftBuckConfig(config);
  OCamlBuckConfig ocamlBuckConfig=new OCamlBuckConfig(platform,config);
  DefaultCxxPlatform cxxPlatform=new DefaultCxxPlatform(platform,config);
  ProGuardConfig proGuardConfig=new ProGuardConfig(config);
  Optional<Path> pythonPathToPex=config.getPath("python","path_to_pex");
  Optional<Path> pythonPathToPythonTestMain=config.getPath("python","path_to_python_test_main");
  Optional<String> defaultMavenRepo=config.getValue("download","maven_repo");
  Downloader downloader=new Downloader(Optional.<Proxy>absent(),defaultMavenRepo);
  boolean downloadAtRuntimeOk=config.getBooleanValue("download","in_build",false);
  Builder builder=builder();
  JavacOptions androidBinaryOptions=JavacOptions.builder(JavacOptions.DEFAULTS).setJavaCompilerEnvironment(javacEnv).build();
  builder.register(new AndroidBinaryDescription(androidBinaryOptions,proGuardConfig));
  builder.register(new AndroidBuildConfigDescription());
  builder.register(new AndroidInstrumentationApkDescription());
  builder.register(new AndroidLibraryDescription(javacEnv));
  builder.register(new AndroidManifestDescription());
  builder.register(new AndroidPrebuiltAarDescription());
  builder.register(new AndroidResourceDescription());
  builder.register(new ApkGenruleDescription());
  builder.register(new AppleAssetCatalogDescription());
  builder.register(new AppleBinaryDescription());
  builder.register(new AppleBundleDescription());
  builder.register(new AppleLibraryDescription());
  builder.register(new AppleResourceDescription());
  builder.register(new AppleTestDescription());
  builder.register(new BuckExtensionDescription());
  builder.register(new CoreDataModelDescription());
  builder.register(new CxxBinaryDescription(cxxPlatform));
  builder.register(new CxxLibraryDescription(cxxPlatform));
  builder.register(new CxxPythonExtensionDescription(cxxPlatform));
  builder.register(new CxxTestDescription(cxxPlatform));
  builder.register(new ExportFileDescription());
  builder.register(new GenruleDescription());
  builder.register(new GenAidlDescription());
  builder.register(new GenParcelableDescription());
  builder.register(new GwtBinaryDescription());
  builder.register(new IosPostprocessResourcesDescription());
  builder.register(new JavaBinaryDescription());
  builder.register(new JavaLibraryDescription(javacEnv));
  builder.register(new JavaTestDescription(javacEnv));
  builder.register(new KeystoreDescription());
  builder.register(new NdkLibraryDescription(ndkVersion));
  builder.register(new OCamlBinaryDescription(ocamlBuckConfig));
  builder.register(new OCamlLibraryDescription(ocamlBuckConfig));
  builder.register(new PrebuiltCxxLibraryDescription(cxxPlatform));
  builder.register(new PrebuiltJarDescription());
  builder.register(new PrebuiltNativeLibraryDescription());
  builder.register(new PrebuiltOCamlLibraryDescription());
  builder.register(new ProjectConfigDescription());
  builder.register(new PythonBinaryDescription(pythonPathToPex.or(PythonBinaryDescription.DEFAULT_PATH_TO_PEX),pythonEnv));
  builder.register(new PythonLibraryDescription());
  builder.register(new PythonTestDescription(pythonPathToPex.or(PythonBinaryDescription.DEFAULT_PATH_TO_PEX),pythonPathToPythonTestMain.or(PythonTestDescription.PYTHON_PATH_TO_PYTHON_TEST_MAIN),pythonEnv));
  builder.register(new RemoteFileDescription(downloadAtRuntimeOk,downloader));
  builder.register(new RobolectricTestDescription(javacEnv));
  builder.register(new ShBinaryDescription());
  builder.register(new ShTestDescription());
  builder.register(new ThriftLibraryDescription(thriftBuckConfig,ImmutableList.of(new ThriftJavaEnhancer(thriftBuckConfig,javacEnv),new ThriftCxxEnhancer(thriftBuckConfig,cxxPlatform,false),new ThriftCxxEnhancer(thriftBuckConfig,cxxPlatform,true),new ThriftPythonEnhancer(thriftBuckConfig,ThriftPythonEnhancer.Type.NORMAL),new ThriftPythonEnhancer(thriftBuckConfig,ThriftPythonEnhancer.Type.TWISTED))));
  builder.register(new XcodeNativeDescription());
  builder.register(new XcodeProjectConfigDescription());
  builder.register(new XcodeWorkspaceConfigDescription());
  return builder;
}
