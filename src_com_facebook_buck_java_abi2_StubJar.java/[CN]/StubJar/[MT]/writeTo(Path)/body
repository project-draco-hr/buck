{
  Preconditions.checkState(!Files.exists(path),"Output file already exists: %s)",path);
  if (!Files.exists(path.getParent())) {
    Files.createDirectories(path.getParent());
  }
  try (FileInputStream fis=new FileInputStream(toMirror.toFile());BufferedInputStream bis=new BufferedInputStream(fis);JarInputStream jis=new JarInputStream(bis)){
    for (JarEntry entry=jis.getNextJarEntry(); entry != null; entry=jis.getNextJarEntry()) {
      if (!entry.getName().endsWith(".class")) {
        continue;
      }
      ClassReader classReader=new ClassReader(jis);
      ClassMirror visitor=new ClassMirror(entry.getName());
      classes.add(visitor);
      classReader.accept(visitor,ClassReader.SKIP_DEBUG);
    }
  }
   try (FileOutputStream fos=new FileOutputStream(path.toFile());BufferedOutputStream bos=new BufferedOutputStream(fos);JarOutputStream jar=new JarOutputStream(bos)){
    for (    ClassMirror aClass : classes) {
      aClass.writeTo(jar);
    }
  }
 }
