{
  Preconditions.checkState(!filesystem.exists(path),"Output file already exists: %s)",path);
  if (path.getParent() != null && !filesystem.exists(path.getParent())) {
    filesystem.createParentDirs(path);
  }
  Walker walker=Walkers.getWalkerFor(toMirror);
  walker.walk(new FileAction(){
    @Override public void visit(    Path relativizedPath,    InputStream stream) throws IOException {
      String fileName=relativizedPath.toString();
      if (!fileName.endsWith(".class")) {
        return;
      }
      ClassReader classReader=new ClassReader(stream);
      ClassMirror visitor=new ClassMirror(fileName);
      classes.add(visitor);
      classReader.accept(visitor,SKIP_CODE | SKIP_DEBUG | SKIP_FRAMES);
    }
  }
);
  try (OutputStream fos=filesystem.newFileOutputStream(path);JarOutputStream jar=new JarOutputStream(fos)){
    for (    ClassMirror aClass : classes) {
      aClass.writeTo(jar);
    }
  }
 }
