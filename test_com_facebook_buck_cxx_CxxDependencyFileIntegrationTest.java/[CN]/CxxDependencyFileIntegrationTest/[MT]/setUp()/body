{
  workspace=TestDataHelper.createProjectWorkspaceForScenario(this,"depfiles",tmp);
  workspace.setUp();
  workspace.writeContentsToPath("[cxx]\n  preprocess_mode = " + mode.toString().toLowerCase() + "\n",".buckconfig");
  workspace.runBuckBuild("//:test").assertSuccess();
  target=BuildTargetFactory.newInstance("//:test");
  CxxPlatform cxxPlatform=DefaultCxxPlatforms.build(new CxxBuckConfig(new FakeBuckConfig()));
  CxxSourceRuleFactory cxxSourceRuleFactory=CxxSourceRuleFactoryHelper.of(target,cxxPlatform);
  String source="test.cpp";
  if (mode == CxxPreprocessMode.SEPARATE) {
    preprocessTarget=cxxSourceRuleFactory.createPreprocessBuildTarget(source,CxxSource.Type.CXX,CxxSourceRuleFactory.PicType.PDC);
  }
 else {
    preprocessTarget=cxxSourceRuleFactory.createCompileBuildTarget(source,CxxSourceRuleFactory.PicType.PDC);
  }
  workspace.getBuildLog().assertTargetBuiltLocally(preprocessTarget.toString());
}
