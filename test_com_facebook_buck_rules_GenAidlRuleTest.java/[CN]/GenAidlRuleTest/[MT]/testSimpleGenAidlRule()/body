{
  BuildContext context=null;
  Map<String,BuildRule> buildRuleIndex=Maps.newHashMap();
  String pathToAidl="java/com/example/base/IWhateverService.aidl";
  String importPath="java/com/example/base/";
  GenAidlRule genAidlRule=GenAidlRule.newGenAidlRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//java/com/example/base:IWhateverService")).setAidl(pathToAidl).setImportPath(importPath).build(buildRuleIndex);
  assertEquals(BuildRuleType.GEN_AIDL,genAidlRule.getType());
  assertTrue(genAidlRule.isAndroidRule());
  assertEquals(ImmutableList.of(pathToAidl),genAidlRule.getInputsToCompareToOutput(context));
  List<Command> commands=genAidlRule.buildInternal(context);
  final String pathToAidlExecutable="/usr/local/bin/aidl";
  final String pathToFrameworkAidl="/home/root/android/platforms/android-16/framework.aidl";
  AndroidPlatformTarget androidPlatformTarget=createMock(AndroidPlatformTarget.class);
  File aidlExecutable=createMock(File.class);
  expect(aidlExecutable.getAbsolutePath()).andReturn(pathToAidlExecutable);
  expect(androidPlatformTarget.getAidlExecutable()).andReturn(aidlExecutable);
  File frameworkIdlFile=createMock(File.class);
  expect(frameworkIdlFile.getAbsolutePath()).andReturn(pathToFrameworkAidl);
  expect(androidPlatformTarget.getAndroidFrameworkIdlFile()).andReturn(frameworkIdlFile);
  ExecutionContext executionContext=createMock(ExecutionContext.class);
  expect(executionContext.getAndroidPlatformTarget()).andReturn(androidPlatformTarget);
  replay(androidPlatformTarget,aidlExecutable,frameworkIdlFile,executionContext);
  String outputDirectory=String.format("%s/%s",BuckConstant.GEN_DIR,importPath);
  MoreAsserts.assertShellCommands("gen_aidl() should make a directory and then use the aidl binary to write .java files.",ImmutableList.of(String.format("mkdir -p %s",outputDirectory),String.format("%s -b -p%s -I%s -o%s %s",pathToAidlExecutable,pathToFrameworkAidl,importPath,outputDirectory,pathToAidl)),commands,executionContext);
  verify(androidPlatformTarget,aidlExecutable,frameworkIdlFile,executionContext);
}
