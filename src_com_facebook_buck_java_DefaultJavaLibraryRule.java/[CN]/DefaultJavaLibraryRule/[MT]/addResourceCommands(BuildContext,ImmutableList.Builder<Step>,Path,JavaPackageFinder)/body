{
  if (!resources.isEmpty()) {
    String targetPackageDir=javaPackageFinder.findJavaPackageForPath(getBuildTarget().getBasePathWithSlash()).replace('.',File.separatorChar);
    for (    SourcePath rawResource : resources) {
      Path resource=MorePaths.separatorsToUnix(rawResource.resolve(context));
      String javaPackageAsPath=javaPackageFinder.findJavaPackageFolderForPath(resource.toString());
      Path relativeSymlinkPath;
      if (resource.startsWith(BuckConstant.BUCK_OUTPUT_DIRECTORY) || resource.startsWith(BuckConstant.GEN_DIR) || resource.startsWith(BuckConstant.BIN_DIR)|| resource.startsWith(BuckConstant.ANNOTATION_DIR)) {
        relativeSymlinkPath=Paths.get(String.format("%s/%s",targetPackageDir,rawResource.resolve(context).getFileName()));
      }
 else       if ("".equals(javaPackageAsPath)) {
        relativeSymlinkPath=resource;
      }
 else {
        int lastIndex=resource.toString().lastIndexOf(javaPackageAsPath);
        Preconditions.checkState(lastIndex >= 0,"Resource path %s must contain %s",resource,javaPackageAsPath);
        relativeSymlinkPath=Paths.get(resource.toString().substring(lastIndex));
      }
      Path target=outputDirectory.resolve(relativeSymlinkPath);
      MkdirAndSymlinkFileStep link=new MkdirAndSymlinkFileStep(resource,target);
      commands.add(link);
    }
  }
}
