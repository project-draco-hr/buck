{
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  BuildTarget nonIncludedTarget=BuildTargetFactory.newInstance("//:not_included");
  JavaLibraryRule notIncluded=ruleResolver.buildAndAddToIndex(DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(nonIncludedTarget).addSrc(Paths.get("java/src/com/not_included/Raz.java")));
  BuildTarget includedTarget=BuildTargetFactory.newInstance("//:included");
  JavaLibraryRule included=ruleResolver.buildAndAddToIndex(DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(includedTarget).addSrc(Paths.get("java/src/com/included/Rofl.java")));
  BuildTarget libraryOneTarget=BuildTargetFactory.newInstance("//:libone");
  JavaLibraryRule libraryOne=ruleResolver.buildAndAddToIndex(DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(libraryOneTarget).addDep(BuildTargetFactory.newInstance("//:not_included")).addDep(BuildTargetFactory.newInstance("//:included")).addExportedDep(BuildTargetFactory.newInstance("//:included")).addSrc(Paths.get("java/src/com/libone/Bar.java")));
  BuildTarget libraryTwoTarget=BuildTargetFactory.newInstance("//:libtwo");
  JavaLibraryRule libraryTwo=ruleResolver.buildAndAddToIndex(DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(libraryTwoTarget).addSrc(Paths.get("java/src/com/libtwo/Foo.java")).addDep(BuildTargetFactory.newInstance("//:libone")).addExportedDep(BuildTargetFactory.newInstance("//:libone")));
  BuildTarget parentTarget=BuildTargetFactory.newInstance("//:parent");
  JavaLibraryRule parent=ruleResolver.buildAndAddToIndex(DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(parentTarget).addSrc(Paths.get("java/src/com/parent/Meh.java")).addDep(BuildTargetFactory.newInstance("//:libtwo")));
  assertEquals("A java_library that depends on //:libone should include only libone.jar in its " + "classpath when compiling itself.",ImmutableSetMultimap.builder().put(notIncluded,"buck-out/gen/lib__not_included__output/not_included.jar").build(),notIncluded.getOutputClasspathEntries());
  assertEquals(ImmutableSetMultimap.builder().put(included,"buck-out/gen/lib__included__output/included.jar").build(),included.getOutputClasspathEntries());
  assertEquals(ImmutableSetMultimap.builder().put(included,"buck-out/gen/lib__included__output/included.jar").put(libraryOne,"buck-out/gen/lib__libone__output/libone.jar").put(libraryOne,"buck-out/gen/lib__included__output/included.jar").build(),libraryOne.getOutputClasspathEntries());
  assertEquals("//:libtwo exports its deps, so a java_library that depends on //:libtwo should include " + "both libone.jar and libtwo.jar in its classpath when compiling itself.",ImmutableSetMultimap.builder().put(libraryOne,"buck-out/gen/lib__libone__output/libone.jar").put(libraryOne,"buck-out/gen/lib__included__output/included.jar").put(libraryTwo,"buck-out/gen/lib__libone__output/libone.jar").put(libraryTwo,"buck-out/gen/lib__libtwo__output/libtwo.jar").put(libraryTwo,"buck-out/gen/lib__included__output/included.jar").build(),libraryTwo.getOutputClasspathEntries());
  assertEquals("A java_binary that depends on //:parent should include libone.jar, libtwo.jar and " + "parent.jar.",ImmutableSetMultimap.builder().put(included,"buck-out/gen/lib__included__output/included.jar").put(notIncluded,"buck-out/gen/lib__not_included__output/not_included.jar").put(libraryOne,"buck-out/gen/lib__included__output/included.jar").put(libraryOne,"buck-out/gen/lib__libone__output/libone.jar").put(libraryTwo,"buck-out/gen/lib__included__output/included.jar").put(libraryTwo,"buck-out/gen/lib__not_included__output/not_included.jar").put(libraryTwo,"buck-out/gen/lib__libone__output/libone.jar").put(libraryTwo,"buck-out/gen/lib__libtwo__output/libtwo.jar").put(parent,"buck-out/gen/lib__parent__output/parent.jar").build(),parent.getTransitiveClasspathEntries());
  assertEquals("A java_library that depends on //:parent should include only parent.jar in its " + "-classpath when compiling itself.",ImmutableSetMultimap.builder().put(parent,"buck-out/gen/lib__parent__output/parent.jar").build(),parent.getOutputClasspathEntries());
}
