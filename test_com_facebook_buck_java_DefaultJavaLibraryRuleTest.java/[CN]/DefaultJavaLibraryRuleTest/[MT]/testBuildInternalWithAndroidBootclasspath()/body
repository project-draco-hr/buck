{
  BuildTarget buildTarget=BuildTargetFactory.newInstance("//android/java/src/com/facebook:fb");
  String src="android/java/src/com/facebook/Main.java";
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  DefaultJavaLibraryRule javaLibrary=ruleResolver.buildAndAddToIndex(AndroidLibraryRule.newAndroidLibraryRuleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(buildTarget).addSrc(src));
  String bootclasspath="effects.jar:maps.jar:usb.jar:";
  BuildContext context=createBuildContext(javaLibrary,bootclasspath);
  List<Step> steps=javaLibrary.buildInternal(context);
  Step step=Iterables.find(steps,new Predicate<Step>(){
    @Override public boolean apply(    Step command){
      return command instanceof JavacInMemoryStep;
    }
  }
);
  assertNotNull("Expected a JavacInMemoryCommand in the command list.",step);
  JavacInMemoryStep javac=(JavacInMemoryStep)step;
  assertEquals("Should compile Main.java rather than generated R.java.",ImmutableSet.of(src),javac.getSrcs());
}
