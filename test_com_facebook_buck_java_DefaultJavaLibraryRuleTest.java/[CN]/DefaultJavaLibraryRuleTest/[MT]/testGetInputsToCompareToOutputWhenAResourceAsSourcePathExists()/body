{
  AbstractBuildRuleBuilderParams params=new FakeAbstractBuildRuleBuilderParams();
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  BuildTarget genruleBuildTarget=BuildTargetFactory.newInstance("//generated:stuff");
  Genrule.newGenruleBuilder(params).setBuildTarget(genruleBuildTarget).setCmd("echo 'aha' > $OUT").setOut("stuff.txt").build(ruleResolver);
  DefaultJavaLibraryRule javaRule=DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(params).setBuildTarget(BuildTargetFactory.newInstance("//library:code")).addResource(new BuildTargetSourcePath(genruleBuildTarget)).build(ruleResolver);
  assertEquals(ImmutableList.of(BuckConstant.GEN_DIR + "/generated/stuff.txt"),javaRule.getInputsToCompareToOutput());
}
