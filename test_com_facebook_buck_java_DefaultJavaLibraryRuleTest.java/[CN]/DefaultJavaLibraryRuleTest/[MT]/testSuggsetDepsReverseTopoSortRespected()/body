{
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  ProjectFilesystem projectFilesystem=new ProjectFilesystem(tmp.getRoot());
  BuildTarget libraryOneTarget=BuildTargetFactory.newInstance("//:libone");
  DefaultJavaLibraryRule libraryOne=ruleResolver.buildAndAddToIndex(DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(new FakeBuildRuleBuilderParams()).setBuildTarget(libraryOneTarget).addSrc(Paths.get("java/src/com/libone/Bar.java")).addVisibilityPattern(BuildTargetPattern.MATCH_ALL));
  BuildTarget libraryTwoTarget=BuildTargetFactory.newInstance("//:libtwo");
  DefaultJavaLibraryRule libraryTwo=ruleResolver.buildAndAddToIndex(DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(new FakeBuildRuleBuilderParams()).setBuildTarget(libraryTwoTarget).addSrc(Paths.get("java/src/com/libtwo/Foo.java")).addDep(BuildTargetFactory.newInstance("//:libone")));
  BuildTarget parentTarget=BuildTargetFactory.newInstance("//:parent");
  DefaultJavaLibraryRule parent=ruleResolver.buildAndAddToIndex(DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(new FakeBuildRuleBuilderParams()).setBuildTarget(parentTarget).addSrc(Paths.get("java/src/com/parent/Meh.java")).addDep(BuildTargetFactory.newInstance("//:libtwo")).addVisibilityPattern(BuildTargetPattern.MATCH_ALL));
  BuildTarget grandparentTarget=BuildTargetFactory.newInstance("//:grandparent");
  DefaultJavaLibraryRule grandparent=ruleResolver.buildAndAddToIndex(DefaultJavaLibraryRule.newJavaLibraryRuleBuilder(new FakeBuildRuleBuilderParams()).setBuildTarget(grandparentTarget).addSrc(Paths.get("java/src/com/parent/OldManRiver.java")).addDep(BuildTargetFactory.newInstance("//:parent")));
  BuildContext context=createSuggestContext(ruleResolver,BuildDependencies.WARN_ON_TRANSITIVE);
  ImmutableSetMultimap<JavaLibrary,String> transitive=parent.getTransitiveClasspathEntries();
  ImmutableMap<String,String> classToSymbols=ImmutableMap.of(Iterables.getFirst(transitive.get(parent),null),"com.facebook.Foo",Iterables.getFirst(transitive.get(libraryOne),null),"com.facebook.Bar",Iterables.getFirst(transitive.get(libraryTwo),null),"com.facebook.Foo");
  Optional<JavacInMemoryStep.SuggestBuildRules> suggestFn=grandparent.createSuggestBuildFunction(context,transitive,ImmutableSetMultimap.<JavaLibrary,String>of(),createJarResolver(classToSymbols));
  assertTrue(suggestFn.isPresent());
  assertEquals(ImmutableSet.of("//:parent","//:libone"),suggestFn.get().suggest(projectFilesystem,ImmutableSet.of("com.facebook.Foo","com.facebook.Bar")));
  EasyMock.verify(context);
}
