{
  Optional<String> masterRevisionId=getMasterRevisionId();
  Optional<String> diffBase=masterRevisionId;
  String currentRevisionId=vcCmdLineInterface.currentRevisionId();
  Optional<ImmutableSet<String>> filesChangedFromMasterBranchPoint=Optional.absent();
  Optional<ImmutableSet<String>> diffBaseBookmarks=Optional.absent();
  Optional<String> producedDiff=Optional.absent();
  if (masterRevisionId.isPresent()) {
    diffBase=getCommonAncestorRevisionId(currentRevisionId,masterRevisionId.get());
    if (diffBase.isPresent()) {
      filesChangedFromMasterBranchPoint=Optional.of(vcCmdLineInterface.changedFiles(diffBase.get()));
      diffBaseBookmarks=Optional.of(getBasedOffWhichTrackedBookmark(diffBase.get()));
      producedDiff=Optional.of(vcCmdLineInterface.diffBetweenRevisions(currentRevisionId,diffBase.get()));
    }
  }
  return SourceControlInfo.builder().setCurrentRevisionId(currentRevisionId).setBasedOffWhichTracked(diffBaseBookmarks).setRevisionIdOffTracked(diffBase).setDiff(producedDiff).setDirtyFiles(vcCmdLineInterface.changedFiles(".")).setFilesChangedFromMasterBranchPoint(filesChangedFromMasterBranchPoint).build();
}
