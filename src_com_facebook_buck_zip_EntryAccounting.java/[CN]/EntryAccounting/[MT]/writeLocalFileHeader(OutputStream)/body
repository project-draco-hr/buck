{
  try (ByteArrayOutputStream stream=new ByteArrayOutputStream()){
    ByteIo.writeInt(stream,ZipEntry.LOCSIG);
    ByteIo.writeShort(stream,getRequiredExtractVersion());
    ByteIo.writeShort(stream,flags);
    ByteIo.writeShort(stream,getCompressionMethod());
    ByteIo.writeInt(stream,getTime());
    if (isDeflated()) {
      ByteIo.writeInt(stream,0);
      ByteIo.writeInt(stream,0);
      ByteIo.writeInt(stream,0);
    }
 else {
      ByteIo.writeInt(stream,entry.getCrc());
      ByteIo.writeInt(stream,entry.getSize());
      ByteIo.writeInt(stream,entry.getSize());
    }
    byte[] nameBytes=entry.getName().getBytes(Charsets.UTF_8);
    ByteIo.writeShort(stream,nameBytes.length);
    ByteIo.writeShort(stream,0);
    stream.write(nameBytes);
    byte[] bytes=stream.toByteArray();
    out.write(bytes);
    return bytes.length;
  }
 }
