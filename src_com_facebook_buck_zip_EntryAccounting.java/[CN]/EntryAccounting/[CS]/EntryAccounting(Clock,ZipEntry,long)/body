{
  this.entry=Preconditions.checkNotNull(entry);
  this.method=Method.detect(entry.getMethod());
  Preconditions.checkNotNull(clock);
  this.offset=currentOffset;
  if (entry.getTime() == -1) {
    entry.setTime(clock.currentTimeMillis());
  }
  if (method == Method.DEFLATE) {
    flags|=DATA_DESCRIPTOR_FLAG;
  }
  if (entry instanceof CustomZipEntry) {
    deflater.setLevel(((CustomZipEntry)entry).getCompressionLevel());
  }
}
