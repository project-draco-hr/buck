{
  BuildRuleResolver buildRuleResolver=new BuildRuleResolver();
  SourcePathResolver sourcePathResolver=new SourcePathResolver(buildRuleResolver);
  BuildTarget target=BuildTargetFactory.newInstance("//:target");
  BuildRuleParams params=BuildRuleParamsFactory.createTrivialBuildRuleParams(target);
  ProjectFilesystem filesystem=new AllExistingProjectFilesystem();
  Joiner space=Joiner.on(" ");
  ImmutableList<String> explicitCompilerFlags=ImmutableList.of("-explicit-compilerflag");
  SourcePath as=new TestSourcePath("as");
  ImmutableList<String> asflags=ImmutableList.of("-asflag","-asflag");
  SourcePath cc=new TestSourcePath("cc");
  ImmutableList<String> cflags=ImmutableList.of("-cflag","-cflag");
  SourcePath cxx=new TestSourcePath("cxx");
  ImmutableList<String> cxxflags=ImmutableList.of("-cxxflag","-cxxflag");
  FakeBuckConfig buckConfig=new FakeBuckConfig(ImmutableMap.<String,Map<String,String>>of("cxx",ImmutableMap.<String,String>builder().put("as",sourcePathResolver.getPath(as).toString()).put("asflags",space.join(asflags)).put("cc",sourcePathResolver.getPath(cc).toString()).put("cflags",space.join(cflags)).put("cxx",sourcePathResolver.getPath(cxx).toString()).put("cxxflags",space.join(cxxflags)).build()),filesystem);
  CxxPlatform platform=DefaultCxxPlatforms.build(new CxxBuckConfig(buckConfig));
  CxxSourceRuleFactory cxxSourceRuleFactory=new CxxSourceRuleFactory(params,buildRuleResolver,sourcePathResolver,platform,CxxPreprocessorInput.EMPTY,explicitCompilerFlags);
  String cSourceName="test.i";
  List<String> cSourcePerFileFlags=ImmutableList.of("-c-source-par-file-flag");
  CxxSource cSource=ImmutableCxxSource.of(CxxSource.Type.C_CPP_OUTPUT,new TestSourcePath(cSourceName),cSourcePerFileFlags);
  CxxPreprocessAndCompile cCompile=cxxSourceRuleFactory.createCompileBuildRule(cSourceName,cSource,CxxSourceRuleFactory.PicType.PDC);
  assertContains(cCompile.getFlags(),explicitCompilerFlags);
  assertContains(cCompile.getFlags(),cflags);
  assertContains(cCompile.getFlags(),asflags);
  assertContains(cCompile.getFlags(),cSourcePerFileFlags);
  cSourceName="test.c";
  cSource=ImmutableCxxSource.of(CxxSource.Type.C,new TestSourcePath(cSourceName),cSourcePerFileFlags);
  CxxPreprocessAndCompile cPreprocessAndCompile=cxxSourceRuleFactory.createPreprocessAndCompileBuildRule(cSourceName,cSource,CxxSourceRuleFactory.PicType.PDC);
  assertContains(cPreprocessAndCompile.getFlags(),explicitCompilerFlags);
  assertContains(cPreprocessAndCompile.getFlags(),cflags);
  assertContains(cPreprocessAndCompile.getFlags(),asflags);
  assertContains(cPreprocessAndCompile.getFlags(),cSourcePerFileFlags);
  String cxxSourceName="test.ii";
  List<String> cxxSourcePerFileFlags=ImmutableList.of("-cxx-source-par-file-flag");
  CxxSource cxxSource=ImmutableCxxSource.of(CxxSource.Type.CXX_CPP_OUTPUT,new TestSourcePath(cxxSourceName),cxxSourcePerFileFlags);
  CxxPreprocessAndCompile cxxCompile=cxxSourceRuleFactory.createCompileBuildRule(cxxSourceName,cxxSource,CxxSourceRuleFactory.PicType.PDC);
  assertContains(cxxCompile.getFlags(),explicitCompilerFlags);
  assertContains(cxxCompile.getFlags(),cxxflags);
  assertContains(cxxCompile.getFlags(),asflags);
  assertContains(cxxCompile.getFlags(),cxxSourcePerFileFlags);
  cxxSourceName="test.cpp";
  cxxSource=ImmutableCxxSource.of(CxxSource.Type.CXX,new TestSourcePath(cxxSourceName),cxxSourcePerFileFlags);
  CxxPreprocessAndCompile cxxPreprocessAndCompile=cxxSourceRuleFactory.createPreprocessAndCompileBuildRule(cxxSourceName,cxxSource,CxxSourceRuleFactory.PicType.PDC);
  assertContains(cxxPreprocessAndCompile.getFlags(),explicitCompilerFlags);
  assertContains(cxxPreprocessAndCompile.getFlags(),cxxflags);
  assertContains(cxxPreprocessAndCompile.getFlags(),asflags);
  assertContains(cxxPreprocessAndCompile.getFlags(),cxxSourcePerFileFlags);
  String cCppOutputSourceName="test.i";
  List<String> cCppOutputSourcePerFileFlags=ImmutableList.of("-c-cpp-output-source-par-file-flag");
  CxxSource cCppOutputSource=ImmutableCxxSource.of(CxxSource.Type.C_CPP_OUTPUT,new TestSourcePath(cCppOutputSourceName),cCppOutputSourcePerFileFlags);
  CxxPreprocessAndCompile cCppOutputCompile=cxxSourceRuleFactory.createCompileBuildRule(cCppOutputSourceName,cCppOutputSource,CxxSourceRuleFactory.PicType.PDC);
  assertContains(cCppOutputCompile.getFlags(),explicitCompilerFlags);
  assertContains(cCppOutputCompile.getFlags(),cflags);
  assertContains(cCppOutputCompile.getFlags(),asflags);
  assertContains(cCppOutputCompile.getFlags(),cCppOutputSourcePerFileFlags);
  cCppOutputSourceName="test.c";
  cCppOutputSource=ImmutableCxxSource.of(CxxSource.Type.C,new TestSourcePath(cCppOutputSourceName),cCppOutputSourcePerFileFlags);
  CxxPreprocessAndCompile cCppOutputPreprocessAndCompile=cxxSourceRuleFactory.createPreprocessAndCompileBuildRule(cCppOutputSourceName,cCppOutputSource,CxxSourceRuleFactory.PicType.PDC);
  assertContains(cCppOutputPreprocessAndCompile.getFlags(),explicitCompilerFlags);
  assertContains(cCppOutputPreprocessAndCompile.getFlags(),cflags);
  assertContains(cCppOutputPreprocessAndCompile.getFlags(),asflags);
  assertContains(cCppOutputPreprocessAndCompile.getFlags(),cCppOutputSourcePerFileFlags);
  String assemblerSourceName="test.s";
  List<String> assemblerSourcePerFileFlags=ImmutableList.of("-assember-source-par-file-flag");
  CxxSource assemblerSource=ImmutableCxxSource.of(CxxSource.Type.ASSEMBLER,new TestSourcePath(assemblerSourceName),assemblerSourcePerFileFlags);
  CxxPreprocessAndCompile assemblerCompile=cxxSourceRuleFactory.createCompileBuildRule(assemblerSourceName,assemblerSource,CxxSourceRuleFactory.PicType.PDC);
  assertContains(assemblerCompile.getFlags(),asflags);
  assertContains(assemblerCompile.getFlags(),assemblerSourcePerFileFlags);
  assemblerSourceName="test.S";
  assemblerSource=ImmutableCxxSource.of(CxxSource.Type.ASSEMBLER_WITH_CPP,new TestSourcePath(assemblerSourceName),assemblerSourcePerFileFlags);
  CxxPreprocessAndCompile assemblerPreprocessAndCompile=cxxSourceRuleFactory.createPreprocessAndCompileBuildRule(assemblerSourceName,assemblerSource,CxxSourceRuleFactory.PicType.PDC);
  assertContains(assemblerPreprocessAndCompile.getFlags(),asflags);
  assertContains(assemblerPreprocessAndCompile.getFlags(),assemblerSourcePerFileFlags);
}
