{
  BuildRuleResolver buildRuleResolver=new BuildRuleResolver();
  SourcePathResolver sourcePathResolver=new SourcePathResolver(buildRuleResolver);
  BuildTarget target=BuildTargetFactory.newInstance("//:target");
  BuildRuleParams params=BuildRuleParamsFactory.createTrivialBuildRuleParams(target);
  ProjectFilesystem filesystem=new AllExistingProjectFilesystem();
  Joiner space=Joiner.on(" ");
  ImmutableList<String> explicitCompilerFlags=ImmutableList.of("-explicit-compilerflag");
  SourcePath as=new TestSourcePath("as");
  ImmutableList<String> asflags=ImmutableList.of("-asflag","-asflag");
  SourcePath cc=new TestSourcePath("cc");
  ImmutableList<String> cflags=ImmutableList.of("-cflag","-cflag");
  SourcePath cxx=new TestSourcePath("cxx");
  ImmutableList<String> cxxflags=ImmutableList.of("-cxxflag","-cxxflag");
  FakeBuckConfig buckConfig=new FakeBuckConfig(ImmutableMap.of("cxx",ImmutableMap.<String,String>builder().put("as",sourcePathResolver.getPath(as).toString()).put("asflags",space.join(asflags)).put("cc",sourcePathResolver.getPath(cc).toString()).put("cflags",space.join(cflags)).put("cxx",sourcePathResolver.getPath(cxx).toString()).put("cxxflags",space.join(cxxflags)).build()),filesystem);
  CxxPlatform platform=DefaultCxxPlatforms.build(new CxxBuckConfig(buckConfig));
  CxxSourceRuleFactory cxxSourceRuleFactory=new CxxSourceRuleFactory(params,buildRuleResolver,sourcePathResolver,platform,ImmutableList.<CxxPreprocessorInput>of(),explicitCompilerFlags);
  String cSourceName="test.i";
  List<String> cSourcePerFileFlags=ImmutableList.of("-c-source-par-file-flag");
  CxxSource cSource=CxxSource.of(CxxSource.Type.C_CPP_OUTPUT,new TestSourcePath(cSourceName),cSourcePerFileFlags);
  CxxPreprocessAndCompile cCompile=cxxSourceRuleFactory.requireCompileBuildRule(buildRuleResolver,cSourceName,cSource,CxxSourceRuleFactory.PicType.PDC);
  assertContains(cCompile.getCompilerFlags().get(),explicitCompilerFlags);
  assertContains(cCompile.getCompilerFlags().get(),cflags);
  assertContains(cCompile.getCompilerFlags().get(),asflags);
  assertContains(cCompile.getCompilerFlags().get(),cSourcePerFileFlags);
  cSourceName="test.c";
  cSource=CxxSource.of(CxxSource.Type.C,new TestSourcePath(cSourceName),cSourcePerFileFlags);
  CxxPreprocessAndCompile cPreprocessAndCompile=cxxSourceRuleFactory.requirePreprocessAndCompileBuildRule(buildRuleResolver,cSourceName,cSource,CxxSourceRuleFactory.PicType.PDC,CxxPreprocessMode.SEPARATE);
  assertContains(cPreprocessAndCompile.getCompilerFlags().get(),explicitCompilerFlags);
  assertContains(cPreprocessAndCompile.getCompilerFlags().get(),cflags);
  assertContains(cPreprocessAndCompile.getCompilerFlags().get(),asflags);
  assertContains(cPreprocessAndCompile.getCompilerFlags().get(),cSourcePerFileFlags);
  String cxxSourceName="test.ii";
  List<String> cxxSourcePerFileFlags=ImmutableList.of("-cxx-source-par-file-flag");
  CxxSource cxxSource=CxxSource.of(CxxSource.Type.CXX_CPP_OUTPUT,new TestSourcePath(cxxSourceName),cxxSourcePerFileFlags);
  CxxPreprocessAndCompile cxxCompile=cxxSourceRuleFactory.requireCompileBuildRule(buildRuleResolver,cxxSourceName,cxxSource,CxxSourceRuleFactory.PicType.PDC);
  assertContains(cxxCompile.getCompilerFlags().get(),explicitCompilerFlags);
  assertContains(cxxCompile.getCompilerFlags().get(),cxxflags);
  assertContains(cxxCompile.getCompilerFlags().get(),asflags);
  assertContains(cxxCompile.getCompilerFlags().get(),cxxSourcePerFileFlags);
  cxxSourceName="test.cpp";
  cxxSource=CxxSource.of(CxxSource.Type.CXX,new TestSourcePath(cxxSourceName),cxxSourcePerFileFlags);
  CxxPreprocessAndCompile cxxPreprocessAndCompile=cxxSourceRuleFactory.requirePreprocessAndCompileBuildRule(buildRuleResolver,cxxSourceName,cxxSource,CxxSourceRuleFactory.PicType.PDC,CxxPreprocessMode.SEPARATE);
  assertContains(cxxPreprocessAndCompile.getCompilerFlags().get(),explicitCompilerFlags);
  assertContains(cxxPreprocessAndCompile.getCompilerFlags().get(),cxxflags);
  assertContains(cxxPreprocessAndCompile.getCompilerFlags().get(),asflags);
  assertContains(cxxPreprocessAndCompile.getCompilerFlags().get(),cxxSourcePerFileFlags);
  String cCppOutputSourceName="test2.i";
  List<String> cCppOutputSourcePerFileFlags=ImmutableList.of("-c-cpp-output-source-par-file-flag");
  CxxSource cCppOutputSource=CxxSource.of(CxxSource.Type.C_CPP_OUTPUT,new TestSourcePath(cCppOutputSourceName),cCppOutputSourcePerFileFlags);
  CxxPreprocessAndCompile cCppOutputCompile=cxxSourceRuleFactory.requireCompileBuildRule(buildRuleResolver,cCppOutputSourceName,cCppOutputSource,CxxSourceRuleFactory.PicType.PDC);
  assertContains(cCppOutputCompile.getCompilerFlags().get(),explicitCompilerFlags);
  assertContains(cCppOutputCompile.getCompilerFlags().get(),cflags);
  assertContains(cCppOutputCompile.getCompilerFlags().get(),asflags);
  assertContains(cCppOutputCompile.getCompilerFlags().get(),cCppOutputSourcePerFileFlags);
  cCppOutputSourceName="test2.c";
  cCppOutputSource=CxxSource.of(CxxSource.Type.C,new TestSourcePath(cCppOutputSourceName),cCppOutputSourcePerFileFlags);
  CxxPreprocessAndCompile cCppOutputPreprocessAndCompile=cxxSourceRuleFactory.requirePreprocessAndCompileBuildRule(buildRuleResolver,cCppOutputSourceName,cCppOutputSource,CxxSourceRuleFactory.PicType.PDC,CxxPreprocessMode.SEPARATE);
  assertContains(cCppOutputPreprocessAndCompile.getCompilerFlags().get(),explicitCompilerFlags);
  assertContains(cCppOutputPreprocessAndCompile.getCompilerFlags().get(),cflags);
  assertContains(cCppOutputPreprocessAndCompile.getCompilerFlags().get(),asflags);
  assertContains(cCppOutputPreprocessAndCompile.getCompilerFlags().get(),cCppOutputSourcePerFileFlags);
  String assemblerSourceName="test.s";
  List<String> assemblerSourcePerFileFlags=ImmutableList.of("-assember-source-par-file-flag");
  CxxSource assemblerSource=CxxSource.of(CxxSource.Type.ASSEMBLER,new TestSourcePath(assemblerSourceName),assemblerSourcePerFileFlags);
  CxxPreprocessAndCompile assemblerCompile=cxxSourceRuleFactory.requireCompileBuildRule(buildRuleResolver,assemblerSourceName,assemblerSource,CxxSourceRuleFactory.PicType.PDC);
  assertContains(assemblerCompile.getCompilerFlags().get(),asflags);
  assertContains(assemblerCompile.getCompilerFlags().get(),assemblerSourcePerFileFlags);
  assemblerSourceName="test.S";
  assemblerSource=CxxSource.of(CxxSource.Type.ASSEMBLER_WITH_CPP,new TestSourcePath(assemblerSourceName),assemblerSourcePerFileFlags);
  CxxPreprocessAndCompile assemblerPreprocessAndCompile=cxxSourceRuleFactory.requirePreprocessAndCompileBuildRule(buildRuleResolver,assemblerSourceName,assemblerSource,CxxSourceRuleFactory.PicType.PDC,CxxPreprocessMode.SEPARATE);
  assertContains(assemblerPreprocessAndCompile.getCompilerFlags().get(),asflags);
  assertContains(assemblerPreprocessAndCompile.getCompilerFlags().get(),assemblerSourcePerFileFlags);
}
