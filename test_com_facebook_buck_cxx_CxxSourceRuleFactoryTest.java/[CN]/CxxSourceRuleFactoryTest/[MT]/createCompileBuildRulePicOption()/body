{
  BuildTarget target=BuildTargetFactory.newInstance("//foo:bar");
  BuildRuleParams params=BuildRuleParamsFactory.createTrivialBuildRuleParams(target);
  BuildRuleResolver resolver=new BuildRuleResolver();
  String name="foo/bar.ii";
  CxxSource cxxSource=ImmutableCxxSource.of(CxxSource.Type.CXX_CPP_OUTPUT,new TestSourcePath(name),ImmutableList.<String>of());
  CxxCompile noPic=CxxSourceRuleFactory.createCompileBuildRule(params,resolver,CXX_PLATFORM,ImmutableList.<String>of(),false,name,cxxSource);
  assertFalse(noPic.getFlags().contains("-fPIC"));
  assertEquals(CxxSourceRuleFactory.createCompileBuildTarget(target,CXX_PLATFORM.getFlavor(),name,false),noPic.getBuildTarget());
  CxxCompile pic=CxxSourceRuleFactory.createCompileBuildRule(params,resolver,CXX_PLATFORM,ImmutableList.<String>of(),true,name,cxxSource);
  assertTrue(pic.getFlags().contains("-fPIC"));
  assertEquals(CxxSourceRuleFactory.createCompileBuildTarget(target,CXX_PLATFORM.getFlavor(),name,true),pic.getBuildTarget());
}
