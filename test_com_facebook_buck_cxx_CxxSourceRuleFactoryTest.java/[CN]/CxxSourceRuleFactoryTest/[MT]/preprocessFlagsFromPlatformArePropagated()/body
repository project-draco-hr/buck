{
  BuildTarget target=BuildTargetFactory.newInstance("//foo:bar");
  BuildRuleParams params=BuildRuleParamsFactory.createTrivialBuildRuleParams(target);
  BuildRuleResolver resolver=new BuildRuleResolver();
  SourcePathResolver pathResolver=new SourcePathResolver(resolver);
  ImmutableList<String> platformFlags=ImmutableList.of("-some","-flags");
  CxxPlatform platform=DefaultCxxPlatforms.build(new CxxBuckConfig(new FakeBuckConfig(ImmutableMap.of("cxx",ImmutableMap.of("cxxppflags",Joiner.on(" ").join(platformFlags))))));
  CxxPreprocessorInput cxxPreprocessorInput=CxxPreprocessorInput.EMPTY;
  CxxSourceRuleFactory cxxSourceRuleFactory=new CxxSourceRuleFactory(params,resolver,pathResolver,platform,cxxPreprocessorInput,ImmutableList.<String>of());
  String name="source.cpp";
  CxxSource cxxSource=CxxSource.of(CxxSource.Type.CXX,new TestSourcePath(name),ImmutableList.<String>of());
  CxxPreprocessAndCompile cxxPreprocess=cxxSourceRuleFactory.requirePreprocessBuildRule(resolver,name,cxxSource,CxxSourceRuleFactory.PicType.PDC);
  assertNotEquals(-1,Collections.indexOfSubList(cxxPreprocess.getPreprocessorFlags().get(),platformFlags));
  CxxPreprocessAndCompile cxxPreprocessAndCompile=cxxSourceRuleFactory.requirePreprocessAndCompileBuildRule(resolver,name,cxxSource,CxxSourceRuleFactory.PicType.PDC,CxxPreprocessMode.SEPARATE);
  assertNotEquals(-1,Collections.indexOfSubList(cxxPreprocessAndCompile.getPreprocessorFlags().get(),platformFlags));
}
