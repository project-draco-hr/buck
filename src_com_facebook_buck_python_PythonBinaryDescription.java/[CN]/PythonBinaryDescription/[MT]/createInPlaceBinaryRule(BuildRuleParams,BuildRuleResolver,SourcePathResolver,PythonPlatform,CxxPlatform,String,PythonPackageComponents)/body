{
  if (cxxPlatform.getLd() instanceof WindowsLinker) {
    throw new HumanReadableException("%s: cannot build in-place python binaries for Windows (%s)",params.getBuildTarget(),cxxPlatform.getFlavor());
  }
  BuildTarget emptyInitTarget=BuildTarget.builder(params.getBuildTarget()).addFlavors(ImmutableFlavor.of("__init__")).build();
  Path emptyInitPath=BuildTargets.getGenPath(params.getBuildTarget(),"%s/__init__.py");
  resolver.addToIndex(new WriteFile(params.copyWithChanges(emptyInitTarget,Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>of()),Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>of())),pathResolver,"",emptyInitPath,false));
  components=addMissingInitModules(components,new BuildTargetSourcePath(emptyInitTarget));
  BuildTarget linkTreeTarget=BuildTarget.builder(params.getBuildTarget()).addFlavors(ImmutableFlavor.of("link-tree")).build();
  Path linkTreeRoot=params.getProjectFilesystem().resolve(BuildTargets.getGenPath(linkTreeTarget,"%s"));
  SymlinkTree linkTree;
  try {
    linkTree=resolver.addToIndex(new SymlinkTree(params.copyWithChanges(linkTreeTarget,Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>of()),Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>of())),pathResolver,linkTreeRoot,ImmutableMap.<Path,SourcePath>builder().putAll(components.getModules()).putAll(components.getResources()).putAll(components.getNativeLibraries()).build()));
  }
 catch (  SymlinkTree.InvalidSymlinkTreeException e) {
    throw e.getHumanReadableExceptionForBuildTarget(params.getBuildTarget().getUnflavoredBuildTarget());
  }
  return new PythonInPlaceBinary(params,pathResolver,pythonPlatform,cxxPlatform,linkTree,mainModule,components,pythonPlatform.getEnvironment(),pythonBuckConfig.getPexExtension());
}
