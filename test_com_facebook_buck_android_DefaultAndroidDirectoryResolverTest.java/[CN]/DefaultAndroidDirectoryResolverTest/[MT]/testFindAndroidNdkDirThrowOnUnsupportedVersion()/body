{
  Path ndkDir=createTmpNdkVersions("ndk-dir","r9q")[0];
  PropertyFinder propertyFinder=new FakePropertyFinder(ImmutableMap.of("ndk.dir",Optional.of(ndkDir),"ndk.repository",Optional.<Path>absent()));
  DefaultAndroidDirectoryResolver androidDirectoryResolver=new DefaultAndroidDirectoryResolver(new ProjectFilesystem(tmpDir.getRoot()),Optional.<String>absent(),Optional.of("r9e"),propertyFinder);
  try {
    androidDirectoryResolver.findAndroidNdkDir();
    fail("Should have thrown an exception for malformed NDK directory.");
  }
 catch (  Exception e) {
    assertEquals("Supported NDK version is r9e but Buck is configured to use r9q with ndk.dir " + "or ANDROID_NDK",e.getMessage());
  }
}
