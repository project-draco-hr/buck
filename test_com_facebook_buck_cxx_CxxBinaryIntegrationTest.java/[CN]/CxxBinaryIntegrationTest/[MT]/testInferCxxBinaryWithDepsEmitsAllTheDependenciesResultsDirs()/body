{
  assumeTrue(Platform.detect() != Platform.WINDOWS);
  ProjectWorkspace workspace=InferHelper.setupCxxInferWorkspace(this,tmp,Optional.<String>absent());
  BuildTarget inputBuildTarget=BuildTargetFactory.newInstance("//foo:binary_with_chain_deps");
  String inputBuildTargetName=inputBuildTarget.withFlavors(CxxInferEnhancer.InferFlavors.INFER.get()).getFullyQualifiedName();
  workspace.runBuckCommand("build",inputBuildTargetName).assertSuccess();
  assertTrue(workspace.getPath("buck-out/gen/foo/infer-binary_with_chain_deps#infer/infer-deps.txt").toFile().exists());
  String loggedDeps=workspace.getFileContents("buck-out/gen/foo/infer-binary_with_chain_deps#infer/infer-deps.txt");
  String sanitizedChainDepOne=sanitize("chain_dep_one.c.o");
  String sanitizedTopChain=sanitize("top_chain.c.o");
  String sanitizedChainDepTwo=sanitize("chain_dep_two.c.o");
  String expectedOutput="//foo:binary_with_chain_deps#infer-analyze\t" + "[infer-analyze]\t" + "buck-out/gen/foo/infer-analysis-binary_with_chain_deps#infer-analyze\n"+ "//foo:binary_with_chain_deps#default,infer-capture-" + sanitizedTopChain + "\t"+ "[default, infer-capture-"+ sanitizedTopChain+ "]\t"+ "buck-out/gen/foo/infer-out-binary_with_chain_deps#default,infer-capture-"+ sanitizedTopChain+ "\n"+ "//foo:chain_dep_one#default,infer-analyze\t"+ "[default, infer-analyze]\t"+ "buck-out/gen/foo/infer-analysis-chain_dep_one#default,infer-analyze\n"+ "//foo:chain_dep_one#default,infer-capture-"+ sanitizedChainDepOne+ "\t"+ "[default, infer-capture-"+ sanitizedChainDepOne+ "]\t"+ "buck-out/gen/foo/infer-out-chain_dep_one#default,infer-capture-"+ sanitizedChainDepOne+ "\n"+ "//foo:chain_dep_two#default,infer-analyze\t"+ "[default, infer-analyze]\t"+ "buck-out/gen/foo/infer-analysis-chain_dep_two#default,infer-analyze\n"+ "//foo:chain_dep_two#default,infer-capture-"+ sanitizedChainDepTwo+ "\t"+ "[default, infer-capture-"+ sanitizedChainDepTwo+ "]\t"+ "buck-out/gen/foo/infer-out-chain_dep_two#default,infer-capture-"+ sanitizedChainDepTwo+ "\n";
  assertEquals(expectedOutput,loggedDeps);
}
