{
  return new RuleKey.Builder(pathResolver,hashCache,appendableRuleKeyCache){
    @Override protected RuleKey.Builder setSourcePath(    SourcePath sourcePath){
      Optional<BuildRule> provider=pathResolver.getRule(sourcePath);
      Preconditions.checkState(!provider.isPresent() || rule.getDeps().contains(provider.get()));
      return setSingleValue(pathResolver.getPath(sourcePath));
    }
    @Override protected RuleKey.Builder setBuildRule(    BuildRule rule){
      throw new IllegalStateException("Input-based rule key builders cannot process build rules");
    }
  }
;
}
