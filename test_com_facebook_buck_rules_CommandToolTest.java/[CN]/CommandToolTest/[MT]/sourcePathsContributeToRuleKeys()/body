{
  BuildRuleResolver resolver=new BuildRuleResolver();
  SourcePathResolver pathResolver=new SourcePathResolver(resolver);
  SourcePath path=new FakeSourcePath("input");
  CommandTool tool=new CommandTool.Builder().addArg("exec %s",path).build();
  FileHashCache hashCache=FakeFileHashCache.createFromStrings(ImmutableMap.of("input",Strings.repeat("a",40)));
  RuleKeyBuilderFactory ruleKeyBuilderFactory=new DefaultRuleKeyBuilderFactory(hashCache,pathResolver);
  RuleKey ruleKey=new RuleKeyBuilder(pathResolver,hashCache,ruleKeyBuilderFactory).setReflectively("key",tool).build();
  hashCache=FakeFileHashCache.createFromStrings(ImmutableMap.of("input",Strings.repeat("b",40)));
  ruleKeyBuilderFactory=new DefaultRuleKeyBuilderFactory(hashCache,pathResolver);
  RuleKey changedRuleKey=new RuleKeyBuilder(pathResolver,hashCache,ruleKeyBuilderFactory).setReflectively("key",tool).build();
  assertThat(ruleKey,Matchers.not(Matchers.equalTo(changedRuleKey)));
}
