{
  TestCellBuilder repoBuilder=new TestCellBuilder().setBuildFileParserFactory(buildFileParserFactory).setBuckConfig(buckConfig).setFilesystem(filesystem);
  Cell toUse=repoBuilder.build();
  Parser parser=new Parser(toUse,buildFileTreeSupplier,false,allowSymlinks);
  try {
    parser.parseRawRulesInternal(filesystem.getRootPath(),rules);
  }
 catch (  BuildTargetException|IOException e) {
    throw new RuntimeException(e);
  }
  return parser;
}
