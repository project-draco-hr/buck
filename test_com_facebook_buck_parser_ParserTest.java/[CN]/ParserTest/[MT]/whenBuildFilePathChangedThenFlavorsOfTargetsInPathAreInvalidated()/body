{
  Parser parser=createParser(emptyBuildTargets());
  tempDir.newFolder("foo");
  tempDir.newFolder("bar");
  File testFooBuckFile=tempDir.newFile("foo/BUCK");
  Files.write("java_library(name = 'foo', visibility=['PUBLIC'])\n",testFooBuckFile,Charsets.UTF_8);
  File testBarBuckFile=tempDir.newFile("bar/BUCK");
  Files.write("java_library(name = 'bar',\n" + "  deps = ['//foo:foo'])\n",testBarBuckFile,Charsets.UTF_8);
  BuildTarget barTarget=BuildTarget.builder("//bar","bar").addFlavors(ImmutableFlavor.of("src")).build();
  Iterable<BuildTarget> buildTargets=ImmutableList.of(barTarget);
  BuckConfig config=new FakeBuckConfig();
  parser.buildTargetGraphForBuildTargets(buildTargets,new ParserConfig(config),BuckEventBusFactory.newInstance(),new TestConsole(),config.getEnvironment(),false);
  testFooBuckFile.delete();
  Files.write("java_library(name = 'bar')\n",testBarBuckFile,Charsets.UTF_8);
  WatchEvent<Path> deleteEvent=createPathEvent(Paths.get("foo").resolve("BUCK"),StandardWatchEventKinds.ENTRY_DELETE);
  parser.onFileSystemChange(deleteEvent);
  WatchEvent<Path> modifyEvent=createPathEvent(Paths.get("bar").resolve("BUCK"),StandardWatchEventKinds.ENTRY_MODIFY);
  parser.onFileSystemChange(modifyEvent);
  parser.buildTargetGraphForBuildTargets(buildTargets,new ParserConfig(config),BuckEventBusFactory.newInstance(),new TestConsole(),config.getEnvironment(),false);
}
