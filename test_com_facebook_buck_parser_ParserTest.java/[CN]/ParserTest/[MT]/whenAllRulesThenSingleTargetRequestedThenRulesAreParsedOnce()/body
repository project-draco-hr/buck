{
  TestProjectBuildFileParserFactory buildFileParserFactory=new TestProjectBuildFileParserFactory(filesystem);
  Parser parser=createParser(emptyBuildTargets(),buildFileParserFactory);
  parser.filterAllTargetsInProject(filesystem,Lists.<String>newArrayList(),alwaysTrue());
  BuildTarget foo=BuildTargetFactory.newInstance("//java/com/facebook","foo",testBuildFile);
  parser.parseBuildFilesForTargets(ImmutableList.of(foo),Lists.<String>newArrayList(),BuckEventBusFactory.newInstance());
  assertEquals("Should have cached build rules.",1,buildFileParserFactory.calls);
}
