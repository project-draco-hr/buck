{
  TestProjectBuildFileParserFactory buildFileParserFactory=new TestProjectBuildFileParserFactory(filesystem);
  Parser parser=createParser(emptyBuildTargets(),buildFileParserFactory);
  parser.filterAllTargetsInProject(filesystem,Lists.<String>newArrayList(),alwaysTrue());
  WatchEvent<Path> event=createMock(WatchEvent.class);
  expect(event.kind()).andReturn(StandardWatchEventKinds.ENTRY_MODIFY).anyTimes();
  expect(event.context()).andReturn(new File("./SomeClass.java").toPath());
  replay(event);
  parser.onFileSystemChange(event);
  parser.filterAllTargetsInProject(filesystem,Lists.<String>newArrayList(),alwaysTrue());
  verify(event);
  assertEquals("Should have cached build rules.",1,buildFileParserFactory.calls);
}
