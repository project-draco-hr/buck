{
  BuildTarget fooTarget=BuildTarget.builder("//java/com/facebook","foo").build();
  BuildTarget barTarget=BuildTarget.builder("//java/com/facebook","bar").build();
  Iterable<BuildTarget> buildTargets=ImmutableList.of(fooTarget,barTarget);
  FakeBuckEventListener listener=new FakeBuckEventListener();
  eventBus.register(listener);
  TargetGraph targetGraph=testParser.buildTargetGraphForBuildTargets(buildTargets,new ParserConfig(new FakeBuckConfig()),eventBus,new TestConsole(),ImmutableMap.<String,String>of(),false);
  ActionGraph actionGraph=buildActionGraph(eventBus,targetGraph);
  BuildRule fooRule=actionGraph.findBuildRuleByTarget(fooTarget);
  assertNotNull(fooRule);
  BuildRule barRule=actionGraph.findBuildRuleByTarget(barTarget);
  assertNotNull(barRule);
  ImmutableList<ParseEvent> expected=ImmutableList.of(TestEventConfigerator.configureTestEvent(ParseEvent.started(buildTargets),eventBus),TestEventConfigerator.configureTestEvent(ParseEvent.finished(buildTargets,Optional.of(targetGraph)),eventBus));
  Iterable<ParseEvent> events=Iterables.filter(listener.getEvents(),ParseEvent.class);
  assertEquals(expected,ImmutableList.copyOf(events));
}
