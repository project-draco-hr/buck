{
  final int exitCode=17;
  Step step=new FakeStep("cp","cp foo bar",exitCode);
  ExecutionContext context=TestExecutionContext.newInstance();
  StepFailedException exception=StepFailedException.createForFailingStepWithException(step,context,new IOException("Copy failed!"),Optional.<BuildTarget>absent());
  assertEquals(step,exception.getStep());
  assertEquals(1,exception.getExitCode());
  assertEquals("Failed on step cp with an exception:\nCopy failed!",exception.getMessage());
}
