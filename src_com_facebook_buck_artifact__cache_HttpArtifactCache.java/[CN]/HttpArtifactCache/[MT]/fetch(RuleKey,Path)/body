{
  Started startedEvent=HttpArtifactCacheEvent.newFetchStartedEvent();
  buckEventBus.post(startedEvent);
  Finished.Builder eventBuilder=HttpArtifactCacheEvent.newFinishedEventBuilder(startedEvent).setRuleKeys(Lists.newArrayList(ruleKey.toString()));
  try {
    CacheResult result=fetchImpl(ruleKey,output,eventBuilder);
    buckEventBus.post(eventBuilder.setFetchResult(result.toString()).build());
    return result;
  }
 catch (  IOException e) {
    String msg=String.format("%s: %s",e.getClass().getName(),e.getMessage());
    reportFailure(e,"fetch(%s, %s): %s",url,ruleKey,msg);
    CacheResult cacheResult=CacheResult.error(name,msg);
    buckEventBus.post(eventBuilder.setFetchResult(cacheResult.toString()).setErrorMessage(msg).build());
    return cacheResult;
  }
}
