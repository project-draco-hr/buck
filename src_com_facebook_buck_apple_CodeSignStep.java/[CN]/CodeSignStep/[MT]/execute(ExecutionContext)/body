{
  ProcessExecutorParams.Builder paramsBuilder=ProcessExecutorParams.builder();
  if (codesignAllocatePath.isPresent()) {
    ImmutableList<String> commandPrefix=codesignAllocatePath.get().getCommandPrefix(resolver);
    paramsBuilder.setEnvironment(ImmutableMap.of("CODESIGN_ALLOCATE",Joiner.on(" ").join(commandPrefix)));
  }
  ProcessExecutorParams processExecutorParams=paramsBuilder.setCommand(ImmutableList.of("codesign","--force","--sign",getIdentityArg(codeSignIdentitySupplier.get()),"--entitlements",pathToSigningEntitlements.toString(),pathToSign.toString())).setDirectory(workingDirectory.toFile()).build();
  Set<ProcessExecutor.Option> options=EnumSet.of(ProcessExecutor.Option.EXPECTING_STD_OUT);
  ProcessExecutor.Result result;
  try {
    ProcessExecutor processExecutor=context.getProcessExecutor();
    result=processExecutor.launchAndExecute(processExecutorParams,options,Optional.<String>absent(),Optional.<Long>absent(),Optional.<Function<Process,Void>>absent());
  }
 catch (  InterruptedException|IOException e) {
    context.logError(e,"Could not execute codesign.");
    return 1;
  }
  if (result.getExitCode() != 0) {
    return 1;
  }
  return 0;
}
