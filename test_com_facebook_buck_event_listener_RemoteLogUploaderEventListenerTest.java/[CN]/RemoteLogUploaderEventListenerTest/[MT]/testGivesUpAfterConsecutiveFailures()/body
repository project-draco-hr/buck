{
  final AtomicInteger logCount=new AtomicInteger(0);
  RemoteLogger consistentlyFailingLogger=new RemoteLogger(){
    @Override public Optional<ListenableFuture<Void>> log(    String logLine){
      logCount.incrementAndGet();
      return Optional.of(Futures.<Void>immediateFailedFuture(new Throwable()));
    }
    @Override public ListenableFuture<Void> close(){
      return Futures.immediateFuture(null);
    }
  }
;
  RemoteLogUploaderEventListener eventListener=new RemoteLogUploaderEventListener(objectMapper,consistentlyFailingLogger,BUILD_ENVIRONMENT_DESCRIPTION);
  EventBus eventBus=new EventBus();
  eventBus.register(eventListener);
  final int maxRepetitions=2 * RemoteLogUploaderEventListener.MAX_FAILURE_COUNT;
  for (int i=0; i < maxRepetitions; ++i) {
    eventBus.post(configureTestEvent(BuildEvent.started(ImmutableSet.of(""))));
  }
  assertThat(logCount.get(),Matchers.lessThan(maxRepetitions));
}
