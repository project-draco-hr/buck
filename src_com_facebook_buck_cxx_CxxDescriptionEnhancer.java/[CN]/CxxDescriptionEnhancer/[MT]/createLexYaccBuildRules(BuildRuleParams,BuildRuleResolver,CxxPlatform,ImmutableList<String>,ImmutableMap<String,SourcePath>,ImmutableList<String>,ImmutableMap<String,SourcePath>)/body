{
  SourcePathResolver pathResolver=new SourcePathResolver(resolver);
  ImmutableMap.Builder<String,CxxSource> lexYaccCxxSourcesBuilder=ImmutableMap.builder();
  ImmutableMap.Builder<Path,SourcePath> lexYaccHeadersBuilder=ImmutableMap.builder();
  for (  ImmutableMap.Entry<String,SourcePath> ent : lexSrcs.entrySet()) {
    final String name=ent.getKey();
    final SourcePath source=ent.getValue();
    BuildTarget target=createLexBuildTarget(params.getBuildTarget(),name);
    Path outputSource=getLexSourceOutputPath(target,name);
    Path outputHeader=getLexHeaderOutputPath(target,name);
    Lex lex=new Lex(params.copyWithChanges(LEX_TYPE,target,ImmutableSortedSet.copyOf(SourcePaths.filterBuildRuleInputs(ImmutableList.of(source))),ImmutableSortedSet.<BuildRule>of()),pathResolver,config.getLex(),ImmutableList.<String>builder().addAll(config.getLexFlags()).addAll(lexFlags).build(),outputSource,outputHeader,source);
    resolver.addToIndex(lex);
    lexYaccCxxSourcesBuilder.put(name + ".cc",new CxxSource(CxxSource.Type.CXX,new BuildRuleSourcePath(lex,outputSource)));
    lexYaccHeadersBuilder.put(params.getBuildTarget().getBasePath().resolve(name + ".h"),new BuildRuleSourcePath(lex,outputHeader));
  }
  for (  ImmutableMap.Entry<String,SourcePath> ent : yaccSrcs.entrySet()) {
    final String name=ent.getKey();
    final SourcePath source=ent.getValue();
    BuildTarget target=createYaccBuildTarget(params.getBuildTarget(),name);
    Path outputPrefix=getYaccOutputPrefix(target,Files.getNameWithoutExtension(name));
    Yacc yacc=new Yacc(params.copyWithChanges(YACC_TYPE,target,ImmutableSortedSet.copyOf(SourcePaths.filterBuildRuleInputs(ImmutableList.of(source))),ImmutableSortedSet.<BuildRule>of()),pathResolver,config.getYacc(),ImmutableList.<String>builder().addAll(config.getYaccFlags()).addAll(yaccFlags).build(),outputPrefix,source);
    resolver.addToIndex(yacc);
    lexYaccCxxSourcesBuilder.put(name + ".cc",new CxxSource(CxxSource.Type.CXX,new BuildRuleSourcePath(yacc,Yacc.getSourceOutputPath(outputPrefix))));
    lexYaccHeadersBuilder.put(params.getBuildTarget().getBasePath().resolve(name + ".h"),new BuildRuleSourcePath(yacc,Yacc.getHeaderOutputPath(outputPrefix)));
  }
  return new CxxHeaderSourceSpec(lexYaccHeadersBuilder.build(),lexYaccCxxSourcesBuilder.build());
}
