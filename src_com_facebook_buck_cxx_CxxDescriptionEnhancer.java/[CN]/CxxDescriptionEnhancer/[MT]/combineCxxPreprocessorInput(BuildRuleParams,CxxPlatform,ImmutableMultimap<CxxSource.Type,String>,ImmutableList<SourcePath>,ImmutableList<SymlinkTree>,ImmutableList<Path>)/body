{
  CxxPreprocessorInput cxxPreprocessorInputFromDeps;
  try {
    cxxPreprocessorInputFromDeps=CxxPreprocessables.getTransitiveCxxPreprocessorInput(cxxPlatform,FluentIterable.from(params.getDeps()).filter(Predicates.instanceOf(CxxPreprocessorDep.class)));
    BuildTarget targetWithoutFlavor=BuildTarget.of(params.getBuildTarget().getUnflavoredBuildTarget());
    ImmutableSet.Builder<AbstractCxxLibrary> librariesTestedByTargetBuilder=ImmutableSet.builder();
    for (    BuildRule rule : params.getDeps()) {
      if (rule instanceof AbstractCxxLibrary) {
        AbstractCxxLibrary libraryRule=(AbstractCxxLibrary)rule;
        if (libraryRule.getTests().contains(targetWithoutFlavor)) {
          librariesTestedByTargetBuilder.add(libraryRule);
        }
      }
    }
    cxxPreprocessorInputFromDeps=CxxPreprocessorInput.concat(ImmutableList.of(cxxPreprocessorInputFromDeps,getPrivateCxxPreprocessorInputFromLibraries(cxxPlatform,librariesTestedByTargetBuilder.build())));
  }
 catch (  CxxPreprocessorInput.ConflictingHeadersException e) {
    throw e.getHumanReadableExceptionForBuildTarget(params.getBuildTarget());
  }
  ImmutableMap.Builder<Path,SourcePath> allLinks=ImmutableMap.builder();
  ImmutableMap.Builder<Path,SourcePath> allFullLinks=ImmutableMap.builder();
  ImmutableList.Builder<Path> allIncludeRoots=ImmutableList.builder();
  for (  SymlinkTree headerSymlinkTree : headerSymlinkTrees) {
    allLinks.putAll(headerSymlinkTree.getLinks());
    allFullLinks.putAll(headerSymlinkTree.getFullLinks());
    allIncludeRoots.add(headerSymlinkTree.getRoot());
  }
  CxxPreprocessorInput localPreprocessorInput=CxxPreprocessorInput.builder().addAllRules(Iterables.transform(headerSymlinkTrees,HasBuildTarget.TO_TARGET)).putAllPreprocessorFlags(preprocessorFlags).setIncludes(ImmutableCxxHeaders.builder().addAllPrefixHeaders(prefixHeaders).putAllNameToPathMap(allLinks.build()).putAllFullNameToPathMap(allFullLinks.build()).build()).addAllIncludeRoots(allIncludeRoots.build()).addAllFrameworkRoots(frameworkSearchPaths).build();
  try {
    return CxxPreprocessorInput.concat(ImmutableList.of(localPreprocessorInput,cxxPreprocessorInputFromDeps));
  }
 catch (  CxxPreprocessorInput.ConflictingHeadersException e) {
    throw e.getHumanReadableExceptionForBuildTarget(params.getBuildTarget());
  }
}
