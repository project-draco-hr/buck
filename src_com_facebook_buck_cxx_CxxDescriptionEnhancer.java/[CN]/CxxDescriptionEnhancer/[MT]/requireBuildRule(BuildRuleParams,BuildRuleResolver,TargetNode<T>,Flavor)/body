{
  BuildTarget target=BuildTarget.builder(params.getBuildTarget()).addFlavors(flavors).build();
  Optional<BuildRule> rule=ruleResolver.getRuleOptional(target);
  if (!rule.isPresent()) {
    Description<T> description=node.getDescription();
    T args=node.getConstructorArg();
    rule=Optional.of(description.createBuildRule(params.copyWithChanges(params.getBuildRuleType(),target,Suppliers.ofInstance(params.getDeclaredDeps()),Suppliers.ofInstance(params.getExtraDeps())),ruleResolver,args));
    ruleResolver.addToIndex(rule.get());
  }
  return rule.get();
}
