{
  BuildTarget target=BuildTargets.extendFlavoredBuildTarget(params.getBuildTarget(),ImmutableSet.copyOf(flavors));
  Optional<BuildRule> rule=ruleResolver.getRuleOptional(target);
  if (!rule.isPresent()) {
    Description<T> description=node.getDescription();
    T args=node.getConstructorArg();
    rule=Optional.of(description.createBuildRule(params.copyWithChanges(params.getBuildRuleType(),target,params.getDeclaredDeps(),params.getExtraDeps()),ruleResolver,args));
    ruleResolver.addToIndex(rule.get());
  }
  return rule.get();
}
