{
  assumeThat("TODO(8667197): Native libs currently don't work on El Capitan",Platform.detect(),not(equalTo(Platform.MACOS)));
  String nativeLibsEnvVarName=DefaultCxxPlatforms.build(new CxxBuckConfig(FakeBuckConfig.builder().build())).getLd().searchPathEnvVar();
  String originalNativeLibsEnvVar="something";
  workspace.writeContentsToPath(String.format("import os; print(os.environ.get('%s'))",nativeLibsEnvVarName),"main_with_native_libs.py");
  Map<String,String> env=Maps.newHashMap(System.getenv());
  env.remove(nativeLibsEnvVarName);
  String nativeLibsEnvVar=workspace.runBuckCommandWithEnvironmentAndContext(workspace.getPath(""),Optional.<NGContext>absent(),Optional.<BuckEventListener>absent(),Optional.of(ImmutableMap.<String,String>builder().putAll(env).put(nativeLibsEnvVarName,originalNativeLibsEnvVar).build()),"run",":bin-with-native-libs").assertSuccess().getStdout().trim();
  assertThat(nativeLibsEnvVar,equalTo(originalNativeLibsEnvVar));
  nativeLibsEnvVar=workspace.runBuckCommandWithEnvironmentAndContext(workspace.getPath(""),Optional.<NGContext>absent(),Optional.<BuckEventListener>absent(),Optional.of(ImmutableMap.copyOf(env)),"run",":bin-with-native-libs").assertSuccess().getStdout().trim();
  assertThat(nativeLibsEnvVar,equalTo("None"));
}
