{
  resetAll();
  console=new TestConsole();
  console.setVerbosity(verbosity);
  ProcessExecutor processExecutor=new ProcessExecutor(console);
  expect(context.getStdErr()).andStubReturn(console.getStdErr());
  expect(context.getVerbosity()).andStubReturn(verbosity);
  expect(context.getProcessExecutor()).andStubReturn(processExecutor);
  context.postEvent(anyObject(BuckEvent.class));
  expectLastCall().andStubAnswer(new IAnswer<Void>(){
    @Override public Void answer() throws Throwable {
      ConsoleEvent event=(ConsoleEvent)getCurrentArguments()[0];
      if (event.getLevel().equals(Level.SEVERE)) {
        console.getStdErr().write(event.getMessage().getBytes(Charsets.US_ASCII));
      }
      return null;
    }
  }
);
  replayAll();
}
