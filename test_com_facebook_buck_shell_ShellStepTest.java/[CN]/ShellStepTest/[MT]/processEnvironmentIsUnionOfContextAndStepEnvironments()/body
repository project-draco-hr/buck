{
  ShellStep command=createCommand(false,false);
  ExecutionContext context=TestExecutionContext.newBuilder().setEnvironment(ImmutableMap.of("CONTEXT_ENVIRONMENT_VARIABLE","CONTEXT_VALUE")).build();
  Map<String,String> subProcessEnvironment=Maps.newHashMap();
  subProcessEnvironment.put("PROCESS_ENVIRONMENT_VARIABLE","PROCESS_VALUE");
  command.setProcessEnvironment(context,subProcessEnvironment);
  assertEquals("Sub-process environment should be union of client and step environments.",subProcessEnvironment,ImmutableMap.<String,String>builder().putAll(context.getEnvironment()).putAll(ENV).build());
}
