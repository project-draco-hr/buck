{
  resetAll();
  console=new TestConsole(verbosity);
  ProcessExecutor processExecutor=new ProcessExecutor(console);
  expect(context.getVerbosity()).andStubReturn(verbosity);
  expect(context.getProcessExecutor()).andStubReturn(processExecutor);
  process=createMock(Process.class);
  if (stdin.isPresent()) {
    expect(process.getOutputStream()).andReturn(stdin.get());
  }
  expect(process.getInputStream()).andStubReturn(new ByteArrayInputStream(new byte[0]));
  expect(process.getErrorStream()).andStubReturn(new ByteArrayInputStream(new byte[0]));
  process.destroy();
  expect(process.waitFor()).andStubReturn(0);
  expect(process.exitValue()).andStubReturn(0);
  replayAll();
}
