{
  ImmutableList<Pair<NdkCxxPlatforms.Compiler.Type,NdkCxxPlatforms.CxxRuntime>> configs=ImmutableList.of(new Pair<>(NdkCxxPlatforms.Compiler.Type.GCC,NdkCxxPlatforms.CxxRuntime.GNUSTL),new Pair<>(NdkCxxPlatforms.Compiler.Type.CLANG,NdkCxxPlatforms.CxxRuntime.GNUSTL),new Pair<>(NdkCxxPlatforms.Compiler.Type.CLANG,NdkCxxPlatforms.CxxRuntime.LIBCXX));
  for (  Pair<NdkCxxPlatforms.Compiler.Type,NdkCxxPlatforms.CxxRuntime> config : configs) {
    Map<String,ImmutableMap<NdkCxxPlatforms.TargetCpuType,RuleKeyPair>> preprocessAndCompileRukeKeys=Maps.newHashMap();
    Map<String,ImmutableMap<NdkCxxPlatforms.TargetCpuType,RuleKeyPair>> preprocessRukeKeys=Maps.newHashMap();
    Map<String,ImmutableMap<NdkCxxPlatforms.TargetCpuType,RuleKeyPair>> compileRukeKeys=Maps.newHashMap();
    Map<String,ImmutableMap<NdkCxxPlatforms.TargetCpuType,RuleKeyPair>> linkRukeKeys=Maps.newHashMap();
    for (    String dir : ImmutableList.of("something","something else")) {
      for (      Platform platform : ImmutableList.of(Platform.LINUX,Platform.MACOS,Platform.WINDOWS)) {
        tmp.create();
        Path root=tmp.newFolder(dir).toPath();
        FakeProjectFilesystem filesystem=new FakeProjectFilesystem(root.toFile());
        filesystem.writeContentsToPath("something",Paths.get("RELEASE.TXT"));
        ImmutableMap<NdkCxxPlatforms.TargetCpuType,NdkCxxPlatform> platforms=NdkCxxPlatforms.getPlatforms(filesystem,ImmutableNdkCxxPlatforms.Compiler.builder().setType(config.getFirst()).setVersion("gcc-version").setGccVersion("clang-version").build(),NdkCxxPlatforms.CxxRuntime.GNUSTL,"target-app-platform",platform,new AlwaysFoundExecutableFinder());
        preprocessAndCompileRukeKeys.put(String.format("NdkCxxPlatform(%s, %s)",dir,platform),constructCompileRuleKeys(Operation.PREPROCESS_AND_COMPILE,platforms));
        preprocessRukeKeys.put(String.format("NdkCxxPlatform(%s, %s)",dir,platform),constructCompileRuleKeys(Operation.PREPROCESS,platforms));
        compileRukeKeys.put(String.format("NdkCxxPlatform(%s, %s)",dir,platform),constructCompileRuleKeys(Operation.COMPILE,platforms));
        linkRukeKeys.put(String.format("NdkCxxPlatform(%s, %s)",dir,platform),constructLinkRuleKeys(platforms));
        tmp.delete();
      }
    }
    assertThat(Arrays.toString(preprocessAndCompileRukeKeys.entrySet().toArray()),Sets.newHashSet(preprocessAndCompileRukeKeys.values()),Matchers.hasSize(1));
    assertThat(Arrays.toString(preprocessRukeKeys.entrySet().toArray()),Sets.newHashSet(preprocessRukeKeys.values()),Matchers.hasSize(1));
    assertThat(Arrays.toString(compileRukeKeys.entrySet().toArray()),Sets.newHashSet(compileRukeKeys.values()),Matchers.hasSize(1));
    assertThat(Arrays.toString(linkRukeKeys.entrySet().toArray()),Sets.newHashSet(linkRukeKeys.values()),Matchers.hasSize(1));
  }
}
