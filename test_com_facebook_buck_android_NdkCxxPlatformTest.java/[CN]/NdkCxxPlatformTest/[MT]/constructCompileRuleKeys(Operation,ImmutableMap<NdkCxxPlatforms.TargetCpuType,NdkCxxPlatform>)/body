{
  BuildRuleResolver resolver=new BuildRuleResolver();
  SourcePathResolver pathResolver=new SourcePathResolver(resolver);
  String source="source.cpp";
  RuleKeyBuilderFactory ruleKeyBuilderFactory=new DefaultRuleKeyBuilderFactory(FakeFileHashCache.createFromStrings(ImmutableMap.<String,String>builder().put("source.cpp",Strings.repeat("a",40)).build()),pathResolver);
  BuildTarget target=BuildTargetFactory.newInstance("//:target");
  ImmutableMap.Builder<NdkCxxPlatforms.TargetCpuType,RuleKeyPair> ruleKeys=ImmutableMap.builder();
  for (  Map.Entry<NdkCxxPlatforms.TargetCpuType,NdkCxxPlatform> entry : cxxPlatforms.entrySet()) {
    CxxSourceRuleFactory cxxSourceRuleFactory=new CxxSourceRuleFactory(BuildRuleParamsFactory.createTrivialBuildRuleParams(target),resolver,pathResolver,entry.getValue().getCxxPlatform(),CxxPreprocessorInput.EMPTY,ImmutableList.<String>of());
    CxxPreprocessAndCompile rule;
switch (operation) {
case PREPROCESS_AND_COMPILE:
      rule=cxxSourceRuleFactory.createPreprocessAndCompileBuildRule(resolver,source,CxxSource.of(CxxSource.Type.CXX,new TestSourcePath(source),ImmutableList.<String>of()),CxxSourceRuleFactory.PicType.PIC,CxxPreprocessMode.COMBINED);
    break;
case PREPROCESS:
  rule=cxxSourceRuleFactory.createPreprocessBuildRule(resolver,source,CxxSource.of(CxxSource.Type.CXX,new TestSourcePath(source),ImmutableList.<String>of()),CxxSourceRuleFactory.PicType.PIC);
break;
case COMPILE:
rule=cxxSourceRuleFactory.createCompileBuildRule(resolver,source,CxxSource.of(CxxSource.Type.CXX_CPP_OUTPUT,new TestSourcePath(source),ImmutableList.<String>of()),CxxSourceRuleFactory.PicType.PIC);
break;
default :
throw new IllegalStateException();
}
RuleKey.Builder builder=ruleKeyBuilderFactory.newInstance(rule);
ruleKeys.put(entry.getKey(),builder.build());
}
return ruleKeys.build();
}
