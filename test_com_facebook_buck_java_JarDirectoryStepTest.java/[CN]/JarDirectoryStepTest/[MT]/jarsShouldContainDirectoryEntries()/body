{
  File zipup=folder.newFolder("dir-zip");
  File subdir=new File(zipup,"dir/subdir");
  assertTrue(subdir.mkdirs());
  new File(subdir,"a.txt");
  Files.write(subdir.toPath().resolve("a.txt"),"cake".getBytes());
  JarDirectoryStep step=new JarDirectoryStep(Paths.get("output.jar"),ImmutableSet.of(zipup.toPath()),null,null);
  ExecutionContext context=TestExecutionContext.newBuilder().setProjectFilesystem(new ProjectFilesystem(zipup.toPath())).build();
  int returnCode=step.execute(context);
  assertEquals(0,returnCode);
  File zip=new File(zipup,"output.jar");
  assertTrue(zip.exists());
  Set<String> expected=Sets.newHashSet("dir/","dir/subdir/");
  try (ZipInputStream is=new ZipInputStream(new FileInputStream(zip))){
    for (ZipEntry entry=is.getNextEntry(); entry != null; entry=is.getNextEntry()) {
      expected.remove(entry.getName());
    }
  }
   assertTrue("Didn't see entries for: " + expected,expected.isEmpty());
}
