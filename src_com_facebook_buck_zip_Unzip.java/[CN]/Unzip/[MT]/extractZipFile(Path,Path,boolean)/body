{
  Files.createDirectories(destination);
  ImmutableList.Builder<Path> filesWritten=ImmutableList.builder();
  try (ZipFile zip=new ZipFile(zipFile.toFile())){
    Enumeration<ZipArchiveEntry> entries=zip.getEntries();
    while (entries.hasMoreElements()) {
      ZipArchiveEntry entry=entries.nextElement();
      String fileName=entry.getName();
      Path target=destination.resolve(fileName);
      if (Files.exists(target) && !overwriteExistingFiles) {
        continue;
      }
      if (entry.isDirectory()) {
        Files.createDirectories(target);
      }
 else {
        Files.createDirectories(target.getParent());
        filesWritten.add(target);
        try (FileOutputStream out=new FileOutputStream(target.toFile())){
          ByteStreams.copy(zip.getInputStream(entry),out);
        }
         Set<PosixFilePermission> permissions=MorePosixFilePermissions.fromMode(entry.getExternalAttributes() >> 16);
        if (permissions.contains(PosixFilePermission.OWNER_EXECUTE)) {
          MoreFiles.makeExecutable(target.toFile());
        }
      }
    }
  }
   return filesWritten.build();
}
