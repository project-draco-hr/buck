{
  SourcePathResolver pathResolver=new SourcePathResolver(resolver);
  if (params.getBuildTarget().getFlavors().contains(JavaLibrary.SRC_JAR)) {
    return new JavaSourceJar(params,pathResolver,args.srcs.get());
  }
  JavacOptions.Builder javacOptionsBuilder=JavaLibraryDescription.getJavacOptions(resolver,args,defaultOptions);
  AnnotationProcessingParams annotationParams=args.buildAnnotationProcessingParams(params.getBuildTarget(),params.getProjectFilesystem(),resolver);
  javacOptionsBuilder.setAnnotationProcessingParams(annotationParams);
  JavacOptions javacOptions=javacOptionsBuilder.build();
  AndroidLibraryGraphEnhancer graphEnhancer=new AndroidLibraryGraphEnhancer(params.getBuildTarget(),params.copyWithExtraDeps(Suppliers.ofInstance(resolver.getAllRules(args.exportedDeps.get()))),javacOptions,ResourceDependencyMode.FIRST_ORDER);
  Optional<DummyRDotJava> dummyRDotJava=graphEnhancer.createBuildableForAndroidResources(resolver,false);
  ImmutableSet<Path> additionalClasspathEntries=ImmutableSet.of();
  if (dummyRDotJava.isPresent()) {
    additionalClasspathEntries=ImmutableSet.of(dummyRDotJava.get().getRDotJavaBinFolder());
    ImmutableSortedSet<BuildRule> newDeclaredDeps=ImmutableSortedSet.<BuildRule>naturalOrder().addAll(params.getDeclaredDeps()).add(dummyRDotJava.get()).build();
    params=params.copyWithDeps(Suppliers.ofInstance(newDeclaredDeps),Suppliers.ofInstance(params.getExtraDeps()));
  }
  ImmutableSortedSet<BuildRule> exportedDeps=resolver.getAllRules(args.exportedDeps.get());
  return new AndroidLibrary(params.appendExtraDeps(Iterables.concat(BuildRules.getExportedRules(Sets.union(params.getDeclaredDeps(),exportedDeps)),pathResolver.filterBuildRuleInputs(javacOptions.getInputs()))),pathResolver,args.srcs.get(),JavaLibraryDescription.validateResources(pathResolver,args,params.getProjectFilesystem()),args.proguardConfig,args.postprocessClassesCommands.get(),exportedDeps,resolver.getAllRules(args.providedDeps.get()),additionalClasspathEntries,javacOptions,args.resourcesRoot,args.manifest,false);
}
