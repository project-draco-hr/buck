{
  Comparator<BuildRule> comparator=RetainOrderComparator.createComparator(deps);
  ImmutableSortedSet<BuildRule> sortedDeps=ImmutableSortedSet.copyOf(comparator,deps);
  BuildRuleParams buildRuleParams=new BuildRuleParams(buildTarget,sortedDeps,visibilityPatterns);
  return new AbstractCachingBuildRule(buildRuleParams){
    private Iterable<InputRule> inputs=inputRules;
    @Override public BuildRuleType getType(){
      return BuildRuleType.JAVA_LIBRARY;
    }
    @Override public Iterable<InputRule> getInputs(){
      return inputs;
    }
    @Override public String getPathToOutputFile(){
      return output;
    }
    @Override Optional<RuleKey> getRuleKeyOnDisk(    ProjectFilesystem projectFilesystem){
      return ruleKeyOnDisk;
    }
    @Override protected List<Step> buildInternal(    BuildContext context) throws IOException {
      return buildSteps;
    }
    @Override protected Iterable<String> getInputsToCompareToOutput(){
      throw new UnsupportedOperationException();
    }
  }
;
}
