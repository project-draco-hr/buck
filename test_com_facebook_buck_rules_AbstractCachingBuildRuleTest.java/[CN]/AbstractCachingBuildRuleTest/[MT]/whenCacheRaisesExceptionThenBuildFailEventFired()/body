{
  BuildTarget target=BuildTargetFactory.newInstance("//com/example:rule");
  CachingBuildRuleParams params=new CachingBuildRuleParams(target,ImmutableSortedSet.<BuildRule>of(),ImmutableSet.of(BuildTargetPattern.MATCH_ALL),artifactCache);
  StepRunner stepRunner=createNiceMock(StepRunner.class);
  expect(stepRunner.getListeningExecutorService()).andStubReturn(MoreExecutors.sameThreadExecutor());
  JavaPackageFinder packageFinder=createNiceMock(JavaPackageFinder.class);
  replay(stepRunner,packageFinder);
  EventBus bus=new EventBus();
  Listener listener=new Listener();
  bus.register(listener);
  DummyRule rule=new DummyRule(params,false,true);
  File root=new File(".");
  BuildContext context=BuildContext.builder().setEventBus(bus).setProjectRoot(root).setDependencyGraph(createMock(DependencyGraph.class)).setProjectFilesystem(new ProjectFilesystem(root)).setCommandRunner(stepRunner).setJavaPackageFinder(packageFinder).build();
  ListenableFuture<BuildRuleSuccess> build=rule.build(context);
  try {
    build.get();
    fail("Cache should have thrown an IOException");
  }
 catch (  ExecutionException ignored) {
  }
  assertSeenEventsContain(ImmutableList.<BuildEvent>of(BuildEvents.started(rule),BuildEvents.finished(rule,FAIL,MISS)),listener.getSeen());
}
