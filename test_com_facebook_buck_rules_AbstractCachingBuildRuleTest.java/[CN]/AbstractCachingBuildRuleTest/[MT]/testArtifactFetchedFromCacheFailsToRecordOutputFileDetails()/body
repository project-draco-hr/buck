{
  ArtifactFetchedFromCacheScenario scenario=createArtifactFetchedFromCacheScenario(false);
  BuildableAbstractCachingBuildRule cachingRule=scenario.cachingRule;
  cachingRule.setRecordOutputFileDetailsAfterFetchedFromArtifactCacheShouldThrowIOException(true);
  ListenableFuture<BuildRuleSuccess> result=cachingRule.build(scenario.buildContext);
  assertEquals("recordOutputFileDetailsAfterFetchedFromArtifactCache() should be invoked once.",1,cachingRule.numCallsToRecordOutputFileDetailsAfterFetchedFromArtifactCache);
  Throwable failure=MoreFutures.getFailure(result);
  assertTrue(failure instanceof IOException);
  assertEquals("Failed to record output file details!",failure.getMessage());
  verifyAll();
}
