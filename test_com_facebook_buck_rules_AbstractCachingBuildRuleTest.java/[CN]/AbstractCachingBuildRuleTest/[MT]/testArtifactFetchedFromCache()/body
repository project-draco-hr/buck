{
  ArtifactFetchedFromCacheScenario scenario=createArtifactFetchedFromCacheScenario(true);
  BuildableAbstractCachingBuildRule cachingRule=scenario.cachingRule;
  ListenableFuture<BuildRuleSuccess> result=cachingRule.build(scenario.buildContext);
  assertEquals("recordOutputFileDetailsAfterFetchedFromArtifactCache() should be invoked once.",1,cachingRule.numCallsToRecordOutputFileDetailsAfterFetchedFromArtifactCache);
  ImmutableList<String> linesWrittenToSuccessFile=ImmutableList.copyOf(scenario.lines.getValue());
  assertEquals("The RuleKey should have been written to the .success file.",ImmutableList.of(cachingRule.getRuleKey().toString()),linesWrittenToSuccessFile);
  assertTrue("We expect build() to be synchronous in this case, " + "so the future should already be resolved.",MoreFutures.isSuccess(result));
  BuildRuleSuccess success=result.get();
  assertEquals(BuildRuleSuccess.Type.FETCHED_FROM_CACHE,success.getType());
  verifyAll();
}
