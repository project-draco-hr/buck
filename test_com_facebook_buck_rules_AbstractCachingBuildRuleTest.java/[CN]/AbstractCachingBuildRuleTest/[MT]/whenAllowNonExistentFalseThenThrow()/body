{
  AbstractBuildRuleBuilder builder=JavaBinaryRule.newJavaBinaryRuleBuilder();
  builder.setBuildTarget(BuildTargetFactory.newInstance("//foo/bar","raz"));
  try {
    builder.getBuildTargetsAsBuildRules(ImmutableMap.<String,BuildRule>of(),ImmutableList.of("//com/fake:javarule"),false);
  }
 catch (  HumanReadableException e) {
    assertEquals("No rule for //com/fake:javarule found when processing //foo/bar:raz",e.getHumanReadableErrorMessage());
    return;
  }
  fail("Should have thrown exception when not allowing non-existent rules in no_dx.");
}
