{
  if (args.length == 0) {
    return usage();
  }
  BuckConfig buckConfig=createBuckConfig(projectRoot);
  ProjectFilesystem projectFilesystem=new ProjectFilesystem(projectRoot);
  Optional<Command> command=Command.getCommandForName(args[0]);
  if (command.isPresent()) {
    String[] remainingArgs=new String[args.length - 1];
    System.arraycopy(args,1,remainingArgs,0,remainingArgs.length);
    Console console=new Console(stdOut,stdErr,buckConfig.getAnsi());
    CommandRunnerParams params=new CommandRunnerParams(console,buckConfig.getArtifactCache(),projectFilesystem,new KnownBuildRuleTypes());
    return command.get().execute(remainingArgs,buckConfig,params);
  }
 else {
    int exitCode=new GenericBuckOptions(stdOut,stdErr).execute(args);
    if (exitCode == GenericBuckOptions.SHOW_MAIN_HELP_SCREEN_EXIT_CODE) {
      return usage();
    }
 else {
      return exitCode;
    }
  }
}
