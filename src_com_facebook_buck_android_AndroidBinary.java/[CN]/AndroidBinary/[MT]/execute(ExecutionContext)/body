{
  ProjectFilesystem filesystem=context.getProjectFilesystem();
  final ImmutableSet.Builder<Path> executablesBuilder=ImmutableSet.builder();
  try {
    filesystem.walkRelativeFileTree(destinationDir,new SimpleFileVisitor<Path>(){
      @Override public FileVisitResult visitFile(      Path file,      BasicFileAttributes attrs) throws IOException {
        if (file.toString().endsWith("-disguised-exe")) {
          executablesBuilder.add(file);
        }
        return FileVisitResult.CONTINUE;
      }
    }
);
    for (    Path exePath : executablesBuilder.build()) {
      Path fakeSoPath=Paths.get(exePath.toString().replaceAll("/([^/]+)-disguised-exe$","/lib$1.so"));
      filesystem.move(exePath,fakeSoPath);
    }
  }
 catch (  IOException e) {
    context.logError(e,"Renaming native executables failed.");
    return 1;
  }
  return 0;
}
