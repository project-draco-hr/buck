{
  if (value instanceof Optional) {
    value=((Optional<?>)value).orNull();
  }
  if (value instanceof BuildTargetSourcePath) {
    value=((BuildTargetSourcePath)value).getTarget();
  }
 else   if (value instanceof Collection) {
    for (    Object item : ((Collection<?>)value)) {
      builder=addBuildRule(resolver,builder,item);
    }
  }
  if (value instanceof BuildTarget) {
    BuildRule rule=resolver.get((BuildTarget)value);
    if (builder == null) {
      builder=ImmutableSortedSet.naturalOrder();
    }
    builder.add(rule);
  }
  return builder;
}
