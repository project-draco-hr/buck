{
  Path dir=file;
  if (!getProjectFilesystem().isDirectory(dir)) {
    dir=dir.getParent();
  }
  Path projectRoot=getProjectFilesystem().getRootPath();
  while (dir != null && !dir.equals(projectRoot)) {
    Path buck=dir.resolve(BuckConstant.BUILD_RULES_FILE_NAME);
    if (getProjectFilesystem().exists(buck)) {
      return buck;
    }
    dir=dir.getParent();
  }
  throw new RuntimeException("Failed to find BUCK file for " + file);
}
