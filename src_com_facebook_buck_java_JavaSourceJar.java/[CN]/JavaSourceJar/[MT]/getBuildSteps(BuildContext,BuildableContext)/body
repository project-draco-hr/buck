{
  JavaPackageFinder packageFinder=context.getJavaPackageFinder();
  ImmutableList.Builder<Step> steps=ImmutableList.builder();
  steps.add(new MkdirStep(output.getParent()));
  steps.add(new RmStep(output,true));
  steps.add(new MakeCleanDirectoryStep(temp));
  Set<Path> seenPackages=Sets.newHashSet();
  for (  Path source : getResolver().filterInputsToCompareToOutput(sources)) {
    Path packageFolder=packageFinder.findJavaPackageFolder(source);
    Path packageDir=temp.resolve(packageFolder);
    if (seenPackages.add(packageDir)) {
      steps.add(new MkdirStep(packageDir));
    }
    steps.add(CopyStep.forFile(source,packageDir.resolve(source.getFileName())));
  }
  steps.add(new ZipStep(output,ImmutableSet.<Path>of(),false,DEFAULT_COMPRESSION_LEVEL,temp));
  buildableContext.recordArtifact(output);
  return steps.build();
}
