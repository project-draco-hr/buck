{
  TestCommandOptions options=getOptions("--exclude","windows+linux");
  TestRule rule1=new FakeTestRule(BuildRuleType.JAVA_TEST,ImmutableSet.of("windows","linux"),BuildTargetFactory.newInstance("//:for"),ImmutableSortedSet.<BuildRule>of(),ImmutableSet.<BuildTargetPattern>of());
  TestRule rule2=new FakeTestRule(BuildRuleType.JAVA_TEST,ImmutableSet.of("windows"),BuildTargetFactory.newInstance("//:lulz"),ImmutableSortedSet.<BuildRule>of(),ImmutableSet.<BuildTargetPattern>of());
  List<TestRule> testRules=ImmutableList.of(rule1,rule2);
  Iterable<TestRule> result=TestCommand.filterTestRules(options,testRules);
  assertEquals(ImmutableSet.of(rule2),result);
}
