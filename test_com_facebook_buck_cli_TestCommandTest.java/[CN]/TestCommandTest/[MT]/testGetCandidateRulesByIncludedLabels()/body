{
  SourcePathResolver pathResolver=new SourcePathResolver(new BuildRuleResolver());
  FakeTestRule rule1=new FakeTestRule(JavaTestDescription.TYPE,ImmutableSet.of(Label.of("windows"),Label.of("linux")),BuildTargetFactory.newInstance("//:for"),pathResolver,ImmutableSortedSet.<BuildRule>of());
  FakeTestRule rule2=new FakeTestRule(JavaTestDescription.TYPE,ImmutableSet.of(Label.of("android")),BuildTargetFactory.newInstance("//:teh"),pathResolver,ImmutableSortedSet.<BuildRule>of(rule1));
  FakeTestRule rule3=new FakeTestRule(JavaTestDescription.TYPE,ImmutableSet.of(Label.of("windows")),BuildTargetFactory.newInstance("//:lulz"),pathResolver,ImmutableSortedSet.<BuildRule>of(rule2));
  Iterable<FakeTestRule> rules=Lists.newArrayList(rule1,rule2,rule3);
  ActionGraph graph=createDependencyGraphFromBuildRules(rules);
  TestCommand command=getCommand("--include","linux","windows");
  Iterable<TestRule> result=command.filterTestRules(new FakeBuckConfig(),ImmutableSet.<BuildTarget>of(),TestCommand.getCandidateRules(graph));
  assertThat(result,containsInAnyOrder((TestRule)rule1,rule3));
}
