{
  BuildRuleResolver resolver=new BuildRuleResolver();
  SourcePathResolver pathResolver=new SourcePathResolver(resolver);
  BuildRuleParams flavoredParams=BuildRuleParamsFactory.createTrivialBuildRuleParams(TARGET);
  final String cppHeaderNamespace="foo";
  final ImmutableMap<String,SourcePath> cppHeaders=ImmutableMap.<String,SourcePath>of("header.h",new TestSourcePath("header.h"));
  final ImmutableMap<String,SourceWithFlags> cppSrcs=ImmutableMap.of("source.cpp",SourceWithFlags.of(new TestSourcePath("source.cpp")));
  ThriftConstructorArg arg=new ThriftConstructorArg();
  arg.cppOptions=Optional.absent();
  arg.cppDeps=Optional.absent();
  arg.cppHeaderNamespace=Optional.of(cppHeaderNamespace);
  arg.cppExportedHeaders=Optional.of(Either.<ImmutableList<SourcePath>,ImmutableMap<String,SourcePath>>ofRight(cppHeaders));
  arg.cppSrcs=Optional.of(SourceWithFlagsList.ofNamedSources(cppSrcs));
  ThriftCompiler thrift=createFakeThriftCompiler("//:thrift_source",pathResolver);
  resolver.addToIndex(thrift);
  ImmutableMap<String,ThriftSource> sources=ImmutableMap.of("test.thrift",new ThriftSource(thrift,ImmutableList.<String>of(),Paths.get("output")));
  CxxLibraryDescription cxxLibraryDescription=new CxxLibraryDescription(CXX_BUCK_CONFIG,CXX_PLATFORMS,CxxPreprocessMode.SEPARATE){
    @Override public <A extends Arg>BuildRule createBuildRule(    BuildRuleParams params,    BuildRuleResolver resolver,    A args){
      assertThat(args.headerNamespace,Matchers.equalTo(Optional.of(cppHeaderNamespace)));
      for (      Map.Entry<String,SourcePath> header : cppHeaders.entrySet()) {
        assertThat(args.exportedHeaders.get().getRight().get(header.getKey()),Matchers.equalTo(header.getValue()));
      }
      for (      Map.Entry<String,SourceWithFlags> source : cppSrcs.entrySet()) {
        assertThat(args.srcs.get().getNamedSources().get().get(source.getKey()),Matchers.equalTo(source.getValue()));
      }
      return super.createBuildRule(params,resolver,args);
    }
  }
;
  ThriftCxxEnhancer enhancer=new ThriftCxxEnhancer(THRIFT_BUCK_CONFIG,cxxLibraryDescription,false);
  enhancer.createBuildRule(flavoredParams,resolver,arg,sources,ImmutableSortedSet.<BuildRule>of());
}
