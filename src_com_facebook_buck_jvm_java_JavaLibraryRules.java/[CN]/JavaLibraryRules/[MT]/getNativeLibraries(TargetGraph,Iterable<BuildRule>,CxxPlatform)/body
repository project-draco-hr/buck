{
  final ImmutableMap.Builder<String,SourcePath> libraries=ImmutableMap.builder();
  new AbstractBreadthFirstTraversal<BuildRule>(deps){
    @Override public ImmutableSet<BuildRule> visit(    BuildRule rule){
      if (rule instanceof JavaNativeLinkable) {
        JavaNativeLinkable linkable=(JavaNativeLinkable)rule;
        libraries.putAll(linkable.getSharedLibraries(targetGraph,cxxPlatform));
      }
      if (rule instanceof JavaNativeLinkable || rule instanceof JavaLibrary) {
        return rule.getDeps();
      }
 else {
        return ImmutableSet.of();
      }
    }
  }
.start();
  return libraries.build();
}
