{
  SimulateTimes times=SimulateTimes.createEmpty(DEFAULT_MILLIS);
  TargetGraphTransformer transformer=new TargetGraphToActionGraph(eventBus,new BuildTargetNodeToBuildRuleTransformer());
  Pair<ActionGraph,BuildRuleResolver> result=Preconditions.checkNotNull(transformer.apply(targetGraph));
  BuildSimulator sim=new BuildSimulator(times,result.getFirst(),result.getSecond(),numberThreads);
  SimulateReport report=sim.simulateBuild(System.currentTimeMillis(),ImmutableList.of(ROOT_NODE));
  Assert.assertEquals(1,report.getRunReports().size());
  SingleRunReport runReport=report.getRunReports().get(0);
  Assert.assertEquals(1,runReport.getBuildTargets().size());
  Assert.assertEquals(expectedDurationMillis,runReport.getBuildDurationMillis());
}
