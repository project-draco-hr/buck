{
  if (path.startsWith(GENFILE_PREFIX)) {
    path=path.substring(GENFILE_PREFIX.length());
    return String.format("%s/%s",BuckConstant.GEN_DIR,resolvePathAgainstBuildTargetBase(path),path);
  }
 else {
    String fullPath=resolvePathAgainstBuildTargetBase(path);
    File file=filesystem.getFileForRelativePath(fullPath);
    if (!ignoreFileExistenceChecks && !file.isFile()) {
      throw new RuntimeException("Not an ordinary file: " + fullPath);
    }
    String basePath=target.getBasePath();
    if (!basePath.isEmpty() && !fullPath.startsWith(basePath + '/')) {
      throw new RuntimeException(file + " is not a descendant of " + target.getBasePath());
    }
    if (fullPath.contains("..")) {
      handleError(String.format("\"%s\" in target \"%s\" refers to a parent directory.",fullPath,target.getFullyQualifiedName()));
    }
    if (buildTargetParser != null) {
      checkFullPath(fullPath);
    }
    return fullPath;
  }
}
