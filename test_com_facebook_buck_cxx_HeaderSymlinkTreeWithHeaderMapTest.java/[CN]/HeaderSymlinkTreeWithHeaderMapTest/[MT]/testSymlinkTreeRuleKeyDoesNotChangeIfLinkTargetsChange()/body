{
  SourcePathResolver resolver=new SourcePathResolver(new BuildRuleResolver(ImmutableSet.of(symlinkTreeBuildRule)));
  RuleKeyBuilderFactory ruleKeyBuilderFactory=new DefaultRuleKeyBuilderFactory(FakeFileHashCache.createFromStrings(ImmutableMap.<String,String>of()),resolver);
  RuleKeyBuilder builder1=ruleKeyBuilderFactory.newInstance(symlinkTreeBuildRule);
  RuleKey pair1=builder1.build();
  Path existingFile=projectFilesystem.resolve(new SourcePathResolver(new BuildRuleResolver()).deprecatedGetPath(links.values().asList().get(0)));
  Files.write(existingFile,"something new".getBytes(Charsets.UTF_8));
  RuleKeyBuilder builder2=ruleKeyBuilderFactory.newInstance(symlinkTreeBuildRule);
  RuleKey pair2=builder2.build();
  assertEquals(pair1,pair2);
}
