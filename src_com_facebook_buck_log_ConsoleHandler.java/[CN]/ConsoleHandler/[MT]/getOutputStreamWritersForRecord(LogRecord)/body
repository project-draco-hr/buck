{
  ImmutableSet.Builder<OutputStreamWriter> builder=ImmutableSet.builder();
  long recordThreadId=record.getThreadID();
  String logRecordCommandId=state.threadIdToCommandId(recordThreadId);
  if (logRecordCommandId != null) {
    OutputStreamWriter consoleWriter=state.getWriter(logRecordCommandId);
    if (consoleWriter != null) {
      builder.add(consoleWriter);
    }
 else {
      builder.add(defaultOutputStreamWriter);
    }
  }
 else {
    Collection<OutputStreamWriter> allConsoleWriters=Lists.newArrayList(state.getAllAvailableWriters());
    if (allConsoleWriters.isEmpty()) {
      builder.add(defaultOutputStreamWriter);
    }
 else {
      builder.addAll(allConsoleWriters);
    }
  }
  return builder.build();
}
