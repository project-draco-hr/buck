{
  ImmutableSet.Builder<OutputStreamWriter> builder=ImmutableSet.builder();
  long recordThreadId=record.getThreadID();
  String logRecordCommandId=threadIdToCommandId.get(recordThreadId);
  if (logRecordCommandId != null) {
    OutputStreamWriter consoleWriter=commandIdToConsoleWriter.get(logRecordCommandId);
    if (consoleWriter != null) {
      builder.add(consoleWriter);
    }
 else {
      builder.add(defaultOutputStreamWriter);
    }
  }
 else {
    Collection<OutputStreamWriter> allConsoleWriters=commandIdToConsoleWriter.values();
    if (allConsoleWriters.isEmpty()) {
      builder.add(defaultOutputStreamWriter);
    }
 else {
      builder.addAll(allConsoleWriters);
    }
  }
  return builder.build();
}
