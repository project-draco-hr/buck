{
  ZipDirectoryWithMaxDeflateStep zipCommand=new ZipDirectoryWithMaxDeflateStep(zipDirectory,outputApk.getAbsolutePath(),128);
  ExecutionContext executionContext=EasyMock.createMock(ExecutionContext.class);
  EasyMock.replay(executionContext);
  zipCommand.execute(executionContext);
  assertTrue(outputApk.exists());
  ZipFile resultZip=new ZipFile(outputApk.getAbsoluteFile());
  ZipEntry storedFile=resultZip.getEntry("StoredFile");
  assertEquals("StoredFile should have been STORED else Froyo will crash on launch.",storedFile.getMethod(),ZipEntry.STORED);
  ZipEntry deflatedFile=resultZip.getEntry("subDir/DeflatedFile");
  assertEquals("DeflatedFile should have been DEFLATED",deflatedFile.getMethod(),ZipEntry.DEFLATED);
  EasyMock.verify(executionContext);
}
