{
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  BuildTarget target=BuildTargetFactory.newInstance("//:example");
  Genrule rule=ruleResolver.buildAndAddToIndex(Genrule.newGenruleBuilder(new FakeAbstractBuildRuleBuilderParams()).setRelativeToAbsolutePathFunctionForTesting(ABSOLUTIFIER).setBuildTarget(target).setBash(Optional.of("ignored")).addSrc("in-dir.txt").addSrc("foo/bar.html").addSrc("other/place.txt").setOut("example-file"));
  ImmutableList.Builder<Step> builder=ImmutableList.builder();
  rule.addSymlinkCommands(builder);
  ImmutableList<Step> commands=builder.build();
  String baseTmpPath=GEN_DIR + "/example__srcs/";
  assertEquals(3,commands.size());
  MkdirAndSymlinkFileStep linkCmd=(MkdirAndSymlinkFileStep)commands.get(0);
  assertEquals("in-dir.txt",linkCmd.getSource());
  assertEquals(baseTmpPath + "in-dir.txt",linkCmd.getTarget());
  linkCmd=(MkdirAndSymlinkFileStep)commands.get(1);
  assertEquals("foo/bar.html",linkCmd.getSource());
  assertEquals(baseTmpPath + "foo/bar.html",linkCmd.getTarget());
  linkCmd=(MkdirAndSymlinkFileStep)commands.get(2);
  assertEquals("other/place.txt",linkCmd.getSource());
  assertEquals(baseTmpPath + "other/place.txt",linkCmd.getTarget());
}
