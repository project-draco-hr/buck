{
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  BuildRule javaBinary=createSampleJavaBinaryRule(ruleResolver);
  String originalCmd="$(exe :ManifestGenerator) $OUT";
  Path contextBasePath=Paths.get("java/com/facebook/util");
  Genrule rule=(Genrule)newGenruleBuilder(ruleResolver,originalCmd,contextBasePath,ImmutableSortedSet.of(javaBinary.getBuildTarget()));
  AbstractGenruleStep genruleStep=rule.createGenruleStep();
  String transformedString=genruleStep.replaceMatches(fakeFilesystem,originalCmd);
  Path expectedClasspath=getAbsolutePathInBase(GEN_DIR + "/java/com/facebook/util/ManifestGenerator.jar");
  String expectedCmd=String.format("java -jar %s $OUT",expectedClasspath);
  assertEquals(expectedCmd,transformedString);
}
