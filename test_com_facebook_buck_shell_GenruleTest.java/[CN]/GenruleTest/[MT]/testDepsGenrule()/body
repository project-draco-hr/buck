{
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  JavaBinaryRule javaBinary=createSampleJavaBinaryRule(ruleResolver);
  String originalCmd="$(exe :ManifestGenerator) $OUT";
  Set<? extends BuildRule> deps=ImmutableSet.of(javaBinary);
  String contextBasePath="java/com/facebook/util";
  Genrule rule=createGenrule(ruleResolver,originalCmd,contextBasePath,deps);
  AbstractGenruleStep genruleStep=rule.createGenruleStep();
  String transformedString=genruleStep.replaceMatches(fakeFilesystem,originalCmd);
  String expectedClasspath=getAbsolutePathInBase(GEN_DIR + "/java/com/facebook/util/lib__util__output/util.jar");
  String expectedCmd=String.format("java -classpath %s com.facebook.util.ManifestGenerator $OUT",expectedClasspath);
  assertEquals(expectedCmd,transformedString);
}
