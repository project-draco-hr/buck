{
  File fakeDx=new File(".");
  AndroidPlatformTarget android=EasyMock.createNiceMock(AndroidPlatformTarget.class);
  EasyMock.expect(android.getDxExecutable()).andStubReturn(fakeDx);
  EasyMock.replay(android);
  Genrule rule=Genrule.newGenruleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(BuildTargetFactory.newInstance("//example:genrule")).setCmd("true").setOut("/dev/null").build(new BuildRuleResolver());
  ExecutionContext context=ExecutionContext.builder().setConsole(new TestConsole()).setProjectFilesystem(new ProjectFilesystem(new File("."))).setAndroidPlatformTarget(Optional.of(android)).setEventBus(new EventBus()).build();
  ImmutableMap.Builder<String,String> builder=ImmutableMap.builder();
  rule.addEnvironmentVariables(context,builder);
  ImmutableMap<String,String> env=builder.build();
  assertEquals(fakeDx.getAbsolutePath(),env.get("DX"));
  EasyMock.verify(android);
}
