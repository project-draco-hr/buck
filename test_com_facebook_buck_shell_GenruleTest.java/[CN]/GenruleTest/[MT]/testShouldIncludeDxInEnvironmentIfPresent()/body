{
  AndroidPlatformTarget android=EasyMock.createNiceMock(AndroidPlatformTarget.class);
  EasyMock.expect(android.getDxExecutable()).andStubReturn(Paths.get("."));
  EasyMock.replay(android);
  BuildTarget target=BuildTargetFactory.newInstance("//example:genrule");
  Genrule genrule=GenruleBuilder.createGenrule(target).setBash("true").setOut("/dev/null").build();
  ExecutionContext context=TestExecutionContext.newBuilder().setAndroidPlatformTarget(Optional.of(android)).build();
  ImmutableMap.Builder<String,String> builder=ImmutableMap.builder();
  genrule.addEnvironmentVariables(context,builder);
  ImmutableMap<String,String> env=builder.build();
  assertEquals(Paths.get(".").toString(),env.get("DX"));
  EasyMock.verify(android);
}
