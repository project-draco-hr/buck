{
  String bash="rm -rf /usr";
  String cmdExe="rmdir /s /q C:\\Windows";
  String cmd="echo \"Hello\"";
  String genruleName="//example:genrule";
  ExecutionContext linuxExecutionContext=newEmptyExecutionContext(Platform.LINUX);
  ExecutionContext windowsExecutionContext=newEmptyExecutionContext(Platform.WINDOWS);
  Genrule rule=Genrule.newGenruleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(BuildTargetFactory.newInstance(genruleName)).setBash(Optional.of(bash)).setCmdExe(Optional.of(cmdExe)).setOut("out.txt").build(new BuildRuleResolver());
  ImmutableList<String> command=rule.createGenruleStep().getShellCommand(linuxExecutionContext);
  assertEquals(ImmutableList.of("/bin/bash","-e","-c",bash),command);
  command=rule.createGenruleStep().getShellCommand(windowsExecutionContext);
  assertEquals(ImmutableList.of("cmd.exe","/c",cmdExe),command);
  rule=Genrule.newGenruleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(BuildTargetFactory.newInstance("//example:genrule")).setCmd(Optional.of(cmd)).setOut("out.txt").build(new BuildRuleResolver());
  command=rule.createGenruleStep().getShellCommand(linuxExecutionContext);
  assertEquals(ImmutableList.of("/bin/bash","-e","-c",cmd),command);
  command=rule.createGenruleStep().getShellCommand(windowsExecutionContext);
  assertEquals(ImmutableList.of("cmd.exe","/c",cmd),command);
  rule=Genrule.newGenruleBuilder(new FakeAbstractBuildRuleBuilderParams()).setBuildTarget(BuildTargetFactory.newInstance("//example:genrule")).setOut("out.txt").build(new BuildRuleResolver());
  try {
    rule.createGenruleStep().getShellCommand(linuxExecutionContext);
  }
 catch (  HumanReadableException e) {
    assertEquals(String.format("You must specify either bash or cmd for genrule %s.",genruleName),e.getHumanReadableErrorMessage());
  }
  try {
    rule.createGenruleStep().getShellCommand(windowsExecutionContext);
  }
 catch (  HumanReadableException e) {
    assertEquals(String.format("You must specify either cmd_exe or cmd for genrule %s.",genruleName),e.getHumanReadableErrorMessage());
  }
}
