{
  ProjectFilesystem filesystem=new FakeProjectFilesystem();
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  BuildRule javaBinary=createSampleJavaBinaryRule(ruleResolver);
  Path outputPath=javaBinary.getPathToOutputFile();
  Path absolutePath=outputPath.toAbsolutePath();
  String originalCmd=String.format("$(location :%s) $(location %s) $OUT",javaBinary.getBuildTarget().getShortName(),javaBinary.getBuildTarget().getFullyQualifiedName());
  String contextBasePath=javaBinary.getBuildTarget().getBasePath();
  Set<? extends BuildRule> deps=ImmutableSet.of(javaBinary);
  Genrule buildable=(Genrule)createGenrule(ruleResolver,originalCmd,contextBasePath,deps);
  AbstractGenruleStep genruleStep=buildable.createGenruleStep();
  String transformedString=genruleStep.replaceMatches(filesystem,originalCmd);
  String expectedCmd=String.format("%s %s $OUT",absolutePath,absolutePath);
  assertEquals(expectedCmd,transformedString);
}
