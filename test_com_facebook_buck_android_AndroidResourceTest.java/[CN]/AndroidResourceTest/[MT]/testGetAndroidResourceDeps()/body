{
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  BuildRule c=ruleResolver.addToIndex(AndroidResourceRuleBuilder.newBuilder().setBuildTarget(BuildTargetFactory.newInstance("//:c")).setRes(Paths.get("res_c")).setRDotJavaPackage("com.facebook").build());
  BuildRule b=ruleResolver.addToIndex(AndroidResourceRuleBuilder.newBuilder().setBuildTarget(BuildTargetFactory.newInstance("//:b")).setRes(Paths.get("res_b")).setRDotJavaPackage("com.facebook").setDeps(ImmutableSortedSet.of(c)).build());
  BuildRule d=ruleResolver.addToIndex(AndroidResourceRuleBuilder.newBuilder().setBuildTarget(BuildTargetFactory.newInstance("//:d")).setRes(Paths.get("res_d")).setRDotJavaPackage("com.facebook").setDeps(ImmutableSortedSet.of(c)).build());
  BuildRule a=ruleResolver.addToIndex(AndroidResourceRuleBuilder.newBuilder().setBuildTarget(BuildTargetFactory.newInstance("//:a")).setRes(Paths.get("res_a")).setRDotJavaPackage("com.facebook").setDeps(ImmutableSortedSet.of(b,c,d)).build());
  ImmutableList<HasAndroidResourceDeps> deps=UberRDotJavaUtil.getAndroidResourceDeps(a);
  Function<BuildRule,Buildable> ruleToBuildable=new Function<BuildRule,Buildable>(){
    @Override public Buildable apply(    BuildRule input){
      return input.getBuildable();
    }
  }
;
  ImmutableList<Buildable> result=FluentIterable.from(ImmutableList.of(a,d,b,c)).transform(ruleToBuildable).toList();
  assertEquals(String.format("Topological sort %s should be %s",deps,result),deps,result);
  BuildTarget keystoreTarget=BuildTargetFactory.newInstance("//keystore:debug");
  BuildRule keystore=KeystoreBuilder.createBuilder(keystoreTarget).setStore(Paths.get("keystore/debug.keystore")).setProperties(Paths.get("keystore/debug.keystore.properties")).build(ruleResolver);
  ImmutableSortedSet<BuildRule> declaredDeps=ImmutableSortedSet.of(a,c);
  BuildRule e=AndroidBinaryBuilder.newBuilder().setBuildTarget(BuildTargetFactory.newInstance("//:e")).setManifest(new TestSourcePath("AndroidManfiest.xml")).setTarget("Google Inc.:Google APIs:16").setKeystore((Keystore)keystore.getBuildable()).setOriginalDeps(declaredDeps).build(ruleResolver);
  ((AndroidBinary)e.getBuildable()).getEnhancedDeps(ruleResolver,declaredDeps,ImmutableSortedSet.of(keystore));
  ImmutableList<HasAndroidResourceDeps> deps2=UberRDotJavaUtil.getAndroidResourceDeps(a);
  assertEquals(String.format("Topological sort %s should be %s",deps,result),deps2,result);
}
