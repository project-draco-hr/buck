{
  if (getArguments().size() != 1) {
    params.getConsole().getStdErr().println("Must specify exactly one android_binary() or apk_genrule() rule.");
    return 1;
  }
  int exitCode=super.runWithoutHelp(params);
  if (exitCode != 0) {
    return exitCode;
  }
  Build build=super.getBuild();
  ActionGraph graph=build.getActionGraph();
  BuildRule buildRule=Preconditions.checkNotNull(graph.findBuildRuleByTarget(getBuildTargets().get(0)));
  if (!(buildRule instanceof InstallableApk)) {
    params.getConsole().printBuildFailure(String.format("Specified rule %s must be of type android_binary() or apk_genrule() but was %s().\n",buildRule.getFullyQualifiedName(),buildRule.getType()));
    return 1;
  }
  InstallableApk installableApk=(InstallableApk)buildRule;
  final AdbHelper adbHelper=new AdbHelper(adbOptions(),targetDeviceOptions(),build.getExecutionContext(),params.getConsole(),params.getBuckEventBus(),params.getBuckConfig());
  if (shouldUninstallFirst()) {
    String packageName=AdbHelper.tryToExtractPackageNameFromManifest(installableApk,build.getExecutionContext());
    adbHelper.uninstallApp(packageName,uninstallOptions());
  }
  boolean installSuccess;
  Optional<ExopackageInfo> exopackageInfo=installableApk.getExopackageInfo();
  if (exopackageInfo.isPresent()) {
    installSuccess=new ExopackageInstaller(build.getExecutionContext(),adbHelper,installableApk).install();
  }
 else {
    installSuccess=adbHelper.installApk(installableApk,this);
  }
  if (!installSuccess) {
    return 1;
  }
  if (shouldStartActivity()) {
    exitCode=adbHelper.startActivity(installableApk,getActivityToStart());
    if (exitCode != 0) {
      return exitCode;
    }
  }
  return exitCode;
}
