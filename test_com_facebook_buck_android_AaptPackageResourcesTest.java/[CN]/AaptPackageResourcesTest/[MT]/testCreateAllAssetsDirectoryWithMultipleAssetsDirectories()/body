{
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  AndroidBinaryTest.createAndroidLibraryRule("//facebook/base:libraryOne",ruleResolver,null,"facebook/base/assets1",null);
  AndroidBinaryTest.createAndroidLibraryRule("//facebook/base:libraryTwo",ruleResolver,null,"facebook/base/assets2",null);
  ResourcesFilter resourcesFilter=EasyMock.createMock(ResourcesFilter.class);
  EasyMock.replay(resourcesFilter);
  BuildRuleParams params=new FakeBuildRuleParamsBuilder(BuildTarget.builder("//facebook/base","apk").setFlavor("aapt_package").build()).build();
  AaptPackageResources aaptPackageResources=new AaptPackageResources(params,new SourcePathResolver(ruleResolver),new TestSourcePath("facebook/base/AndroidManifest.xml"),resourcesFilter,ImmutableList.<HasAndroidResourceDeps>of(),ImmutableSet.<Path>of(),PackageType.DEBUG,ImmutableSet.<TargetCpuType>of(),DEFAULT_JAVAC,DEFAULT_JAVAC_OPTIONS,false,false);
  AndroidResource resourceOne=(AndroidResource)ruleResolver.getRule(BuildTargetFactory.newInstance("//facebook/base:libraryOne_resources"));
  AndroidResource resourceTwo=(AndroidResource)ruleResolver.getRule(BuildTargetFactory.newInstance("//facebook/base:libraryTwo_resources"));
  Set<Path> assetsDirectories=ImmutableSet.of(resourceOne.getAssets(),resourceTwo.getAssets());
  ImmutableList.Builder<Step> commands=ImmutableList.builder();
  FakeProjectFilesystem filesystem=new FakeProjectFilesystem();
  filesystem.touch(Paths.get("facebook/base/assets1/guava-10.0.1-fork.dex.1.jar"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/Theinhardt-Medium.otf"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/Theinhardt-Regular.otf"));
  filesystem.touch(Paths.get("facebook/base/assets1/fonts/.svn"));
  filesystem.touch(Paths.get("facebook/base/assets1/fonts/.git"));
  filesystem.touch(Paths.get("facebook/base/assets1/fonts/.DS_Store"));
  filesystem.touch(Paths.get("facebook/base/assets1/fonts/Something.scc"));
  filesystem.touch(Paths.get("facebook/base/assets1/fonts/CVS"));
  filesystem.touch(Paths.get("facebook/base/assets1/fonts/thumbs.db"));
  filesystem.touch(Paths.get("facebook/base/assets1/fonts/picasa.ini"));
  filesystem.touch(Paths.get("facebook/base/assets1/fonts/something~"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/.svn"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/.git"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/.DS_Store"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/Something.scc"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/CVS"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/thumbs.db"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/picasa.ini"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/something~"));
  Optional<Path> allAssetsDirectory=aaptPackageResources.createAllAssetsDirectory(assetsDirectories,commands,filesystem);
  EasyMock.verify(resourcesFilter);
  assertTrue(allAssetsDirectory.isPresent());
  assertEquals(BIN_PATH.resolve("facebook/base/__assets_apk#aapt_package__"),allAssetsDirectory.get());
  List<? extends Step> observedCommands=commands.build();
  assertEquals(4,observedCommands.size());
  assertEquals(new MakeCleanDirectoryStep(BIN_PATH.resolve("facebook/base/__assets_apk#aapt_package__")),observedCommands.get(0));
  ImmutableSet<Step> remainingCommands=ImmutableSet.copyOf(observedCommands.subList(1,4));
  MoreAsserts.assertSetEquals(ImmutableSet.<Step>of(new MkdirAndSymlinkFileStep(Paths.get("facebook/base/assets1/guava-10.0.1-fork.dex.1.jar"),BIN_PATH.resolve("facebook/base/__assets_apk#aapt_package__/guava-10.0.1-fork.dex.1.jar")),new MkdirAndSymlinkFileStep(Paths.get("facebook/base/assets2/fonts/Theinhardt-Medium.otf"),BIN_PATH.resolve("facebook/base/__assets_apk#aapt_package__/fonts/Theinhardt-Medium.otf")),new MkdirAndSymlinkFileStep(Paths.get("facebook/base/assets2/fonts/Theinhardt-Regular.otf"),BIN_PATH.resolve("facebook/base/__assets_apk#aapt_package__/fonts/Theinhardt-Regular.otf"))),remainingCommands);
}
