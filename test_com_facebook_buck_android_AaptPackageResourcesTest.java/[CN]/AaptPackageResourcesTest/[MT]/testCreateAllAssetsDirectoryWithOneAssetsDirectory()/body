{
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  SourcePathResolver pathResolver=new SourcePathResolver(ruleResolver);
  AndroidBinaryTest.createAndroidLibraryRule("//java/src/com/facebook/base:libraryOne",ruleResolver,null,null,null);
  AndroidBinaryTest.createAndroidLibraryRule("//java/src/com/facebook/base:libraryTwo",ruleResolver,null,"java/src/com/facebook/base/assets2",null);
  ResourcesFilter resourcesFilter=EasyMock.createMock(ResourcesFilter.class);
  EasyMock.replay(resourcesFilter);
  AndroidResource resourceOne=(AndroidResource)ruleResolver.getRule(BuildTargetFactory.newInstance("//java/src/com/facebook/base:libraryTwo_resources"));
  BuildRuleParams params=new FakeBuildRuleParamsBuilder("//java/src/com/facebook/base:apk#aapt_package").build();
  AaptPackageResources aaptPackageResources=new AaptPackageResources(params,new SourcePathResolver(ruleResolver),new TestSourcePath("java/src/com/facebook/base/AndroidManifest.xml"),resourcesFilter,ImmutableList.<HasAndroidResourceDeps>of(),ImmutableSet.<SourcePath>of(),PackageType.DEBUG,DEFAULT_JAVAC_OPTIONS,false,false,false);
  Set<SourcePath> assetsDirectories=ImmutableSet.of(resourceOne.getAssets());
  ImmutableList.Builder<Step> commands=ImmutableList.builder();
  FakeProjectFilesystem filesystem=new FakeProjectFilesystem();
  filesystem.touch(Paths.get("java/src/com/facebook/base/assets2/fonts/Theinhardt-Medium.otf"));
  filesystem.touch(Paths.get("java/src/com/facebook/base/assets2/fonts/Theinhardt-Regular.otf"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/.gitkeep"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/.svn"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/.git"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/.DS_Store"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/Something.scc"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/CVS"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/thumbs.db"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/picasa.ini"));
  filesystem.touch(Paths.get("facebook/base/assets2/fonts/something~"));
  Optional<Path> allAssetsDirectory=aaptPackageResources.createAllAssetsDirectory(ImmutableSet.copyOf(pathResolver.deprecatedAllPaths(assetsDirectories)),commands,filesystem);
  EasyMock.verify(resourcesFilter);
  assertTrue(allAssetsDirectory.isPresent());
  assertEquals("Even though there is only one assets directory, the one in " + SCRATCH_DIR + " should be used.",aaptPackageResources.getPathToAllAssetsDirectory(),allAssetsDirectory.get());
}
