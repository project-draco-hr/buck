{
  BuildRule installableApk=resolver.getRule(args.apk);
  if (!(installableApk instanceof InstallableApk)) {
    throw new HumanReadableException("The 'apk' argument of %s, %s, must correspond to an " + "installable rule, such as android_binary() or apk_genrule().",params.getBuildTarget(),args.apk.getFullyQualifiedName());
  }
  ImmutableList<SourcePath> srcs=args.srcs.get();
  ImmutableSortedSet<BuildRule> extraDeps=ImmutableSortedSet.<BuildRule>naturalOrder().addAll(SourcePaths.filterBuildRuleInputs(srcs)).add(installableApk).build();
  return new ApkGenrule(params.copyWithExtraDeps(extraDeps),new SourcePathResolver(resolver),srcs,args.cmd,args.bash,args.cmdExe,params.getPathAbsolutifier(),(InstallableApk)installableApk);
}
