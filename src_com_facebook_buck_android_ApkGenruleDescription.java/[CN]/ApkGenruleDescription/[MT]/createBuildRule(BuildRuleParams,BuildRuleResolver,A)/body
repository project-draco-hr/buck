{
  BuildRule installableApk=resolver.getRule(args.apk);
  if (!(installableApk instanceof InstallableApk)) {
    throw new HumanReadableException("The 'apk' argument of %s, %s, must correspond to an " + "installable rule, such as android_binary() or apk_genrule().",params.getBuildTarget(),args.apk.getFullyQualifiedName());
  }
  SourcePathResolver pathResolver=new SourcePathResolver(resolver);
  ImmutableList<SourcePath> srcs=args.srcs.get();
  ImmutableSortedSet<BuildRule> extraDeps=ImmutableSortedSet.<BuildRule>naturalOrder().addAll(pathResolver.filterBuildRuleInputs(srcs)).add(installableApk).build();
  return new ApkGenrule(params.copyWithExtraDeps(Suppliers.ofInstance(extraDeps)).appendExtraDeps(findExtraDepsFromArgs(params.getBuildTarget(),resolver,args)),pathResolver,srcs,MACRO_HANDLER.getExpander(params.getBuildTarget(),resolver,params.getProjectFilesystem()),args.cmd,args.bash,args.cmdExe,params.getPathAbsolutifier(),(InstallableApk)installableApk);
}
