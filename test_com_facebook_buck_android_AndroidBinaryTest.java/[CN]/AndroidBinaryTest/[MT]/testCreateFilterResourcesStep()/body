{
  BuildRuleResolver resolver=new BuildRuleResolver();
  BuildRule keystoreRule=addKeystoreRule(resolver);
  AndroidBinaryBuilder.Builder builder=AndroidBinaryBuilder.newBuilder().setBuildTarget(BuildTargetFactory.newInstance("//:target")).setManifest(new TestSourcePath("AndroidManifest.xml")).setKeystore((Keystore)keystoreRule.getBuildable()).setTarget("Google Inc:Google APIs:16").setResourceFilter(new ResourceFilter(ImmutableList.<String>of("mdpi"))).setResourceCompressionMode(ResourceCompressionMode.ENABLED_WITH_STRINGS_AS_ASSETS);
  AndroidBinary buildRule=(AndroidBinary)builder.build(resolver).getBuildable();
  buildRule.getEnhancedDeps(resolver,ImmutableSortedSet.<BuildRule>of(),ImmutableSortedSet.of(keystoreRule));
  ImmutableList<Path> resourceDirectories=ImmutableList.of(Paths.get("one"),Paths.get("two"));
  assertTrue(buildRule.getFilteredResourcesProvider() instanceof ResourcesFilter);
  ImmutableList.Builder<Path> filteredDirs=ImmutableList.builder();
  ((ResourcesFilter)buildRule.getFilteredResourcesProvider()).createFilterResourcesStep(resourceDirectories,ImmutableSet.<Path>of(),filteredDirs);
  assertEquals(ImmutableList.of(Paths.get("buck-out/bin/__filtered__target#resources_filter__/0"),Paths.get("buck-out/bin/__filtered__target#resources_filter__/1")),filteredDirs.build());
}
