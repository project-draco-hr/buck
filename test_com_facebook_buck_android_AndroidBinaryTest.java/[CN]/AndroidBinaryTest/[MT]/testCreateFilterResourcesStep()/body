{
  BuildRuleResolver resolver=new BuildRuleResolver();
  BuildRule keystoreRule=addKeystoreRule(resolver);
  AndroidBinaryBuilder builder=AndroidBinaryBuilder.createBuilder(BuildTargetFactory.newInstance("//:target")).setManifest(new TestSourcePath("AndroidManifest.xml")).setKeystore(keystoreRule.getBuildTarget()).setTarget("Google Inc:Google APIs:16").setResourceFilter(new ResourceFilter(ImmutableList.<String>of("mdpi"))).setResourceCompressionMode(ResourceCompressionMode.ENABLED_WITH_STRINGS_AS_ASSETS);
  AndroidBinary buildRule=(AndroidBinary)builder.build(resolver);
  ImmutableList<Path> resourceDirectories=ImmutableList.of(Paths.get("one"),Paths.get("two"));
  FilteredResourcesProvider resourcesProvider=buildRule.getEnhancementResult().getAaptPackageResources().getFilteredResourcesProvider();
  assertTrue(resourcesProvider instanceof ResourcesFilter);
  ImmutableList.Builder<Path> filteredDirs=ImmutableList.builder();
  ((ResourcesFilter)resourcesProvider).createFilterResourcesStep(resourceDirectories,ImmutableSet.<Path>of(),ImmutableSet.<String>of(),filteredDirs);
  assertEquals(ImmutableList.of(Paths.get("buck-out/bin/__filtered__target#resources_filter__/0"),Paths.get("buck-out/bin/__filtered__target#resources_filter__/1")),filteredDirs.build());
}
