{
  BuildRuleResolver resolver=new BuildRuleResolver();
  BuildRule keystoreRule=addKeystoreRule(resolver);
  AndroidBinaryBuilder.Builder builder=AndroidBinaryBuilder.newBuilder().setBuildTarget(BuildTargetFactory.newInstance("//:target")).setManifest(new TestSourcePath("AndroidManifest.xml")).setKeystore((Keystore)keystoreRule.getBuildable()).setTarget("Google Inc:Google APIs:16").setResourceFilter(new ResourceFilter(ImmutableList.<String>of("mdpi"))).setResourceCompressionMode(ResourceCompressionMode.ENABLED_WITH_STRINGS_AS_ASSETS);
  AndroidBinary buildRule=(AndroidBinary)builder.build(resolver).getBuildable();
  buildRule.getEnhancedDeps(resolver,ImmutableSortedSet.<BuildRule>of(),ImmutableSortedSet.of(keystoreRule));
  Set<Path> resourceDirectories=ImmutableSet.of(Paths.get("one"),Paths.get("two"));
  assertTrue(buildRule.getFilteredResourcesProvider() instanceof ResourcesFilter);
  FilterResourcesStep filterResourcesStep=((ResourcesFilter)buildRule.getFilteredResourcesProvider()).createFilterResourcesStep(resourceDirectories,ImmutableSet.<Path>of());
  assertEquals(ImmutableSet.of(Paths.get("buck-out/bin/__filtered__target#resources_filter__/0"),Paths.get("buck-out/bin/__filtered__target#resources_filter__/1")),filterResourcesStep.getOutputResourceDirs());
}
