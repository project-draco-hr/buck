{
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  BuildRule libraryOne=createAndroidLibraryRule("//java/src/com/facebook/base:libraryOne",ruleResolver,null,null,null);
  BuildRule libraryOneRule=ruleResolver.get(libraryOne.getBuildTarget());
  BuildRule libraryTwo=createAndroidLibraryRule("//java/src/com/facebook/base:libraryTwo",ruleResolver,null,null,null);
  BuildRule libraryTwoRule=ruleResolver.get(libraryTwo.getBuildTarget());
  BuildTarget binaryBuildTarget=BuildTargetFactory.newInstance("//java/src/com/facebook/base:apk");
  ImmutableSortedSet<BuildRule> originalDeps=ImmutableSortedSet.of(libraryOneRule,libraryTwoRule);
  BuildRule keystoreRule=addKeystoreRule(ruleResolver);
  BuildRule androidBinaryRule=AndroidBinaryBuilder.newBuilder().setBuildTarget(binaryBuildTarget).setOriginalDeps(originalDeps).setBuildTargetsToExcludeFromDex(ImmutableSet.of(BuildTargetFactory.newInstance("//java/src/com/facebook/base:libraryTwo"))).setManifest(new TestSourcePath("java/src/com/facebook/base/AndroidManifest.xml")).setTarget("Google Inc.:Google APIs:16").setKeystore((Keystore)keystoreRule.getBuildable()).build(ruleResolver);
  AndroidBinary androidBinary=(AndroidBinary)androidBinaryRule.getBuildable();
  androidBinary.getEnhancedDeps(ruleResolver,originalDeps,ImmutableSortedSet.of(keystoreRule));
  AndroidTransitiveDependencies transitiveDependencies=androidBinary.findTransitiveDependencies();
  AndroidDexTransitiveDependencies dexTransitiveDependencies=androidBinary.findDexTransitiveDependencies();
  ImmutableList.Builder<Step> commands=ImmutableList.builder();
  FakeBuildableContext buildableContext=new FakeBuildableContext();
  androidBinary.addProguardCommands(dexTransitiveDependencies.classpathEntriesToDex,transitiveDependencies.proguardConfigs,commands,ImmutableSet.<Path>of(),buildableContext);
  ImmutableSet<Path> expectedRecordedArtifacts=ImmutableSet.of(Paths.get("buck-out/gen/java/src/com/facebook/base/.proguard/apk/configuration.txt"),Paths.get("buck-out/gen/java/src/com/facebook/base/.proguard/apk/mapping.txt"));
  assertEquals(expectedRecordedArtifacts,buildableContext.getRecordedArtifacts());
  buildableContext=new FakeBuildableContext();
  MakeCleanDirectoryStep expectedClean=new MakeCleanDirectoryStep(Paths.get("buck-out/gen/java/src/com/facebook/base/.proguard/apk"));
  GenProGuardConfigStep expectedGenProguard=new GenProGuardConfigStep(Paths.get("buck-out/bin/java/src/com/facebook/base/" + "__manifest_apk#aapt_package__/AndroidManifest.xml"),ImmutableSet.<Path>of(),Paths.get("buck-out/gen/java/src/com/facebook/base/.proguard/apk/proguard.txt"),Optional.<Path>absent());
  Step expectedObfuscation=ProGuardObfuscateStep.create(Optional.<Path>absent(),Paths.get("buck-out/gen/java/src/com/facebook/base/.proguard/apk/proguard.txt"),ImmutableSet.<Path>of(),false,Optional.<Integer>absent(),ImmutableMap.of(Paths.get("buck-out/gen/java/src/com/facebook/base/lib__libraryOne__output/libraryOne.jar"),Paths.get("buck-out/gen/java/src/com/facebook/base/.proguard/apk/buck-out/gen/" + "java/src/com/facebook/base/lib__libraryOne__output/libraryOne-obfuscated.jar")),ImmutableSet.of(Paths.get("buck-out/gen/java/src/com/facebook/base/lib__libraryTwo__output/libraryTwo.jar")),Paths.get("buck-out/gen/java/src/com/facebook/base/.proguard/apk"),buildableContext);
  assertEquals(ImmutableList.of(expectedClean,expectedGenProguard,expectedObfuscation),commands.build());
  assertEquals(expectedRecordedArtifacts,buildableContext.getRecordedArtifacts());
}
