{
  NativeLinkable a=new Node("//:a",ImmutableList.<NativeLinkable>of(),ImmutableList.<NativeLinkable>of(),NativeLinkable.Linkage.STATIC);
  NativeLinkable b=new Node("//:b");
  SharedNativeLinkTarget root=new Root("//:root",ImmutableList.of(a,b));
  Omnibus.OmnibusSpec spec=Omnibus.buildSpec(CxxPlatformUtils.DEFAULT_PLATFORM,ImmutableList.of(root),ImmutableList.<NativeLinkable>of());
  assertThat(spec.getGraph().getNodes(),Matchers.containsInAnyOrder(b.getBuildTarget()));
  assertThat(spec.getBody().keySet(),Matchers.containsInAnyOrder(b.getBuildTarget()));
  assertThat(spec.getRoots().keySet(),Matchers.containsInAnyOrder(root.getBuildTarget()));
  assertThat(spec.getDeps().keySet(),Matchers.<BuildTarget>empty());
  assertThat(spec.getExcluded().keySet(),Matchers.<BuildTarget>empty());
  BuildRuleResolver resolver=new BuildRuleResolver(TargetGraph.EMPTY,new DefaultTargetNodeToBuildRuleTransformer());
  SourcePathResolver pathResolver=new SourcePathResolver(resolver);
  ImmutableMap<String,SourcePath> libs=toSonameMap(Omnibus.getSharedLibraries(new FakeBuildRuleParamsBuilder(BuildTargetFactory.newInstance("//:rule")).build(),resolver,pathResolver,CxxPlatformUtils.DEFAULT_CONFIG,CxxPlatformUtils.DEFAULT_PLATFORM,ImmutableList.<Arg>of(),ImmutableList.of(root),ImmutableList.<NativeLinkable>of()));
  assertThat(libs.keySet(),Matchers.containsInAnyOrder(root.getBuildTarget().toString(),"libomnibus.so"));
  assertCxxLinkContainsNativeLinkableInput(getCxxLinkRule(pathResolver,libs.get(root.getBuildTarget().toString())),root.getSharedNativeLinkTargetInput(CxxPlatformUtils.DEFAULT_PLATFORM),a.getNativeLinkableInput(CxxPlatformUtils.DEFAULT_PLATFORM,Linker.LinkableDepType.STATIC_PIC));
  assertCxxLinkContainsNativeLinkableInput(getCxxLinkRule(pathResolver,libs.get("libomnibus.so")),b.getNativeLinkableInput(CxxPlatformUtils.DEFAULT_PLATFORM,Linker.LinkableDepType.STATIC_PIC));
}
