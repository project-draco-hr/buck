{
  ImmutableSet.Builder<IjFolder> mergedFoldersBuilder=ImmutableSet.builder();
  ImmutableSet.Builder<IjFolder> foldersToMergeBuilder=ImmutableSet.builder();
  for (  IjFolder folder : folders) {
    if (!MERGABLE_FOLDER_TYPES.contains(folder.getType())) {
      mergedFoldersBuilder.add(folder);
    }
 else {
      foldersToMergeBuilder.add(folder);
    }
  }
  ImmutableSet<IjFolder> foldersToMerge=foldersToMergeBuilder.build();
  PackagePathCache packagePathCache=new PackagePathCache(foldersToMerge,javaPackageFinder);
  BottomUpPathMerger walker=new BottomUpPathMerger(foldersToMerge,limit.getValue(),packagePathCache);
  return mergedFoldersBuilder.addAll(walker.getMergedFolders()).build();
}
