{
  Console console=new Console(Verbosity.ALL,new CapturingPrintStream(),new CapturingPrintStream(),Ansi.withoutTty());
  ProcessExecutor executor=new ProcessExecutor(console);
  final AtomicBoolean called=new AtomicBoolean(false);
  Function<Process,Void> handler=new Function<Process,Void>(){
    @Override public Void apply(    Process input){
      called.set(true);
      return null;
    }
  }
;
  String command="sleep 50";
  if (Platform.detect() == Platform.WINDOWS) {
    command="ping -n 50 0.0.0.0";
  }
  ProcessExecutor.Result result=executor.execute(Runtime.getRuntime().exec(command),ImmutableSet.<ProcessExecutor.Option>builder().build(),Optional.<String>absent(),Optional.of((long)100),Optional.of(handler));
  assertTrue("process was reported as timed out",result.isTimedOut());
  assertTrue("timeOutHandler was called when a timeout was hit",called.get());
}
