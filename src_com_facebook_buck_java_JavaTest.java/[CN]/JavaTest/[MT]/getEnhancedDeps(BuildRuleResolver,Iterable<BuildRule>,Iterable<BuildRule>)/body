{
  ImmutableSet.Builder<BuildRule> sourcesUnderTestBuilder=ImmutableSet.builder();
  for (  BuildTarget target : sourceTargetsUnderTest) {
    BuildRule rule=ruleResolver.get(target);
    if (rule == null) {
      throw new HumanReadableException("Specified source under test for %s is not among its dependencies: %s",getBuildTarget().getFullyQualifiedName(),target);
    }
    if (rule.getBuildable() instanceof JavaLibrary) {
      sourcesUnderTestBuilder.add(rule);
    }
 else {
      throw new HumanReadableException("Specified source under test for %s is not a Java library: %s (%s).",getBuildTarget().getFullyQualifiedName(),rule.getFullyQualifiedName(),rule.getType().getName());
    }
  }
  sourceUnderTest=sourcesUnderTestBuilder.build();
  return ImmutableSortedSet.<BuildRule>naturalOrder().addAll(deps).addAll(inferredDeps).build();
}
