{
  Map<TestRule,TestResults> result=Maps.newHashMap();
  TestResults ourTestResults=Preconditions.checkNotNull(allTestResults.get(ourTestRule));
  result.put(ourTestRule,ourTestResults);
  int failedDepsCount=0;
  Set<TestRule> dependentTestRules=getDependentTestRules(ourTestRule);
  for (  TestRule dependentTestRule : dependentTestRules) {
    TestResults dependentTestResults=allTestResults.get(dependentTestRule);
    if (dependentTestResults == null) {
      return ImmutableMap.of();
    }
 else {
      if (!dependentTestResults.isSuccess()) {
        failedDepsCount++;
      }
      result.put(dependentTestRule,dependentTestResults);
    }
  }
  ourTestResults.setDependenciesPassTheirTests(failedDepsCount == 0);
  return result;
}
