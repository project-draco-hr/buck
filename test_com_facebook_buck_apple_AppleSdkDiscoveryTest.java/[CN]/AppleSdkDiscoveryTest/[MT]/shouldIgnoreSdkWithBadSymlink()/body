{
  Path root=temp.newFolder().toPath();
  File toDelete=File.createTempFile("foo","bar");
  Path symlink=root.resolve("Platforms/Foo.platform/Developer/NonExistent1.0.sdk");
  Files.createDirectories(symlink.getParent());
  Files.createSymbolicLink(symlink,toDelete.toPath());
  assertTrue(toDelete.delete());
  ImmutableMap<String,Path> toolchainPaths=ImmutableMap.of("com.apple.dt.toolchain.XcodeDefault",root.resolve("Toolchains/XcodeDefault"));
  ImmutableMap<AppleSdk,AppleSdkPaths> sdks=AppleSdkDiscovery.discoverAppleSdkPaths(root,toolchainPaths);
  assertEquals(0,sdks.size());
}
