{
  Path dirPath=null;
  if (localProperties.isPresent()) {
    String propertyValue=localProperties.get().getProperty(propertyName);
    if (propertyValue != null) {
      dirPath=Paths.get(propertyValue);
    }
  }
  String dirPathEnvironmentVariable=null;
  for (  String environmentVariable : environmentVariables) {
    if (dirPath == null) {
      String environmentVariableValue=systemEnvironment.get(environmentVariable);
      if (environmentVariableValue != null) {
        dirPath=Paths.get(environmentVariableValue);
        dirPathEnvironmentVariable=environmentVariable;
      }
    }
 else {
      break;
    }
  }
  if (dirPath == null) {
    return Optional.absent();
  }
 else {
    if (!hostFilesystem.isDirectory(dirPath)) {
      String message;
      if (dirPathEnvironmentVariable != null) {
        message=String.format("Environment variable %s points to invalid path [%s].",dirPathEnvironmentVariable,dirPath);
      }
 else {
        message=String.format("Properties file %s contains invalid path [%s] for key %s.",LOCAL_PROPERTIES_PATH,dirPath,propertyName);
      }
      throw new RuntimeException(message);
    }
    return Optional.of(dirPath);
  }
}
