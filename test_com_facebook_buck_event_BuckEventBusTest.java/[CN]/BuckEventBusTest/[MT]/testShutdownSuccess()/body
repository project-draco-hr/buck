{
  BuckEventBus eb=new BuckEventBus(new DefaultClock(),MoreExecutors.newSingleThreadExecutor(BuckEventBus.class.getSimpleName()),BuckEventBusFactory.BUILD_ID_FOR_TEST,timeoutMillis);
  eb.register(new SleepSubscriber());
  eb.post(new SleepEvent(1));
  long start=System.nanoTime();
  try {
    eb.close();
  }
 catch (  ShutdownException e) {
    fail("Bus should shut down successfully.");
  }
  long durationNanos=System.nanoTime() - start;
  long durationMillis=TimeUnit.MILLISECONDS.convert(durationNanos,TimeUnit.NANOSECONDS);
  assertThat("Shutdown should not take a long time.",durationMillis,lessThanOrEqualTo((long)timeoutMillis));
}
