{
  ImmutableList.Builder<GroupedSource> sources=ImmutableList.builder();
  ImmutableMap.Builder<SourcePath,String> perFileCompileFlags=ImmutableMap.builder();
  ImmutableList<AppleSource> input=ImmutableList.of(AppleSource.ofSourceGroup(new Pair<>("Group1",ImmutableList.of(AppleSource.ofSourcePath(new FileSourcePath("foo.m")),AppleSource.ofSourcePathWithFlags(new Pair<SourcePath,String>(new FileSourcePath("bar.m"),"-Wall"))))),AppleSource.ofSourceGroup(new Pair<>("Group2",ImmutableList.of(AppleSource.ofSourcePath(new FileSourcePath("baz.m")),AppleSource.ofSourcePathWithFlags(new Pair<SourcePath,String>(new FileSourcePath("blech.m"),"-fobjc-arc"))))));
  RuleUtils.extractSourcePaths(sources,perFileCompileFlags,input);
  assertEquals(ImmutableList.<GroupedSource>of(GroupedSource.ofSourceGroup("Group1",ImmutableList.of(GroupedSource.ofSourcePath(new FileSourcePath("foo.m")),GroupedSource.ofSourcePath(new FileSourcePath("bar.m")))),GroupedSource.ofSourceGroup("Group2",ImmutableList.of(GroupedSource.ofSourcePath(new FileSourcePath("baz.m")),GroupedSource.ofSourcePath(new FileSourcePath("blech.m"))))),sources.build());
  assertEquals(ImmutableMap.<SourcePath,String>of(new FileSourcePath("bar.m"),"-Wall",new FileSourcePath("blech.m"),"-fobjc-arc"),perFileCompileFlags.build());
}
