{
  ProjectFilesystem filesystem=context.getProjectFilesystem();
  Filters.Density targetDensity=Filters.Density.ORDERING.max(targetDensities);
  for (  Path drawable : drawableFinder.findDrawables(inResDirToOutResDirMap.values())) {
    if (drawable.toString().endsWith(".9.png")) {
      continue;
    }
    Filters.Qualifiers qualifiers=new Filters.Qualifiers(drawable);
    Filters.Density density=qualifiers.density;
    if (!targetDensities.contains(density)) {
      String fromDensity=(density == Density.NO_QUALIFIER ? "" : "-") + density.toString();
      Path destination=Paths.get(drawable.toString().replaceFirst("((?:^|/)drawable[^/]*)" + Pattern.quote(fromDensity) + "(-|$|/)","$1-" + targetDensity + "$2"));
      double factor=targetDensity.value() / density.value();
      if (factor >= 1.0) {
        continue;
      }
      filesystem.createParentDirs(destination);
      imageScaler.scale(factor,drawable,destination,context);
      if (!filesystem.deleteFileAtPath(drawable)) {
        throw new HumanReadableException("Cannot delete file: " + drawable);
      }
      Path parent=drawable.getParent();
      if (filesystem.listFiles(parent).length == 0 && !filesystem.deleteFileAtPath(parent)) {
        throw new HumanReadableException("Cannot delete directory: " + parent);
      }
    }
  }
}
