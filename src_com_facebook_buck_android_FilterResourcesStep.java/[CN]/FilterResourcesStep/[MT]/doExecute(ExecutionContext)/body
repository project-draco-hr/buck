{
  List<Predicate<Path>> pathPredicates=Lists.newArrayList();
  boolean canDownscale=imageScaler != null && imageScaler.isAvailable(context);
  LOG.info("FilterResourcesStep: canDownscale: %s. imageScalar non-null: %s.",canDownscale,imageScaler != null);
  if (filterDrawables) {
    Preconditions.checkNotNull(drawableFinder);
    Set<Path> drawables=drawableFinder.findDrawables(inResDirToOutResDirMap.keySet(),context.getProjectFilesystem());
    pathPredicates.add(Filters.createImageDensityFilter(drawables,targetDensities,canDownscale));
  }
  if (!locales.isEmpty()) {
    pathPredicates.add(new Predicate<Path>(){
      @Override public boolean apply(      Path input){
        Matcher matcher=VALUES_DIR_PATTERN.matcher(MorePaths.pathWithUnixSeparators(input));
        if (!matcher.matches() || isPathWhitelisted(input)) {
          return true;
        }
        String locale=matcher.group(1);
        if (matcher.group(2) != null) {
          locale+="_" + matcher.group(2);
        }
        return locales.contains(locale);
      }
    }
);
  }
  if (filterStrings) {
    pathPredicates.add(new Predicate<Path>(){
      @Override public boolean apply(      Path pathRelativeToProjectRoot){
        if (!NON_ENGLISH_STRINGS_FILE_PATH.matcher(MorePaths.pathWithUnixSeparators(pathRelativeToProjectRoot)).matches()) {
          return true;
        }
        return isPathWhitelisted(pathRelativeToProjectRoot);
      }
    }
);
  }
  filteredDirectoryCopier.copyDirs(context.getProjectFilesystem(),inResDirToOutResDirMap,Predicates.and(pathPredicates));
  if (canDownscale && filterDrawables) {
    scaleUnmatchedDrawables(context);
  }
  return 0;
}
