{
  Preconditions.checkState(root.isDirectory(),"Must be a directory: %s",root);
  final Path rootPath=root.toPath();
  FileVisitor<Path> visitor=new FileVisitor<Path>(){
    @Override public FileVisitResult preVisitDirectory(    Path dir,    BasicFileAttributes attrs) throws IOException {
      if (ignorePaths.contains(rootPath.relativize(dir))) {
        return FileVisitResult.SKIP_SUBTREE;
      }
 else {
        return FileVisitResult.CONTINUE;
      }
    }
    @Override public FileVisitResult visitFile(    Path file,    BasicFileAttributes attrs) throws IOException {
      visit(file.toFile(),rootPath.relativize(file).toString());
      return FileVisitResult.CONTINUE;
    }
    @Override public FileVisitResult visitFileFailed(    Path file,    IOException exc) throws IOException {
      return FileVisitResult.CONTINUE;
    }
    @Override public FileVisitResult postVisitDirectory(    Path dir,    IOException exc) throws IOException {
      return FileVisitResult.CONTINUE;
    }
  }
;
  Files.walkFileTree(rootPath,EnumSet.of(FileVisitOption.FOLLOW_LINKS),Integer.MAX_VALUE,visitor);
}
