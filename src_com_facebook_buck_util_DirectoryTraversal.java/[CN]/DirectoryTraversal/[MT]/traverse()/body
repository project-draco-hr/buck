{
  Preconditions.checkState(root.isDirectory(),"Must be a directory: %s",root);
  Deque<DirectoryWithRelativePath> directoriesToVisit=new ArrayDeque<DirectoryWithRelativePath>();
  directoriesToVisit.add(new DirectoryWithRelativePath(root,""));
  while (!directoriesToVisit.isEmpty()) {
    DirectoryWithRelativePath directoryWithRelativePath=directoriesToVisit.pop();
    String relativePath=directoryWithRelativePath.relativePath;
    for (    File entry : directoryWithRelativePath.directory.listFiles()) {
      if (entry.isDirectory()) {
        String directoryPath=relativePath + (relativePath.isEmpty() ? "" : "/") + entry.getName();
        if (!ignorePaths.contains(directoryPath)) {
          directoriesToVisit.push(new DirectoryWithRelativePath(entry,directoryPath));
        }
      }
 else {
        visit(entry,relativePath + (relativePath.isEmpty() ? "" : "/") + entry.getName());
      }
    }
  }
}
