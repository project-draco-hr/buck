{
  ImmutableSortedSet.Builder<TestRule> builder=ImmutableSortedSet.naturalOrder();
  List<String> allTargets=options.getArgumentsFormattedAsBuildTargets();
  for (  TestRule rule : testRules) {
    if (allTargets.contains(rule.getFullyQualifiedName())) {
      builder.add(rule);
    }
  }
  builder.addAll(Iterables.filter(testRules,new Predicate<TestRule>(){
    @Override public boolean apply(    TestRule rule){
      return options.isMatchedByLabelOptions(rule.getLabels());
    }
  }
));
  return builder.build();
}
