{
  ImmutableSortedSet.Builder<TestRule> builder=ImmutableSortedSet.orderedBy(new Comparator<TestRule>(){
    @Override public int compare(    TestRule o1,    TestRule o2){
      return o1.getBuildTarget().getFullyQualifiedName().compareTo(o2.getBuildTarget().getFullyQualifiedName());
    }
  }
);
  if (!options.shouldExcludeWin()) {
    ImmutableSet<String> allTargets=options.getArgumentsFormattedAsBuildTargets();
    for (    TestRule rule : testRules) {
      if (allTargets.contains(rule.getBuildTarget().getFullyQualifiedName())) {
        builder.add(rule);
      }
    }
  }
  builder.addAll(Iterables.filter(testRules,new Predicate<TestRule>(){
    @Override public boolean apply(    TestRule rule){
      return options.isMatchedByLabelOptions(rule.getLabels());
    }
  }
));
  return builder.build();
}
