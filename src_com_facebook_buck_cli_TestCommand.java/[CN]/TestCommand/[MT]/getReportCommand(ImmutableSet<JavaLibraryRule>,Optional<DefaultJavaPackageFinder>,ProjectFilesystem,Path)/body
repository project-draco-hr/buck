{
  ImmutableSet.Builder<String> srcDirectories=ImmutableSet.builder();
  ImmutableSet.Builder<Path> pathsToClasses=ImmutableSet.builder();
  for (  JavaLibraryRule rule : rulesUnderTest) {
    ImmutableSet<String> sourceFolderPath=getPathToSourceFolders(rule,defaultJavaPackageFinderOptional,projectFilesystem);
    if (!sourceFolderPath.isEmpty()) {
      srcDirectories.addAll(sourceFolderPath);
    }
    Path pathToOutput=rule.getPathToOutputFile();
    if (pathToOutput == null) {
      continue;
    }
    pathsToClasses.add(pathToOutput);
  }
  return new GenerateCodeCoverageReportStep(srcDirectories.build(),pathsToClasses.build(),outputDirectory);
}
