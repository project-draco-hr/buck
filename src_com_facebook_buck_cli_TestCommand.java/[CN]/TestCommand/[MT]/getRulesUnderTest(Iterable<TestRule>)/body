{
  ImmutableSet.Builder<JavaLibrary> rulesUnderTest=ImmutableSet.builder();
  for (  TestRule test : tests) {
    if (test instanceof JavaTest) {
      JavaTest javaTestRule=(JavaTest)test;
      ImmutableSet<BuildRule> sourceUnderTest=javaTestRule.getSourceUnderTest();
      for (      BuildRule buildRule : sourceUnderTest) {
        if (buildRule instanceof JavaLibrary) {
          JavaLibrary javaLibrary=(JavaLibrary)buildRule;
          rulesUnderTest.add(javaLibrary);
        }
 else {
          throw new HumanReadableException("Test '%s' is a java_test() " + "but it is testing module '%s' " + "which is not a java_library()!",test.getBuildTarget(),buildRule.getBuildTarget());
        }
      }
    }
  }
  return rulesUnderTest.build();
}
