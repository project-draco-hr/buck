{
  ImmutableSet.Builder<JavaLibrary> rulesUnderTest=ImmutableSet.builder();
  for (  TestRule test : tests) {
    if (test instanceof JavaTest) {
      JavaTest javaTest=(JavaTest)test;
      ImmutableSet<BuildRule> sourceUnderTest=javaTest.getSourceUnderTest();
      for (      BuildRule buildRule : sourceUnderTest) {
        if (buildRule.getBuildable() instanceof JavaLibrary) {
          JavaLibrary javaLibrary=(JavaLibrary)buildRule.getBuildable();
          rulesUnderTest.add(javaLibrary);
        }
 else {
          throw new HumanReadableException("Test '%s' is a java_test() " + "but it is testing module '%s' " + "which is not a java_library()!",test.getBuildTarget(),buildRule.getBuildTarget());
        }
      }
    }
  }
  return rulesUnderTest.build();
}
