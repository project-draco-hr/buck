{
  ImmutableSet.Builder<JavaLibraryRule> rulesUnderTest=ImmutableSet.builder();
  for (  TestRule test : tests) {
    if (test instanceof JavaTestRule) {
      JavaTestRule javaTestRule=(JavaTestRule)test;
      ImmutableSet<BuildRule> sourceUnderTest=javaTestRule.getSourceUnderTest();
      for (      BuildRule buildRule : sourceUnderTest) {
        if (buildRule instanceof JavaLibraryRule) {
          JavaLibraryRule javaLibraryRule=(JavaLibraryRule)buildRule;
          rulesUnderTest.add(javaLibraryRule);
        }
 else {
          throw new HumanReadableException("Test '%s' is a java_test() " + "but it is testing module '%s' " + "which is not a java_library()!",test.getBuildTarget(),buildRule.getBuildTarget());
        }
      }
    }
  }
  return rulesUnderTest.build();
}
