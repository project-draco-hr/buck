{
  if (resources.isEmpty()) {
    return;
  }
  PBXGroup resourcesGroup=targetGroup.getOrCreateChildGroupByName("Resources");
  PBXBuildPhase phase=new PBXResourcesBuildPhase();
  target.getBuildPhases().add(phase);
  for (  AppleResourceDescription.Arg resource : resources) {
    Iterable<Path> paths=Iterables.concat(sourcePathResolver.getAllPaths(resource.files),resource.dirs);
    for (    Path path : paths) {
      PBXFileReference fileReference=resourcesGroup.getOrCreateFileReferenceBySourceTreePath(new SourceTreePath(PBXReference.SourceTree.SOURCE_ROOT,pathRelativizer.outputDirToRootRelative(path)));
      PBXBuildFile buildFile=new PBXBuildFile(fileReference);
      phase.getFiles().add(buildFile);
    }
    for (    Map.Entry<String,Map<String,SourcePath>> virtualOutputEntry : resource.variants.get().entrySet()) {
      String variantName=Paths.get(virtualOutputEntry.getKey()).getFileName().toString();
      PBXVariantGroup variantGroup=resourcesGroup.getOrCreateChildVariantGroupByName(variantName);
      PBXBuildFile buildFile=new PBXBuildFile(variantGroup);
      phase.getFiles().add(buildFile);
      for (      Map.Entry<String,SourcePath> childVirtualNameEntry : virtualOutputEntry.getValue().entrySet()) {
        SourceTreePath sourceTreePath=new SourceTreePath(PBXReference.SourceTree.SOURCE_ROOT,pathRelativizer.outputPathToSourcePath(childVirtualNameEntry.getValue()));
        variantGroup.getOrCreateVariantFileReferenceByNameAndSourceTreePath(childVirtualNameEntry.getKey(),sourceTreePath);
      }
    }
  }
  LOG.debug("Added resources build phase %s",phase);
}
