{
  if (assetCatalogs.isEmpty()) {
    return;
  }
  PBXGroup resourcesGroup=targetGroup.getOrCreateChildGroupByName("Resources");
  ImmutableList.Builder<String> commonAssetCatalogsBuilder=ImmutableList.builder();
  ImmutableList.Builder<String> assetCatalogsToSplitIntoBundlesBuilder=ImmutableList.builder();
  for (  AppleAssetCatalogDescription.Arg assetCatalog : assetCatalogs) {
    for (    Path dir : assetCatalog.dirs) {
      Path pathRelativeToProjectRoot=pathRelativizer.outputDirToRootRelative(dir);
      resourcesGroup.getOrCreateFileReferenceBySourceTreePath(new SourceTreePath(PBXReference.SourceTree.SOURCE_ROOT,pathRelativeToProjectRoot));
      LOG.debug("Resolved asset catalog path %s, result %s",dir,pathRelativeToProjectRoot);
      String bundlePath="$PROJECT_DIR/" + pathRelativeToProjectRoot.toString();
      if (assetCatalog.getCopyToBundles()) {
        assetCatalogsToSplitIntoBundlesBuilder.add(bundlePath);
      }
 else {
        commonAssetCatalogsBuilder.add(bundlePath);
      }
    }
  }
  ImmutableList<String> commonAssetCatalogs=commonAssetCatalogsBuilder.build();
  ImmutableList<String> assetCatalogsToSplitIntoBundles=assetCatalogsToSplitIntoBundlesBuilder.build();
  Path buildScript=pathRelativizer.outputDirToRootRelative(assetCatalogBuildScript);
  StringBuilder scriptBuilder=new StringBuilder("set -e\n");
  if (commonAssetCatalogs.size() != 0) {
    scriptBuilder.append("\"${PROJECT_DIR}/\"").append(buildScript.toString()).append(" ").append(Joiner.on(' ').join(commonAssetCatalogs)).append("\n");
  }
  if (assetCatalogsToSplitIntoBundles.size() != 0) {
    scriptBuilder.append("\"${PROJECT_DIR}/\"").append(buildScript.toString()).append(" -b ").append(Joiner.on(' ').join(assetCatalogsToSplitIntoBundles)).append("\n");
  }
  PBXShellScriptBuildPhase phase=new PBXShellScriptBuildPhase();
  target.getBuildPhases().add(phase);
  phase.setShellScript(scriptBuilder.toString());
  LOG.debug("Added asset catalog build phase %s",phase);
}
