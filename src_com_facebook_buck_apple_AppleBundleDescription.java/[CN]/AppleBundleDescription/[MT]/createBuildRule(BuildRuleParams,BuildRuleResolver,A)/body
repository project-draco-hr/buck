{
  BuildRule flavoredBinaryRule=getFlavoredBinaryRule(params,resolver,args);
  BuildRuleParams bundleParamsWithFlavoredBinaryDep=getBundleParamsWithFlavoredBinaryDep(params,args.binary,flavoredBinaryRule);
  ImmutableMap.Builder<Path,AppleBundleDestination> bundleDirsBuilder=ImmutableMap.builder();
  ImmutableMap.Builder<SourcePath,AppleBundleDestination> bundleFilesBuilder=ImmutableMap.builder();
  collectBundleDirsAndFiles(params,args,bundleDirsBuilder,bundleFilesBuilder);
  ImmutableMap<Path,AppleBundleDestination> bundleDirs=bundleDirsBuilder.build();
  ImmutableMap<SourcePath,AppleBundleDestination> bundleFiles=bundleFilesBuilder.build();
  return new AppleBundle(bundleParamsWithFlavoredBinaryDep,new SourcePathResolver(resolver),args.extension,args.infoPlist,Optional.of(flavoredBinaryRule),IOS_APP_SUBFOLDER_SPEC_MAP,bundleDirs,bundleFiles);
}
