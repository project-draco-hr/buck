{
  Path outputPath=TestDataHelper.getTestDataDirectory(this).resolve("xctest-output/simple-failure.txt");
  final List<Object> streamedObjects=new ArrayList<>();
  try (Reader outputReader=Files.newBufferedReader(outputPath,StandardCharsets.UTF_8)){
    XctestOutputParsing.streamOutput(outputReader,eventCallbackAddingEventsToList(streamedObjects));
  }
   assertThat(streamedObjects,hasSize(8));
  Iterator<Object> iter=streamedObjects.iterator();
  Object nextStreamedObject;
  nextStreamedObject=iter.next();
  assertThat(nextStreamedObject,instanceOf(XctestOutputParsing.BeginXctestEvent.class));
  nextStreamedObject=iter.next();
  assertThat(nextStreamedObject,instanceOf(XctestOutputParsing.BeginTestSuiteEvent.class));
  XctestOutputParsing.BeginTestSuiteEvent beginTestSuiteEvent1=(XctestOutputParsing.BeginTestSuiteEvent)nextStreamedObject;
  assertThat(beginTestSuiteEvent1.suite,equalTo("Example/ExampleTests.xctest(Tests)"));
  nextStreamedObject=iter.next();
  assertThat(nextStreamedObject,instanceOf(XctestOutputParsing.BeginTestSuiteEvent.class));
  XctestOutputParsing.BeginTestSuiteEvent beginTestSuiteEvent2=(XctestOutputParsing.BeginTestSuiteEvent)nextStreamedObject;
  assertThat(beginTestSuiteEvent2.suite,equalTo("FailureTests"));
  nextStreamedObject=iter.next();
  assertThat(nextStreamedObject,instanceOf(XctestOutputParsing.BeginTestCaseEvent.class));
  XctestOutputParsing.BeginTestCaseEvent beginTestEvent=(XctestOutputParsing.BeginTestCaseEvent)nextStreamedObject;
  assertThat(beginTestEvent.test,equalTo("-[FailureTests testFailure]"));
  assertThat(beginTestEvent.className,equalTo("FailureTests"));
  assertThat(beginTestEvent.methodName,equalTo("testFailure"));
  nextStreamedObject=iter.next();
  assertThat(nextStreamedObject,instanceOf(XctestOutputParsing.EndTestCaseEvent.class));
  XctestOutputParsing.EndTestCaseEvent endTestEvent=(XctestOutputParsing.EndTestCaseEvent)nextStreamedObject;
  assertThat(endTestEvent.totalDuration,closeTo(0.000,EPSILON));
  assertThat(endTestEvent.test,equalTo("-[FailureTests testFailure]"));
  assertThat(endTestEvent.className,equalTo("FailureTests"));
  assertThat(endTestEvent.methodName,equalTo("testFailure"));
  assertThat(endTestEvent.output,equalTo("-- test output --\n"));
  assertThat(endTestEvent.succeeded,is(false));
  assertThat(endTestEvent.exceptions,hasSize(1));
  XctestOutputParsing.TestError testException=endTestEvent.exceptions.get(0);
  assertThat(testException.lineNumber,equalTo(9));
  assertThat(testException.filePathInProject,equalTo("FailureTests.m"));
  assertThat(testException.reason,equalTo("failure reason"));
  nextStreamedObject=iter.next();
  assertThat(nextStreamedObject,instanceOf(XctestOutputParsing.EndTestSuiteEvent.class));
  XctestOutputParsing.EndTestSuiteEvent endTestSuiteEvent2=(XctestOutputParsing.EndTestSuiteEvent)nextStreamedObject;
  assertThat(endTestSuiteEvent2.suite,equalTo("FailureTests"));
  assertThat(endTestSuiteEvent2.testCaseCount,equalTo(0));
  assertThat(endTestSuiteEvent2.totalFailureCount,equalTo(1));
  assertThat(endTestSuiteEvent2.unexpectedExceptionCount,equalTo(0));
  assertThat(endTestSuiteEvent2.testDuration,closeTo(0.012,EPSILON));
  assertThat(endTestSuiteEvent2.totalDuration,closeTo(0.013,EPSILON));
  nextStreamedObject=iter.next();
  assertThat(nextStreamedObject,instanceOf(XctestOutputParsing.EndTestSuiteEvent.class));
  XctestOutputParsing.EndTestSuiteEvent endTestSuiteEvent1=(XctestOutputParsing.EndTestSuiteEvent)nextStreamedObject;
  assertThat(endTestSuiteEvent1.suite,equalTo("Example/ExampleTests.xctest(Tests)"));
  assertThat(endTestSuiteEvent1.testCaseCount,equalTo(0));
  assertThat(endTestSuiteEvent1.totalFailureCount,equalTo(1));
  assertThat(endTestSuiteEvent1.unexpectedExceptionCount,equalTo(0));
  assertThat(endTestSuiteEvent1.testDuration,closeTo(0.012,EPSILON));
  assertThat(endTestSuiteEvent1.totalDuration,closeTo(0.051,EPSILON));
  nextStreamedObject=iter.next();
  assertThat(nextStreamedObject,instanceOf(XctestOutputParsing.EndXctestEvent.class));
}
