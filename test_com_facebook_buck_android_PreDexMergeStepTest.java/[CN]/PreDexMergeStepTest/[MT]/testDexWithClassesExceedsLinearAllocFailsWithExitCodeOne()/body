{
  DexWithClasses dex1=createDexWithClasses("buck-out/gen/dex1.dex.jar",ImmutableSet.of("com/example/Foo"),350);
  PreDexMergeStep preDexMergeStep=createPreDexMergeStep(ImmutableList.of(dex1),300,DexStore.JAR);
  BuckEventBus eventBus=BuckEventBusFactory.newInstance();
  CapturingLogEventListener listener=new BuckEventBusFactory.CapturingLogEventListener();
  eventBus.register(listener);
  ExecutionContext context=TestExecutionContext.newBuilder().setEventBus(eventBus).build();
  int exitCode=preDexMergeStep.execute(context);
  assertEquals(1,exitCode);
  assertEquals(ImmutableList.of("DexWithClasses buck-out/gen/dex1.dex.jar with cost 350 exceeds the max " + "cost 300 for a secondary dex file."),listener.getErrorMessages());
}
