{
  if (!options.shouldShowTransitiveDependencies()) {
    return TargetNodes.getTestTargetsForNode(graph.get(target));
  }
  ProjectGraphParser projectGraphParser=ProjectGraphParsers.createProjectGraphParser(getParser(),new ParserConfig(options.getBuckConfig()),getBuckEventBus(),console,environment,options.getEnableProfiling());
  TargetGraph graphWithTests=TargetGraphTestParsing.expandedTargetGraphToIncludeTestsForTargets(projectGraphParser,graph,ImmutableSet.of(target));
  ImmutableSet<BuildTarget> tests=TargetGraphAndTargets.getExplicitTestTargets(ImmutableSet.of(target),graphWithTests);
  Sets.SetView<BuildTarget> testsWithDependencies=Sets.union(tests,getTransitiveDependencies(tests,graphWithTests));
  return Sets.difference(testsWithDependencies,ImmutableSet.of(target));
}
