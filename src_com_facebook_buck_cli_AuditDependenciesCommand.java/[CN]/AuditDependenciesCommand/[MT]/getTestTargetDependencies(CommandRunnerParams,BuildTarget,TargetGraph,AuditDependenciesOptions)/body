{
  if (!options.shouldShowTransitiveDependencies()) {
    return TargetNodes.getTestTargetsForNode(graph.get(target));
  }
  ProjectGraphParser projectGraphParser=ProjectGraphParsers.createProjectGraphParser(params.getParser(),new ParserConfig(options.getBuckConfig()),params.getBuckEventBus(),params.getConsole(),params.getEnvironment(),options.getEnableProfiling());
  TargetGraph graphWithTests=TargetGraphTestParsing.expandedTargetGraphToIncludeTestsForTargets(projectGraphParser,graph,ImmutableSet.of(target));
  ImmutableSet<BuildTarget> tests=TargetGraphAndTargets.getExplicitTestTargets(ImmutableSet.of(target),graphWithTests);
  Sets.SetView<BuildTarget> testsWithDependencies=Sets.union(tests,getTransitiveDependencies(tests,graphWithTests));
  return Sets.difference(testsWithDependencies,ImmutableSet.of(target));
}
