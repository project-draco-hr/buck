{
  boolean isAllTestsPassed=true;
  ListMultimap<TestResults,TestCaseSummary> failingTests=ArrayListMultimap.create();
  int numFailures=0;
  for (  TestResults summary : completedResults) {
    if (!summary.isSuccess()) {
      isAllTestsPassed=false;
      numFailures+=summary.getFailureCount();
      failingTests.putAll(summary,summary.getFailures());
    }
  }
  if (completedResults.isEmpty()) {
    addTo.add(ansi.asHighlightedFailureText("NO TESTS RAN"));
  }
 else   if (isAllTestsPassed) {
    addTo.add(ansi.asHighlightedSuccessText("TESTS PASSED"));
  }
 else {
    addTo.add(ansi.asHighlightedFailureText(String.format("TESTS FAILED: %d Failures",numFailures)));
    for (    TestResults results : failingTests.keySet()) {
      addTo.add("Failed target: " + results.getBuildTarget().getFullyQualifiedName());
      for (      TestCaseSummary summary : failingTests.get(results)) {
        addTo.add(summary.toString());
      }
    }
  }
}
