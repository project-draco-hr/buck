{
  ImmutableList.Builder<DxPseudoRule> pseudoRules=ImmutableList.builder();
  for (  File outputFile : outputToInputs.keySet()) {
    pseudoRules.add(new DxPseudoRule(context,ImmutableSet.copyOf(Iterables.transform(outputToInputs.get(outputFile),new Function<File,Path>(){
      @Override public Path apply(      File input){
        return input.toPath();
      }
    }
)),outputFile.toPath(),context.getProjectFilesystem().resolve(successDir.resolve(outputFile.getName())),optimizeDex));
  }
  ImmutableList.Builder<Step> commands=ImmutableList.builder();
  for (  DxPseudoRule pseudoRule : pseudoRules.build()) {
    if (!pseudoRule.checkIsCached()) {
      commands.addAll(pseudoRule.buildInternal());
    }
  }
  return commands.build();
}
