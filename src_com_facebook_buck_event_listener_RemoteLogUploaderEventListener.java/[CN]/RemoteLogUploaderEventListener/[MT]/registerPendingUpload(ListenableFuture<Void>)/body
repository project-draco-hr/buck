{
synchronized (pendingUploads) {
    pendingUploads.add(upload);
  }
  Futures.addCallback(upload,new FutureCallback<Void>(){
    @Override public void onSuccess(    Void result){
      failureCount.set(0);
      onDone();
    }
    @Override public void onFailure(    Throwable t){
      onDone();
      LOG.info(t,"Failed uploading event to the remote log.");
      if (failureCount.incrementAndGet() == MAX_FAILURE_COUNT) {
        LOG.info("Maximum number of log upload failures reached, giving up.");
      }
    }
    private void onDone(){
synchronized (pendingUploads) {
        pendingUploads.remove(upload);
      }
    }
  }
);
}
