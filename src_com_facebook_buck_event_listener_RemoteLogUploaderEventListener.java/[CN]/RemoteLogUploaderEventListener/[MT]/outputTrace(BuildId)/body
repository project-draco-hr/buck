{
  ImmutableSet<ListenableFuture<Void>> uploads;
  ListenableFuture<Void> drain=remoteLogger.close();
synchronized (pendingUploads) {
    pendingUploads.add(drain);
    uploads=ImmutableSet.copyOf(pendingUploads);
    pendingUploads.clear();
  }
  try {
    Futures.successfulAsList(uploads).get(BlockingHttpEndpoint.DEFAULT_COMMON_TIMEOUT_MS * 100,TimeUnit.MILLISECONDS);
  }
 catch (  ExecutionException|TimeoutException e) {
    LOG.info(e,"Failed uploading remaining log data to remote server");
  }
}
