{
  ImmutableSetMultimap.Builder<CopyFilePhaseDestinationSpec,TargetNode<?>> ruleByDestinationSpecBuilder=ImmutableSetMultimap.builder();
  for (  TargetNode<?> copiedNode : copiedNodes) {
    Optional<CopyFilePhaseDestinationSpec> optionalDestinationSpec=getDestinationSpec(copiedNode);
    if (optionalDestinationSpec.isPresent()) {
      ruleByDestinationSpecBuilder.put(optionalDestinationSpec.get(),copiedNode);
    }
  }
  ImmutableSetMultimap<CopyFilePhaseDestinationSpec,TargetNode<?>> ruleByDestinationSpec=ruleByDestinationSpecBuilder.build();
  for (  CopyFilePhaseDestinationSpec destinationSpec : ruleByDestinationSpec.keySet()) {
    Iterable<TargetNode<?>> targetNodes=ruleByDestinationSpec.get(destinationSpec);
    generateSingleCopyFilesBuildPhase(target,destinationSpec,targetNodes);
  }
}
