{
  Thread.sleep(1500);
  ApkInspector apkInspector;
  workspace.replaceFileContents("native/fakenative/jni/fakesystem.c","exit(status)","exit(1+status)");
  workspace.resetBuildLogFile();
  workspace.runBuckCommand("build",EXOPACKAGE_TARGET).assertSuccess();
  workspace.getBuildLog().assertTargetBuiltLocally(EXOPACKAGE_TARGET);
  apkInspector=new ApkInspector(workspace.getFile("buck-out/gen/apps/multidex/app-exo.apk"));
  apkInspector.assertFileExists("lib/armeabi/libfakenative.so");
  apkInspector.assertFileDoesNotExist("assets/lib/armeabi/libfakenative.so");
  workspace.replaceFileContents("native/fakenative/jni/BUCK","name = 'fakenative',","name = 'fakenative',\nis_asset=True,");
  workspace.resetBuildLogFile();
  workspace.runBuckCommand("build",EXOPACKAGE_TARGET).assertSuccess();
  workspace.getBuildLog().assertTargetBuiltLocally(EXOPACKAGE_TARGET);
  apkInspector=new ApkInspector(workspace.getFile("buck-out/gen/apps/multidex/app-exo.apk"));
  apkInspector.assertFileDoesNotExist("lib/armeabi/libfakenative.so");
  apkInspector.assertFileExists("assets/lib/armeabi/libfakenative.so");
  Thread.sleep(1500);
  workspace.replaceFileContents("native/fakenative/jni/fakesystem.c","exit(1+status)","exit(2+status)");
  workspace.resetBuildLogFile();
  workspace.runBuckCommand("build",EXOPACKAGE_TARGET).assertSuccess();
  workspace.getBuildLog().assertTargetBuiltLocally(EXOPACKAGE_TARGET);
  apkInspector=new ApkInspector(workspace.getFile("buck-out/gen/apps/multidex/app-exo.apk"));
  apkInspector.assertFileDoesNotExist("lib/armeabi/libfakenative.so");
  apkInspector.assertFileExists("assets/lib/armeabi/libfakenative.so");
}
