{
  Map<String,BuildRule> buildRuleIndex=Maps.newHashMap();
  PrebuiltJarRule guavaRule=PrebuiltJarRule.newPrebuiltJarRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//third_party/guava:guava")).setBinaryJar("third_party/guava/guava-10.0.1.jar").addVisibilityPattern(BuildTargetPattern.MATCH_ALL).setArtifactCache(artifactCache).build(buildRuleIndex);
  buildRuleIndex.put(guavaRule.getFullyQualifiedName(),guavaRule);
  PrebuiltJarRule jsr305Rule=PrebuiltJarRule.newPrebuiltJarRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//third_party/jsr-305:jsr-305")).setBinaryJar("third_party/jsr-305/jsr305.jar").addVisibilityPattern(BuildTargetPattern.MATCH_ALL).setArtifactCache(artifactCache).build(buildRuleIndex);
  buildRuleIndex.put(jsr305Rule.getFullyQualifiedName(),jsr305Rule);
  DefaultJavaLibraryRule libraryRule=DefaultJavaLibraryRule.newJavaLibraryRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//java/src/com/facebook:example")).addDep(guavaRule.getFullyQualifiedName()).addDep(jsr305Rule.getFullyQualifiedName()).setArtifactCache(artifactCache).build(buildRuleIndex);
  buildRuleIndex.put(libraryRule.getFullyQualifiedName(),libraryRule);
  AndroidResourceRule manifestRule=AndroidResourceRule.newAndroidResourceRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//java/src/com/facebook:res")).setManifestFile("java/src/com/facebook/module/AndroidManifest.xml").setAssetsDirectory("assets/").setArtifactCache(artifactCache).build(buildRuleIndex);
  buildRuleIndex.put(manifestRule.getFullyQualifiedName(),manifestRule);
  AndroidBinaryRule binaryRule=AndroidBinaryRule.newAndroidBinaryRuleBuilder().setBuildTarget(BuildTargetFactory.newInstance("//java/src/com/facebook:app")).addDep(libraryRule.getFullyQualifiedName()).addDep(manifestRule.getFullyQualifiedName()).addBuildRuleToExcludeFromDex("//third_party/guava:guava").setManifest("java/src/com/facebook/AndroidManifest.xml").setTarget("Google Inc.:Google APIs:16").setKeystorePropertiesPath("java/src/com/facebook/base/keystore.properties").setArtifactCache(artifactCache).build(buildRuleIndex);
  buildRuleIndex.put(binaryRule.getFullyQualifiedName(),binaryRule);
  DependencyGraph graph=RuleMap.createGraphFromBuildRules(buildRuleIndex);
  AndroidTransitiveDependencies transitiveDeps=binaryRule.findTransitiveDependencies(graph);
  AndroidDexTransitiveDependencies dexTransitiveDeps=binaryRule.findDexTransitiveDependencies(graph);
  assertEquals("Because guava was passed to no_dx, it should not be in the classpathEntriesToDex list",ImmutableSet.of("third_party/jsr-305/jsr305.jar"),dexTransitiveDeps.classpathEntriesToDex);
  assertEquals("Because guava was passed to no_dx, it should not be treated as a third-party JAR whose " + "resources need to be extracted and repacked in the APK. If this is done, then code in " + "the guava-10.0.1.dex.1.jar in the APK's assets/ folder may try to load the resource "+ "from the APK as a ZipFileEntry rather than as a resource within guava-10.0.1.dex.1.jar. "+ "Loading a resource in this way could take substantially longer. Specifically, this was "+ "observed to take over one second longer to load the resource in fb4a. Because the "+ "resource was loaded on startup, this introduced a substantial regression in the startup "+ "time for the fb4a app.",ImmutableSet.of("third_party/jsr-305/jsr305.jar"),dexTransitiveDeps.pathsToThirdPartyJars);
  assertEquals("Because assets directory was passed an AndroidResourceRule it should be added to the " + "transitive dependencies",ImmutableSet.of("assets/"),transitiveDeps.assetsDirectories);
  assertEquals("Because manifest file was passed an AndroidResourceRule it should be added to the " + "transitive dependencies",ImmutableSet.of("java/src/com/facebook/module/AndroidManifest.xml"),transitiveDeps.manifestFiles);
  assertEquals(ImmutableSet.of(),transitiveDeps.nativeLibsDirectories);
}
