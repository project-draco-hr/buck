{
  BuildRuleResolver ruleResolver=new BuildRuleResolver();
  BuildTarget guavaTarget=BuildTargetFactory.newInstance("//third_party/guava:guava");
  BuildRule guavaRule=PrebuiltJarBuilder.createBuilder(guavaTarget).setBinaryJar(Paths.get("third_party/guava/guava-10.0.1.jar")).build(ruleResolver);
  BuildRule jsr305Rule=PrebuiltJarBuilder.createBuilder(BuildTargetFactory.newInstance("//third_party/jsr-305:jsr-305")).setBinaryJar(Paths.get("third_party/jsr-305/jsr305.jar")).build(ruleResolver);
  BuildRule ndkLibrary=NdkLibraryBuilder.createNdkLibrary(BuildTargetFactory.newInstance("//java/com/facebook/native_library:library")).addSrc(Paths.get("Android.mk")).setIsAsset(false).build();
  ruleResolver.addToIndex(ndkLibrary.getBuildTarget(),ndkLibrary);
  BuildTarget prebuiltNativeLibraryTarget=BuildTargetFactory.newInstance("//java/com/facebook/prebuilt_native_library:library");
  BuildRule prebuiltNativeLibraryBuild=PrebuiltNativeLibraryBuilder.newBuilder(prebuiltNativeLibraryTarget).setNativeLibs(Paths.get("/java/com/facebook/prebuilt_native_library/libs")).setIsAsset(true).build();
  ruleResolver.addToIndex(prebuiltNativeLibraryTarget,prebuiltNativeLibraryBuild);
  BuildRule libraryRule=JavaLibraryBuilder.createBuilder(BuildTargetFactory.newInstance("//java/src/com/facebook:example")).addDep(guavaRule).addDep(jsr305Rule).addDep(prebuiltNativeLibraryBuild).addDep(ndkLibrary).build(ruleResolver);
  BuildRule manifestRule=ruleResolver.addToIndex(AndroidResourceRuleBuilder.newBuilder().setBuildTarget(BuildTargetFactory.newInstance("//java/src/com/facebook:res")).setManifest(Paths.get("java/src/com/facebook/module/AndroidManifest.xml")).setAssets(Paths.get("assets")).build());
  BuildTarget keystoreTarget=BuildTargetFactory.newInstance("//keystore:debug");
  BuildRule keystore=KeystoreBuilder.createBuilder(keystoreTarget).setStore(Paths.get("keystore/debug.keystore")).setProperties(Paths.get("keystore/debug.keystore.properties")).build(ruleResolver);
  ImmutableSortedSet<BuildRule> originalDeps=ImmutableSortedSet.of(libraryRule,manifestRule);
  AndroidBinary binaryRule=(AndroidBinary)AndroidBinaryBuilder.newBuilder().setBuildTarget(BuildTargetFactory.newInstance("//java/src/com/facebook:app")).setOriginalDeps(originalDeps).setBuildTargetsToExcludeFromDex(ImmutableSet.of(BuildTargetFactory.newInstance("//third_party/guava:guava"))).setManifest(new TestSourcePath("java/src/com/facebook/AndroidManifest.xml")).setTarget("Google Inc.:Google APIs:16").setKeystore((Keystore)keystore.getBuildable()).build(ruleResolver).getBuildable();
  binaryRule.getEnhancedDeps(ruleResolver,originalDeps,ImmutableSortedSet.of(keystore));
  AndroidTransitiveDependencies transitiveDeps=binaryRule.findTransitiveDependencies();
  AndroidDexTransitiveDependencies dexTransitiveDeps=binaryRule.findDexTransitiveDependencies();
  assertEquals("Because guava was passed to no_dx, it should not be in the classpathEntriesToDex list",ImmutableSet.of(Paths.get("third_party/jsr-305/jsr305.jar")),dexTransitiveDeps.classpathEntriesToDex);
  assertEquals("Because guava was passed to no_dx, it should not be treated as a third-party JAR whose " + "resources need to be extracted and repacked in the APK. If this is done, then code " + "in the guava-10.0.1.dex.1.jar in the APK's assets/ tmp may try to load the resource "+ "from the APK as a ZipFileEntry rather than as a resource within "+ "guava-10.0.1.dex.1.jar. Loading a resource in this way could take substantially "+ "longer. Specifically, this was observed to take over one second longer to load "+ "the resource in fb4a. Because the resource was loaded on startup, this introduced a "+ "substantial regression in the startup time for the fb4a app.",ImmutableSet.of(Paths.get("third_party/jsr-305/jsr305.jar")),dexTransitiveDeps.pathsToThirdPartyJars);
  assertEquals("Because assets directory was passed an AndroidResourceRule it should be added to the " + "transitive dependencies",ImmutableSet.of(Paths.get("assets")),transitiveDeps.assetsDirectories);
  assertEquals("Because manifest file was passed an AndroidResourceRule it should be added to the " + "transitive dependencies",ImmutableSet.of(Paths.get("java/src/com/facebook/module/AndroidManifest.xml")),transitiveDeps.manifestFiles);
  assertEquals("Because a native library was declared as a dependency, it should be added to the " + "transitive dependencies.",ImmutableSet.of(((NativeLibraryBuildable)ndkLibrary.getBuildable()).getLibraryPath()),transitiveDeps.nativeLibsDirectories);
  assertEquals("Because a prebuilt native library  was declared as a dependency (and asset), it should " + "be added to the transitive dependecies.",ImmutableSet.of(((NativeLibraryBuildable)prebuiltNativeLibraryBuild.getBuildable()).getLibraryPath()),transitiveDeps.nativeLibAssetsDirectories);
}
