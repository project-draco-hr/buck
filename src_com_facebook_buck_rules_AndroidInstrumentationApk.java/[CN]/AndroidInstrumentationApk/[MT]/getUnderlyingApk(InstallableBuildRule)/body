{
  if (rule instanceof AndroidBinaryRule) {
    return (AndroidBinaryRule)rule;
  }
 else   if (rule instanceof ApkGenrule) {
    return getUnderlyingApk(((ApkGenrule)rule).getInstallableBuildRule());
  }
 else {
    throw new IllegalStateException(rule.getFullyQualifiedName() + " must be backed by either an android_binary() or an apk_genrule()");
  }
}
