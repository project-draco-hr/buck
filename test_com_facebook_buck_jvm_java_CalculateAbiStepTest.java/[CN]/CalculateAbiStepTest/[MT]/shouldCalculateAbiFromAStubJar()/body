{
  Path outDir=temp.newFolder().toAbsolutePath();
  ProjectFilesystem filesystem=new ProjectFilesystem(outDir);
  Path directory=TestDataHelper.getTestDataDirectory(this);
  Path source=directory.resolve("prebuilt/junit.jar");
  Path binJar=Paths.get("source.jar");
  Files.copy(source,outDir.resolve(binJar));
  Path abiJar=outDir.resolve("abi.jar");
  ExecutionContext executionContext=TestExecutionContext.newInstance();
  FakeBuildableContext context=new FakeBuildableContext();
  new CalculateAbiStep(context,filesystem,binJar,abiJar).execute(executionContext);
  String expectedHash=filesystem.computeSha1(Paths.get("abi.jar")).getHash();
  ImmutableMap<String,Object> metadata=context.getRecordedMetadata();
  Object seenHash=metadata.get(AbiRule.ABI_KEY_ON_DISK_METADATA);
  assertEquals(expectedHash,seenHash);
  assertEquals("51787f5a1c004c81fb7fc893227787e0f266def1",seenHash);
}
