{
  return FluentIterable.from(getRecursiveRuleDependenciesOfType(rule,IosLibraryDescription.TYPE,XcodeNativeDescription.TYPE)).transform(new Function<BuildRule,PBXFileReference>(){
    @Override public PBXFileReference apply(    BuildRule input){
      if (input.getType().equals(IosLibraryDescription.TYPE)) {
        PBXNativeTarget target=(PBXNativeTarget)buildRuleToXcodeTarget.getUnchecked(input).get();
        return target.getProductReference();
      }
 else       if (input.getType().equals(XcodeNativeDescription.TYPE)) {
        XcodeNative xcodeNative=(XcodeNative)input.getBuildable();
        return project.getMainGroup().getOrCreateChildGroupByName("Frameworks").getOrCreateFileReferenceBySourceTreePath(new SourceTreePath(PBXReference.SourceTree.BUILT_PRODUCTS_DIR,Paths.get(xcodeNative.getProduct())));
      }
 else {
        throw new RuntimeException("Unexpected type: " + input.getType());
      }
    }
  }
).toSet();
}
