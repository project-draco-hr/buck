{
  String productName=getProductName(targetNode.getBuildTarget());
  String productOutputName;
  if (targetNode.getType().equals(AppleLibraryDescription.TYPE)) {
    String productOutputFormat=AppleBuildRules.getOutputFileNameFormatForLibrary(targetNode.getBuildTarget().getFlavors().contains(AppleLibraryDescription.DYNAMIC_LIBRARY));
    productOutputName=String.format(productOutputFormat,productName);
  }
 else   if (targetNode.getType().equals(AppleBundleDescription.TYPE)) {
    AppleBundleDescription.Arg arg=(AppleBundleDescription.Arg)targetNode.getConstructorArg();
    productOutputName=productName + "." + arg.getExtensionString();
  }
 else   if (targetNode.getType().equals(AppleBinaryDescription.TYPE)) {
    productOutputName=productName;
  }
 else {
    throw new RuntimeException("Unexpected type: " + targetNode.getType());
  }
  String productOutputRelativePath=Joiner.on('/').join(getBuiltProductsRelativeTargetOutputPath(targetNode),productOutputName);
  return new SourceTreePath(PBXReference.SourceTree.BUILT_PRODUCTS_DIR,Paths.get(productOutputRelativePath));
}
