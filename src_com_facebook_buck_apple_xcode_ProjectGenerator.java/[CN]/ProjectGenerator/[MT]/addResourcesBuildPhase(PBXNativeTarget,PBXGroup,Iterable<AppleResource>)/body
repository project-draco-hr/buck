{
  PBXGroup resourcesGroup=targetGroup.getOrCreateChildGroupByName("Resources");
  PBXBuildPhase phase=new PBXResourcesBuildPhase();
  target.getBuildPhases().add(phase);
  for (  AppleResource resource : resources) {
    Iterable<Path> paths=Iterables.concat(resolver.getAllPaths(resource.getFiles()),resource.getDirs());
    for (    Path path : paths) {
      PBXFileReference fileReference=resourcesGroup.getOrCreateFileReferenceBySourceTreePath(new SourceTreePath(PBXReference.SourceTree.SOURCE_ROOT,pathRelativizer.outputDirToRootRelative(path)));
      PBXBuildFile buildFile=new PBXBuildFile(fileReference);
      phase.getFiles().add(buildFile);
    }
    for (    String virtualOutputPath : resource.getVariants().keySet()) {
      ImmutableMap<String,SourcePath> contents=resource.getVariants().get(virtualOutputPath);
      String variantName=Paths.get(virtualOutputPath).getFileName().toString();
      PBXVariantGroup variantGroup=resourcesGroup.getOrCreateChildVariantGroupByName(variantName);
      PBXBuildFile buildFile=new PBXBuildFile(variantGroup);
      phase.getFiles().add(buildFile);
      for (      String childVirtualName : contents.keySet()) {
        SourceTreePath sourceTreePath=new SourceTreePath(PBXReference.SourceTree.SOURCE_ROOT,pathRelativizer.outputPathToSourcePath(contents.get(childVirtualName)));
        variantGroup.getOrCreateVariantFileReferenceByNameAndSourceTreePath(childVirtualName,sourceTreePath);
      }
    }
  }
  LOG.debug("Added resources build phase %s",phase);
}
