{
  PBXGroup sourcesGroup=targetGroup.getOrCreateChildGroupByName("Sources");
  sourcesGroup.setSortPolicy(PBXGroup.SortPolicy.UNSORTED);
  PBXSourcesBuildPhase sourcesBuildPhase=new PBXSourcesBuildPhase();
  PBXHeadersBuildPhase headersBuildPhase=new PBXHeadersBuildPhase();
  addGroupedSourcesToBuildPhases(sourcesGroup,sourcesBuildPhase,(useBuckHeaderMaps ? Optional.<PBXHeadersBuildPhase>absent() : Optional.of(headersBuildPhase)),groupedSources,sourceFlags);
  if (!sourcesBuildPhase.getFiles().isEmpty()) {
    target.getBuildPhases().add(sourcesBuildPhase);
  }
  if (!headersBuildPhase.getFiles().isEmpty()) {
    target.getBuildPhases().add(headersBuildPhase);
  }
  if (useBuckHeaderMaps) {
    HeaderMap.Builder publicMapBuilder=HeaderMap.builder();
    HeaderMap.Builder targetMapBuilder=HeaderMap.builder();
    HeaderMap.Builder targetUserMapBuilder=HeaderMap.builder();
    addGroupedSourcesToHeaderMaps(publicMapBuilder,targetMapBuilder,targetUserMapBuilder,Paths.get(headerPathPrefix.or(getProductName(buildRule.getBuildTarget()))),groupedSources,sourceFlags);
    writeHeaderMap(publicMapBuilder.build(),buildRule,HeaderMapType.PUBLIC_HEADER_MAP);
    writeHeaderMap(targetMapBuilder.build(),buildRule,HeaderMapType.TARGET_HEADER_MAP);
    writeHeaderMap(targetUserMapBuilder.build(),buildRule,HeaderMapType.TARGET_USER_HEADER_MAP);
  }
}
