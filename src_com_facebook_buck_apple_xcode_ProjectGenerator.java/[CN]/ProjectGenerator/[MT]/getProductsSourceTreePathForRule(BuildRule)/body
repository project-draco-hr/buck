{
  String productName=getProductName(rule.getBuildTarget());
  String productOutputName;
  if (rule.getType().equals(AppleLibraryDescription.TYPE)) {
    AppleLibrary library=(AppleLibrary)rule;
    String productOutputFormat=AppleLibrary.getOutputFileNameFormat(library.getLinkedDynamically());
    productOutputName=String.format(productOutputFormat,productName);
  }
 else   if (rule.getType().equals(AppleBundleDescription.TYPE)) {
    AppleBundle bundle=(AppleBundle)rule;
    productOutputName=productName + "." + bundle.getExtensionString();
  }
 else   if (rule.getType().equals(AppleBinaryDescription.TYPE)) {
    productOutputName=productName;
  }
 else {
    throw new RuntimeException("Unexpected type: " + rule.getType());
  }
  return new SourceTreePath(PBXReference.SourceTree.BUILT_PRODUCTS_DIR,Paths.get(productOutputName));
}
