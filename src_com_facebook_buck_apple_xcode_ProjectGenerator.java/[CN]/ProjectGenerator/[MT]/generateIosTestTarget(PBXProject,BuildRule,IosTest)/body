{
  PBXNativeTarget target=new PBXNativeTarget(getXcodeTargetName(rule));
  target.setProductType(PBXTarget.ProductType.IOS_TEST);
  PBXGroup targetGroup=project.getMainGroup().getOrCreateChildGroupByName(target.getName());
  Path infoPlistPath=this.repoRootRelativeToOutputDirectory.resolve(buildable.getInfoPlist());
  setTargetBuildConfigurations(rule.getBuildTarget(),target,targetGroup,buildable.getConfigurations(),ImmutableMap.of("INFOPLIST_FILE",infoPlistPath.toString()));
  addRunScriptBuildPhasesForDependencies(rule,target);
  addSourcesBuildPhase(target,targetGroup,buildable.getGroupedSrcs(),buildable.getPerFileCompilerFlags());
  addFrameworksBuildPhase(rule.getBuildTarget(),target,project.getMainGroup().getOrCreateChildGroupByName("Frameworks"),buildable.getFrameworks(),collectRecursiveLibraryDependencies(rule));
  addResourcesBuildPhase(target,targetGroup,collectRecursiveResources(rule));
  PBXGroup productsGroup=project.getMainGroup().getOrCreateChildGroupByName("Products");
  String productName=getProductName(rule.getBuildTarget());
  String productOutputName=productName + ".octest";
  PBXFileReference productReference=new PBXFileReference(productOutputName,productOutputName,PBXReference.SourceTree.BUILT_PRODUCTS_DIR);
  productsGroup.getChildren().add(productReference);
  target.setProductName(productName);
  target.setProductReference(productReference);
  project.getTargets().add(target);
  return target;
}
