{
  XcconfigStack.Builder builder=XcconfigStack.builder();
  for (  XcodeRuleConfiguration.Layer layer : configuration.getLayers()) {
switch (layer.getLayerType()) {
case FILE:
      builder.addSettingsFromFile(projectFilesystem,searchPaths,layer.getSourcePath().get().resolve());
    break;
case INLINE_SETTINGS:
  ImmutableMap<String,String> entries=layer.getInlineSettings().get();
for (ImmutableMap.Entry<String,String> entry : entries.entrySet()) {
  builder.addSetting(entry.getKey(),entry.getValue());
}
break;
}
builder.pushLayer();
}
for (ImmutableMap.Entry<String,String> entry : extra.entrySet()) {
builder.addSetting(entry.getKey(),entry.getValue());
}
builder.pushLayer();
XcconfigStack stack=builder.build();
ImmutableList<String> resolvedConfigs=stack.resolveConfigStack();
ImmutableSortedSet<String> sortedConfigs=ImmutableSortedSet.copyOf(resolvedConfigs);
StringBuilder stringBuilder=new StringBuilder();
stringBuilder.append("// This configuration is autogenerated.\n" + "// Re-run buck to update this file after modifying the hand-written configs.\n");
for (String line : sortedConfigs) {
stringBuilder.append(line);
stringBuilder.append('\n');
}
return stringBuilder.toString();
}
