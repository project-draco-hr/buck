{
  if (targetNode.getType().equals(AppleLibraryDescription.TYPE) || targetNode.getType().equals(AppleBundleDescription.TYPE)) {
    if (isBuiltByCurrentProject(targetNode.getBuildTarget())) {
      PBXNativeTarget target=(PBXNativeTarget)targetNodeToProjectTarget.getUnchecked(targetNode).get();
      return Preconditions.checkNotNull(target.getProductReference());
    }
 else {
      SourceTreePath productsPath=getProductsSourceTreePath(targetNode);
      return project.getMainGroup().getOrCreateChildGroupByName("Frameworks").getOrCreateFileReferenceBySourceTreePath(productsPath);
    }
  }
 else {
    throw new RuntimeException("Unexpected type: " + targetNode.getType());
  }
}
