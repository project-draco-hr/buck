{
  final ImmutableSet.Builder<BuildRule> buildRulesBuilder=ImmutableSet.builder();
  AbstractAcyclicDepthFirstPostOrderTraversal<BuildRule> allDependenciesTraversal=new AbstractAcyclicDepthFirstPostOrderTraversal<BuildRule>(){
    @Override protected Iterator<BuildRule> findChildren(    BuildRule node) throws IOException {
      return node.getDeps().iterator();
    }
    @Override protected void onNodeExplored(    BuildRule node){
    }
    @Override protected void onTraversalComplete(    Iterable<BuildRule> nodesInExplorationOrder){
      buildRulesBuilder.addAll(nodesInExplorationOrder);
    }
  }
;
  try {
    allDependenciesTraversal.traverse(initial);
  }
 catch (  AbstractAcyclicDepthFirstPostOrderTraversal.CycleException e) {
    throw new HumanReadableException(e,"Cycle detected while gathering build rule dependencies for project generation:\n " + e.getMessage());
  }
catch (  IOException e) {
    throw new RuntimeException(e);
  }
  return buildRulesBuilder.build();
}
