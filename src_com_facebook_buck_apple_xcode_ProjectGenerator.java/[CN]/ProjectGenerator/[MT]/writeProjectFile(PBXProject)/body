{
  Preconditions.checkNotNull(targetNameToGIDMap);
  XcodeprojSerializer serializer=new XcodeprojSerializer(new GidGenerator(ImmutableSet.copyOf(targetNameToGIDMap.values())),project);
  NSDictionary rootObject=serializer.toPlist();
  Path xcodeprojDir=outputDirectory.resolve(projectName + ".xcodeproj");
  projectFilesystem.mkdirs(xcodeprojDir);
  Path serializedProject=xcodeprojDir.resolve("project.pbxproj");
  String unsignedXmlProject=rootObject.toXMLPropertyList();
  Optional<String> signedXmlProject=SourceSigner.sign(unsignedXmlProject);
  String contentsToWrite;
  if (signedXmlProject.isPresent()) {
    contentsToWrite=signedXmlProject.get();
  }
 else {
    contentsToWrite=unsignedXmlProject;
  }
  if (shouldGenerateReadOnlyFiles()) {
    projectFilesystem.writeContentsToPath(contentsToWrite,serializedProject,READ_ONLY_FILE_ATTRIBUTE);
  }
 else {
    projectFilesystem.writeContentsToPath(contentsToWrite,serializedProject);
  }
  return xcodeprojDir;
}
