{
  if (rule.getType().equals(IosLibraryDescription.TYPE)) {
    if (isBuiltByCurrentProject(rule)) {
      PBXNativeTarget target=(PBXNativeTarget)buildRuleToXcodeTarget.getUnchecked(rule).get();
      return target.getProductReference();
    }
 else {
      IosLibrary library=(IosLibrary)rule;
      String productOutputFormat=IosLibrary.getOutputFileNameFormat(library.getLinkedDynamically());
      String productName=getProductName(rule.getBuildTarget());
      String productOutputName=String.format(productOutputFormat,productName);
      return project.getMainGroup().getOrCreateChildGroupByName("Frameworks").getOrCreateFileReferenceBySourceTreePath(new SourceTreePath(PBXReference.SourceTree.BUILT_PRODUCTS_DIR,Paths.get(productOutputName)));
    }
  }
 else   if (rule.getType().equals(XcodeNativeDescription.TYPE)) {
    XcodeNative nativeRule=(XcodeNative)rule;
    return project.getMainGroup().getOrCreateChildGroupByName("Frameworks").getOrCreateFileReferenceBySourceTreePath(new SourceTreePath(PBXReference.SourceTree.BUILT_PRODUCTS_DIR,Paths.get(nativeRule.getBuildableName())));
  }
 else {
    throw new RuntimeException("Unexpected type: " + rule.getType());
  }
}
