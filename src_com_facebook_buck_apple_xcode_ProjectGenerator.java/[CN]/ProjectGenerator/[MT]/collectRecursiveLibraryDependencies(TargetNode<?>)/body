{
  return FluentIterable.from(AppleBuildRules.getRecursiveTargetNodeDependenciesOfTypes(targetGraph,AppleBuildRules.RecursiveDependenciesMode.LINKING,targetNode,AppleLibraryDescription.TYPE,AppleBundleDescription.TYPE)).filter(new Predicate<TargetNode<?>>(){
    @Override public boolean apply(    TargetNode<?> input){
      if (input.getType().equals(AppleBundleDescription.TYPE)) {
        AppleBundleDescription.Arg arg=(AppleBundleDescription.Arg)input.getConstructorArg();
        return arg.extension.isLeft() && arg.extension.getLeft() == AppleBundleExtension.FRAMEWORK;
      }
 else {
        return true;
      }
    }
  }
).transform(new Function<TargetNode<?>,PBXFileReference>(){
    @Override public PBXFileReference apply(    TargetNode<?> input){
      return getLibraryFileReference(input);
    }
  }
).toSet();
}
