def decode_url(self, url):
    (target, _, headers, _) = self.translate_all(url)
    headers_fp = open(headers, 'rb')
    (code,) = struct.unpack('>h', headers_fp.read(2))

    def make_headers(fp):
        return (HTTPMessage(fp) if PY2 else parse_headers(fp))
    return addinfourl(open(target, 'rb'), make_headers(headers_fp), url, code)
