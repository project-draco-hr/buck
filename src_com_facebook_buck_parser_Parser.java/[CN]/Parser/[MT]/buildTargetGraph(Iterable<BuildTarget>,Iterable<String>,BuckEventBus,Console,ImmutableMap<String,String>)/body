{
  postParseStartEvent(buildTargets,eventBus);
  TargetGraph graph=null;
  try (ProjectBuildFileParser buildFileParser=buildFileParserFactory.createParser(defaultIncludes,console,environment,eventBus)){
    if (!isCacheComplete(defaultIncludes,environment)) {
      Set<Path> buildTargetFiles=Sets.newHashSet();
      for (      BuildTarget buildTarget : buildTargets) {
        Path buildFile=repository.getAbsolutePathToBuildFile(buildTarget);
        boolean isNewElement=buildTargetFiles.add(buildFile);
        if (isNewElement) {
          parseBuildFile(buildFile,defaultIncludes,buildFileParser,environment);
        }
      }
    }
    graph=buildTargetGraph(buildTargets,defaultIncludes,buildFileParser,environment);
    return graph;
  }
  finally {
    eventBus.post(ParseEvent.finished(buildTargets,Optional.fromNullable(graph)));
  }
}
