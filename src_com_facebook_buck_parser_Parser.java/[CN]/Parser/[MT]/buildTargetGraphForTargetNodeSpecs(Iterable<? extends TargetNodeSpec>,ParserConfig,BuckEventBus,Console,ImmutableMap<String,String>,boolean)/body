{
  TargetGraph graph=null;
  try (ProjectBuildFileParser buildFileParser=createBuildFileParser(console,environment,eventBus)){
    buildFileParser.setEnableProfiling(enableProfiling);
    ImmutableSet<BuildTarget> buildTargets=resolveTargetSpecs(targetNodeSpecs,parserConfig,buildFileParser,environment);
    ParseEvent.Started parseStart=postParseStartEvent(buildTargets,eventBus);
    try {
      graph=buildTargetGraph(buildTargets,parserConfig,buildFileParser,environment,eventBus);
      return new Pair<>(buildTargets,graph);
    }
  finally {
      eventBus.post(ParseEvent.finished(parseStart,Optional.fromNullable(graph)));
    }
  }
 }
