{
  TargetGraph graph=null;
  try (ProjectBuildFileParser buildFileParser=buildFileParserFactory.createParser(console,environment,eventBus)){
    buildFileParser.setEnableProfiling(enableProfiling);
    ImmutableSet<BuildTarget> buildTargets=resolveTargetSpecs(targetNodeSpecs,parserConfig,buildFileParser,environment);
    postParseStartEvent(buildTargets,eventBus);
    try {
      graph=buildTargetGraph(buildTargets,parserConfig,buildFileParser,environment,eventBus);
      return graph;
    }
  finally {
      eventBus.post(ParseEvent.finished(buildTargets,Optional.fromNullable(graph)));
    }
  }
 }
