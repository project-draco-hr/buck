{
  TargetGraph graph=null;
  try (BuildFileParsers buildFileParsers=new BuildFileParsers(marshaller,console,eventBus)){
    buildFileParsers.setEnableProfiling(enableProfiling);
    ProjectBuildFileParser buildFileParser=buildFileParsers.create(cell);
    ImmutableSet<BuildTarget> buildTargets=resolveTargetSpecs(targetNodeSpecs,parserConfig,buildFileParsers,environment);
    ParseEvent.Started parseStart=postParseStartEvent(buildTargets,eventBus);
    try {
      graph=buildTargetGraph(buildTargets,parserConfig,buildFileParser,environment,eventBus);
      return new Pair<>(buildTargets,graph);
    }
  finally {
      eventBus.post(ParseEvent.finished(parseStart,Optional.fromNullable(graph)));
    }
  }
 }
