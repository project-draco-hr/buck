{
  Preconditions.checkNotNull(filesystem);
  Preconditions.checkNotNull(includes);
  ProjectFilesystem projectFilesystem=repository.getFilesystem();
  if (!projectFilesystem.getProjectRoot().equals(filesystem.getProjectRoot())) {
    throw new HumanReadableException(String.format("Unsupported root path change from %s to %s",projectFilesystem.getProjectRoot(),filesystem.getProjectRoot()));
  }
  if (!isCacheComplete(includes,environment)) {
    memoizedTargetNodes.clear();
    parsedBuildFiles.clear();
    parseRawRulesInternal(ProjectBuildFileParser.getAllRulesInProject(buildFileParserFactory,includes,console,environment));
    allBuildFilesParsed=true;
  }
  return filterTargets(filter);
}
