{
  ProjectFilesystem projectFilesystem=repository.getFilesystem();
  if (!projectFilesystem.getRootPath().equals(filesystem.getRootPath())) {
    throw new HumanReadableException(String.format("Unsupported root path change from %s to %s",projectFilesystem.getRootPath(),filesystem.getRootPath()));
  }
  return FluentIterable.from(buildTargetGraphForTargetNodeSpecs(ImmutableList.of(TargetNodePredicateSpec.of(filter,BuildFileSpec.fromRecursivePath(Paths.get(""),filesystem.getIgnorePaths()))),parserConfig,buckEventBus,console,environment,enableProfiling).getSecond().getNodes()).filter(filter).transform(HasBuildTarget.TO_TARGET).toSet();
}
