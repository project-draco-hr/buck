{
  ProjectFilesystem projectFilesystem=repository.getFilesystem();
  if (!projectFilesystem.getRootPath().equals(filesystem.getRootPath())) {
    throw new HumanReadableException(String.format("Unsupported root path change from %s to %s",projectFilesystem.getRootPath(),filesystem.getRootPath()));
  }
  return FluentIterable.from(buildTargetGraphForTargetNodeSpecs(ImmutableList.of(new TargetNodePredicateSpec(filter,filesystem.getIgnorePaths())),parserConfig,buckEventBus,console,environment,enableProfiling).getNodes()).filter(filter).transform(HasBuildTarget.TO_TARGET).toSet();
}
