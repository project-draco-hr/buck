{
  postParseStartEvent(buildTargets,eventBus);
  ActionGraph graph=null;
  try (ProjectBuildFileParser buildFileParser=buildFileParserFactory.createParser(defaultIncludes,EnumSet.of(ProjectBuildFileParser.Option.STRIP_NULL),console,environment)){
    if (!isCacheComplete(defaultIncludes)) {
      Set<File> buildTargetFiles=Sets.newHashSet();
      for (      BuildTarget buildTarget : buildTargets) {
        File buildFile=buildTarget.getBuildFile(projectFilesystem);
        boolean isNewElement=buildTargetFiles.add(buildFile);
        if (isNewElement) {
          parseBuildFile(buildFile,defaultIncludes,buildFileParser);
        }
      }
    }
    graph=findAllTransitiveDependencies(buildTargets,defaultIncludes,buildFileParser);
    return graph;
  }
  finally {
    eventBus.post(ParseEvent.finished(buildTargets,Optional.fromNullable(graph)));
  }
}
