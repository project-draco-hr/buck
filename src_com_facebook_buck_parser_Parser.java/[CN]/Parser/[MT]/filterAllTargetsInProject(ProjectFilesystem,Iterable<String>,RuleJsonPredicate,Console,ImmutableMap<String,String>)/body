{
  Preconditions.checkNotNull(filesystem);
  Preconditions.checkNotNull(includes);
  ProjectFilesystem projectFilesystem=repository.getFilesystem();
  if (!projectFilesystem.getRootPath().equals(filesystem.getRootPath())) {
    throw new HumanReadableException(String.format("Unsupported root path change from %s to %s",projectFilesystem.getRootPath(),filesystem.getRootPath()));
  }
  if (!isCacheComplete(includes,environment)) {
    state.invalidateAll();
    parseRawRulesInternal(ProjectBuildFileParser.getAllRulesInProject(buildFileParserFactory,includes,console,environment));
    allBuildFilesParsed=true;
  }
  return filterTargets(filter);
}
