{
  PrintStream output=null;
  if (context.getVerbosity().shouldUseVerbosityFlagIfAvailable()) {
    output=context.getStdOut();
  }
  ProjectFilesystem projectFilesystem=context.getProjectFilesystem();
  try {
    ApkBuilder builder=new ApkBuilder(projectFilesystem.getFileForRelativePath(pathToOutputApkFile),projectFilesystem.getFileForRelativePath(resourceApk),projectFilesystem.getFileForRelativePath(dexFile),null,output);
    builder.setDebugMode(debugMode);
    for (    String nativeLibraryDirectory : nativeLibraryDirectories) {
      builder.addNativeLibraries(projectFilesystem.getFileForRelativePath(nativeLibraryDirectory));
    }
    for (    String assetDirectory : assetDirectories) {
      builder.addSourceFolder(projectFilesystem.getFileForRelativePath(assetDirectory));
    }
    for (    String zipFile : zipFiles) {
      File zipFileOnDisk=projectFilesystem.getFileForRelativePath(zipFile);
      if (zipFileOnDisk.exists() && zipFileOnDisk.isFile()) {
        builder.addZipFile(zipFileOnDisk);
      }
    }
    builder.sealApk();
  }
 catch (  ApkCreationException e) {
    throw new HumanReadableException(e.getMessage());
  }
catch (  DuplicateFileException e) {
    throw new HumanReadableException(String.format("Found duplicate file for APK: %1$s\nOrigin 1: %2$s\nOrigin 2: %3$s",e.getArchivePath(),e.getFile1(),e.getFile2()));
  }
catch (  SealedApkException e) {
    throw new HumanReadableException(e.getMessage());
  }
  return 0;
}
