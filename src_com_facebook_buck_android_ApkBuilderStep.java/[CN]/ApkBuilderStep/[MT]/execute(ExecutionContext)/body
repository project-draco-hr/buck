{
  PrintStream output=null;
  if (context.getVerbosity().shouldUseVerbosityFlagIfAvailable()) {
    output=context.getStdOut();
  }
  ProjectFilesystem projectFilesystem=context.getProjectFilesystem();
  try {
    PrivateKeyAndCertificate privateKeyAndCertificate=createKeystoreProperties(context);
    ApkBuilder builder=new ApkBuilder(projectFilesystem.getPathForRelativePath(pathToOutputApkFile).toFile(),projectFilesystem.getPathForRelativePath(resourceApk).toFile(),projectFilesystem.getPathForRelativePath(dexFile).toFile(),privateKeyAndCertificate.privateKey,privateKeyAndCertificate.certificate,output);
    builder.setDebugMode(debugMode);
    for (    Path nativeLibraryDirectory : nativeLibraryDirectories) {
      builder.addNativeLibraries(projectFilesystem.getPathForRelativePath(nativeLibraryDirectory).toFile());
    }
    for (    Path assetDirectory : assetDirectories) {
      builder.addSourceFolder(projectFilesystem.getPathForRelativePath(assetDirectory).toFile());
    }
    for (    Path zipFile : zipFiles) {
      if (projectFilesystem.exists(zipFile) && projectFilesystem.isFile(zipFile)) {
        builder.addZipFile(projectFilesystem.getPathForRelativePath(zipFile).toFile());
      }
    }
    for (    Path jarFileThatMayContainResources : jarFilesThatMayContainResources) {
      Path jarFile=projectFilesystem.getPathForRelativePath(jarFileThatMayContainResources);
      builder.addResourcesFromJar(jarFile.toFile());
    }
    builder.sealApk();
  }
 catch (  ApkCreationException|CertificateException|IOException|KeyStoreException|NoSuchAlgorithmException|SealedApkException|UnrecoverableKeyException e) {
    context.logError(e,"Error when creating APK at: %s.",pathToOutputApkFile);
    Throwables.propagateIfInstanceOf(e,IOException.class);
    return 1;
  }
catch (  DuplicateFileException e) {
    throw new HumanReadableException(String.format("Found duplicate file for APK: %1$s\nOrigin 1: %2$s\nOrigin 2: %3$s",e.getArchivePath(),e.getFile1(),e.getFile2()));
  }
  return 0;
}
