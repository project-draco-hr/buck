{
  CreateBuildRequest createTimeRequest=new CreateBuildRequest();
  createTimeRequest.setCreateTimestampMillis(System.currentTimeMillis());
  FrontendRequest request=new FrontendRequest();
  request.setType(FrontendRequestType.CREATE_BUILD);
  request.setCreateBuildRequest(createTimeRequest);
  FrontendResponse response=new FrontendResponse();
  service.makeRequest(request,response);
  Preconditions.checkState(response.getType().equals(FrontendRequestType.CREATE_BUILD));
  BuildJob job=response.getCreateBuildResponse().getBuildJob();
  final BuildId id=job.getBuildId();
  LOG.info("Created job. Build id = " + id.getId());
  logDebugInfo(job);
  StartBuildRequest startRequest=new StartBuildRequest();
  startRequest.setBuildId(id);
  request.clear();
  request.setType(FrontendRequestType.START_BUILD);
  request.setStartBuildRequest(startRequest);
  response.clear();
  service.makeRequest(request,response);
  Preconditions.checkState(response.getType().equals(FrontendRequestType.START_BUILD));
  job=response.getStartBuildResponse().getBuildJob();
  Preconditions.checkState(job.getBuildId().equals(id));
  LOG.info("Started job. Build status: " + job.getStatus().toString());
  logDebugInfo(job);
  BuildStatusRequest statusRequest=new BuildStatusRequest();
  statusRequest.setBuildId(id);
  request.clear();
  request.setType(FrontendRequestType.BUILD_STATUS);
  request.setBuildStatusRequest(statusRequest);
  Stopwatch stopwatch=Stopwatch.createStarted();
  do {
    response.clear();
    service.makeRequest(request,response);
    Preconditions.checkState(response.getType().equals(FrontendRequestType.BUILD_STATUS));
    job=response.getBuildStatusResponse().getBuildJob();
    Preconditions.checkState(job.getBuildId().equals(id));
    LOG.info("Got build status: " + job.getStatus().toString());
    DistBuildStatus distBuildStatus=prepareStatusFromJob(job).setETAMillis(MAX_BUILD_DURATION_MILLIS - stopwatch.elapsed(TimeUnit.MILLISECONDS)).build();
    eventBus.post(new DistBuildStatusEvent(distBuildStatus));
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException e) {
      LOG.error(e,"BuildStatus polling sleep call has been interrupted unexpectedly.");
    }
  }
 while (!(job.getStatus().equals(BuildStatus.FINISHED_SUCCESSFULLY) || job.getStatus().equals(BuildStatus.FAILED)));
  LOG.info("Build was " + (response.isWasSuccessful() ? "" : "not ") + "successful!");
  if (response.isSetErrorMessage()) {
    LOG.error("Error msg: " + response.getErrorMessage());
  }
  logDebugInfo(job);
  DistBuildStatus distBuildStatus=prepareStatusFromJob(job).setETAMillis(0).build();
  eventBus.post(new DistBuildStatusEvent(distBuildStatus));
}
