{
  if (expected == null || observed == null) {
    assertEquals(userMessage,expected,observed);
    return;
  }
  Iterator<?> expectedIter=expected.iterator();
  Iterator<?> observedIter=observed.iterator();
  int index=0;
  while (expectedIter.hasNext()) {
    if (!observedIter.hasNext()) {
      fail(prefixWithUserMessage(userMessage,"Item " + index + " does not exist in the "+ "observed list: "+ expectedIter.next()));
    }
    Object expectedItem=expectedIter.next();
    Object observedItem=observedIter.next();
    assertEquals(prefixWithUserMessage(userMessage,"Item " + index + " in the lists should match."),expectedItem,observedItem);
    ++index;
  }
  if (observedIter.hasNext()) {
    fail(prefixWithUserMessage(userMessage,"Extraneous item %s in the observed list: %s.",index,observedIter.next()));
  }
}
