{
  ImmutableSet.Builder<String> srcDirectories=ImmutableSet.builder();
  ImmutableSet.Builder<Path> pathsToClasses=ImmutableSet.builder();
  for (  JavaLibrary rule : rulesUnderTest) {
    ImmutableSet<String> sourceFolderPath=getPathToSourceFolders(rule,defaultJavaPackageFinderOptional,filesystem);
    if (!sourceFolderPath.isEmpty()) {
      srcDirectories.addAll(sourceFolderPath);
    }
    Path pathToOutput=rule.getPathToOutput();
    if (pathToOutput == null) {
      continue;
    }
    pathsToClasses.add(pathToOutput);
  }
  return new GenerateCodeCoverageReportStep(javaRuntimeLauncher,filesystem,srcDirectories.build(),pathsToClasses.build(),outputDirectory,format,title);
}
