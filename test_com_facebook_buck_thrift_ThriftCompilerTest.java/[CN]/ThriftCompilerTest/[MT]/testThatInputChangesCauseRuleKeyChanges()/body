{
  SourcePathResolver resolver=new SourcePathResolver(new BuildRuleResolver());
  BuildTarget target=BuildTargetFactory.newInstance("//foo:bar");
  BuildRuleParams params=BuildRuleParamsFactory.createTrivialBuildRuleParams(target);
  RuleKeyBuilderFactory ruleKeyBuilderFactory=new FakeRuleKeyBuilderFactory(FakeFileHashCache.createFromStrings(ImmutableMap.of("thrift",Strings.repeat("a",40),"test.thrift",Strings.repeat("b",40),"different",Strings.repeat("c",40),"something.thrift",Strings.repeat("d",40),"blah/something.thrift",Strings.repeat("e",40))));
  RuleKey.Builder.RuleKeyPair defaultRuleKey=generateRuleKey(ruleKeyBuilderFactory,new ThriftCompiler(params,resolver,DEFAULT_COMPILER,DEFAULT_FLAGS,DEFAULT_OUTPUT_DIR,DEFAULT_INPUT,DEFAULT_LANGUAGE,DEFAULT_OPTIONS,DEFAULT_INCLUDE_ROOTS,DEFAULT_INCLUDES));
  RuleKey.Builder.RuleKeyPair compilerChange=generateRuleKey(ruleKeyBuilderFactory,new ThriftCompiler(params,resolver,new TestSourcePath("different"),DEFAULT_FLAGS,DEFAULT_OUTPUT_DIR,DEFAULT_INPUT,DEFAULT_LANGUAGE,DEFAULT_OPTIONS,DEFAULT_INCLUDE_ROOTS,DEFAULT_INCLUDES));
  assertNotEquals(defaultRuleKey.getTotalRuleKey(),compilerChange.getTotalRuleKey());
  RuleKey.Builder.RuleKeyPair flagsChange=generateRuleKey(ruleKeyBuilderFactory,new ThriftCompiler(params,resolver,DEFAULT_COMPILER,ImmutableList.of("--different"),DEFAULT_OUTPUT_DIR,DEFAULT_INPUT,DEFAULT_LANGUAGE,DEFAULT_OPTIONS,DEFAULT_INCLUDE_ROOTS,DEFAULT_INCLUDES));
  assertNotEquals(defaultRuleKey.getTotalRuleKey(),flagsChange.getTotalRuleKey());
  RuleKey.Builder.RuleKeyPair outputDirChange=generateRuleKey(ruleKeyBuilderFactory,new ThriftCompiler(params,resolver,DEFAULT_COMPILER,DEFAULT_FLAGS,Paths.get("different-dir"),DEFAULT_INPUT,DEFAULT_LANGUAGE,DEFAULT_OPTIONS,DEFAULT_INCLUDE_ROOTS,DEFAULT_INCLUDES));
  assertNotEquals(defaultRuleKey.getTotalRuleKey(),outputDirChange.getTotalRuleKey());
  RuleKey.Builder.RuleKeyPair inputChange=generateRuleKey(ruleKeyBuilderFactory,new ThriftCompiler(params,resolver,DEFAULT_COMPILER,DEFAULT_FLAGS,DEFAULT_OUTPUT_DIR,new TestSourcePath("different"),DEFAULT_LANGUAGE,DEFAULT_OPTIONS,DEFAULT_INCLUDE_ROOTS,DEFAULT_INCLUDES));
  assertNotEquals(defaultRuleKey.getTotalRuleKey(),inputChange.getTotalRuleKey());
  RuleKey.Builder.RuleKeyPair languageChange=generateRuleKey(ruleKeyBuilderFactory,new ThriftCompiler(params,resolver,DEFAULT_COMPILER,DEFAULT_FLAGS,DEFAULT_OUTPUT_DIR,DEFAULT_INPUT,"different",DEFAULT_OPTIONS,DEFAULT_INCLUDE_ROOTS,DEFAULT_INCLUDES));
  assertNotEquals(defaultRuleKey.getTotalRuleKey(),languageChange.getTotalRuleKey());
  RuleKey.Builder.RuleKeyPair optionsChange=generateRuleKey(ruleKeyBuilderFactory,new ThriftCompiler(params,resolver,DEFAULT_COMPILER,DEFAULT_FLAGS,DEFAULT_OUTPUT_DIR,DEFAULT_INPUT,DEFAULT_LANGUAGE,ImmutableSet.of("different"),DEFAULT_INCLUDE_ROOTS,DEFAULT_INCLUDES));
  assertNotEquals(defaultRuleKey.getTotalRuleKey(),optionsChange.getTotalRuleKey());
  RuleKey.Builder.RuleKeyPair includeRootsChange=generateRuleKey(ruleKeyBuilderFactory,new ThriftCompiler(params,resolver,DEFAULT_COMPILER,DEFAULT_FLAGS,DEFAULT_OUTPUT_DIR,DEFAULT_INPUT,DEFAULT_LANGUAGE,DEFAULT_OPTIONS,ImmutableList.of(Paths.get("different")),DEFAULT_INCLUDES));
  assertEquals(defaultRuleKey.getTotalRuleKey(),includeRootsChange.getTotalRuleKey());
  RuleKey.Builder.RuleKeyPair includesKeyChange=generateRuleKey(ruleKeyBuilderFactory,new ThriftCompiler(params,resolver,DEFAULT_COMPILER,DEFAULT_FLAGS,DEFAULT_OUTPUT_DIR,DEFAULT_INPUT,DEFAULT_LANGUAGE,DEFAULT_OPTIONS,DEFAULT_INCLUDE_ROOTS,ImmutableMap.<Path,SourcePath>of(DEFAULT_INCLUDES.entrySet().iterator().next().getKey(),new TestSourcePath("different"))));
  assertNotEquals(defaultRuleKey.getTotalRuleKey(),includesKeyChange.getTotalRuleKey());
  RuleKey.Builder.RuleKeyPair includesValueChange=generateRuleKey(ruleKeyBuilderFactory,new ThriftCompiler(params,resolver,DEFAULT_COMPILER,DEFAULT_FLAGS,DEFAULT_OUTPUT_DIR,DEFAULT_INPUT,DEFAULT_LANGUAGE,DEFAULT_OPTIONS,DEFAULT_INCLUDE_ROOTS,ImmutableMap.of(Paths.get("different"),DEFAULT_INCLUDES.entrySet().iterator().next().getValue())));
  assertNotEquals(defaultRuleKey.getTotalRuleKey(),includesValueChange.getTotalRuleKey());
}
