{
  SourcePathResolver resolver=new SourcePathResolver(new BuildRuleResolver());
  BuildTarget target=BuildTargetFactory.newInstance("//foo:bar");
  RuleKeyBuilderFactory ruleKeyBuilderFactory=new DefaultRuleKeyBuilderFactory(FakeFileHashCache.createFromStrings(ImmutableMap.of("blah/something.thrift",Strings.repeat("e",40),"different",Strings.repeat("c",40),"something.thrift",Strings.repeat("d",40),"thrift",Strings.repeat("a",40),"test.thrift",Strings.repeat("b",40))),resolver);
  BuildRuleParams params=new FakeBuildRuleParamsBuilder(target).build();
  RuleKey defaultRuleKey=ruleKeyBuilderFactory.build(new ThriftCompiler(params,resolver,DEFAULT_COMPILER,DEFAULT_FLAGS,DEFAULT_OUTPUT_DIR,DEFAULT_INPUT,DEFAULT_LANGUAGE,DEFAULT_OPTIONS,DEFAULT_INCLUDE_ROOTS,DEFAULT_HEADER_MAPS,DEFAULT_INCLUDES,DEFAULT_GENERATED_SOURCES));
  RuleKey compilerChange=ruleKeyBuilderFactory.build(new ThriftCompiler(params,resolver,new CommandTool.Builder().addArg(new TestSourcePath("different")).build(),DEFAULT_FLAGS,DEFAULT_OUTPUT_DIR,DEFAULT_INPUT,DEFAULT_LANGUAGE,DEFAULT_OPTIONS,DEFAULT_INCLUDE_ROOTS,DEFAULT_HEADER_MAPS,DEFAULT_INCLUDES,DEFAULT_GENERATED_SOURCES));
  assertNotEquals(defaultRuleKey,compilerChange);
  RuleKey flagsChange=ruleKeyBuilderFactory.build(new ThriftCompiler(params,resolver,DEFAULT_COMPILER,ImmutableList.of("--different"),DEFAULT_OUTPUT_DIR,DEFAULT_INPUT,DEFAULT_LANGUAGE,DEFAULT_OPTIONS,DEFAULT_INCLUDE_ROOTS,DEFAULT_HEADER_MAPS,DEFAULT_INCLUDES,DEFAULT_GENERATED_SOURCES));
  assertNotEquals(defaultRuleKey,flagsChange);
  RuleKey outputDirChange=ruleKeyBuilderFactory.build(new ThriftCompiler(params,resolver,DEFAULT_COMPILER,DEFAULT_FLAGS,Paths.get("different-dir"),DEFAULT_INPUT,DEFAULT_LANGUAGE,DEFAULT_OPTIONS,DEFAULT_INCLUDE_ROOTS,DEFAULT_HEADER_MAPS,DEFAULT_INCLUDES,DEFAULT_GENERATED_SOURCES));
  assertNotEquals(defaultRuleKey,outputDirChange);
  RuleKey inputChange=ruleKeyBuilderFactory.build(new ThriftCompiler(params,resolver,DEFAULT_COMPILER,DEFAULT_FLAGS,DEFAULT_OUTPUT_DIR,new TestSourcePath("different"),DEFAULT_LANGUAGE,DEFAULT_OPTIONS,DEFAULT_INCLUDE_ROOTS,DEFAULT_HEADER_MAPS,DEFAULT_INCLUDES,DEFAULT_GENERATED_SOURCES));
  assertNotEquals(defaultRuleKey,inputChange);
  RuleKey languageChange=ruleKeyBuilderFactory.build(new ThriftCompiler(params,resolver,DEFAULT_COMPILER,DEFAULT_FLAGS,DEFAULT_OUTPUT_DIR,DEFAULT_INPUT,"different",DEFAULT_OPTIONS,DEFAULT_INCLUDE_ROOTS,DEFAULT_HEADER_MAPS,DEFAULT_INCLUDES,DEFAULT_GENERATED_SOURCES));
  assertNotEquals(defaultRuleKey,languageChange);
  RuleKey optionsChange=ruleKeyBuilderFactory.build(new ThriftCompiler(params,resolver,DEFAULT_COMPILER,DEFAULT_FLAGS,DEFAULT_OUTPUT_DIR,DEFAULT_INPUT,DEFAULT_LANGUAGE,ImmutableSet.of("different"),DEFAULT_INCLUDE_ROOTS,DEFAULT_HEADER_MAPS,DEFAULT_INCLUDES,DEFAULT_GENERATED_SOURCES));
  assertNotEquals(defaultRuleKey,optionsChange);
  RuleKey includeRootsChange=ruleKeyBuilderFactory.build(new ThriftCompiler(params,resolver,DEFAULT_COMPILER,DEFAULT_FLAGS,DEFAULT_OUTPUT_DIR,DEFAULT_INPUT,DEFAULT_LANGUAGE,DEFAULT_OPTIONS,ImmutableList.of(Paths.get("different")),DEFAULT_HEADER_MAPS,DEFAULT_INCLUDES,DEFAULT_GENERATED_SOURCES));
  assertEquals(defaultRuleKey,includeRootsChange);
  RuleKey headerMapKeyChange=ruleKeyBuilderFactory.build(new ThriftCompiler(params,resolver,DEFAULT_COMPILER,DEFAULT_FLAGS,DEFAULT_OUTPUT_DIR,DEFAULT_INPUT,DEFAULT_LANGUAGE,DEFAULT_OPTIONS,DEFAULT_INCLUDE_ROOTS,ImmutableSet.of(Paths.get("different-header-map")),DEFAULT_INCLUDES,DEFAULT_GENERATED_SOURCES));
  assertEquals(defaultRuleKey,headerMapKeyChange);
  RuleKey includesKeyChange=ruleKeyBuilderFactory.build(new ThriftCompiler(params,resolver,DEFAULT_COMPILER,DEFAULT_FLAGS,DEFAULT_OUTPUT_DIR,DEFAULT_INPUT,DEFAULT_LANGUAGE,DEFAULT_OPTIONS,DEFAULT_INCLUDE_ROOTS,DEFAULT_HEADER_MAPS,ImmutableMap.<Path,SourcePath>of(DEFAULT_INCLUDES.entrySet().iterator().next().getKey(),new TestSourcePath("different")),DEFAULT_GENERATED_SOURCES));
  assertNotEquals(defaultRuleKey,includesKeyChange);
  RuleKey includesValueChange=ruleKeyBuilderFactory.build(new ThriftCompiler(params,resolver,DEFAULT_COMPILER,DEFAULT_FLAGS,DEFAULT_OUTPUT_DIR,DEFAULT_INPUT,DEFAULT_LANGUAGE,DEFAULT_OPTIONS,DEFAULT_INCLUDE_ROOTS,DEFAULT_HEADER_MAPS,ImmutableMap.of(Paths.get("different"),DEFAULT_INCLUDES.entrySet().iterator().next().getValue()),DEFAULT_GENERATED_SOURCES));
  assertNotEquals(defaultRuleKey,includesValueChange);
}
