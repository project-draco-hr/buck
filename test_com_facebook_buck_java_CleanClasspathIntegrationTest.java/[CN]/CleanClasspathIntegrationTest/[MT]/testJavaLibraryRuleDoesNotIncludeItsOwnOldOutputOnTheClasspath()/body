{
  ProjectWorkspace workspace=TestDataHelper.createProjectWorkspaceForScenario(this,"classpath_corruption_regression",tmp);
  workspace.setUp();
  ProcessResult processResult1=workspace.runBuckCommand("build","//:example");
  processResult1.assertSuccess();
  assertTrue("example.jar should be written. This should not be on the classpath on the next build.",Files.isRegularFile(workspace.getPath("buck-out/gen/lib__example__output/example.jar")));
  Path buildFile=workspace.getPath("BUCK");
  String newBuildFileContents=Joiner.on('\n').join("java_library(","  name = 'example',","  srcs = [ 'Foo.java' ], ",")");
  Files.write(buildFile,newBuildFileContents.getBytes(StandardCharsets.UTF_8));
  ProcessResult processResult2=workspace.runBuckCommand("build","//:example");
  processResult2.assertFailure("Build should fail because Foo.java depends on Bar.java.");
}
