{
  if (operation != CxxPreprocessAndCompileStep.Operation.COMPILE || preprocessBuildRule.operation != CxxPreprocessAndCompileStep.Operation.PREPROCESS) {
    throw new HumanReadableException("%s is not preprocess rule or %s is not compile rule.",preprocessBuildRule,this);
  }
  ImmutableList.Builder<String> cmd=ImmutableList.builder();
  cmd.addAll(compiler.getCommandPrefix(getResolver()));
  cmd.add("-x",preprocessBuildRule.inputType.getLanguage());
  cmd.add("-c");
  cmd.addAll(preprocessBuildRule.getCommandSuffix());
  cmd.addAll(getCommandSuffix());
  cmd.add("-o",output.toString());
  cmd.add(getResolver().getPath(preprocessBuildRule.input).toString());
  return cmd.build();
}
