{
  if (!operation.isCompile() || !preprocessBuildRule.operation.isPreprocess()) {
    throw new HumanReadableException("%s is not preprocess rule or %s is not compile rule.",preprocessBuildRule,this);
  }
  ImmutableList.Builder<String> cmd=ImmutableList.builder();
  cmd.addAll(compiler.get().getCommandPrefix(getResolver()));
  cmd.addAll(preprocessBuildRule.getPreprocessorPlatformPrefix());
  cmd.addAll(getCompilerPlatformPrefix());
  cmd.addAll(preprocessBuildRule.getPreprocessorSuffix());
  cmd.addAll(getCompilerSuffix());
  cmd.add("-x",preprocessBuildRule.inputType.getLanguage());
  cmd.add("-c");
  cmd.add("-o",output.toString());
  cmd.add(getResolver().deprecatedGetPath(preprocessBuildRule.input).toString());
  return cmd.build();
}
