{
  SourcePathResolver pathResolver=new SourcePathResolver(new BuildRuleResolver());
  BuildTarget target=BuildTargetFactory.newInstance("//foo:bar");
  BuildRuleParams params=BuildRuleParamsFactory.createTrivialBuildRuleParams(target);
  String soname="soname";
  ImmutableList<String> sonameArgs=ImmutableList.copyOf(CxxLinkableEnhancer.iXlinker(CXX_PLATFORM.getLd().soname(soname)));
  CxxLink executable=CxxLinkableEnhancer.createCxxLinkableBuildRule(CXX_PLATFORM,params,pathResolver,ImmutableList.<String>of(),ImmutableList.<String>of(),target,Linker.LinkType.EXECUTABLE,Optional.<String>absent(),DEFAULT_OUTPUT,DEFAULT_INPUTS,Linker.LinkableDepType.STATIC,ImmutableSortedSet.<BuildRule>of(),Optional.<Linker.CxxRuntimeType>absent());
  assertFalse(executable.getArgs().contains("-shared"));
  assertEquals(Collections.indexOfSubList(executable.getArgs(),sonameArgs),-1);
  CxxLink shared=CxxLinkableEnhancer.createCxxLinkableBuildRule(CXX_PLATFORM,params,pathResolver,ImmutableList.<String>of(),ImmutableList.<String>of(),target,Linker.LinkType.SHARED,Optional.<String>absent(),DEFAULT_OUTPUT,DEFAULT_INPUTS,Linker.LinkableDepType.STATIC,ImmutableSortedSet.<BuildRule>of(),Optional.<Linker.CxxRuntimeType>absent());
  assertTrue(shared.getArgs().contains("-shared"));
  assertEquals(Collections.indexOfSubList(shared.getArgs(),sonameArgs),-1);
  CxxLink sharedWithSoname=CxxLinkableEnhancer.createCxxLinkableBuildRule(CXX_PLATFORM,params,pathResolver,ImmutableList.<String>of(),ImmutableList.<String>of(),target,Linker.LinkType.SHARED,Optional.of("soname"),DEFAULT_OUTPUT,DEFAULT_INPUTS,Linker.LinkableDepType.STATIC,ImmutableSortedSet.<BuildRule>of(),Optional.<Linker.CxxRuntimeType>absent());
  assertTrue(sharedWithSoname.getArgs().contains("-shared"));
  assertNotEquals(Collections.indexOfSubList(sharedWithSoname.getArgs(),sonameArgs),-1);
}
