{
  try {
    Predicate<String> requiredInPrimaryZip=createRequiredInPrimaryZipPredicate(context);
    ZipSplitterFactory zipSplitterFactory;
    if (useLinearAllocSplitDex) {
      zipSplitterFactory=new LinearAllocAwareZipSplitterFactory(linearAllocHardLimit);
    }
 else {
      zipSplitterFactory=new DefaultZipSplitterFactory(ZIP_SIZE_SOFT_LIMIT,ZIP_SIZE_HARD_LIMIT);
    }
    ProjectFilesystem projectFilesystem=context.getProjectFilesystem();
    File primaryJarFile=new File(primaryJarPath);
    Collection<File> secondaryZips=zipSplitterFactory.newInstance(ImmutableSet.copyOf(Paths.transformPathToFile(inputPathsToSplit)),primaryJarFile,new File(secondaryJarDir),secondaryJarPattern,requiredInPrimaryZip,dexSplitStrategy,ZipSplitter.CanaryStrategy.INCLUDE_CANARIES,projectFilesystem.getFileForRelativePath(pathToReportDir)).execute();
    BufferedWriter secondaryMetaInfoWriter=Files.newWriter(new File(secondaryJarMetaPath),Charsets.UTF_8);
    try {
      writeMetaList(secondaryMetaInfoWriter,secondaryZips,dexStore);
    }
  finally {
      secondaryMetaInfoWriter.close();
    }
    return 0;
  }
 catch (  IOException e) {
    e.printStackTrace(context.getStdErr());
    return 1;
  }
}
