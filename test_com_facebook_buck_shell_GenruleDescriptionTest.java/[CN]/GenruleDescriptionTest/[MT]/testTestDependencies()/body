{
  BuildRuleResolver ruleResolver=new BuildRuleResolver(TargetGraph.EMPTY,new BuildTargetNodeToBuildRuleTransformer());
  BuildRule shTest=new ShTestBuilder(BuildTargetFactory.newInstance("//:test")).setTest(new FakeSourcePath("test.sh")).setArgs(ImmutableList.of("$(location //:rule)")).build(ruleResolver);
  Genrule genrule=(Genrule)GenruleBuilder.newGenruleBuilder(BuildTargetFactory.newInstance("//:rule")).setOut("out").setCmd("build.sh").setTests(ImmutableSortedSet.of(shTest.getBuildTarget())).build(ruleResolver);
  assertThat(genrule.getTests(),Matchers.containsInAnyOrder(shTest.getBuildTarget()));
}
