{
  Optional<Map.Entry<Flavor,Type>> type;
  Optional<AppleDebugFormat> flavoredDebugInfoFormat;
  try {
    type=LIBRARY_TYPE.getFlavorAndValue(ImmutableSet.copyOf(params.getBuildTarget().getFlavors()));
    flavoredDebugInfoFormat=AppleDebugFormat.FLAVOR_DOMAIN.getValue(ImmutableSet.copyOf(params.getBuildTarget().getFlavors()));
  }
 catch (  FlavorDomainException e) {
    throw new HumanReadableException("%s: %s",params.getBuildTarget(),e.getMessage());
  }
  if (type.isPresent() && type.get().getValue().isFramework()) {
    if (!args.infoPlist.isPresent()) {
      throw new HumanReadableException("Cannot create framework for apple_library '%s':\n","No value specified for 'info_plist' attribute.",params.getBuildTarget().getUnflavoredBuildTarget());
    }
    Optional<DependencyMode> dependencyMode=type.get().getValue().getDependencyMode();
    if (!dependencyMode.isPresent()) {
      throw new RuntimeException(String.format("Invalid framework type '%s', missing dependency mode.",type.get().getValue()));
    }
    return AppleDescriptions.createAppleBundle(cxxPlatformFlavorDomain,defaultCxxPlatform,platformFlavorsToAppleCxxPlatforms,targetGraph,params,resolver,codeSignIdentityStore,provisioningProfileStore,params.getBuildTarget(),Either.<AppleBundleExtension,String>ofLeft(AppleBundleExtension.FRAMEWORK),Optional.<String>absent(),args.infoPlist.get(),args.infoPlistSubstitutions,args.deps.get(),args.getTests(),flavoredDebugInfoFormat.or(debugInfoFormat));
  }
  return createBuildRule(params,resolver,args,args.linkStyle,Optional.<SourcePath>absent(),ImmutableSet.<BuildTarget>of());
}
