{
  ProcessExecutorParams.Builder builder=ProcessExecutorParams.builder();
  File workDir=getFinalWorkingDirectory(context);
  builder.setCommand(getShellCommand(context));
  Map<String,String> environment=Maps.newHashMap();
  setProcessEnvironment(context,environment,workDir);
  builder.setEnvironment(environment);
  builder.setDirectory(workDir);
  Optional<String> stdin=getStdin(context);
  if (stdin.isPresent()) {
    builder.setRedirectInput(ProcessBuilder.Redirect.PIPE);
  }
  int exitCode;
  try {
    startTime=System.currentTimeMillis();
    exitCode=launchAndInteractWithProcess(context,builder.build());
  }
 catch (  IOException e) {
    e.printStackTrace(context.getStdErr());
    exitCode=1;
  }
  endTime=System.currentTimeMillis();
  return exitCode;
}
