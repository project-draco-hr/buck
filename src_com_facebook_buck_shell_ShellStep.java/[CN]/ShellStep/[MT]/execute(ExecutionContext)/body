{
  ProcessBuilder processBuilder=new ProcessBuilder(getShellCommand(context));
  setProcessEnvironment(context,processBuilder.environment());
  if (workingDirectory != null) {
    processBuilder.directory(workingDirectory);
  }
 else {
    processBuilder.directory(context.getProjectDirectoryRoot());
  }
  Optional<String> stdin=getStdin();
  if (stdin.isPresent()) {
    processBuilder.redirectInput(ProcessBuilder.Redirect.PIPE);
  }
  Process process;
  int exitCode;
  try {
    startTime=System.currentTimeMillis();
    process=processBuilder.start();
    exitCode=interactWithProcess(context,process);
  }
 catch (  IOException e) {
    e.printStackTrace(context.getStdErr());
    exitCode=1;
  }
  endTime=System.currentTimeMillis();
  onProcessFinished(exitCode);
  return exitCode;
}
