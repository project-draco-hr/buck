{
  ImmutableProcessExecutorParams.Builder builder=ImmutableProcessExecutorParams.builder();
  builder.setCommand(getShellCommand(context));
  Map<String,String> environment=Maps.newHashMap();
  setProcessEnvironment(context,environment);
  builder.setEnvironment(environment);
  if (workingDirectory != null) {
    builder.setDirectory(workingDirectory);
  }
 else {
    builder.setDirectory(context.getProjectDirectoryRoot().toAbsolutePath().toFile());
  }
  Optional<String> stdin=getStdin(context);
  if (stdin.isPresent()) {
    builder.setRedirectInput(ProcessBuilder.Redirect.PIPE);
  }
  int exitCode;
  try {
    startTime=System.currentTimeMillis();
    exitCode=launchAndInteractWithProcess(context,builder.build());
  }
 catch (  IOException e) {
    e.printStackTrace(context.getStdErr());
    exitCode=1;
  }
  endTime=System.currentTimeMillis();
  return exitCode;
}
