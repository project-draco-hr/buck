{
  try {
    setup(context);
  }
 catch (  IOException e) {
    e.printStackTrace(context.getStdErr());
    return 1;
  }
  ProcessBuilder processBuilder=new ProcessBuilder(getShellCommand(context));
  if (!getEnvironmentVariables(context).isEmpty()) {
    Map<String,String> environment=processBuilder.environment();
    environment.putAll(getEnvironmentVariables(context));
  }
  if (workingDirectory != null) {
    processBuilder.directory(workingDirectory);
  }
 else {
    processBuilder.directory(context.getProjectDirectoryRoot());
  }
  Process process;
  try {
    startTime=System.currentTimeMillis();
    process=processBuilder.start();
  }
 catch (  IOException e) {
    e.printStackTrace(context.getStdErr());
    return 1;
  }
  int exitCode=interactWithProcess(context,process);
  endTime=System.currentTimeMillis();
  return exitCode;
}
