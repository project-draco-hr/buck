{
  assumeTrue(Platform.detect() == Platform.MACOS);
  ProjectWorkspace workspace=TestDataHelper.createProjectWorkspaceForScenario(this,"apple_test_xctest",tmp);
  workspace.setUp();
  workspace.copyRecursively(TestDataHelper.getTestDataDirectory(this).resolve("xctool"),Paths.get("xctool"));
  workspace.runBuckCommand("test","--config","apple.xctool_path=xctool/bin/xctool","//:foo").assertSuccess("normally the test should succeed");
  workspace.resetBuildLogFile();
  workspace.runBuckCommand("test","--config","apple.xctool_path=xctool/bin/xctool","--test-runner-env","DYLD_INSERT_LIBRARIES=/non_existent_library_omg.dylib","//:foo").assertTestFailure("test should fail if i set incorrect dyld environment");
}
