{
  Set<BuildRule> allDeps=Sets.newHashSet();
  Set<BuildRule> seen=Sets.newHashSet();
  LinkedList<BuildRule> queue=new LinkedList<>();
  queue.add(rootBuildRule);
  while (!queue.isEmpty()) {
    BuildRule node=queue.remove();
    allDeps.add(node);
    for (    BuildRule child : node.getDeps()) {
      if (seen.add(child)) {
        queue.add(child);
      }
    }
  }
  return ImmutableSet.copyOf(allDeps);
}
