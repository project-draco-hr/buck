{
  ActionGraphCache cache=new ActionGraphCache();
  ActionGraphAndResolver resultRun1=cache.getActionGraph(eventBus,CHECK_GRAPHS,targetGraph,0);
  ImmutableList<Counter> counters=cache.getCounters();
  assertEquals(((IntegerCounter)counters.get(CACHE_HIT_COUNTER_INDEX)).get(),0);
  assertEquals(((IntegerCounter)counters.get(CACHE_MISS_COUNTER_INDEX)).get(),1);
  ActionGraphAndResolver resultRun2=cache.getActionGraph(eventBus,CHECK_GRAPHS,targetGraph.getSubgraph(ImmutableSet.of(nodeB)),0);
  counters=cache.getCounters();
  assertEquals(((IntegerCounter)counters.get(CACHE_HIT_COUNTER_INDEX)).get(),0);
  assertEquals(((IntegerCounter)counters.get(CACHE_MISS_COUNTER_INDEX)).get(),2);
  ActionGraphAndResolver resultRun3=cache.getActionGraph(eventBus,CHECK_GRAPHS,targetGraph,0);
  counters=cache.getCounters();
  assertEquals(((IntegerCounter)counters.get(CACHE_HIT_COUNTER_INDEX)).get(),0);
  assertEquals(((IntegerCounter)counters.get(CACHE_MISS_COUNTER_INDEX)).get(),3);
  Map<BuildRule,RuleKey> resultRun1RuleKeys=getRuleKeysFromBuildRules(resultRun1.getActionGraph().getNodes(),resultRun1.getResolver());
  Map<BuildRule,RuleKey> resultRun2RuleKeys=getRuleKeysFromBuildRules(resultRun2.getActionGraph().getNodes(),resultRun2.getResolver());
  Map<BuildRule,RuleKey> resultRun3RuleKeys=getRuleKeysFromBuildRules(resultRun3.getActionGraph().getNodes(),resultRun3.getResolver());
  assertThat(resultRun1RuleKeys,Matchers.not(Matchers.equalTo(resultRun2RuleKeys)));
  assertThat(resultRun1RuleKeys,Matchers.equalTo(resultRun3RuleKeys));
}
