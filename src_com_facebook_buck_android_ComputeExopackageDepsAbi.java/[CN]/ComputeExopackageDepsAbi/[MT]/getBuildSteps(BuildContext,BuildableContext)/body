{
  return ImmutableList.<Step>of(new AbstractExecutionStep("compute_android_binary_deps_abi"){
    @Override public int execute(    ExecutionContext context){
      try {
        ProjectFilesystem filesystem=context.getProjectFilesystem();
        final Hasher hasher=Hashing.sha1().newHasher();
        hasher.putUnencodedChars(aaptPackageResources.getResourcePackageHash().toString());
        hasher.putUnencodedChars(preDexMerge.get().getPrimaryDexHash().toString());
        if (packageStringAssets.isPresent()) {
          hasher.putUnencodedChars(packageStringAssets.get().getStringAssetsZipHash().toString());
        }
        ImmutableSortedMap.Builder<Path,String> filesToHash=ImmutableSortedMap.naturalOrder();
        for (        final Path libDir : packageableCollection.nativeLibsDirectories) {
          for (          Path nativeFile : filesystem.getFilesUnderPath(libDir)) {
            filesToHash.put(nativeFile,"native_lib");
          }
        }
        for (        final Path libDir : packageableCollection.nativeLibAssetsDirectories) {
          for (          Path nativeFile : filesystem.getFilesUnderPath(libDir)) {
            filesToHash.put(nativeFile,"native_lib_as_asset");
          }
        }
        for (        Path jar : packageableCollection.pathsToThirdPartyJars) {
          filesToHash.put(jar,"third-party jar");
        }
        filesToHash.put(keystore.getPathToStore(),"keystore");
        filesToHash.put(keystore.getPathToPropertiesFile(),"keystore properties");
        for (        Map.Entry<Path,String> entry : filesToHash.build().entrySet()) {
          Path path=entry.getKey();
          hasher.putUnencodedChars(path.toString());
          hasher.putByte((byte)0);
          hasher.putUnencodedChars(filesystem.computeSha1(path));
          hasher.putByte((byte)0);
          hasher.putUnencodedChars(entry.getValue());
          hasher.putByte((byte)0);
        }
        buildableContext.addMetadata(METADATA_KEY,hasher.hash().toString());
        return 0;
      }
 catch (      IOException e) {
        context.logError(e,"Error computing ABI hash.");
        return 1;
      }
    }
  }
);
}
