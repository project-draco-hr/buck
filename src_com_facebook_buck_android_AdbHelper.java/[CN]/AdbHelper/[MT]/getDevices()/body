{
  AndroidDebugBridge adb=createAdb(context);
  if (adb == null) {
    console.printBuildFailure("Failed to create adb connection.");
    return null;
  }
  List<IDevice> devices=filterDevices(adb.getDevices());
  if (devices == null && restartAdbOnFailure) {
    console.printErrorText("No devices found with adb, restarting adb-server.");
    adb.restart();
    devices=filterDevices(adb.getDevices());
  }
  return devices;
}
