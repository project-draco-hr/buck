{
  int sz=size();
  if (sz == 0) {
    return this;
  }
  RegisterSpecList result=new RegisterSpecList(sz);
  for (int i=0; i < sz; i++) {
    RegisterSpec one=(RegisterSpec)get0(i);
    boolean replace=(compatRegs == null) ? true : !compatRegs.get(i);
    if (replace) {
      result.set0(i,one.withReg(base));
      if (!duplicateFirst) {
        base+=one.getCategory();
      }
    }
 else {
      result.set0(i,one);
    }
    if (duplicateFirst) {
      duplicateFirst=false;
    }
  }
  if (isImmutable()) {
    result.setImmutable();
  }
  return result;
}
