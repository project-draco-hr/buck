{
  ProjectFilesystem filesystem=context.getProjectFilesystem();
  File inputDirectory=filesystem.getFileForRelativePath(inputDirectoryPath);
  Preconditions.checkState(inputDirectory.exists() && inputDirectory.isDirectory(),"%s must be a directory.",inputDirectoryPath);
  try {
    ImmutableMap.Builder<File,ZipEntry> zipEntriesBuilder=ImmutableMap.builder();
    addDirectoryToZipEntryList(inputDirectory,"",zipEntriesBuilder);
    ImmutableMap<File,ZipEntry> zipEntries=zipEntriesBuilder.build();
    if (!zipEntries.isEmpty()) {
      File outputZipFile=filesystem.getFileForRelativePath(outputZipPath);
      try (CustomZipOutputStream outputStream=ZipOutputStreams.newOutputStream(outputZipFile)){
        for (        Map.Entry<File,ZipEntry> zipEntry : zipEntries.entrySet()) {
          outputStream.putNextEntry(zipEntry.getValue());
          Files.asByteSource(zipEntry.getKey()).copyTo(outputStream);
          outputStream.closeEntry();
        }
      }
     }
  }
 catch (  IOException e) {
    e.printStackTrace(context.getStdErr());
    return 1;
  }
  return 0;
}
