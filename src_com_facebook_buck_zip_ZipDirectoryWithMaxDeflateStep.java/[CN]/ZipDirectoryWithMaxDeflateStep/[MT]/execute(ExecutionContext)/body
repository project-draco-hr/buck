{
  File inputDirectory=new File(inputDirectoryPath);
  Preconditions.checkState(inputDirectory.exists() && inputDirectory.isDirectory(),"%s must be a directory.",inputDirectoryPath);
  try {
    ImmutableMap.Builder<File,ZipEntry> zipEntriesBuilder=ImmutableMap.builder();
    addDirectoryToZipEntryList(inputDirectory,"",zipEntriesBuilder);
    ImmutableMap<File,ZipEntry> zipEntries=zipEntriesBuilder.build();
    if (!zipEntries.isEmpty()) {
      try (CustomZipOutputStream outputStream=ZipOutputStreams.newOutputStream(new File(outputZipPath))){
        for (        Map.Entry<File,ZipEntry> zipEntry : zipEntries.entrySet()) {
          outputStream.putNextEntry(zipEntry.getValue());
          ByteStreams.copy(Files.newInputStreamSupplier(zipEntry.getKey()),outputStream);
          outputStream.closeEntry();
        }
      }
     }
  }
 catch (  IOException e) {
    e.printStackTrace(context.getStdErr());
    return 1;
  }
  return 0;
}
