{
  Preconditions.checkNotNull(currentPath);
  for (  File inputFile : directory.listFiles()) {
    String childPath=currentPath + (currentPath.isEmpty() ? "" : "/") + inputFile.getName();
    if (inputFile.isDirectory()) {
      addDirectoryToZipEntryList(inputFile,childPath,zipEntriesBuilder);
    }
 else {
      ZipEntry nextEntry=new ZipEntry(childPath);
      long fileLength=inputFile.length();
      if (fileLength > maxDeflatedBytes || EXTENSIONS_NOT_TO_DEFLATE.contains(Files.getFileExtension(inputFile.getName()))) {
        nextEntry.setMethod(ZipEntry.STORED);
        nextEntry.setCompressedSize(inputFile.length());
        nextEntry.setSize(inputFile.length());
        HashCode crc=ByteStreams.hash(Files.newInputStreamSupplier(inputFile),Hashing.crc32());
        nextEntry.setCrc(crc.padToLong());
      }
      zipEntriesBuilder.put(inputFile,nextEntry);
    }
  }
}
