{
  ProjectWorkspace workspace=TestDataHelper.createProjectWorkspaceForScenario(this,"ocaml",tmp);
  workspace.setUp();
  BuildTarget target=BuildTargetFactory.newInstance("//clib:clib");
  BuildTarget binary=createOCamlLinkTarget(target);
  BuildTarget libplus=BuildTargetFactory.newInstance("//clib:plus");
  BuildTarget libplusStatic=createStaticLibraryBuildTarget(libplus);
  BuildTarget cclib=BuildTargetFactory.newInstance("//clib:cc");
  DefaultCxxPlatform cxxPlatform=new DefaultCxxPlatform(new FakeBuckConfig());
  BuildTarget cclibbin=CxxDescriptionEnhancer.createStaticLibraryBuildTarget(cclib,cxxPlatform.asFlavor());
  String sourceName="cc.cpp";
  BuildTarget ccObj=CxxCompilableEnhancer.createCompileBuildTarget(cclib,cxxPlatform.asFlavor(),sourceName,false);
  BuildTarget headerSymlinkTreeTarget=CxxDescriptionEnhancer.createHeaderSymlinkTreeTarget(cclib,cxxPlatform.asFlavor());
  ImmutableSet<BuildTarget> targets=ImmutableSet.of(target,binary,libplus,libplusStatic,cclib,cclibbin,ccObj,headerSymlinkTreeTarget);
  workspace.runBuckCommand("build",target.toString()).assertSuccess();
  BuckBuildLog buildLog=workspace.getBuildLog();
  assertTrue(buildLog.getAllTargets().containsAll(targets));
  buildLog.assertTargetBuiltLocally(target.toString());
  buildLog.assertTargetBuiltLocally(binary.toString());
  buildLog.assertTargetBuiltLocally(libplus.toString());
  buildLog.assertTargetBuiltLocally(libplusStatic.toString());
  buildLog.assertTargetBuiltLocally(cclibbin.toString());
  buildLog.assertTargetBuiltLocally(ccObj.toString());
  buildLog.assertTargetBuiltLocally(headerSymlinkTreeTarget.toString());
  workspace.resetBuildLogFile();
  workspace.runBuckCommand("build",target.toString()).assertSuccess();
  buildLog=workspace.getBuildLog();
  assertTrue(buildLog.getAllTargets().containsAll(targets));
  buildLog.assertTargetHadMatchingRuleKey(target.toString());
  buildLog.assertTargetHadMatchingRuleKey(binary.toString());
  buildLog.assertTargetHadMatchingRuleKey(libplus.toString());
  buildLog.assertTargetHadMatchingRuleKey(libplusStatic.toString());
  buildLog.assertTargetHadMatchingRuleKey(cclibbin.toString());
  buildLog.assertTargetHadMatchingRuleKey(ccObj.toString());
  buildLog.assertTargetHadMatchingRuleKey(headerSymlinkTreeTarget.toString());
  workspace.resetBuildLogFile();
  workspace.replaceFileContents("clib/cc/cc.cpp","Hi there","hi there");
  workspace.runBuckCommand("build",target.toString()).assertSuccess();
  buildLog=workspace.getBuildLog();
  assertTrue(buildLog.getAllTargets().containsAll(targets));
  buildLog.assertTargetBuiltLocally(target.toString());
  buildLog.assertTargetBuiltLocally(binary.toString());
  buildLog.assertTargetBuiltLocally(libplus.toString());
  buildLog.assertTargetBuiltLocally(libplusStatic.toString());
  buildLog.assertTargetBuiltLocally(cclibbin.toString());
  buildLog.assertTargetBuiltLocally(ccObj.toString());
  buildLog.assertTargetHadMatchingRuleKey(headerSymlinkTreeTarget.toString());
}
