{
  ProjectWorkspace workspace=TestDataHelper.createProjectWorkspaceForScenario(this,"ocaml",tmp);
  workspace.setUp();
  BuildTarget target=BuildTargetFactory.newInstance("//hello_ocaml:hello_ocaml");
  BuildTarget binary=createOCamlLinkTarget(target);
  BuildTarget lib=BuildTargetFactory.newInstance("//hello_ocaml:ocamllib");
  BuildTarget staticLib=createStaticLibraryBuildTarget(lib);
  ImmutableSet<BuildTarget> targets=ImmutableSet.of(target,binary,lib,staticLib);
  workspace.runBuckCommand("build",target.toString()).assertSuccess();
  BuckBuildLog buildLog=workspace.getBuildLog();
  assertTrue(buildLog.getAllTargets().containsAll(targets));
  buildLog.assertTargetBuiltLocally(target.toString());
  buildLog.assertTargetBuiltLocally(staticLib.toString());
  workspace.resetBuildLogFile();
  workspace.runBuckCommand("build",target.toString()).assertSuccess();
  buildLog=workspace.getBuildLog();
  assertTrue(buildLog.getAllTargets().containsAll(targets));
  buildLog.assertTargetHadMatchingRuleKey(target.toString());
  buildLog.assertTargetHadMatchingRuleKey(staticLib.toString());
  workspace.resetBuildLogFile();
  workspace.replaceFileContents("hello_ocaml/amodule.ml","v2","v3");
  workspace.runBuckCommand("build",target.toString()).assertSuccess();
  buildLog=workspace.getBuildLog();
  assertTrue(buildLog.getAllTargets().containsAll(targets));
  buildLog.assertTargetBuiltLocally(target.toString());
  buildLog.assertTargetHadMatchingRuleKey(staticLib.toString());
  workspace.resetBuildLogFile();
  workspace.replaceFileContents("hello_ocaml/ocamllib/m1.ml","print me","print Me");
  workspace.runBuckCommand("build",target.toString()).assertSuccess();
  buildLog=workspace.getBuildLog();
  assertTrue(buildLog.getAllTargets().containsAll(targets));
  buildLog.assertTargetBuiltLocally(target.toString());
  buildLog.assertTargetBuiltLocally(staticLib.toString());
  workspace.resetBuildLogFile();
  workspace.replaceFileContents("hello_ocaml/BUCK","#INSERT_POINT","'ocamllib/dummy.ml',");
  workspace.runBuckCommand("build",target.toString()).assertSuccess();
  buildLog=workspace.getBuildLog();
  assertTrue(buildLog.getAllTargets().containsAll(targets));
  buildLog.assertTargetBuiltLocally(target.toString());
  buildLog.assertTargetBuiltLocally(staticLib.toString());
  workspace.resetBuildLogFile();
  BuildTarget lib1=BuildTargetFactory.newInstance("//hello_ocaml:ocamllib1");
  BuildTarget staticLib1=createStaticLibraryBuildTarget(lib1);
  ImmutableSet<BuildTarget> targets1=ImmutableSet.of(target,binary,lib1,staticLib1);
  workspace.replaceFileContents("hello_ocaml/BUCK","name = 'ocamllib'","name = 'ocamllib1'");
  workspace.replaceFileContents("hello_ocaml/BUCK",":ocamllib",":ocamllib1");
  workspace.runBuckCommand("build",target.toString()).assertSuccess();
  buildLog=workspace.getBuildLog();
  assertTrue(buildLog.getAllTargets().containsAll(targets1));
  buildLog.assertTargetBuiltLocally(target.toString());
  buildLog.assertTargetBuiltLocally(staticLib1.toString());
}
