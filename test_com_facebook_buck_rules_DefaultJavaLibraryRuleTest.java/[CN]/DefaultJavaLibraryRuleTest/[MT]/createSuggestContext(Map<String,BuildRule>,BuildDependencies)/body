{
  DependencyGraph graph=RuleMap.createGraphFromBuildRules(ImmutableMap.copyOf(buildRuleIndex));
  BuildContext context=EasyMock.createMock(BuildContext.class);
  EasyMock.expect(context.getDependencyGraph()).andReturn(graph);
  EasyMock.expectLastCall().anyTimes();
  EasyMock.expect(context.getBuildDependencies()).andReturn(buildDependencies).anyTimes();
  EasyMock.replay(context);
  return context;
}
