{
  ImmutableList.Builder<Path> toolSearchPathsBuilder=ImmutableList.builder();
  toolSearchPathsBuilder.add(sdkPaths.getSdkPath().resolve(USR_BIN)).add(sdkPaths.getPlatformPath().resolve("Developer").resolve(USR_BIN));
  for (  Path toolchainPath : sdkPaths.getToolchainPaths()) {
    toolSearchPathsBuilder.add(toolchainPath.resolve(USR_BIN));
  }
  ImmutableList<Path> toolSearchPaths=toolSearchPathsBuilder.build();
  ImmutableList.Builder<String> cflagsBuilder=ImmutableList.builder();
  cflagsBuilder.add("-isysroot",sdkPaths.getSdkPath().toString());
  cflagsBuilder.add("-arch",targetArchitecture);
switch (targetPlatform.getName()) {
case ApplePlatform.Name.IPHONEOS:
    cflagsBuilder.add("-mios-version-min=" + targetVersion);
  break;
case ApplePlatform.Name.IPHONESIMULATOR:
cflagsBuilder.add("-mios-simulator-version-min=" + targetVersion);
break;
default :
cflagsBuilder.add("-m" + targetPlatform.getName() + "-version-min="+ targetVersion);
break;
}
ImmutableList<String> cflags=cflagsBuilder.build();
String xcodeAndSdkVersion=Joiner.on(':').join(xcodeVersion,targetSdkName);
Tool clangPath=new VersionedTool(getToolPath("clang",toolSearchPaths,executableFinder),cflags,"apple-clang",xcodeAndSdkVersion);
Tool clangXxPath=new VersionedTool(getToolPath("clang++",toolSearchPaths,executableFinder),cflags,"apple-clang++",xcodeAndSdkVersion);
Tool ar=new VersionedTool(getToolPath("ar",toolSearchPaths,executableFinder),ImmutableList.<String>of(),"apple-ar",xcodeAndSdkVersion);
CxxBuckConfig config=new CxxBuckConfig(buckConfig);
ImmutableFlavor targetFlavor=ImmutableFlavor.of(ImmutableFlavor.replaceInvalidCharacters(targetSdkName + "-" + targetArchitecture));
return CxxPlatforms.build(targetFlavor,Platform.MACOS,config,clangPath,clangPath,clangPath,clangXxPath,clangPath,clangXxPath,clangXxPath,Optional.of(CxxPlatform.LinkerType.DARWIN),clangXxPath,ar,"!<arch>\n".getBytes(Charsets.US_ASCII),getOptionalTool("lex",toolSearchPaths,executableFinder,xcodeAndSdkVersion),getOptionalTool("yacc",toolSearchPaths,executableFinder,xcodeAndSdkVersion));
}
