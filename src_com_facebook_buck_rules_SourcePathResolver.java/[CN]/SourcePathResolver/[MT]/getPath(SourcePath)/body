{
  if (sourcePath instanceof PathSourcePath) {
    return ((PathSourcePath)sourcePath).getRelativePath();
  }
  Preconditions.checkArgument(sourcePath instanceof BuildTargetSourcePath);
  BuildTargetSourcePath buildTargetSourcePath=(BuildTargetSourcePath)sourcePath;
  Optional<Path> resolvedPath=buildTargetSourcePath.getResolvedPath();
  if (resolvedPath.isPresent()) {
    return resolvedPath.get();
  }
  Path path=ruleResolver.getRule(buildTargetSourcePath.getTarget()).getPathToOutput();
  if (path == null) {
    throw new HumanReadableException("No known output for: %s",buildTargetSourcePath.getTarget());
  }
  return path;
}
