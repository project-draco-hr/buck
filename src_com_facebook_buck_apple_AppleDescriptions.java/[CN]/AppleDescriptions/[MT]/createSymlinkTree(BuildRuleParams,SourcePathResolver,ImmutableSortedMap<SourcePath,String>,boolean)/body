{
  Map<Path,SourcePath> headersToCopy;
  if (useBuckHeaderMaps) {
    headersToCopy=ImmutableSortedMap.of();
  }
 else {
    Path headerPathPrefix=params.getBuildTarget().getBasePath().getFileName();
    headersToCopy=Maps.newHashMap();
    for (    Map.Entry<SourcePath,String> entry : perFileFlags.entrySet()) {
      String flags=entry.getValue();
      if (isPublicHeader(flags)) {
        SourcePath sourcePath=entry.getKey();
        Path sourcePathName=pathResolver.getPath(sourcePath).getFileName();
        headersToCopy.put(headerPathPrefix.resolve(sourcePathName),sourcePath);
      }
    }
  }
  BuildRuleParams headerParams=params.copyWithDeps(Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>of()),Suppliers.ofInstance(params.getExtraDeps()));
  Path root=getPathToHeaders(params.getBuildTarget());
  return new SymlinkTree(headerParams,pathResolver,root,ImmutableMap.copyOf(headersToCopy));
}
