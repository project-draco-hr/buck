{
  Preconditions.checkNotNull(command);
  ProcessBuilder processBuilder=new ProcessBuilder(command);
  processBuilder.directory(workingDirectory);
  for (  ImmutableMap.Entry<String,String> entry : environment.entrySet()) {
    processBuilder.environment().put(entry.getKey(),entry.getValue());
  }
  try {
    Process process=processBuilder.start();
    int exitCode;
    Future<String> stdoutFuture=readStream(process.getInputStream());
    Future<String> stderrFuture=readStream(process.getErrorStream());
    exitCode=process.waitFor();
    stdout=stdoutFuture.get();
    stderr=stderrFuture.get();
    return exitCode;
  }
 catch (  IOException e) {
    LOG.error(e);
  }
catch (  ExecutionException e) {
    LOG.error(e);
  }
catch (  InterruptedException e) {
    LOG.error(e);
  }
  return -1;
}
