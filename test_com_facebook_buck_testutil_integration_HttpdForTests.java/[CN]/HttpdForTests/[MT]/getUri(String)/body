{
  assertTrue("Server must be running before retrieving a URI, otherwise the resulting URI may " + "not have an appropriate port",isRunning.get());
  URI baseUri;
  try {
    baseUri=server.getURI();
  }
 catch (  Exception e) {
    baseUri=null;
  }
  if (baseUri == null) {
    for (    Connector connector : server.getConnectors()) {
      if (connector instanceof NetworkConnector) {
        return new URI("http://localhost:" + ((NetworkConnector)connector).getLocalPort());
      }
    }
    throw new RuntimeException("Unable to determine URL of localhost.");
  }
  return new URI(baseUri.getScheme(),null,baseUri.getHost(),baseUri.getPort(),path,null,null);
}
