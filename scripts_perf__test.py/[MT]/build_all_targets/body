def build_all_targets(args, cwd, perftest_side, cache_mode, run_clean=True, dir_cache_only=True, log_as_perftest=True):
    set_perftest_side(args, cwd, perftest_side, cache_mode, dir_cache_only=dir_cache_only)
    result = {}
    for target in args.targets_to_build:
        if run_clean:
            buck_clean(args, cwd)
        result[target] = buck_build_target(args, cwd, target, perftest_side, log_as_perftest=log_as_perftest)
    return result
